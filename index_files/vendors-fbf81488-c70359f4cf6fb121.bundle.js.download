!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="5c8a9e00-5d9d-4b8d-a0bc-a0ee47725b76",e._sentryDebugIdIdentifier="sentry-dbid-5c8a9e00-5d9d-4b8d-a0bc-a0ee47725b76")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"03c050f83997f8f858284f712ef0b0ca3dc661b2"},(self.webpackChunkdisco=self.webpackChunkdisco||[]).push([[4362],{304783:function(e,t,a){a.d(t,{a:function(){return l},f:function(){return s}});var s,n=a(254568),r=a(840708),o=a(388671);!function(e){e.CAM="camera",e.MIC="microphone"}(s||(s={}));const i={audio:s.MIC,video:s.CAM};class l{constructor({mediaType:e}){this.state=new o.X(void 0),this.status=new o.X(void 0),this.error=new r.x,this.changeSubscriptions=[],this.name=i[e]}get isWatching(){return this.changeSubscriptions.some((e=>!e.closed))}async watch(){if(!this.status.value&&(await this.check(),!this.status.value))return;const e=this.status.value,t=e=>{const{state:t}=e.target;this.state.next(t)};e.addEventListener("change",t),this.changeSubscriptions.push(new n.w((()=>{e.removeEventListener("change",t)})))}unwatch(){this.changeSubscriptions.forEach((e=>e.unsubscribe()))}async check(){if(!this.name)return void this.error.next(new Error("Unknown media recording permission"));let e;try{const t=await navigator.permissions.query({name:this.name});e=t.state,this.status.next(t)}catch(t){e="granted"}this.state.next(e)}}},255926:function(e,t,a){a.d(t,{j_:function(){return k},vJ:function(){return x},hX:function(){return R}});var s=a(986027),n=a.n(s),r=a(900373),o=a(388671),i=a(840708),l=a(720586),c=a(425108);const d={analyserConfig:{fftSize:32,maxDecibels:0,minDecibels:-100},sampleCount:100,samplingFrequencyMs:60};var u;!function(e){e.CLOSED="closed",e.RECORDING="recording",e.STOPPED="stopped"}(u||(u={}));class m{constructor({config:e,stream:t}){this.amplitudes=new o.X([]),this.state=new o.X(void 0),this.error=new i.x,this.start=()=>{if(this.state.value!==u.CLOSED){if(!this.stream)throw new Error("Missing MediaStream instance. Cannot to start amplitude recording");if(this.state.value===u.RECORDING&&this.stop(),!this.analyserNode){if(!this.stream)return;this.init()}this.state.next(u.RECORDING),this.amplitudeSamplingInterval=setInterval((()=>{if(!this.analyserNode||this.state.value!==u.RECORDING)return;const e=new Uint8Array(this.analyserNode.frequencyBinCount);try{this.analyserNode.getByteFrequencyData(e)}catch(e){return(e=>{e&&c.error("[AMPLITUDE RECORDER ERROR]",e)})(e),void this.error.next(e)}const t=(a=e,Math.sqrt(a.reduce(((e,t)=>e+Math.pow(t,2)),0)/a.length)/255);var a;this.amplitudes.next([...this.amplitudes.value,t])}),this.config.samplingFrequencyMs)}},this.config=(0,l.o)({...e},d),this.stream=t}init(){this.audioContext=new AudioContext,this.analyserNode=this.audioContext.createAnalyser();const{analyserConfig:e}=this.config;this.analyserNode.fftSize=e.fftSize,this.analyserNode.maxDecibels=e.maxDecibels,this.analyserNode.minDecibels=e.minDecibels,this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.microphone.connect(this.analyserNode)}stop(){clearInterval(this.amplitudeSamplingInterval),this.amplitudeSamplingInterval=void 0,this.state.next(u.STOPPED)}close(){this.state.value!==u.STOPPED&&this.stop(),this.state.next(u.CLOSED),this.amplitudes.next([]),this.microphone?.disconnect(),this.analyserNode?.disconnect(),"closed"!==this.audioContext?.state&&this.audioContext?.close()}}var g=a(304783),h=a(306918);a(425108);const p={AUDIO_FORMAT:{offset:20,value:1},BITS_PER_SAMPLE:{offset:34,value:16},BLOCK_ALIGN:{offset:32},BYTE_RATE:{offset:28},CHANNEL_COUNT:{offset:22},CHUNK_ID:{offset:0,value:1380533830},CHUNK_SIZE:{offset:4},FILE_FORMAT:{offset:8,value:1463899717},SAMPLE_RATE:{offset:24},SUBCHUNK1_ID:{offset:12,value:1718449184},SUBCHUNK1_SIZE:{offset:16,value:16},SUBCHUNK2_ID:{offset:36,value:1684108385},SUBCHUNK2_SIZE:{offset:40}},_=e=>e.charCodeAt(0)<<24|e.charCodeAt(1)<<16|e.charCodeAt(2)<<8|e.charCodeAt(3),f=(_("data"),_("fmt "),_("RIFF"),_("WAVE"),e=>Array.from({length:e.numberOfChannels},((t,a)=>e.getChannelData(a)))),v=async(e,t)=>{const a=await(async(e,t)=>{const a=new OfflineAudioContext(e.numberOfChannels,e.duration*t,t),s=a.createBufferSource();return s.buffer=e,s.connect(a.destination),s.start(),await a.startRendering()})(await(async e=>{const t=new AudioContext,a=await(0,h.pV)(e),s=await t.decodeAudioData(a);return"closed"!==t.state&&await t.close(),s})(e),t),s=a.duration*t*a.numberOfChannels*2+44,n=new ArrayBuffer(s);return(({arrayBuffer:e,channelCount:t,sampleRate:a})=>{const s=a*t*2,n=2*t,r=new DataView(e),o=Math.min(r.byteLength-44,4294967251);r.setUint32(p.CHUNK_ID.offset,p.CHUNK_ID.value),r.setUint32(p.CHUNK_SIZE.offset,e.byteLength-8,!0),r.setUint32(p.FILE_FORMAT.offset,p.FILE_FORMAT.value),r.setUint32(p.SUBCHUNK1_ID.offset,p.SUBCHUNK1_ID.value),r.setUint32(p.SUBCHUNK1_SIZE.offset,p.SUBCHUNK1_SIZE.value,!0),r.setUint16(p.AUDIO_FORMAT.offset,p.AUDIO_FORMAT.value,!0),r.setUint16(p.CHANNEL_COUNT.offset,t,!0),r.setUint32(p.SAMPLE_RATE.offset,a,!0),r.setUint32(p.BYTE_RATE.offset,s,!0),r.setUint16(p.BLOCK_ALIGN.offset,n,!0),r.setUint16(p.BITS_PER_SAMPLE.offset,p.BITS_PER_SAMPLE.value,!0),r.setUint32(p.SUBCHUNK2_ID.offset,p.SUBCHUNK2_ID.value),r.setUint32(p.SUBCHUNK2_SIZE.offset,o,!0)})({arrayBuffer:n,channelCount:a.numberOfChannels,sampleRate:t}),(({arrayBuffer:e,dataByChannel:t})=>{const a=new DataView(e),s=t.length;t.forEach(((e,t)=>{let n=44+s*t;e.forEach((e=>{a.setInt16(n,e<0?32768*Math.max(-1,e):32767*Math.min(1,e),!0),n+=2*s}))}))})({arrayBuffer:n,dataByChannel:f(a)}),new Blob([n],{type:"audio/wav"})};var E=a(482613),w=a(766722),M=a(96895),y=a(425108);const b={others:"audio/webm",safari:"audio/mp4;codecs=mp4a.40.2"},C={mimeType:(0,M.G)()?b.safari:b.others},N={sampleRate:16e3},S=e=>e&&y.error("[MEDIA RECORDER ERROR]",e);var x,R;!function(e){e.PAUSED="paused",e.RECORDING="recording",e.STOPPED="stopped"}(x||(x={})),function(e){e.VOICE_RECORDING="voiceRecording"}(R||(R={}));class k{constructor({config:e,generateRecordingTitle:t,t:a}={}){this.recordedChunkDurations=[],this.recordedData=[],this.recordingState=new o.X(void 0),this.recording=new o.X(void 0),this.error=new i.x,this.notification=new i.x,this.generateRecordingTitle=e=>this.customGenerateRecordingTitle?this.customGenerateRecordingTitle(e):`${this.mediaType}_recording_${(new Date).toISOString()}.${(0,h.jM)(e)}`,this.makeVoiceRecording=async()=>{if(this.recordingUri&&URL.revokeObjectURL(this.recordingUri),!this.recordedData.length)return;const{mimeType:e}=this.mediaRecorderConfig;let t=new Blob(this.recordedData,{type:e});if(e.match("audio/webm")&&(t=await n()(t,this.durationMs,{logger:()=>null})),e.match("audio/mp4")||(t=await(({blob:e,encoder:t=v,sampleRate:a})=>t((0,h.au)({blobsArray:[e],fileName:`audio_recording_${(new Date).toISOString()}.${(0,h.jM)(e.type)}`,mimeType:e.type}),a))({blob:t,...this.transcoderConfig})),!t)return;this.recordingUri=URL.createObjectURL(t);const a=(0,h.au)({blobsArray:[t],fileName:this.generateRecordingTitle(t.type),mimeType:t.type});return{asset_url:this.recordingUri,duration:this.durationMs/1e3,file_size:t.size,localMetadata:{file:a,id:(0,r.x0)()},mime_type:t.type,title:a.name,type:R.VOICE_RECORDING,waveform_data:(0,E.me)(this.amplitudeRecorder?.amplitudes.value??[],this.amplitudeRecorderConfig.sampleCount)}},this.handleErrorEvent=e=>{const{error:t}=e;S(t),this.error.next(t),this.notification.next({text:this.t("An error has occurred during recording"),type:"error"})},this.handleDataavailableEvent=async e=>{if(e.data.size&&"audio"===this.mediaType)try{this.recordedData.push(e.data);const t=await this.makeVoiceRecording();if(!t)return;this.signalRecordingReady?.(t),this.recording.next(t)}catch(e){S(e),this.error.next(e),this.notification.next({text:this.t("An error has occurred during the recording processing"),type:"error"})}},this.resetRecordingState=()=>{this.recordedData=[],this.recording.next(void 0),this.recordingState.next(void 0),this.recordedChunkDurations=[],this.startTime=void 0},this.cleanUp=()=>{var e;this.resetRecordingState(),this.recordingUri&&URL.revokeObjectURL(this.recordingUri),this.amplitudeRecorder?.close(),this.mediaRecorder&&(e=this.mediaRecorder.stream,e?.active&&e.getTracks().forEach((t=>{t.stop(),e.removeTrack(t)})),this.mediaRecorder.removeEventListener("dataavailable",this.handleDataavailableEvent),this.mediaRecorder.removeEventListener("error",this.handleErrorEvent))},this.start=async()=>{if([x.RECORDING,x.PAUSED].includes(this.recordingState.value)){const e=new Error("Cannot start recording. Recording already in progress");return S(e),void this.error.next(e)}if(!navigator.mediaDevices){const e=new Error("Media recording is not supported");return S(e),this.error.next(e),void this.notification.next({text:this.t("Error starting recording"),type:"error"})}if("video"===this.mediaType){const e=new Error(`Video recording is not supported. Provided MIME type: ${this.mediaRecorderConfig.mimeType}`);return S(e),this.error.next(e),void this.notification.next({text:this.t("Error starting recording"),type:"error"})}if(this.permission.state.value||await this.permission.check(),"denied"!==this.permission.state.value)try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});this.mediaRecorder=new MediaRecorder(e,this.mediaRecorderConfig),this.mediaRecorder.addEventListener("dataavailable",this.handleDataavailableEvent),this.mediaRecorder.addEventListener("error",this.handleErrorEvent),this.startTime=(new Date).getTime(),this.mediaRecorder.start(),"audio"===this.mediaType&&e&&(this.amplitudeRecorder=new m({config:this.amplitudeRecorderConfig,stream:e}),this.amplitudeRecorder.start()),this.recordingState.next(x.RECORDING)}catch(e){S(e),this.cancel(),this.error.next(e),this.notification.next({text:this.t("Error starting recording"),type:"error"})}else S(new Error("Permission denied"))},this.pause=()=>{this.recordingState.value===x.RECORDING&&(this.startTime&&(this.recordedChunkDurations.push((new Date).getTime()-this.startTime),this.startTime=void 0),this.mediaRecorder?.pause(),this.amplitudeRecorder?.stop(),this.recordingState.next(x.PAUSED))},this.resume=()=>{this.recordingState.value===x.PAUSED&&(this.startTime=(new Date).getTime(),this.mediaRecorder?.resume(),this.amplitudeRecorder?.start(),this.recordingState.next(x.RECORDING))},this.stop=()=>{const e=this.recording.value;if(e)return Promise.resolve(e);if(![x.PAUSED,x.RECORDING].includes(this.mediaRecorder?.state||""))return Promise.resolve(void 0);this.startTime&&(this.recordedChunkDurations.push((new Date).getTime()-this.startTime),this.startTime=void 0);const t=new Promise((e=>{this.signalRecordingReady=e}));return this.mediaRecorder?.stop(),this.amplitudeRecorder?.stop(),this.recordingState.next(x.STOPPED),t},this.cancel=()=>{this.stop(),this.cleanUp()},this.t=a||w.DE,this.amplitudeRecorderConfig=(0,l.o)({...e?.amplitudeRecorderConfig},d),this.mediaRecorderConfig=(0,l.o)({...e?.mediaRecorderConfig},C),this.transcoderConfig=(0,l.o)({...e?.transcoderConfig},N);const s=(0,h.We)(this.mediaRecorderConfig.mimeType);if(!s)throw new Error(`Unsupported media type (supported audio or video only). Provided mimeType: ${this.mediaRecorderConfig.mimeType}`);this.mediaType=s,this.permission=new g.a({mediaType:s}),this.customGenerateRecordingTitle=t}get durationMs(){return this.recordedChunkDurations.reduce(((e,t)=>e+t),0)}}},388671:function(e,t,a){a.d(t,{X:function(){return r}});var s=a(840708),n=a(903227);class r extends s.x{constructor(e){super(),this._value=e}get value(){const{_value:e,thrownError:t}=this;if(t)throw t;return e}subscribe(e){const t=(0,n.z)(e),a=super.subscribe(e);return a.closed||t.next(this._value),a}next(e){super.next(this._value=e)}}},903227:function(e,t,a){function s(e){return"function"==typeof e?{next:e}:e}a.d(t,{z:function(){return s}})},840708:function(e,t,a){a.d(t,{x:function(){return o}});var s=a(903227),n=a(254568);class r{constructor(e){this._closed=!1,e&&(this._producer=e)}get closed(){return this._closed}subscribe(e){const t=(0,s.z)(e);return this.closed||this._producer?.(t),new n.w((()=>{this._closed=!0}))}}class o extends r{constructor(){super(),this._observers=new Map,this._observerCounter=0}get observers(){return Array.from(this._observers.values())}next(e){if(this.closed)return;const t=this.observers;for(let a=0;a<t.length;a++)t[a].next(e)}error(e){if(this.closed)return;this.thrownError=e;const{observers:t}=this;for(let a=0;a<t.length;a++)t[a].error?.(e);this._observers.clear()}complete(){if(this.closed)return;this._closed=!0;const{observers:e}=this;for(let t=0;t<e.length;t++)e[t].complete?.();this._observers.clear()}subscribe(e){const t=(0,s.z)(e);if(this.thrownError||this.closed){const e=new n.w;return e.closed=!0,e}const a=this._observerCounter++;return this._observers.set(a,t),new n.w((()=>{this._observers.delete(a)}))}unsubscribe(){this._closed=!0,this._observers.clear()}}},254568:function(e,t,a){a.d(t,{w:function(){return s}});class s{constructor(e){this.closed=!1,this._unsubscribe=e}unsubscribe(){this.closed=!0,this._unsubscribe?.()}}},297747:function(e,t,a){a.d(t,{v:function(){return S}});var s=a(667294);var n=a(437495),r=a(387029),o=a(425108);var i=a(425108);var l=a(493096),c=a.n(l),d=a(983156),u=a(636791),m=a(425108);const g=e=>{const t=(0,u.io)(),{updateMessage:a}=(0,n.uz)("useReactionHandler"),{channel:o,channelCapabilities:i}=(0,r.JN)("useReactionHandler"),{client:l}=(0,d.mx)("useReactionHandler"),g=(0,s.useCallback)(((e,t,a)=>{const s=a?.reaction_groups||{},n=t.type,r=!!s[n];if(e){const e=(new Date).toISOString();s[n]=r?{...s[n],count:s[n].count+1}:{count:1,first_reaction_at:e,last_reaction_at:e,sum_scores:1}}else r&&s[n].count>1?s[n]={...s[n],count:s[n].count-1}:delete s[n];const o=e?[t,...a?.latest_reactions||[]]:a.latest_reactions?.filter((e=>!(e.type===t.type&&e.user_id===t.user_id))),i=e?[t,...a?.own_reactions||[]]:a?.own_reactions?.filter((e=>e.type!==t.type));return{...a,latest_reactions:o||a.latest_reactions,own_reactions:i,reaction_groups:s}}),[l.user,l.userID]),h=c()((async(s,n,r)=>{if(!e||!i["send-reaction"])return;const c=(t=>({message_id:e?.id,score:1,type:t,user:l.user,user_id:l.user?.id}))(n),d=g(r,c,e);try{a(d),t?.upsertReplyLocally({message:d});const e=r?await o.sendReaction(s,{type:n}):await o.deleteReaction(s,n);a(e.message)}catch(s){a(e),t?.upsertReplyLocally({message:e})}}),1e3);return async(t,a)=>{if(a?.preventDefault&&a.preventDefault(),!e)return m.warn("Reaction handler was called, but it is missing one of its required arguments.\nMake sure the ChannelAction and ChannelState contexts are properly set and the hook is initialized with a valid message.");let s=null;e.own_reactions&&e.own_reactions.forEach((e=>{e.user&&l.userID===e.user.id&&e.type===t?s=e:e.user&&l.userID!==e.user.id&&m.warn("message.own_reactions contained reactions from a different user, this indicates a bug")}));try{s?await h(e.id,s.type,!1):await h(e.id,t,!0)}catch(e){m.log({error:e})}}};var h=a(308336),p=a(998431),_=a(52127),f=a(21681);var v=a(425108);var E=a(425108);var w=a(425108);function M(e,t){return a=>{"function"==typeof e&&t?.mentioned_users?.length&&e(a,t.mentioned_users)}}var y=a(540239),b=a(112239),C=a(800749);const N=s.memo((e=>{const{canPin:t,groupedByUser:a,Message:n,message:o,messageActions:i=Object.keys(_.Xh),onUserClick:l,onUserHover:c,userRoles:u}=e,{client:m}=(0,d.mx)("Message"),{read:g}=(0,r.JN)("Message"),{Message:h}=(0,y.yM)("Message"),p="regular"===o.type&&"received"===o.status,f=n??h??C.u,{clearEdit:v,editing:E,setEdit:w}=((e=!1,t,a)=>{const[n,r]=(0,s.useState)(e);return{clearEdit:a||(e=>{e?.preventDefault&&e.preventDefault(),r(!1)}),editing:n,setEdit:t||(e=>{e?.preventDefault&&e.preventDefault(),r(!0)})}})(),{onUserClick:M,onUserHover:N}=((e,t)=>({onUserClick:a=>{"function"==typeof t?.onUserClickHandler&&e?.user&&t.onUserClickHandler(a,e.user)},onUserHover:a=>{"function"==typeof t?.onUserHoverHandler&&e?.user&&t.onUserHoverHandler(a,e.user)}}))(o,{onUserClickHandler:l,onUserHoverHandler:c}),{canDelete:S,canEdit:x,canFlag:R,canMarkUnread:k,canMute:T,canQuote:L,canReact:U,canReply:A,isMyMessage:P}=u,D=(0,s.useMemo)((()=>!(P||!m.user?.id||!g||g[m.user.id]&&!(o?.created_at&&new Date(o.created_at).getTime()>g[m.user.id].last_read.getTime()))),[m,P,o.created_at,g]),I=(0,s.useCallback)((()=>(0,_.oT)(i,{canDelete:S,canEdit:x,canFlag:R,canMarkUnread:k,canMute:T,canPin:t,canQuote:L,canReact:U,canReply:A})),[i,S,x,R,k,T,t,L,U,A]),{canPin:O,messageActions:H,onlySenderCanEdit:B,onUserClick:F,onUserHover:G,userRoles:q,...V}=e,$={...V,actionsEnabled:p,clearEditingState:v,editing:E,getMessageActions:I,handleEdit:w,isMyMessage:()=>P,messageIsUnread:D,onUserClick:M,onUserHover:N,setEditingState:w};return s.createElement(b.x1,{value:$},s.createElement(f,{groupedByUser:a}))}),_.s4),S=e=>{const{closeReactionSelectorOnClick:t,disableQuotedMessages:a,getDeleteMessageErrorNotification:l,getFetchReactionsErrorNotification:c,getFlagMessageErrorNotification:u,getFlagMessageSuccessNotification:m,getMarkMessageUnreadErrorNotification:y,getMarkMessageUnreadSuccessNotification:b,getMuteUserErrorNotification:C,getMuteUserSuccessNotification:S,getPinMessageErrorNotification:x,message:R,onlySenderCanEdit:k=!1,onMentionsClick:T,onMentionsHover:L,openThread:U,pinPermissions:A,reactionDetailsSort:P,retrySendMessage:D,sortReactionDetails:I,sortReactions:O}=e,{addNotification:H}=(0,n.uz)("Message"),{highlightedMessageId:B,mutes:F}=(0,r.JN)("Message"),G=function(e){const{removeMessage:t,updateMessage:a}=(0,n.uz)("useActionHandler"),{channel:s}=(0,r.JN)("useActionHandler");return async(n,r,i)=>{if(i&&i.preventDefault(),!(e&&a&&t&&s))return void o.warn("Action handler was called, but it is missing one of its required arguments. \nMake sure the ChannelAction and ChannelState contexts are properly set and the hook is initialized with a valid message.");const l=e.id;let c={};if("string"==typeof n?c[n]=r:c={...n},l){const n=await s.sendAction(l,c);n?.message?a(n.message):t(e)}}}(R),q=((e,t)=>{const{openThread:a}=(0,n.uz)("useOpenThreadHandler"),s=t||a;return t=>{s&&e?s(e,t):i.warn("Open thread handler was called but it is missing one of its parameters")}})(R,U),V=g(R),$=(e=>{const{retrySendMessage:t}=(0,n.uz)("useRetryHandler"),a=e||t;return async e=>{e&&await a(e)}})(D),z=(0,h.j)(R,k,a),Z=(0,p.O)(R,{getErrorNotification:c,notify:H}),j=((e,t={})=>{const{getErrorNotification:a,notify:s}=t,{deleteMessage:r,updateMessage:o}=(0,n.uz)("useDeleteHandler"),{client:i}=(0,d.mx)("useDeleteHandler"),{t:l}=(0,f.Ht)("useDeleteHandler");return async t=>{if(t.preventDefault(),e?.id&&i&&o)try{const t=await r(e);o(t)}catch(t){const n=a&&(0,_.nU)(a,[e]);s&&s(n||l("Error deleting message"),"error")}}})(R,{getErrorNotification:l,notify:H}),Q=((e,t={})=>{const{client:a}=(0,d.mx)("useFlagHandler"),{t:s}=(0,f.Ht)("useFlagHandler");return async n=>{n.preventDefault();const{getErrorNotification:r,getSuccessNotification:o,notify:i}=t;if(a&&s&&i&&e?.id){if(a.user?.banned)return i(s("Error adding flag"),"error");try{await a.flagMessage(e.id),i(o&&(0,_.nU)(o,[e])||s("Message has been successfully flagged"),"success")}catch(t){i(r&&(0,_.nU)(r,[e])||s("Error adding flag"),"error")}}else v.warn("useFlagHandler was called but it is missing one or more necessary parameters.")}})(R,{getErrorNotification:u,getSuccessNotification:m,notify:H}),J=((e,t={})=>{const{getErrorNotification:a,getSuccessNotification:s,notify:n}=t,{channel:o}=(0,r.JN)("useMarkUnreadHandler"),{t:i}=(0,f.Ht)("useMarkUnreadHandler");return async t=>{if(t.preventDefault(),e?.id)try{if(await o.markUnread({message_id:e.id}),!n)return;const t=s&&(0,_.nU)(s,[e]);t&&n(t,"success")}catch(t){if(!n)return;const s=a&&(0,_.nU)(a,[e]);if(a&&!s)return;n(s||i("Error marking message unread. Cannot mark unread messages older than the newest 100 channel messages."),"error")}else E.warn("Mark unread handler does not have access to message id")}})(R,{getErrorNotification:y,getSuccessNotification:b,notify:H}),K=((e,t={})=>{const{mutes:a}=(0,r.JN)("useMuteHandler"),{client:s}=(0,d.mx)("useMuteHandler"),{t:n}=(0,f.Ht)("useMuteHandler");return async r=>{r.preventDefault();const{getErrorNotification:o,getSuccessNotification:i,notify:l}=t;if(n&&e?.user&&l&&s)if((0,_.B9)(e,a))try{await s.unmuteUser(e.user.id);const t=n("{{ user }} has been unmuted",{user:e.user.name||e.user.id}),a=i&&(0,_.nU)(i,[e.user])||t;"string"==typeof a&&l(a,"success")}catch(t){const a=o&&(0,_.nU)(o,[e.user])||n("Error unmuting a user ...");"string"==typeof a&&l(a,"error")}else try{await s.muteUser(e.user.id),l(i&&(0,_.nU)(i,[e.user])||n("{{ user }} has been muted",{user:e.user.name||e.user.id}),"success")}catch(t){l(o&&(0,_.nU)(o,[e.user])||n("Error muting a user ..."),"error")}else w.warn("useMuteHandler was called but it is missing one or more necessary parameter.")}})(R,{getErrorNotification:C,getSuccessNotification:S,notify:H}),{onMentionsClick:W,onMentionsHover:X}=((e,t)=>{const{onMentionsClick:a,onMentionsHover:s}=(0,n.uz)("useMentionsHandler"),r=t?.onMentionsClick||a||(()=>null),o=t?.onMentionsHover||s||(()=>null);return{onMentionsClick:M(r,e),onMentionsHover:M(o,e)}})(R,{onMentionsClick:T,onMentionsHover:L}),{canPin:Y,handlePin:ee}=((e,t=_.Z1,a={})=>{const{getErrorNotification:s,notify:o}=a,{updateMessage:i}=(0,n.uz)("usePinHandler"),{channelCapabilities:l={}}=(0,r.JN)("usePinHandler"),{client:c}=(0,d.mx)("usePinHandler"),{t:u}=(0,f.Ht)("usePinHandler");return{canPin:!!l["pin-message"],handlePin:async t=>{if(t.preventDefault(),e)if(e.pinned)try{const t={...e,pin_expires:null,pinned:!1,pinned_at:null,pinned_by:null};i(t),await c.unpinMessage(e)}catch(t){const a=s&&(0,_.nU)(s,[e]);o&&o(a||u("Error removing message pin"),"error"),i(e)}else try{const t={...e,pinned:!0,pinned_at:new Date,pinned_by:c.user};i(t),await c.pinMessage(e)}catch(t){const a=s&&(0,_.nU)(s,[e]);o&&o(a||u("Error pinning message"),"error"),i(e)}}}})(R,A,{getErrorNotification:x,notify:H}),te=B===R.id;return s.createElement(N,{additionalMessageInputProps:e.additionalMessageInputProps,autoscrollToBottom:e.autoscrollToBottom,canPin:Y,closeReactionSelectorOnClick:t,customMessageActions:e.customMessageActions,disableQuotedMessages:e.disableQuotedMessages,endOfGroup:e.endOfGroup,firstOfGroup:e.firstOfGroup,formatDate:e.formatDate,groupedByUser:e.groupedByUser,groupStyles:e.groupStyles,handleAction:G,handleDelete:j,handleFetchReactions:Z,handleFlag:Q,handleMarkUnread:J,handleMute:K,handleOpenThread:q,handlePin:ee,handleReaction:V,handleRetry:$,highlighted:te,initialMessage:e.initialMessage,lastReceivedId:e.lastReceivedId,message:R,Message:e.Message,messageActions:e.messageActions,messageListRect:e.messageListRect,mutes:F,onMentionsClickMessage:W,onMentionsHoverMessage:X,onUserClick:e.onUserClick,onUserHover:e.onUserHover,pinPermissions:e.pinPermissions,reactionDetailsSort:P,readBy:e.readBy,renderText:e.renderText,sortReactionDetails:I,sortReactions:O,threadList:e.threadList,unsafeHTML:e.unsafeHTML,userRoles:z})}},173082:function(e,t,a){a.d(t,{c:function(){return o}});var s=a(667294),n=a(308336),r=a(21681);const o=e=>{const{message:t}=e,{t:a}=(0,r.Ht)("MessageDeleted"),{isMyMessage:o}=(0,n.j)(t),i=o?"str-chat__message str-chat__message--me str-chat__message-simple str-chat__message-simple--me":"str-chat__message str-chat__message-simple str-chat__message--other";return s.createElement("div",{className:`${i} str-chat__message--deleted ${t.type} `,"data-testid":"message-deleted-component",key:t.id},s.createElement("div",{className:"str-chat__message--deleted-inner"},a("This message was deleted...")))}},427490:function(e,t,a){a.d(t,{u:function(){return r}});var s=a(667294),n=a(21681);const r=s.memo((e=>{const{labelPlural:t,labelSingle:a,onClick:r,reply_count:o=0}=e,{t:i}=(0,n.Ht)("MessageRepliesCountButton");if(!o)return null;let l=i("replyCount",{count:o});return t&&o>1?l=`${o} ${t}`:a&&(l=`1 ${a}`),s.createElement("div",{className:"str-chat__message-replies-count-button-wrapper"},s.createElement("button",{className:"str-chat__message-replies-count-button","data-testid":"replies-count-button",onClick:r},l))}))},800749:function(e,t,a){a.d(t,{u:function(){return Q}});var s=a(667294),n=a(770149);const r=({className:e=""})=>s.createElement("svg",{className:e,height:"4",viewBox:"0 0 11 4",width:"11",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M1.5 3a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm4 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm4 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z",fillRule:"nonzero"})),o=({className:e=""})=>s.createElement("svg",{className:e,height:"12",viewBox:"0 0 12 12",width:"12",xmlns:"http://www.w3.org/2000/svg"},s.createElement("g",{clipRule:"evenodd",fillRule:"evenodd"},s.createElement("path",{d:"M6 1.2C3.3 1.2 1.2 3.3 1.2 6c0 2.7 2.1 4.8 4.8 4.8 2.7 0 4.8-2.1 4.8-4.8 0-2.7-2.1-4.8-4.8-4.8zM0 6c0-3.3 2.7-6 6-6s6 2.7 6 6-2.7 6-6 6-6-2.7-6-6z"}),s.createElement("path",{d:"M5.4 4.5c0 .5-.4.9-.9.9s-.9-.4-.9-.9.4-.9.9-.9.9.4.9.9zM8.4 4.5c0 .5-.4.9-.9.9s-.9-.4-.9-.9.4-.9.9-.9.9.4.9.9zM3.3 6.7c.3-.2.6-.1.8.1.3.4.8.9 1.5 1 .6.2 1.4.1 2.4-1 .2-.2.6-.3.8 0 .2.2.3.6 0 .8-1.1 1.3-2.4 1.7-3.5 1.5-1-.2-1.8-.9-2.2-1.5-.2-.3-.1-.7.2-.9z"}))),i=({className:e=""})=>s.createElement("svg",{className:e,height:"10",width:"14",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M8.516 3c4.78 0 4.972 6.5 4.972 6.5-1.6-2.906-2.847-3.184-4.972-3.184v2.872L3.772 4.994 8.516.5V3zM.484 5l4.5-4.237v1.78L2.416 5l2.568 2.125v1.828L.484 5z",fillRule:"evenodd"})),l=()=>s.createElement("svg",{"data-testid":"delivered-icon",fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{clipRule:"evenodd",d:"M8.9999 16.2L4.7999 12L3.3999 13.4L8.9999 19L20.9999 6.99998L19.5999 5.59998L8.9999 16.2Z",fill:"black",fillRule:"evenodd"})),c=()=>s.createElement("div",{className:"str-chat__message-error-icon"},s.createElement("svg",{"data-testid":"error",fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2Z",fill:"black",id:"background"}),s.createElement("path",{d:"M13 17H11V15H13V17ZM13 13H11V7H13V13Z",fill:"white"})));var d=a(301112),u=a(21681);function m({children:e,onClose:t}){const{handleDelete:a,handleEdit:n,handleRetry:r}=(0,d.K)("MessageBouncePrompt"),{t:o}=(0,u.Ht)("MessageBouncePrompt");function i(e){return a=>{e(a),t?.(a)}}return s.createElement("div",{className:"str-chat__message-bounce-prompt","data-testid":"message-bounce-prompt"},s.createElement("div",{className:"str-chat__message-bounce-prompt-header"},e??o("This message did not meet our content guidelines")),s.createElement("div",{className:"str-chat__message-bounce-actions"},s.createElement("button",{className:"str-chat__message-bounce-edit","data-testid":"message-bounce-edit",onClick:i(n),type:"button"},o("Edit Message")),s.createElement("button",{className:"str-chat__message-bounce-send","data-testid":"message-bounce-send",onClick:i(r)},o("Send Anyway")),s.createElement("button",{className:"str-chat__message-bounce-delete","data-testid":"message-bounce-delete",onClick:i(a)},o("Delete"))))}var g=a(173082),h=a(52127),p=a(540239),_=a(437495),f=a(112239);const v=e=>{const{customMessageActions:t,message:a}=e;if(!t)return null;const n=Object.keys(t);return s.createElement(s.Fragment,null,n.map((e=>{const n=t[e];return s.createElement("button",{"aria-selected":"false",className:"str-chat__message-actions-list-item str-chat__message-actions-list-item-button",key:e,onClick:e=>n(a,e),role:"option"},e)})))},E=s.memo((e=>{const{className:t,getMessageActions:a,handleDelete:r,handleEdit:o,handleFlag:i,handleMarkUnread:l,handleMute:c,handlePin:d,isUserMuted:m,mine:g,open:E,...w}=e,{CustomMessageActionsList:M=v}=(0,p.yM)("MessageActionsBox"),{setQuotedMessage:y}=(0,_.uz)("MessageActionsBox"),{customMessageActions:b,message:C,threadList:N}=(0,f.fr)("MessageActionsBox"),{t:S}=(0,u.Ht)("MessageActionsBox"),x=a(),R=(0,n.Z)("str-chat__message-actions-box",t,{"str-chat__message-actions-box--open":E}),k="str-chat__message-actions-list-item str-chat__message-actions-list-item-button";return s.createElement("div",{...w,className:R,"data-testid":"message-actions-box"},s.createElement("div",{"aria-label":S("aria/Message Options"),className:"str-chat__message-actions-list",role:"listbox"},s.createElement(M,{customMessageActions:b,message:C}),x.indexOf(h.Xh.quote)>-1&&s.createElement("button",{"aria-selected":"false",className:k,onClick:()=>{y(C);const e=(C.parent_id?document.querySelectorAll(".str-chat__thread .str-chat__textarea__textarea"):document.getElementsByClassName("str-chat__textarea__textarea")).item(0);e instanceof HTMLTextAreaElement&&e.focus()},role:"option"},S("Reply")),x.indexOf(h.Xh.pin)>-1&&!C.parent_id&&s.createElement("button",{"aria-selected":"false",className:k,onClick:d,role:"option"},C.pinned?S("Unpin"):S("Pin")),x.indexOf(h.Xh.markUnread)>-1&&!N&&!!C.id&&s.createElement("button",{"aria-selected":"false",className:k,onClick:l,role:"option"},S("Mark as unread")),x.indexOf(h.Xh.flag)>-1&&s.createElement("button",{"aria-selected":"false",className:k,onClick:i,role:"option"},S("Flag")),x.indexOf(h.Xh.mute)>-1&&s.createElement("button",{"aria-selected":"false",className:k,onClick:c,role:"option"},m()?S("Unmute"):S("Mute")),x.indexOf(h.Xh.edit)>-1&&s.createElement("button",{"aria-selected":"false",className:k,onClick:o,role:"option"},S("Edit Message")),x.indexOf(h.Xh.delete)>-1&&s.createElement("button",{"aria-selected":"false",className:k,onClick:r,role:"option"},S("Delete"))))}));var w=a(219025),M=a(869725),y=a(983156);const b=e=>{const{ActionsIcon:t=r,customWrapperClass:a="",getMessageActions:n,handleDelete:o,handleFlag:i,handleMarkUnread:l,handleMute:c,handlePin:d,inline:m,message:g,mine:_}=e,{mutes:v}=(0,y.mx)("MessageActions"),{customMessageActions:b,getMessageActions:N,handleDelete:S,handleFlag:x,handleMarkUnread:R,handleMute:k,handlePin:T,isMyMessage:L,message:U,setEditingState:A,threadList:P}=(0,f.fr)("MessageActions"),{CustomMessageActionsList:D}=(0,p.yM)("MessageActions"),{t:I}=(0,u.Ht)("MessageActions"),O=n||N,H=o||S,B=i||x,F=l||R,G=c||k,q=d||T,V=g||U,$=_?_():L(),z=(0,s.useCallback)((()=>(0,h.B9)(V,v)),[V,v]),Z=`message-actions--${V.id}`,j=(0,w.Rh)({id:Z}),Q=(0,w.wB)(Z),J=O(),K=(0,h.fs)({customMessageActions:b,CustomMessageActionsList:D,inThread:P,messageActions:J}),W=(0,s.useRef)(null);return K?s.createElement(C,{customWrapperClass:a,inline:m,toggleOpen:j?.toggle},s.createElement(M.l,{id:Z,placement:$?"top-end":"top-start",referenceElement:W.current,trapFocus:!0},s.createElement(E,{getMessageActions:O,handleDelete:H,handleEdit:A,handleFlag:B,handleMarkUnread:F,handleMute:G,handlePin:q,isUserMuted:z,mine:$,open:Q})),s.createElement("button",{"aria-expanded":Q,"aria-haspopup":"true","aria-label":I("aria/Open Message Actions Menu"),className:"str-chat__message-actions-box-button","data-testid":"message-actions-toggle-button",ref:W},s.createElement(t,{className:"str-chat__message-action-icon"}))):null},C=e=>{const{children:t,customWrapperClass:a,inline:r,toggleOpen:o}=e,i=(0,n.Z)("str-chat__message-simple__actions__action","str-chat__message-simple__actions__action--options","str-chat__message-actions-container"),l={className:a||i,"data-testid":"message-actions",onClick:o};return r?s.createElement("span",{...l},t):s.createElement("div",{...l},t)};var N=a(942117);const S=s.memo((e=>{const{ActionsIcon:t=r,displayReplies:a=!0,handleOpenThread:l,ReactionIcon:c=o,theme:d="simple",ThreadIcon:m=i}=e,{getMessageActions:g,handleOpenThread:p,initialMessage:_,message:v,threadList:E}=(0,f.fr)("MessageOptions"),{t:M}=(0,u.Ht)("MessageOptions"),y=(0,w.wB)(`message-actions--${v.id}`),C=(0,w.wB)(`reaction-selector--${v.id}`),S=l||p,x=g(),R=x.indexOf(h.Xh.react)>-1,k=x.indexOf(h.Xh.reply)>-1&&a&&!E;return!v.type||"error"===v.type||"system"===v.type||"ephemeral"===v.type||"failed"===v.status||"sending"===v.status||_?null:s.createElement("div",{className:(0,n.Z)(`str-chat__message-${d}__actions str-chat__message-options`,{"str-chat__message-options--active":y||C}),"data-testid":"message-options"},s.createElement(b,{ActionsIcon:t}),k&&s.createElement("button",{"aria-label":M("aria/Open Thread"),className:`str-chat__message-${d}__actions__action str-chat__message-${d}__actions__action--thread str-chat__message-reply-in-thread-button`,"data-testid":"thread-action",onClick:S},s.createElement(m,{className:"str-chat__message-action-icon"})),R&&s.createElement(N.A,{ReactionIcon:c}))}));var x=a(427490),R=a(613943),k=a(944498),T=a(19382),L=a(451385);const U=s.memo((e=>{const{Avatar:t,MessageDeliveredStatus:a,MessageReadStatus:r,MessageSendingStatus:o,messageType:i="simple",tooltipUserNameMapper:c=h.jb}=e,{handleEnter:d,handleLeave:m,tooltipVisible:g}=(0,L.r)(),{client:_}=(0,y.mx)("MessageStatus"),{Avatar:v}=(0,p.yM)("MessageStatus"),{isMyMessage:E,lastReceivedId:w,message:M,readBy:b,threadList:C}=(0,f.fr)("MessageStatus"),{t:N}=(0,u.Ht)("MessageStatus"),[S,x]=(0,s.useState)(null),U=t||v||R.q;if(!E()||"error"===M.type)return null;const A=1===b?.length&&b[0].id===_.user?.id,P=`str-chat__message-${i}-status str-chat__message-status`,D="sending"===M.status,I="received"===M.status&&M.id===w&&!C,O=!(!b?.length||C||A),H=O?b.filter((e=>e.id!==_.user?.id)):[],[B]=H;return s.createElement("span",{className:P,"data-testid":(0,n.Z)({"message-status-read-by":O,"message-status-received":I&&!O,"message-status-sending":D}),onMouseEnter:d,onMouseLeave:m,ref:x},D&&(o?s.createElement(o,null):s.createElement(s.Fragment,null,s.createElement(T.X,{offset:[0,5],referenceElement:S,visible:g},N("Sending...")),s.createElement(k.T,null))),I&&!O&&(a?s.createElement(a,null):s.createElement(s.Fragment,null,s.createElement(T.X,{offset:[0,5],referenceElement:S,visible:g},N("Delivered")),s.createElement(l,null))),O&&(r?s.createElement(r,null):s.createElement(s.Fragment,null,s.createElement(T.X,{offset:[0,5],referenceElement:S,visible:g},(0,h.Qn)(b,N,_,c)),s.createElement(U,{className:"str-chat__avatar--message-status",image:B.image,name:B.name||B.id,user:B}),H.length>1&&s.createElement("span",{className:`str-chat__message-${i}-status-number`,"data-testid":"message-status-read-by-many"},H.length))))}));var A=a(344849),P=a(31073),D=a(852429),I=a(196649),O=a(386527),H=a(910758);const B=s.lazy((async()=>({default:(await Promise.all([a.e(6972),a.e(2138),a.e(98),a.e(4467),a.e(4492),a.e(4989),a.e(6966),a.e(6736),a.e(9496),a.e(3506),a.e(4561),a.e(731),a.e(9658),a.e(5647),a.e(8089),a.e(8126),a.e(8469),a.e(7884),a.e(7791),a.e(4796),a.e(6594),a.e(8790),a.e(624),a.e(2166),a.e(4835),a.e(9777),a.e(5991),a.e(6574),a.e(3479),a.e(4980),a.e(4412),a.e(8991),a.e(6273),a.e(4343),a.e(3365),a.e(2360),a.e(1439),a.e(1748),a.e(7841),a.e(8587),a.e(9657),a.e(5702),a.e(1142),a.e(3971),a.e(6381),a.e(457),a.e(6611),a.e(4137),a.e(4362),a.e(5851),a.e(9761),a.e(2935),a.e(3063),a.e(6387),a.e(5538),a.e(1978),a.e(5341),a.e(8212),a.e(1334)]).then(a.bind(a,399203))).MML}))),F=e=>{const{actionHandler:t,align:a="right",source:n}=e,{theme:r}=(0,y.mx)("MML");return s.createElement(s.Suspense,{fallback:null},s.createElement(B,{className:`mml-align-${a}`,Loading:null,onSubmit:t,source:n,Success:null,theme:(r||"").replace(" ","-")}))};var G=a(827666),q=a(932313),V=a(72313);function $({MessageBouncePrompt:e,...t}){return s.createElement(G.u,{className:"str-chat__message-bounce-modal",...t},s.createElement(d.f,null,s.createElement(e,{onClose:t.onClose})))}var z=a(879087);function Z({message:e,open:t,...a}){const{t:r}=(0,u.Ht)("MessageEditedTimestamp"),{message:o}=(0,f.fr)("MessageEditedTimestamp"),{Timestamp:i=z.E}=(0,p.yM)("MessageEditedTimestamp"),l=e||o;return(0,h.$l)(l)?s.createElement("div",{className:(0,n.Z)("str-chat__message-edited-timestamp",t?"str-chat__message-edited-timestamp--open":"str-chat__message-edited-timestamp--collapsed"),"data-testid":"message-edited-timestamp"},r("Edited")," ",s.createElement(i,{timestamp:l.message_text_updated_at,...a})):null}const j=s.memo((e=>{const{additionalMessageInputProps:t,clearEditingState:a,editing:r,endOfGroup:o,firstOfGroup:i,groupedByUser:l,handleAction:d,handleOpenThread:_,handleRetry:f,highlighted:v,isMyMessage:E,message:w,onUserClick:M,onUserHover:b,renderText:C,threadList:N}=e,{client:k}=(0,y.mx)("MessageSimple"),{t:T}=(0,u.Ht)("MessageSimple"),[L,B]=(0,s.useState)(!1),[z,j]=(0,s.useState)(!1),{Attachment:Q=D.P,Avatar:J=R.q,EditMessageInput:K=O.w,MessageOptions:W=S,MessageActions:X=W,MessageDeleted:Y=g.c,MessageBouncePrompt:ee=m,MessageRepliesCountButton:te=x.u,MessageStatus:ae=U,MessageTimestamp:se=P.i,ReactionsList:ne=V.A,PinIndicator:re}=(0,p.yM)("MessageSimple"),oe=(0,h.ue)(w),ie=(0,h.KI)(w);if(w.customType===I.L.date)return null;if(w.deleted_at||"deleted"===w.type)return s.createElement(Y,{message:w});const le=!l||o,ce=!N&&!!w.reply_count,de="failed"===w.status&&403!==w.errorStatusCode,ue=(0,h.yW)(w),me=(0,h.$l)(w);let ge;de?ge=()=>f(w):ue?ge=()=>B(!0):me&&(ge=()=>j((e=>!e)));const he=(0,n.Z)("str-chat__message str-chat__message-simple",`str-chat__message--${w.type}`,`str-chat__message--${w.status}`,E()?"str-chat__message--me str-chat__message-simple--me":"str-chat__message--other",w.text?"str-chat__message--has-text":"has-no-text",{"str-chat__message--has-attachment":oe,"str-chat__message--highlighted":v,"str-chat__message--pinned pinned-message":w.pinned,"str-chat__message--with-reactions":ie,"str-chat__message-send-can-be-retried":"failed"===w?.status&&403!==w?.errorStatusCode,"str-chat__message-with-thread-link":ce,"str-chat__virtual-message__wrapper--end":o,"str-chat__virtual-message__wrapper--first":i,"str-chat__virtual-message__wrapper--group":l}),pe=w.poll_id&&k.polls.fromState(w.poll_id);return s.createElement(s.Fragment,null,r&&s.createElement(G.u,{className:"str-chat__edit-message-modal",onClose:a,open:r},s.createElement(H.R,{clearEditingState:a,grow:!0,hideSendButton:!0,Input:K,message:w,...t})),L&&s.createElement($,{MessageBouncePrompt:ee,onClose:()=>B(!1),open:L}),s.createElement("div",{className:he,key:w.id},re&&s.createElement(re,null),w.user&&s.createElement(J,{image:w.user.image,name:w.user.name||w.user.id,onClick:M,onMouseOver:b,user:w.user}),s.createElement("div",{className:(0,n.Z)("str-chat__message-inner",{"str-chat__simple-message--error-failed":de||ue}),"data-testid":"message-inner",onClick:ge,onKeyUp:ge},s.createElement(X,null),s.createElement("div",{className:"str-chat__message-reactions-host"},ie&&s.createElement(ne,{reverse:!0})),s.createElement("div",{className:"str-chat__message-bubble"},pe&&s.createElement(q.n,{poll:pe}),w.attachments?.length&&!w.quoted_message?s.createElement(Q,{actionHandler:d,attachments:w.attachments}):null,s.createElement(A.Y,{message:w,renderText:C}),w.mml&&s.createElement(F,{actionHandler:d,align:E()?"right":"left",source:w.mml}),s.createElement(c,null))),ce&&s.createElement(te,{onClick:_,reply_count:w.reply_count}),le&&s.createElement("div",{className:"str-chat__message-metadata"},s.createElement(ae,null),!E()&&!!w.user&&s.createElement("span",{className:"str-chat__message-simple-name"},w.user.name||w.user.id),s.createElement(se,{customClass:"str-chat__message-simple-timestamp"}),me&&s.createElement("span",{className:"str-chat__mesage-simple-edited"},T("Edited")),me&&s.createElement(Z,{calendar:!0,open:z}))))}),h.zs),Q=e=>{const t=(0,f.fr)("MessageSimple");return s.createElement(j,{...t,...e})}},344849:function(e,t,a){a.d(t,{Y:function(){return f}});var s=a(770149),n=a(667294),r=a(852429),o=a(613943),i=a(932313),l=a(983156),c=a(540239),d=a(112239),u=a(21681),m=a(437495);const g=()=>{const{Attachment:e=r.P,Avatar:t}=(0,c.yM)("QuotedMessage"),{client:a}=(0,l.mx)(),{isMyMessage:g,message:h}=(0,d.fr)("QuotedMessage"),{t:p,userLanguage:_}=(0,u.Ht)("QuotedMessage"),{jumpToMessage:f}=(0,m.uz)("QuotedMessage"),v=t||o.q,{quoted_message:E}=h;if(!E)return null;const w=E.poll_id&&a.polls.fromState(E.poll_id),M=E.deleted_at||"deleted"===E.type,y=M?p("This message was deleted..."):E.i18n?.[`${_}_text`]||E.text,b=E.attachments?.length&&!M?E.attachments[0]:null;return E.poll||y||b?n.createElement(n.Fragment,null,n.createElement("div",{className:(0,s.Z)("str-chat__quoted-message-preview",{mine:g()}),"data-testid":"quoted-message",onClickCapture:e=>{e.stopPropagation(),e.preventDefault(),f(E.id)}},E.user&&n.createElement(v,{className:"str-chat__avatar--quoted-message-sender",image:E.user.image,name:E.user.name||E.user.id,user:E.user}),n.createElement("div",{className:"str-chat__quoted-message-bubble","data-testid":"quoted-message-contents"},w?n.createElement(i.n,{isQuoted:!0,poll:w}):n.createElement(n.Fragment,null,b&&n.createElement(e,{attachments:[b],isQuoted:!0}),n.createElement("div",{className:"str-chat__quoted-message-bubble__text","data-testid":"quoted-message-text"},y)))),h.attachments?.length?n.createElement(e,{attachments:h.attachments}):null):null};var h=a(52127),p=a(549238);function _({message:e,theme:t}){const{t:a}=(0,u.Ht)("MessageText");return"error"!==e.type||(0,h.yW)(e)?"failed"===e.status?n.createElement("div",{className:`str-chat__${t}-message--error-message str-chat__message--error-message`},403!==e.errorStatusCode?a("Message Failed · Click to try again"):a("Message Failed · Unauthorized")):null:n.createElement("div",{className:`str-chat__${t}-message--error-message str-chat__message--error-message`},a("Error · Unsent"))}const f=n.memo((e=>{const{customInnerClass:t,customWrapperClass:a="",message:r,renderText:o,theme:i="simple"}=e,{QuotedMessage:l=g}=(0,c.yM)("MessageText"),{message:m,onMentionsClickMessage:f,onMentionsHoverMessage:v,renderText:E,unsafeHTML:w}=(0,d.fr)("MessageText"),M=o??E??p.IY,{userLanguage:y}=(0,u.Ht)("MessageText"),b=r||m,C=(0,h.ue)(b),N=b.i18n?.[`${y}_text`]||b.text,S=(0,n.useMemo)((()=>M(N,b.mentioned_users)),[b.mentioned_users,N]),x=a||"str-chat__message-text",R=t||`str-chat__message-text-inner str-chat__message-${i}-text-inner`;return N||b.quoted_message?n.createElement("div",{className:x,tabIndex:0},n.createElement("div",{className:(0,s.Z)(R,{[`str-chat__message-${i}-text-inner--has-attachment`]:C,[` str-chat__message-${i}-text-inner--is-emoji`]:(0,h.Kh)(b.text)&&!b.quoted_message}),"data-testid":"message-text-inner-wrapper",onClick:f,onMouseOver:v},b.quoted_message&&n.createElement(l,null),n.createElement(_,{message:b,theme:i}),w&&b.html?n.createElement("div",{dangerouslySetInnerHTML:{__html:b.html}}):n.createElement("div",null,S))):null}))},31073:function(e,t,a){a.d(t,{i:function(){return i}});var s=a(667294),n=a(112239),r=a(879087),o=a(540239);const i=s.memo((e=>{const{message:t,...a}=e,{message:i}=(0,n.fr)("MessageTimestamp"),{Timestamp:l=r.E}=(0,o.yM)("MessageTimestamp"),c=t||i;return s.createElement(l,{timestamp:c.created_at,...a})}))},879087:function(e,t,a){a.d(t,{E:function(){return i}});var s=a(667294),n=a(112239),r=a(21681),o=a(766722);function i(e){const{calendar:t,calendarFormats:a,customClass:i,format:l,timestamp:c}=e,{formatDate:d}=(0,n.fr)("MessageTimestamp"),{t:u,tDateTimeParser:m}=(0,r.Ht)("MessageTimestamp"),g=c&&(0,o.J_)(c)?c.toISOString():c,h=(0,s.useMemo)((()=>(0,o.fh)({calendar:t,calendarFormats:a,format:l,formatDate:d,messageCreatedAt:g,t:u,tDateTimeParser:m,timestampTranslationKey:"timestamp/MessageTimestamp"})),[t,a,l,d,g,u,m]);return h?s.createElement("time",{className:i,dateTime:g,title:g},h):null}},998431:function(e,t,a){a.d(t,{O:function(){return o},a:function(){return r}});var s=a(983156),n=a(21681);const r=1e3;function o(e,t={}){const{client:a}=(0,s.mx)("useRectionsFetcher"),{t:o}=(0,n.Ht)("useReactionFetcher"),{getErrorNotification:i,notify:l}=t;return async(t,s)=>{try{return await async function(e,t,a,s){const n=[],o=25;let i,l=!0;for(;l&&n.length<r;){const r=await e.queryReactions(t,a?{type:a}:{},s,{limit:o,next:i});n.push(...r.reactions),i=r.next,l=Boolean(i)}return n}(a,e.id,t,s)}catch(t){const a=i?.(e);throw l?.(a||o("Error fetching reactions"),"error"),t}}}},308336:function(e,t,a){a.d(t,{j:function(){return r}});var s=a(387029),n=a(983156);const r=(e,t,a)=>{const{channel:r,channelCapabilities:o={}}=(0,s.JN)("useUserRole"),{client:i}=(0,n.mx)("useUserRole"),l="admin"===i.user?.role||"admin"===r.state.membership.role,c="owner"===r.state.membership.role,d="channel_moderator"===i.user?.role||"channel_moderator"===r.state.membership.role||"moderator"===r.state.membership.role||!0===r.state.membership.is_moderator||"channel_moderator"===r.state.membership.channel_role,u=i.userID===e.user?.id,m=!e.poll&&(!t&&o["update-any-message"]||u&&o["update-own-message"]);return{canDelete:o["delete-any-message"]||u&&o["delete-own-message"],canEdit:m,canFlag:!u&&o["flag-message"],canMarkUnread:o["read-events"],canMute:!u&&o["mute-channel"],canQuote:!a&&o["quote-message"],canReact:o["send-reaction"],canReply:o["send-reply"],isAdmin:l,isModerator:d,isMyMessage:u,isOwner:c}}},329688:function(e,t,a){function s(e){return e.replace(/[-[\]{}()*+?.,/\\^$|#]/g,"\\$&")}a.d(t,{IE:function(){return r},Wd:function(){return n},aL:function(){return o},hr:function(){return s}});const n=/(http(s?):\/\/)?(www\.)?/,r=e=>e.match(/```[a-z]*\n[\s\S]*?\n```|`[a-z]*[\s\S]*?`/gm)||[],o=e=>{const t=e.match(/\[([^[]+)\](\(.*\))/gm),a=/\[([^[]+)\]\((.*)\)/;return(t?t.map((e=>{const t=a.exec(e);return t&&[t[1],t[2]]})):[]).flat()}},549238:function(e,t,a){a.d(t,{IY:function(){return T}});var s=a(667294),n=a(639567),r=a(161907),o=a(565155),i=a(18618),l=a.n(i),c=a(326219),d=a(770149);var u=a(329688),m=a(178434),g=a(158215),h=a(932545),p=a.n(h);const _=()=>{const e=e=>(0,g.u)("element",{properties:{},tagName:"emoji"},[(0,g.u)("text",e)]);return t=>(0,m.n)(t,[p()(),e])};var f=a(746435);const v=e=>{"html"===e.type&&(e.type="text")},E=e=>{(0,f.Vn)(e,v)},w=()=>E,M=(e,t,a)=>{if(!(t&&a&&e.position))return;const s=a.children.at(t-1);if(!s?.position)return;if(e.position.start.line===s.position.start.line)return;const n=e.position.start.line-s.position.end.line-1;if(n<1)return;const r=Array.from({length:n},(()=>(0,g.u)("break",{tagName:"br"})));a.children=[...a.children.slice(0,t),...r,...a.children.slice(t)]},y=e=>{(0,f.Vn)(e,M)},b=()=>y;var C=a(304069);const N=["html","text","br","p","em","strong","a","ol","ul","li","code","pre","blockquote","del","emoji","mention"];function S(e){try{return encodeURI(decodeURIComponent(e))}catch(t){return e}}const x=e=>e.startsWith("app://")?e:(0,n.A)(e),R=e=>e,k={a:({children:e,href:t})=>{const a=t?.startsWith("mailto:"),n=t?.startsWith("http");return t&&(a||n)?s.createElement("a",{className:(0,d.Z)({"str-chat__message-url-link":n}),href:t,rel:"nofollow noreferrer noopener",target:"_blank"},e):s.createElement(s.Fragment,null,e)},emoji:({children:e})=>s.createElement("span",{className:"inline-text-emoji","data-testid":"inline-text-emoji"},e),mention:({children:e,node:{mentionedUser:t}})=>s.createElement("span",{className:"str-chat__message-mention","data-user-id":t.id},e)},T=(e,t,{allowedTagNames:a=N,customMarkDownRenderers:n,getRehypePlugins:i=R,getRemarkPlugins:d=R}={})=>{if(!e)return null;if(1===e.trim().length)return s.createElement(s.Fragment,null,e);let h=e;const p=(0,u.aL)(h),v=(0,u.IE)(h);l()([...(0,o.sE)(h,"email"),...(0,o.sE)(h,"url")],"value").forEach((({href:e,type:a,value:s})=>{const n=v.some((e=>e?.includes(s))),r=p&&p.filter((t=>{const a=e?.replace(u.Wd,""),s=t?.replace(u.Wd,"");return!(!a||!s)&&(a.includes(s)||s.includes(a))}));if(!(r.length>0||n))try{if("email"===a&&t){if(t.some((e=>e.name===s)))return void(h=h.replace(new RegExp((0,u.hr)(s),"g"),((t,a)=>"@"===h.charAt(a-1)?t:`[${t}](${S(e)})`)))}const n="email"===a?s:function(e){try{return decodeURIComponent(e).replace(u.Wd,"")}catch(t){return e}}(e);h=h.replace(new RegExp((0,u.hr)(s),"g"),`[${n}](${S(e)})`)}catch(e){}}));const E=[w,b,[c.Z,{singleTilde:!1}]],M=[_];var y;return t?.length&&M.push((y=t,()=>{const e=y.map((e=>e.name||e.id)).filter(Boolean).map(u.hr),t=new RegExp(e.map((e=>`@${e}`)).join("|"),"g"),a=e=>{const t=e.replace("@",""),a=y.find((({id:e,name:a})=>a===t||e===t));return(0,g.u)("element",{mentionedUser:a,properties:{},tagName:"mention"},[(0,g.u)("text",e)])};return s=>{e.length&&((0,f.Vn)(s,((e,t,a)=>{if(void 0===t)return;if(!a)return;const s=a.children.at(t+1),n=s?.properties?.href;if("text"===e.type&&/.?\s?@$|^@$/.test(e.value)&&n?.startsWith("mailto:")){const s=e.value.replace(/@$/,""),r=n.replace("mailto:","");a.children[t]=(0,g.u)("text",s),a.children[t+1]=(0,g.u)("text",`@${r}`)}})),(0,m.n)(s,[t,a]))}})),s.createElement(C.S,{fallback:s.createElement(s.Fragment,null,e)},s.createElement(r.D,{allowedElements:a,components:{...k,...n},rehypePlugins:i(M),remarkPlugins:d(E),skipHtml:!0,transformLinkUri:x,unwrapDisallowed:!0},h))}},52127:function(e,t,a){a.d(t,{$l:function(){return C},B9:function(){return l},Dl:function(){return g},KI:function(){return v},Kh:function(){return y},Qn:function(){return M},Xh:function(){return c},Z1:function(){return d},fs:function(){return h},jb:function(){return w},nU:function(){return i},oT:function(){return u},s4:function(){return _},ue:function(){return E},yW:function(){return b},zs:function(){return f}});var s=a(416733),n=a.n(s),r=a(932545),o=a.n(r);const i=(e,t)=>{if(!e||"function"!=typeof e)return null;t instanceof Array||(t=[t]);const a=e(...t);return"string"!=typeof a?null:a},l=(e,t)=>{if(!t||!e)return!1;return!!t.filter((t=>t.target.id===e.user?.id)).length},c={delete:"delete",edit:"edit",flag:"flag",markUnread:"markUnread",mute:"mute",pin:"pin",quote:"quote",react:"react",reply:"reply"},d={commerce:{admin:!0,anonymous:!1,channel_member:!1,channel_moderator:!0,guest:!1,member:!1,moderator:!0,owner:!0,user:!1},gaming:{admin:!0,anonymous:!1,channel_member:!1,channel_moderator:!0,guest:!1,member:!1,moderator:!0,owner:!1,user:!1},livestream:{admin:!0,anonymous:!1,channel_member:!1,channel_moderator:!0,guest:!1,member:!1,moderator:!0,owner:!0,user:!1},messaging:{admin:!0,anonymous:!1,channel_member:!0,channel_moderator:!0,guest:!1,member:!0,moderator:!0,owner:!0,user:!1},team:{admin:!0,anonymous:!1,channel_member:!0,channel_moderator:!0,guest:!1,member:!0,moderator:!0,owner:!0,user:!1}},u=(e,{canDelete:t,canEdit:a,canFlag:s,canMarkUnread:n,canMute:r,canPin:o,canQuote:i,canReact:l,canReply:d})=>{const u=[];let m=[];if(e&&"boolean"==typeof e)m=Object.keys(c);else{if(!(e&&e.length>0))return[];m=[...e]}return t&&m.indexOf(c.delete)>-1&&u.push(c.delete),a&&m.indexOf(c.edit)>-1&&u.push(c.edit),s&&m.indexOf(c.flag)>-1&&u.push(c.flag),n&&m.indexOf(c.markUnread)>-1&&u.push(c.markUnread),r&&m.indexOf(c.mute)>-1&&u.push(c.mute),o&&m.indexOf(c.pin)>-1&&u.push(c.pin),i&&m.indexOf(c.quote)>-1&&u.push(c.quote),l&&m.indexOf(c.react)>-1&&u.push(c.react),d&&m.indexOf(c.reply)>-1&&u.push(c.reply),u},m=[c.pin,c.reply,c.markUnread],g=(e,t)=>h({inThread:t,messageActions:e}),h=({customMessageActions:e,CustomMessageActionsList:t,inThread:a,messageActions:s})=>void 0!==t||void 0!==e||!!s.length&&((!a||0!==s.filter((e=>!m.includes(e))).length)&&((1!==s.length||!s.includes(c.react)&&!s.includes(c.reply))&&(2!==s.length||!s.includes(c.react)||!s.includes(c.reply))));function p(e,t){return e.deleted_at===t.deleted_at&&e.latest_reactions?.length===t.latest_reactions?.length&&e.own_reactions?.length===t.own_reactions?.length&&e.pinned===t.pinned&&e.reply_count===t.reply_count&&e.status===t.status&&e.text===t.text&&e.type===t.type&&e.updated_at===t.updated_at&&e.user?.updated_at===t.user?.updated_at&&Boolean(e.quoted_message)===Boolean(t.quoted_message)&&(!e.quoted_message||p(e.quoted_message,t.quoted_message))}const _=(e,t)=>{const{message:a,Message:s}=e,{message:r,Message:o}=t;if(s!==o)return!1;if(e.endOfGroup!==t.endOfGroup)return!1;if(t.showDetailedReactions!==e.showDetailedReactions)return!1;if(t.closeReactionSelectorOnClick!==e.closeReactionSelectorOnClick)return!1;if(!p(a,r))return!1;return!!(n()(t.messageActions,e.messageActions)&&n()(t.readBy,e.readBy)&&n()(t.highlighted,e.highlighted)&&n()(t.groupStyles,e.groupStyles)&&n()(t.mutes,e.mutes)&&n()(t.lastReceivedId,e.lastReceivedId))&&e.messageListRect===t.messageListRect},f=(e,t)=>{const{lastReceivedId:a,message:s}=e,{lastReceivedId:n,message:r}=t;return e.editing===t.editing&&(e.highlighted===t.highlighted&&(e.endOfGroup===t.endOfGroup&&(e.mutes?.length===t.mutes?.length&&(e.readBy?.length===t.readBy?.length&&(e.groupStyles===t.groupStyles&&(e.showDetailedReactions===t.showDetailedReactions&&((s.id!==a&&s.id!==n||a===n)&&p(s,r))))))))},v=e=>Object.values(e?.reaction_groups??{}).some((({count:e})=>e>0)),E=e=>!!e?.attachments&&!!e.attachments.length,w=e=>e.name||e.id,M=(e,t,a,s)=>{let n="";if(!t)throw new Error("getReadByTooltipText was called, but translation function is not available");if(!s)throw new Error("getReadByTooltipText was called, but tooltipUserNameMapper function is not available");const r=e.filter((e=>e&&a?.user&&e.id!==a.user.id)).map(s),o=r.slice(0,5),i=r.length-o.length;if(1===o.length)n=`${o[0]} `;else if(2===o.length)n=t("{{ firstUser }} and {{ secondUser }}",{firstUser:o[0],secondUser:o[1]});else if(o.length>2)if(0===i){const e=o.splice(o.length-1,1);n=t("{{ commaSeparatedUsers }}, and {{ lastUser }}",{commaSeparatedUsers:o.join(", "),lastUser:e})}else n=t("{{ commaSeparatedUsers }} and {{ moreCount }} more",{commaSeparatedUsers:o.join(", "),moreCount:i});return n},y=e=>{if(!e)return!1;return!e.replace(o()(),"").replace(/[\s\n]/gm,"")},b=e=>"error"===e.type&&("MESSAGE_RESPONSE_ACTION_BOUNCE"===e.moderation_details?.action||"bounce"===e.moderation?.action),C=e=>!!e.message_text_updated_at},368493:function(e,t,a){a.d(t,{g:function(){return u}});var s=a(667294),n=a(633999),r=a(696808),o=a(887182),i=a(181935),l=a(387029),c=a(321707);const d=({children:e})=>{const{acceptedFiles:t,multipleUploads:a}=(0,l.JN)("DropzoneProvider"),{cooldownRemaining:r,isUploadEnabled:o,maxFilesLeft:i,uploadNewFiles:d}=(0,c.Nc)("DropzoneProvider");return s.createElement(n.v,{accept:t,disabled:!o||0===i||!!r,handleFiles:d,maxNumberOfFiles:i,multiple:a},e)},u=e=>{const t=(0,r._)(),a=(0,i.k)(e),n=(0,o.u)({...t,...a,...e});return s.createElement(c.G6,{value:n},s.createElement(d,null,e.children))}},386527:function(e,t,a){a.d(t,{w:function(){return i}});var s=a(667294),n=a(619494),r=a(21681),o=a(321707);const i=()=>{const{t:e}=(0,r.Ht)("EditMessageForm"),{clearEditingState:t,handleSubmit:a}=(0,o.Nc)("EditMessageForm");return(0,s.useEffect)((()=>{const e=e=>{"Escape"===e.key&&t?.()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[t]),s.createElement("form",{autoComplete:"off",className:"str-chat__edit-message-form",onSubmit:a},s.createElement(n.r,null),s.createElement("div",{className:"str-chat__edit-message-form-options"},s.createElement("button",{className:"str-chat__edit-message-cancel","data-testid":"cancel-button",onClick:t},e("Cancel")),s.createElement("button",{className:"str-chat__edit-message-send","data-testid":"send-button-edit-form",type:"submit"},e("Send"))))}},910758:function(e,t,a){a.d(t,{R:function(){return N}});var s=a(667294),n=a(516164),r=a(387029),o=a(21681);const i=()=>{const{channelConfig:e}=(0,r.JN)("useCommandTrigger"),{t:t}=(0,o.Ht)("useCommandTrigger"),a=e?.commands;return{component:n.d,dataProvider:(e,s,n)=>{if(0!==s.indexOf("/")||!a)return[];const r=a.filter((t=>-1!==t.name?.indexOf(e)));r.sort(((t,a)=>{let s=t.name?.toLowerCase(),n=a.name?.toLowerCase();if(0===s?.indexOf(e)&&(s=`0${s}`),0===n?.indexOf(e)&&(n=`0${n}`),null!=s&&null!=n){if(s<n)return-1;if(s>n)return 1}return 0}));const o=r.slice(0,5);return n&&n(o.filter((e=>void 0!==e.name)).map((e=>{const a={name:e.name};return e.args&&(a.args=t(`${e.name}-command-args`,{defaultValue:e.args})),e.description&&(a.description=t(`${e.name}-command-description`,{defaultValue:e.description})),a})),e),o},output:e=>({caretPosition:"next",key:e.name,text:`/${e.name}`})}};var l=a(648371);var c=a(493096),d=a.n(c),u=a(844068),m=a(109509),g=a(983156),h=a(425108);const p=e=>{const{disableMentions:t,mentionAllAppUsers:a,mentionQueryParams:n={},onSelectUser:o,useMentionsTransliteration:i}=e,[l,c]=(0,s.useState)(!1),{client:p,mutes:_}=(0,g.mx)("useUserTrigger"),{channel:f}=(0,r.JN)("useUserTrigger"),{members:v}=f.state,{watchers:E}=f.state,w=(0,s.useCallback)((()=>{const e=[...v?Object.values(v).map((({user:e})=>e)):[],...E?Object.values(E):[]],t={};return e.forEach((e=>{e&&!t[e.id]&&(t[e.id]=e)})),Object.values(t)}),[v,E]),M=(0,s.useCallback)(d()((async(e,t)=>{try{const a=(await f.queryMembers({name:{$autocomplete:e}})).members.map((e=>e.user));t&&a.length?t(a):t([])}catch(e){h.log({error:e})}}),200),[f]),y=d()((async(e,t)=>{if(e&&!l){c(!0);try{const{users:a}=await p.queryUsers({$or:[{id:{$autocomplete:e}},{name:{$autocomplete:e}}],..."function"==typeof n.filters?n.filters(e):n.filters},Array.isArray(n.sort)?[{id:1},...n.sort]:{id:1,...n.sort},{limit:10,...n.options});t&&a.length?t(a):t([])}catch(e){h.log({error:e})}c(!1)}}),200);return{callback:e=>o(e),component:m.E,dataProvider:(e,s,r)=>{if(t)return;const o=e=>s.includes("/unmute")&&!_.length?[]:_.length?s.includes("/unmute")?e.filter((e=>_.some((t=>t.target.id===e.id)))):e.filter((e=>_.every((t=>t.target.id!==e.id)))):e;if(a)return y(e,(t=>{r&&r(o(t),e)}));if(!e||Object.values(v||{}).length<100){const t=w(),a={ownUserId:p.userID,query:e,text:s,useMentionsTransliteration:i,users:t},l=(0,u.i_)(a),c=n.options?.limit??7,d=l.slice(0,c);return r&&r(o(d),e),d}return M(e,(t=>{r&&r(o(t),e)}))},output:e=>({caretPosition:"next",key:e.id,text:`@${e.name||e.id}`})}};var _=a(321707);const f=({children:e})=>{const t=(0,_.Nc)("DefaultTriggerProvider"),a={"/":i(),":":(n=t.emojiSearchIndex,{component:l.t,dataProvider:async(e,t,a)=>{if(0===e.length||e.charAt(0).match(/[^a-zA-Z0-9+-]/))return a([],e);const s=(await(n?.search(e))??[]).filter(Boolean).slice(0,7).map((({id:e,name:t,native:a,skins:s=[]})=>{const[n]=s;return{id:e,name:t,native:a??n.native}}));a&&a(s,e)},output:e=>({caretPosition:"next",key:e.id,text:`${"native"in e?e.native:""}`})}),"@":p({disableMentions:t.disableMentions,mentionAllAppUsers:t.mentionAllAppUsers,mentionQueryParams:t.mentionQueryParams,onSelectUser:t.onSelectUser,useMentionsTransliteration:t.useMentionsTransliteration})};var n;const r={...t,autocompleteTriggers:a};return s.createElement(_.G6,{value:r},e)};var v=a(619494),E=a(696808),w=a(887182),M=a(181935),y=a(540239),b=a(193283);const C=e=>{const t=(0,E._)(),a=(0,M.k)(e),{emojiSearchIndex:n}=(0,y.yM)("MessageInput"),r=(0,w.u)({...t,...a,...e,emojiSearchIndex:e.emojiSearchIndex??n});return s.createElement(_.G6,{value:r},e.children)},N=s.memo((e=>{const{Input:t}=e,{dragAndDropWindow:a}=(0,r.JN)(),{Input:n,TriggerProvider:o=f}=(0,y.yM)("MessageInput"),i=t||n||v.r,l=e.isThreadInput?"message-input-dialog-manager-thread":"message-input-dialog-manager";return a?s.createElement(b.r,{id:l},s.createElement(o,null,s.createElement(i,null))):s.createElement(b.r,{id:l},s.createElement(C,{...e},s.createElement(o,null,s.createElement(i,null))))}))},619494:function(e,t,a){a.d(t,{r:function(){return pe}});var s=a(667294),n=a(770149),r=a(50125),o=a(900373),i=a(345291),l=a(771762),c=a(219025),d=a(869725),u=a(520826),m=a(827666),g=a(569203),h=a(864351),p=a(99314),_=a(21681);const f={"Option already exists":!0},v=({errors:e,options:t,setErrors:a,setState:r})=>{const{t:i}=(0,_.Ht)("OptionFieldSet"),l=e=>t.find((t=>!!e.text.trim()&&t.id!==e.id&&t.text.trim()===e.text.trim())),c=(0,s.useCallback)((e=>{r((t=>({...t,options:e.map((e=>t.options[e]))})))}),[r]),d=t.length>1;return s.createElement("fieldset",{className:"str-chat__form__field str-chat__form__input-fieldset"},s.createElement("legend",{className:"str-chat__form__field-label"},i("Options")),s.createElement(p.l,{className:"str-chat__form__input-fieldset__values",draggable:d,onSetNewOrder:c},t.map(((c,u)=>s.createElement("div",{className:(0,n.Z)("str-chat__form__input-field",{"str-chat__form__input-field--draggable":d,"str-chat__form__input-field--has-error":e[c.id]}),key:`new-poll-option-${u}`},s.createElement("div",{className:"str-chat__form__input-field__value"},s.createElement(g.c,{className:"str-chat__form__input-field__error","data-testid":"poll-option-input-field-error",text:e[c.id]}),s.createElement("input",{id:c.id,onBlur:e=>{l({id:e.target.id,text:e.target.value})&&a((t=>({...t,[e.target.id]:i("Option already exists")})))},onChange:t=>{r((s=>{const n=s.options.length<h.wj&&(!s.options||0===s.options.slice(u+1).length&&!!t.target.value),r=s.options&&s.options.slice(u+1).length>0&&!t.target.value,i=s.options?s.options.slice(0,u):[],d=n?[{id:(0,o.x0)(),text:""}]:(s.options||[]).slice(u+1);return(e[c.id]&&!t.target.value||f[e[c.id]]&&!l({id:t.target.id,text:t.target.value}))&&a((e=>(delete e[c.id],e))),{...s,options:[...i,...r?[]:[{...c,text:t.target.value}],...d]}}))},onKeyUp:e=>{if("Enter"===e.key){const e=t[u+1].id;document.getElementById(e)?.focus()}},placeholder:i("Add an option"),type:"text",value:c.text})),d&&s.createElement("div",{className:"str-chat__drag-handle"}))))))};var E=a(983156),w=a(321707);const M=({close:e,errors:t,state:a})=>{const{client:n}=(0,E.mx)(),{t:r}=(0,_.Ht)("PollCreationDialogControls"),{handleSubmit:o}=(0,w.Nc)("PollCreationDialogControls");return s.createElement("div",{className:"str-chat__dialog__controls"},s.createElement("button",{className:"str-chat__dialog__controls-button str-chat__dialog__controls-button--cancel",onClick:e},r("Cancel")),s.createElement("button",{className:"str-chat__dialog__controls-button str-chat__dialog__controls-button--submit",disabled:!(()=>{const e=a.options.filter((e=>!!e.text)).length>0,s=!!a.name,n=parseInt(a.max_votes_allowed?.match(h.BV)?.[0]||""),r=""===a.max_votes_allowed||!!n&&(2<=n||n<=10),o=0===t.length;return e&&s&&r&&o})(),onClick:async t=>{let s;try{const{poll:e}=await n.createPoll({...a,max_votes_allowed:a.max_votes_allowed?parseInt(a.max_votes_allowed):void 0,options:a.options?.filter((e=>e.text)).map((e=>({text:e.text})))});s=e.id}catch(t){return}try{await o(t,{poll_id:s})}catch(t){return}e()},type:"submit"},r("Create")))};var y=a(238110),b=a(166793);const C=({close:e})=>{const{client:t}=(0,E.mx)(),{t:a}=(0,_.Ht)(),[r,i]=(0,s.useState)(),[l,c]=(0,s.useState)({}),[d,u]=(0,s.useState)(),[m,p]=(0,s.useState)((()=>({allow_answers:!1,allow_user_suggested_options:!1,description:"",enforce_unique_vote:!0,id:(0,o.x0)(),max_votes_allowed:"",name:"",options:[{id:(0,o.x0)(),text:""}],user_id:t.user?.id,voting_visibility:"public"})));return s.createElement("div",{className:"str-chat__dialog str-chat__poll-creation-dialog","data-testid":"poll-creation-dialog"},s.createElement(y.x,{close:e,title:a("Create poll")}),s.createElement("div",{className:"str-chat__dialog__body"},s.createElement("form",{autoComplete:"off"},s.createElement("div",{className:(0,n.Z)("str-chat__form__field str-chat__form__input-field str-chat__form__input-field--with-label",{"str-chat__form__input-field--has-error":r})},s.createElement("label",{className:"str-chat__form__field-label",htmlFor:"name"},a("Question")),s.createElement("div",{className:(0,n.Z)("str-chat__form__input-field__value")},s.createElement(g.c,{className:"str-chat__form__input-field__error","data-testid":"poll-name-input-field-error",text:r}),s.createElement("input",{id:"name",onBlur:e=>{e.target.value||i("The field is required")},onChange:e=>{p((t=>({...t,name:e.target.value}))),r&&e.target.value&&i(void 0)},placeholder:a("Ask a question"),type:"text",value:m.name}))),s.createElement(v,{errors:l,options:m.options,setErrors:c,setState:p}),s.createElement("div",{className:(0,n.Z)("str-chat__form__expandable-field",{"str-chat__form__expandable-field--expanded":!m.enforce_unique_vote})},s.createElement(b.I,{checked:!m.enforce_unique_vote,id:"enforce_unique_vote",labelText:a("Multiple answers"),onChange:e=>{p((t=>({...t,enforce_unique_vote:!e.target.checked,max_votes_allowed:""}))),u(void 0)}}),!m.enforce_unique_vote&&s.createElement("div",{className:(0,n.Z)("str-chat__form__input-field",{"str-chat__form__input-field--has-error":d})},s.createElement("div",{className:(0,n.Z)("str-chat__form__input-field__value")},s.createElement(g.c,{className:"str-chat__form__input-field__error","data-testid":"poll-max-votes-allowed-input-field-error",text:d}),s.createElement("input",{id:"max_votes_allowed",onChange:e=>{!e.target.value||e.target.value.match(h.BV)?d&&u(void 0):u(a("Type a number from 2 to 10")),p((t=>({...t,max_votes_allowed:e.target.value})))},placeholder:a("Maximum number of votes (from 2 to 10)"),type:"number",value:m.max_votes_allowed})))),s.createElement(b.I,{checked:"anonymous"===m.voting_visibility,id:"voting_visibility",labelText:a("Anonymous poll"),onChange:e=>p((t=>({...t,voting_visibility:e.target.checked?"anonymous":"public"})))}),s.createElement(b.I,{checked:m.allow_user_suggested_options,id:"allow_user_suggested_options",labelText:a("Allow option suggestion"),onChange:e=>p((t=>({...t,allow_user_suggested_options:e.target.checked})))}),s.createElement(b.I,{checked:m.allow_answers,id:"allow_answers",labelText:a("Allow comments"),onChange:e=>p((t=>({...t,allow_answers:e.target.checked})))}))),s.createElement(M,{close:e,errors:[...r??[],...d??[],...Object.keys(l)],state:m}))};var N=a(803897),S=a(636873),x=a(540239),R=a(387029),k=a(656813);const T=()=>{const{AttachmentSelectorInitiationButtonContents:e,FileUploadIcon:t=i.rG}=(0,x.yM)(),a=(0,s.useRef)(null),[n,r]=(0,s.useState)(null),l=(0,s.useMemo)((()=>(0,o.x0)()),[]);return(0,s.useEffect)((()=>{if(!n)return;const e=e=>{[" ","Enter"].includes(e.key)&&a.current&&(e.preventDefault(),a.current.click())};return n.addEventListener("keyup",e),()=>{n.removeEventListener("keyup",e)}}),[n]),s.createElement("div",{className:"str-chat__file-input-container","data-testid":"file-upload-button"},s.createElement(S.pQ,{id:l,ref:a}),s.createElement("label",{className:"str-chat__file-input-label",htmlFor:l,ref:r,tabIndex:0},e?s.createElement(e,null):s.createElement(t,null)))},L=()=>{const{AttachmentSelectorInitiationButtonContents:e,FileUploadIcon:t}=(0,x.yM)("SimpleAttachmentSelector");return e?s.createElement(e,null):t?s.createElement(t,null):s.createElement("div",{className:"str-chat__attachment-selector__menu-button__icon"})},U={File({closeMenu:e}){const{t:t}=(0,_.Ht)(),{fileInput:a}=(0,k.s)();return s.createElement(u.K,{className:"str-chat__attachment-selector-actions-menu__button str-chat__attachment-selector-actions-menu__upload-file-button",onClick:()=>{a&&a.click(),e()}},t("File"))},Poll({closeMenu:e,openModalForAction:t}){const{t:a}=(0,_.Ht)();return s.createElement(u.K,{className:"str-chat__attachment-selector-actions-menu__button str-chat__attachment-selector-actions-menu__create-poll-button",onClick:()=>{t("createPoll"),e()}},a("Poll"))}},A=[{ActionButton:U.File,type:"uploadFile"},{ActionButton:U.Poll,type:"createPoll"}],P=({attachmentSelectorActionSet:e=A,getModalPortalDestination:t})=>{const{t:a}=(0,_.Ht)(),{channelCapabilities:n}=(0,R.JN)(),{isThreadInput:r}=(0,w.Nc)(),o=(e=>{const{PollCreationDialog:t=C}=(0,x.yM)(),{channelCapabilities:a,channelConfig:s}=(0,R.JN)(),{isThreadInput:n}=(0,w.Nc)();return e.filter((e=>!("uploadFile"===e.type&&!a["upload-file"]||!("createPoll"!==e.type||s?.polls&&!n&&a["send-poll"])))).map((e=>"createPoll"!==e.type||e.ModalContent?e:{...e,ModalContent:t}))})(e),i="attachment-actions-menu"+(r?"-thread":""),u=(0,c.Rh)({id:i}),g=(0,c.wB)(i),[h,p]=(0,s.useState)(),f=(0,s.useCallback)((e=>{const t=o.find((t=>t.type===e));t?.ModalContent&&p(t)}),[o]),v=(0,s.useCallback)((()=>p(void 0)),[]),[E,M]=(0,s.useState)(null),y=(0,s.useRef)(null),b=(0,s.useCallback)((()=>document.getElementById(l.l)),[]);if(0===o.length)return null;if(1===o.length&&"uploadFile"===o[0].type)return s.createElement(T,null);const U=h?.ModalContent,P=!!U;return s.createElement(k.y,{value:{fileInput:E}},s.createElement("div",{className:"str-chat__attachment-selector"},n["upload-file"]&&s.createElement(S.pQ,{ref:M}),s.createElement("button",{"aria-expanded":g,"aria-haspopup":"true","aria-label":a("aria/Open Attachment Selector"),className:"str-chat__attachment-selector__menu-button","data-testid":"invoke-attachment-selector-button",onClick:()=>u?.toggle(),ref:y},s.createElement(L,null)),s.createElement(d.l,{id:i,placement:"top-start",referenceElement:y.current,trapFocus:!0},s.createElement("div",{className:"str-chat__attachment-selector-actions-menu str-chat__dialog-menu","data-testid":"attachment-selector-actions-menu"},o.map((({ActionButton:e,type:t})=>s.createElement(e,{closeMenu:u.close,key:`attachment-selector-item-${t}`,openModalForAction:f}))))),s.createElement(N.h,{getPortalDestination:t??b,isOpen:P},s.createElement(m.u,{className:"str-chat__create-poll-modal",onClose:v,open:P},U&&s.createElement(U,{close:v})))))};var D=a(431840);const I=({attachment:e,handleRetry:t,removeAttachments:a})=>{const{t:n}=(0,_.Ht)("UnsupportedAttachmentPreview"),r=e.title??n("Unsupported attachment");return s.createElement("div",{className:"str-chat__attachment-preview-unsupported","data-testid":"attachment-preview-unknown"},s.createElement("div",{className:"str-chat__attachment-preview-file-icon"},s.createElement(D.a,{filename:r,mimeType:e.mime_type})),s.createElement("button",{className:"str-chat__attachment-preview-delete","data-testid":"file-preview-item-delete-button",disabled:"uploading"===e.localMetadata?.uploadState,onClick:()=>e.localMetadata?.id&&a([e.localMetadata?.id])},s.createElement(i.Tw,null)),"failed"===e.localMetadata?.uploadState&&!!t&&s.createElement("button",{className:"str-chat__attachment-preview-error str-chat__attachment-preview-error-file","data-testid":"file-preview-item-retry-button",onClick:()=>t(e)},s.createElement(i.Oe,null)),s.createElement("div",{className:"str-chat__attachment-preview-metadata"},s.createElement("div",{className:"str-chat__attachment-preview-title",title:r},r),"finished"===e.localMetadata?.uploadState&&!!e.asset_url&&s.createElement("a",{className:"str-chat__attachment-preview-file-download",download:!0,href:e.asset_url,rel:"noreferrer",target:"_blank"},s.createElement(i._8,null)),"uploading"===e.localMetadata?.uploadState&&s.createElement(i.VK,{size:17})))};var O=a(822787),H=a(432228);const B=({durationSeconds:e})=>s.createElement("div",{className:(0,n.Z)("str-chat__recording-timer",{"str-chat__recording-timer--hours":e>=3600})},(0,H.dp)(e));var F=a(309288);const G=({attachment:e,handleRetry:t,removeAttachments:a})=>{const{audioRef:n,isPlaying:r,secondsElapsed:o,togglePlay:l}=(0,F.P)({mimeType:e.mime_type});return s.createElement("div",{className:"str-chat__attachment-preview-voice-recording","data-testid":"attachment-preview-voice-recording"},s.createElement("audio",{ref:n},s.createElement("source",{"data-testid":"audio-source",src:e.asset_url,type:e.mime_type})),s.createElement(O.J,{isPlaying:r,onClick:l}),s.createElement("button",{className:"str-chat__attachment-preview-delete","data-testid":"file-preview-item-delete-button",disabled:"uploading"===e.localMetadata?.uploadState,onClick:()=>e.localMetadata?.id&&a([e.localMetadata.id])},s.createElement(i.Tw,null)),"failed"===e.localMetadata?.uploadState&&!!t&&s.createElement("button",{className:"str-chat__attachment-preview-error str-chat__attachment-preview-error-file","data-testid":"file-preview-item-retry-button",onClick:()=>t(e)},s.createElement(i.Oe,null)),s.createElement("div",{className:"str-chat__attachment-preview-metadata"},s.createElement("div",{className:"str-chat__attachment-preview-file-name",title:e.title},e.title),void 0!==e.duration&&s.createElement(B,{durationSeconds:o||e.duration}),"uploading"===e.localMetadata?.uploadState&&s.createElement(i.VK,{size:17})),s.createElement("div",{className:"str-chat__attachment-preview-file-icon"},s.createElement(D.a,{filename:e.title,mimeType:e.mime_type})))},q=({attachment:e,handleRetry:t,removeAttachments:a})=>{const{t:n}=(0,_.Ht)("FilePreview");return s.createElement("div",{className:"str-chat__attachment-preview-file","data-testid":"attachment-preview-file"},s.createElement("div",{className:"str-chat__attachment-preview-file-icon"},s.createElement(D.a,{filename:e.title,mimeType:e.mime_type})),s.createElement("button",{"aria-label":n("aria/Remove attachment"),className:"str-chat__attachment-preview-delete","data-testid":"file-preview-item-delete-button",disabled:"uploading"===e.localMetadata?.uploadState,onClick:()=>e.localMetadata?.id&&a([e.localMetadata?.id])},s.createElement(i.Tw,null)),"failed"===e.localMetadata?.uploadState&&!!t&&s.createElement("button",{className:"str-chat__attachment-preview-error str-chat__attachment-preview-error-file","data-testid":"file-preview-item-retry-button",onClick:()=>t(e)},s.createElement(i.Oe,null)),s.createElement("div",{className:"str-chat__attachment-preview-file-end"},s.createElement("div",{className:"str-chat__attachment-preview-file-name",title:e.title},e.title),"finished"===e.localMetadata?.uploadState&&!!e.asset_url&&s.createElement("a",{"aria-label":n("aria/Download attachment"),className:"str-chat__attachment-preview-file-download",download:!0,href:e.asset_url,rel:"noreferrer",target:"_blank",title:n("Download attachment {{ name }}",{name:e.title})},s.createElement(i._8,null)),"uploading"===e.localMetadata?.uploadState&&s.createElement(i.VK,{size:17})))};var V=a(606892);const $=({attachment:e,handleRetry:t,removeAttachments:a})=>{const{t:r}=(0,_.Ht)("ImagePreviewItem"),{BaseImage:o=V.Z}=(0,x.yM)("ImagePreview"),[l,c]=(0,s.useState)(!1),{id:d,uploadState:u}=e.localMetadata??{},m=(0,s.useCallback)((()=>c(!0)),[]),g=e.image_url||e.localMetadata.previewUri;return s.createElement("div",{className:(0,n.Z)("str-chat__attachment-preview-image",{"str-chat__attachment-preview-image--error":l}),"data-testid":"attachment-preview-image"},s.createElement("button",{"aria-label":r("aria/Remove attachment"),className:"str-chat__attachment-preview-delete","data-testid":"image-preview-item-delete-button",disabled:"uploading"===u,onClick:()=>d&&a([d])},s.createElement(i.Tw,null)),"failed"===u&&s.createElement("button",{className:"str-chat__attachment-preview-error str-chat__attachment-preview-error-image","data-testid":"image-preview-item-retry-button",onClick:()=>t(e)},s.createElement(i.Oe,null)),"uploading"===u&&s.createElement("div",{className:"str-chat__attachment-preview-image-loading"},s.createElement(i.VK,{size:17})),g&&s.createElement(o,{alt:e.fallback,className:"str-chat__attachment-preview-thumbnail",onError:m,src:g,title:e.fallback}))},z=({AudioAttachmentPreview:e=q,FileAttachmentPreview:t=q,ImageAttachmentPreview:a=$,UnsupportedAttachmentPreview:n=I,VideoAttachmentPreview:r=q,VoiceRecordingPreview:o=G})=>{const{attachments:i,removeAttachments:l,uploadAttachment:c}=(0,w.Nc)("AttachmentPreviewList");return s.createElement("div",{className:"str-chat__attachment-preview-list"},s.createElement("div",{className:"str-chat__attachment-list-scroll-container","data-testid":"attachment-list-scroll-container"},i.map((i=>(0,H.VO)(i)?null:(0,H.JO)(i)?s.createElement(o,{attachment:i,handleRetry:c,key:i.localMetadata.id||i.asset_url,removeAttachments:l}):(0,H.V8)(i)?s.createElement(e,{attachment:i,handleRetry:c,key:i.localMetadata.id||i.asset_url,removeAttachments:l}):(0,H.EM)(i)?s.createElement(r,{attachment:i,handleRetry:c,key:i.localMetadata.id||i.asset_url,removeAttachments:l}):(0,H.SW)(i)?s.createElement(a,{attachment:i,handleRetry:c,key:i.localMetadata.id||i.image_url,removeAttachments:l}):(0,H.es)(i)?s.createElement(t,{attachment:i,handleRetry:c,key:i.localMetadata.id||i.asset_url,removeAttachments:l}):(0,H.a9)(i)?s.createElement(n,{attachment:i,handleRetry:c,key:i.localMetadata.id,removeAttachments:l}):null))))},Z=({cooldownInterval:e})=>{const t=(({startFrom:e})=>{const[t,a]=(0,s.useState)();return(0,s.useEffect)((()=>{let e;return"number"==typeof t&&t>0&&(e=setTimeout((()=>{a(t-1)}),1e3)),()=>{clearTimeout(e)}}),[t]),(0,s.useEffect)((()=>{a(e??0)}),[e]),t})({startFrom:e});return s.createElement("div",{className:"str-chat__message-input-cooldown","data-testid":"cooldown-timer"},t)};var j=a(215487),Q=a(90725);const J=({durationSeconds:e,mimeType:t,waveformData:a,...n})=>{const{audioRef:r,isPlaying:o,progress:l,secondsElapsed:c,seek:d,togglePlay:u}=(0,F.P)({durationSeconds:e,mimeType:t}),m=c||e;return s.createElement(s.Fragment,null,s.createElement("audio",{ref:r},s.createElement("source",{src:n.src,type:t})),s.createElement("button",{className:"str-chat__audio_recorder__toggle-playback-button","data-testid":"audio-recording-preview-toggle-play-btn",onClick:u},o?s.createElement(i.fp,null):s.createElement(i.o1,null)),s.createElement(B,{durationSeconds:m}),s.createElement("div",{className:"str-chat__wave-progress-bar__track-container"},s.createElement(Q.e,{progress:l,seek:d,waveformData:a||[]})))},K=({maxDataPointsDrawn:e=100})=>{const{recordingController:{recorder:t}}=(0,w.Nc)(),[a,n]=(0,s.useState)([]);return(0,s.useEffect)((()=>{if(!t?.amplitudeRecorder)return;const e=t.amplitudeRecorder.amplitudes.subscribe(n);return()=>{e.unsubscribe()}}),[t]),t?s.createElement("div",{className:"str-chat__waveform-box-container"},s.createElement("div",{className:"str-chat__audio_recorder__waveform-box"},a.slice(-e).map(((e,t)=>s.createElement("div",{className:"str-chat__wave-progress-bar__amplitude-bar",key:`amplitude-${t}-voice-recording`,style:{"--str-chat__wave-progress-bar__amplitude-bar-height":e?100*e+"%":"0%"}}))))):null},W=()=>{const{secondsElapsed:e,startCounter:t,stopCounter:a}=(({startOnMount:e}={})=>{const[t,a]=(0,s.useState)(0),n=(0,s.useRef)(),r=(0,s.useCallback)((()=>{n.current||(n.current=setInterval((()=>{a((e=>e+1))}),1e3))}),[]),o=(0,s.useCallback)((()=>{clearInterval(n.current),n.current=void 0}),[]);return(0,s.useEffect)((()=>{if(e)return r(),()=>{o()}}),[r,e,o]),{secondsElapsed:t,startCounter:r,stopCounter:o}})(),{recordingController:{recorder:n}}=(0,w.Nc)();return(0,s.useEffect)((()=>{if(!n?.mediaRecorder)return;const{mediaRecorder:e}=n;return"recording"===e.state&&t(),e.addEventListener("start",t),e.addEventListener("resume",t),e.addEventListener("stop",a),e.addEventListener("pause",a),()=>{e.removeEventListener("start",t),e.removeEventListener("resume",t),e.removeEventListener("stop",a),e.removeEventListener("pause",a)}}),[n,t,a]),s.createElement(s.Fragment,null,s.createElement(B,{durationSeconds:e}),s.createElement(K,null))};var X=a(255926);const Y=()=>{const{recordingController:{completeRecording:e,recorder:t,recording:a,recordingState:n}}=(0,w.Nc)(),r="uploading"===a?.localMetadata?.uploadState,o=(0,s.useMemo)((()=>({paused:n===X.vJ.PAUSED,recording:n===X.vJ.RECORDING,stopped:n===X.vJ.STOPPED})),[n]);return t?s.createElement("div",{className:"str-chat__audio_recorder-container"},s.createElement("div",{className:"str-chat__audio_recorder","data-testid":"audio-recorder"},s.createElement("button",{className:"str-chat__audio_recorder__cancel-button","data-testid":"cancel-recording-audio-button",disabled:r,onClick:t.cancel},s.createElement(i.Q9,null)),o.stopped&&a?.asset_url?s.createElement(J,{durationSeconds:a.duration??0,mimeType:a.mime_type,src:a.asset_url,waveformData:a.waveform_data}):o.paused||o.recording?s.createElement(W,null):null,o.paused&&s.createElement("button",{className:"str-chat__audio_recorder__resume-recording-button",onClick:t.resume},s.createElement(i.ZO,null)),o.recording&&s.createElement("button",{className:"str-chat__audio_recorder__pause-recording-button","data-testid":"pause-recording-audio-button",onClick:t.pause},s.createElement(i.fp,null)),o.stopped?s.createElement("button",{className:"str-chat__audio_recorder__complete-button","data-testid":"audio-recorder-complete-button",disabled:r,onClick:e},r?s.createElement(i.VK,null):s.createElement(i.jE,null)):s.createElement("button",{className:"str-chat__audio_recorder__stop-button","data-testid":"audio-recorder-stop-button",onClick:t.stop},s.createElement(i.Vd,null)))):null},ee=({onClose:e,permissionName:t})=>{const{t:a}=(0,_.Ht)(),n={body:{camera:a("To start recording, allow the camera access in your browser"),microphone:a("To start recording, allow the microphone access in your browser")},heading:{camera:a("Allow access to camera"),microphone:a("Allow access to microphone")}};return s.createElement("div",{className:"str-chat__recording-permission-denied-notification"},s.createElement("div",{className:"str-chat__recording-permission-denied-notification__heading"},n.heading[t]),s.createElement("p",{className:"str-chat__recording-permission-denied-notification__message"},n.body[t]),s.createElement("div",{className:"str-chat__recording-permission-denied-notification__dismiss-button-container"},s.createElement("button",{className:"str-chat__recording-permission-denied-notification__dismiss-button",onClick:e},a("Ok"))))},te=e=>s.createElement("button",{"aria-label":"Start recording audio",className:"str-chat__start-recording-audio-button","data-testid":"start-recording-audio-button",...e},s.createElement(i.ZO,null));var ae=a(304783),se=a(852429),ne=a(613943),re=a(932313),oe=a(437495);const ie=()=>{const{setQuotedMessage:e}=(0,oe.uz)("QuotedMessagePreview"),{t:t}=(0,_.Ht)("QuotedMessagePreview");return s.createElement("div",{className:"str-chat__quoted-message-preview-header"},s.createElement("div",{className:"str-chat__quoted-message-reply-to-message"},t("Reply to Message")),s.createElement("button",{"aria-label":t("aria/Cancel Reply"),className:"str-chat__quoted-message-remove",onClick:()=>e(void 0)},s.createElement(i.Tw,null)))},le=({quotedMessage:e})=>{const{client:t}=(0,E.mx)(),{Attachment:a=se.P,Avatar:n=ne.q}=(0,x.yM)("QuotedMessagePreview"),{userLanguage:r}=(0,_.Ht)("QuotedMessagePreview"),o=e.i18n?.[`${r}_text`]||e.text,i=(0,s.useMemo)((()=>{const[t]=e.attachments??[];return t?[t]:[]}),[e.attachments]);if(!o&&!i)return null;const l=e.poll_id&&t.polls.fromState(e.poll_id);return s.createElement("div",{className:"str-chat__quoted-message-preview","data-testid":"quoted-message-preview"},e.user&&s.createElement(n,{className:"str-chat__avatar--quoted-message-sender",image:e.user.image,name:e.user.name||e.user.id,user:e.user}),s.createElement("div",{className:"str-chat__quoted-message-bubble"},l?s.createElement(re.n,{isQuoted:!0,poll:l}):s.createElement(s.Fragment,null,!!i.length&&s.createElement(a,{attachments:i,isQuoted:!0}),s.createElement("div",{className:"str-chat__quoted-message-text","data-testid":"quoted-message-text"},s.createElement("p",null,o)))))};var ce=a(427882),de=a(19382),ue=a(451385);const me=({linkPreviews:e})=>{const{quotedMessage:t}=(0,R.JN)();return e.length>0&&!t?s.createElement("div",{className:"str-chat__link-preview-list"},Array.from(e.values()).map((e=>e.state===ce.G.LOADED?s.createElement(ge,{key:e.og_scrape_url,linkPreview:e}):null))):null},ge=({linkPreview:e})=>{const{dismissLinkPreview:t}=(0,w.Nc)(),{handleEnter:a,handleLeave:r,tooltipVisible:o}=(0,ue.r)(),[l,c]=(0,s.useState)(null);return s.createElement("div",{className:(0,n.Z)("str-chat__link-preview-card",{"str-chat__link-preview-card--loading":e.state===ce.G.LOADING}),"data-testid":"link-preview-card"},s.createElement(de.X,{offset:[0,5],referenceElement:l,visible:o},e.og_scrape_url),s.createElement("div",{className:"str-chat__link-preview-card__icon-container",onMouseEnter:a,onMouseLeave:r,ref:c},s.createElement(i.xP,null)),s.createElement("div",{className:"str-chat__link-preview-card__content"},s.createElement("div",{className:"str-chat__link-preview-card__content-title"},e.title),s.createElement("div",{className:"str-chat__link-preview-card__content-description"},e.text)),s.createElement("button",{className:"str-chat__link-preview-card__dismiss-button","data-testid":"link-preview-card-dismiss-btn",onClick:()=>t(e)},s.createElement(i.Tw,null)))};var he=a(549867);const pe=()=>{const{t:e}=(0,_.Ht)("MessageInputFlat"),{asyncMessagesMultiSendEnabled:t,attachments:a,cooldownRemaining:o,findAndEnqueueURLsToEnrich:i,handleSubmit:l,hideSendButton:c,isUploadEnabled:d,linkPreviews:u,maxFilesLeft:m,message:g,numberOfUploads:h,parent:p,recordingController:f,setCooldownRemaining:v,text:M,uploadNewFiles:y}=(0,w.Nc)("MessageInputFlat"),{AudioRecorder:b=Y,AttachmentPreviewList:C=z,AttachmentSelector:N=(g?T:P),CooldownTimer:S=Z,LinkPreviewList:k=me,QuotedMessagePreview:L=le,RecordingPermissionDeniedNotification:U=ee,SendButton:A=j.c,StartRecordingAudioButton:D=te,EmojiPicker:I}=(0,x.yM)("MessageInputFlat"),{acceptedFiles:O=[],multipleUploads:H,quotedMessage:B}=(0,R.JN)("MessageInputFlat"),{setQuotedMessage:F}=(0,oe.uz)("MessageInputFlat"),{channel:G}=(0,E.mx)("MessageInputFlat"),[q,V]=(0,s.useState)(!1),$=(0,s.useCallback)((()=>{V(!1)}),[]),Q=(0,s.useMemo)((()=>a.filter((e=>"failed"===e.localMetadata?.uploadState)).length),[a]),J=(0,s.useMemo)((()=>O.reduce(((e,t)=>(e[t]??(e[t]=[]),e)),{})),[O]),{getRootProps:K,isDragActive:W,isDragReject:se}=(0,r.uI)({accept:J,disabled:!d||0===m,multiple:H,noClick:!0,onDrop:y});if((0,s.useEffect)((()=>{const e=e=>{e.message?.id===B?.id&&("message.deleted"!==e.type?F(e.message):F(void 0))};return G?.on("message.deleted",e),G?.on("message.updated",e),()=>{G?.off("message.deleted",e),G?.off("message.updated",e)}}),[G,B]),f.recordingState)return s.createElement(b,null);const ne=!g&&B&&B.parent_id===p?.id,re=!(!f.recorder||!navigator.mediaDevices),ce=!!f.recordingState;return s.createElement(s.Fragment,null,s.createElement("div",{...K({className:"str-chat__message-input"})},re&&"denied"===f.permissionState&&q&&s.createElement(U,{onClose:$,permissionName:ae.f.MIC}),i&&s.createElement(k,{linkPreviews:Array.from(u.values())}),W&&s.createElement("div",{className:(0,n.Z)("str-chat__dropzone-container",{"str-chat__dropzone-container--not-accepted":se})},!se&&s.createElement("p",null,e("Drag your files here")),se&&s.createElement("p",null,e("Some of the files will not be accepted"))),ne&&s.createElement(ie,null),s.createElement("div",{className:"str-chat__message-input-inner"},s.createElement(N,null),s.createElement("div",{className:"str-chat__message-textarea-container"},ne&&s.createElement(L,{quotedMessage:B}),d&&!!(h+Q||a.length>0)&&s.createElement(C,null),s.createElement("div",{className:"str-chat__message-textarea-with-emoji-picker"},s.createElement(he.T,null),I&&s.createElement(I,null))),!c&&s.createElement(s.Fragment,null,o?s.createElement(S,{cooldownInterval:o,setCooldownRemaining:v}):s.createElement(s.Fragment,null,s.createElement(A,{disabled:!h&&!M.length&&a.length-Q==0,sendMessage:l}),re&&s.createElement(D,{disabled:ce||!t&&a.some((e=>e.type===X.hX.VOICE_RECORDING)),onClick:()=>{f.recorder?.start(),V(!0)}}))))))}},215487:function(e,t,a){a.d(t,{c:function(){return r}});var s=a(667294),n=a(345291);const r=({sendMessage:e,...t})=>s.createElement("button",{"aria-label":"Send",className:"str-chat__send-button","data-testid":"send-button",onClick:e,type:"button",...t},s.createElement(n.jE,null))},696808:function(e,t,a){a.d(t,{_:function(){return o}});var s=a(667294),n=a(983156),r=a(387029);const o=()=>{const{client:e,latestMessageDatesByChannels:t}=(0,n.mx)("useCooldownTimer"),{channel:a,messages:o=[]}=(0,r.JN)("useCooldownTimer"),[i,l]=(0,s.useState)(),{cooldown:c=0,own_capabilities:d}=a.data||{},u=d?.includes("skip-slow-mode"),m=(0,s.useMemo)((()=>t[a.cid]??[...o].sort(((e,t)=>t.created_at?.getTime()-e.created_at?.getTime())).find((t=>t.user?.id===e.user?.id))?.created_at),[o,e.user?.id,t,a.cid]);return(0,s.useEffect)((()=>{const e=m?Math.max(0,((new Date).getTime()-m.getTime())/1e3):void 0,t=!u&&void 0!==e&&c>e?Math.round(c-e):0;if(l(t),!t)return;const a=setTimeout((()=>{l(0)}),1e3*t);return()=>{clearTimeout(a)}}),[c,m,u]),{cooldownInterval:c,cooldownRemaining:i,setCooldownRemaining:l}}},887182:function(e,t,a){a.d(t,{u:function(){return n}});var s=a(667294);const n=e=>{const{additionalTextareaProps:t,asyncMessagesMultiSendEnabled:a,attachments:n,audioRecordingEnabled:r,autocompleteTriggers:o,cancelURLEnrichment:i,clearEditingState:l,closeCommandsList:c,closeMentionsList:d,cooldownInterval:u,cooldownRemaining:m,disabled:g,disableMentions:h,dismissLinkPreview:p,doFileUploadRequest:_,doImageUploadRequest:f,emojiSearchIndex:v,errorHandler:E,findAndEnqueueURLsToEnrich:w,focus:M,grow:y,handleChange:b,handleSubmit:C,hideSendButton:N,insertText:S,isThreadInput:x,isUploadEnabled:R,linkPreviews:k,maxFilesLeft:T,maxRows:L,mentionAllAppUsers:U,mentioned_users:A,mentionQueryParams:P,message:D,minRows:I,noFiles:O,numberOfUploads:H,onPaste:B,onSelectUser:F,openCommandsList:G,openMentionsList:q,overrideSubmitHandler:V,parent:$,publishTypingEvent:z,recordingController:Z,removeAttachments:j,setCooldownRemaining:Q,setText:J,shouldSubmit:K,showCommandsList:W,showMentionsList:X,text:Y,textareaRef:ee,uploadAttachment:te,uploadNewFiles:ae,upsertAttachments:se,useMentionsTransliteration:ne}=e,re=D?.editing,oe=Array.from(k.values()).join(),ie=A.length,le=$?.id;return(0,s.useMemo)((()=>({additionalTextareaProps:t,asyncMessagesMultiSendEnabled:a,attachments:n,audioRecordingEnabled:r,autocompleteTriggers:o,cancelURLEnrichment:i,clearEditingState:l,closeCommandsList:c,closeMentionsList:d,cooldownInterval:u,cooldownRemaining:m,disabled:g,disableMentions:h,dismissLinkPreview:p,doFileUploadRequest:_,doImageUploadRequest:f,emojiSearchIndex:v,errorHandler:E,findAndEnqueueURLsToEnrich:w,focus:M,grow:y,handleChange:b,handleSubmit:C,hideSendButton:N,insertText:S,isThreadInput:x,isUploadEnabled:R,linkPreviews:k,maxFilesLeft:T,maxRows:L,mentionAllAppUsers:U,mentioned_users:A,mentionQueryParams:P,message:D,minRows:I,noFiles:O,numberOfUploads:H,onPaste:B,onSelectUser:F,openCommandsList:G,openMentionsList:q,overrideSubmitHandler:V,parent:$,publishTypingEvent:z,recordingController:Z,removeAttachments:j,setCooldownRemaining:Q,setText:J,shouldSubmit:K,showCommandsList:W,showMentionsList:X,text:Y,textareaRef:ee,uploadAttachment:te,uploadNewFiles:ae,upsertAttachments:se,useMentionsTransliteration:ne})),[a,n,r,i,u,m,p,re,v,w,C,N,R,x,oe,ie,I,le,z,Z,j,W,X,Y,te,se])}},181935:function(e,t,a){a.d(t,{k:function(){return N}});var s=a(667294),n=a(900373),r=a(387029),o=a(844068),i=a(432228),l=a(306918),c=a(983156),d=a(21681),u=a(437495),m=a(425108);const g=e=>e.type.startsWith("image/")&&!e.type.endsWith(".photoshop"),h=e=>{if((0,i.a9)(e))return e;const{localMetadata:t,...a}=e;return{localMetadata:{...t??{},id:t?.id||(0,n.x0)()},...a}};var p=a(565155),_=a(691296),f=a.n(_),v=a(427882);var E=a(423274);var w=a(255926);var M=a(720586);const y=()=>({attachments:[],linkPreviews:new Map,mentioned_users:[],setText:()=>null,text:""}),b=e=>{if(!e)return y();const t=e.attachments?.reduce(((e,t)=>t.og_scrape_url?(e.set(t.og_scrape_url,{...t,state:v.G.LOADED}),e):e),new Map)??new Map;return{attachments:e.attachments?.filter((({og_scrape_url:e})=>!e)).map((e=>({...e,localMetadata:{id:(0,n.x0)()}})))||[],linkPreviews:t,mentioned_users:e.mentioned_users||[],setText:()=>null,text:e.text||""}},C=(e,t)=>{switch(t.type){case"setText":return{...e,text:t.getNewText(e.text)};case"clear":return y();case"upsertAttachments":{const a=[...e.attachments];return t.attachments.forEach((t=>{const s=e.attachments.findIndex((e=>e.localMetadata?.id&&e.localMetadata?.id===t.localMetadata?.id));if(-1===s)a.push(t);else{const n=(0,M.E)(e.attachments[s]??{},t);a.splice(s,1,n)}})),{...e,attachments:a}}case"removeAttachments":return{...e,attachments:e.attachments.filter((e=>!t.ids.includes(e.localMetadata?.id)))};case"setLinkPreviews":{const a=new Map(e.linkPreviews);return t.mode===v.l.REMOVE?Array.from(t.linkPreviews.keys()).forEach((e=>{a.delete(e)})):(Array.from(t.linkPreviews.values()).reduce(((e,t)=>{const a=e.get(t.og_scrape_url),s=t.state===v.G.QUEUED&&a?.state!==v.G.FAILED;return a&&s||e.set(t.og_scrape_url,t),e}),a),t.mode===v.l.SET&&Array.from(e.linkPreviews.keys()).forEach((e=>{t.linkPreviews.get(e)||a.delete(e)}))),{...e,linkPreviews:a}}case"addMentionedUser":return{...e,mentioned_users:e.mentioned_users.concat(t.user)};default:return e}},N=e=>{const{additionalTextareaProps:t,asyncMessagesMultiSendEnabled:a,audioRecordingConfig:_,audioRecordingEnabled:M,getDefaultValue:y,message:N,urlEnrichmentConfig:S}=e,{channelCapabilities:x={},enrichURLForPreview:R}=(0,r.JN)("useMessageInputState"),k=y?.()||t?.defaultValue,T=N||(Array.isArray(k)?{text:k.join("")}:{text:k?.toString()}),[L,U]=(0,s.useReducer)(C,T,b),A=(({debounceURLEnrichmentMs:e,dispatch:t,enrichURLForPreview:a=!1,findURLFn:n,linkPreviews:o,onLinkPreviewDismissed:i})=>{const{client:l}=(0,c.mx)(),{channelConfig:d,debounceURLEnrichmentMs:u,findURLFn:m,onLinkPreviewDismissed:g}=(0,r.JN)(),h=(0,s.useRef)(!1),_=n??m,E=i??g,w=e??u??1500,M=(0,s.useCallback)((e=>{E?.(e);const a=new Map;e.state=v.G.DISMISSED,a.set(e.og_scrape_url,e),t({linkPreviews:a,mode:v.l.UPSERT,type:"setLinkPreviews"})}),[E]),y=(0,s.useCallback)(f()(((e,a=v.l.SET)=>{const s=_?_(e):(0,p.sE)(e,"url").reduce(((e,t)=>(t.isLink&&e.push(t.href),e)),[]);h.current=0===s.length,t({linkPreviews:s.reduce(((e,t)=>(e.set(t,{og_scrape_url:t,state:v.G.QUEUED}),e)),new Map),mode:a,type:"setLinkPreviews"})}),w,{leading:!1,trailing:!0}),[w,h,_]),b=(0,s.useCallback)((()=>{y.cancel(),y(""),y.flush()}),[y]);return(0,s.useEffect)((()=>{const e=Array.from(o.values()).reduce(((e,t)=>{if("queued"===t.state){const a={...t,state:v.G.LOADING};e.set(t.og_scrape_url,a)}return e}),new Map);e.size&&(t({linkPreviews:e,mode:v.l.UPSERT,type:"setLinkPreviews"}),e.forEach((e=>{l.enrichURL(e.og_scrape_url).then((({duration:a,...s})=>{if(h.current)return;const n=new Map;n.set(e.og_scrape_url,{...s,state:v.G.LOADED}),t({linkPreviews:n,mode:v.l.UPSERT,type:"setLinkPreviews"})})).catch((()=>{const a=new Map;a.set(e.og_scrape_url,{...e,state:v.G.FAILED}),t({linkPreviews:a,mode:v.l.UPSERT,type:"setLinkPreviews"})}))})))}),[h,o]),{cancelURLEnrichment:b,dismissLinkPreview:M,findAndEnqueueURLsToEnrich:d?.url_enrichment&&a?y:void 0}})({dispatch:U,linkPreviews:L.linkPreviews,...S,enrichURLForPreview:S?.enrichURLForPreview??R}),{handleChange:P,insertText:D,textareaRef:I}=((e,t,a,n)=>{const{channel:o}=(0,r.JN)("useMessageInputText"),{additionalTextareaProps:i,focus:l,parent:c,publishTypingEvent:d=!0}=e,{text:u}=t,m=(0,s.useRef)();(0,s.useEffect)((()=>{l&&m.current&&m.current.focus()}),[l]);const g=(0,s.useRef)(),h=(0,s.useCallback)((e=>{const{maxLength:t}=i||{};if(!m.current)return a({getNewText:a=>{const s=a+e;return t&&s.length>t?s.slice(0,t):s},type:"setText"});const{selectionEnd:s,selectionStart:n}=m.current;g.current=n+e.length,a({getNewText:a=>{const r=a.slice(0,n)+e+a.slice(s);return t&&r.length>t?r.slice(0,t):r},type:"setText"})}),[i,g,m]);return(0,s.useEffect)((()=>{const e=m.current;e&&void 0!==g.current&&(e.selectionStart=g.current,e.selectionEnd=g.current,g.current=void 0)}),[u,g]),{handleChange:(0,s.useCallback)((e=>{if(e.preventDefault(),!e||!e.target)return;const t=e.target.value;a({getNewText:()=>t,type:"setText"}),n?.(t),d&&t&&o&&(0,E.t1)(o.keystroke(c?.id),"start typing event")}),[o,n,c,d]),insertText:h,textareaRef:m}})(e,L,U,A.findAndEnqueueURLsToEnrich),[O,H]=(0,s.useState)(!1),[B,F]=(0,s.useState)(!1),{maxFilesLeft:G,numberOfUploads:q,removeAttachments:V,uploadAttachment:$,uploadNewFiles:z,upsertAttachments:Z}=((e,t,a,p)=>{const{doFileUploadRequest:_,doImageUploadRequest:f,errorHandler:v,noFiles:E}=e,{getAppSettings:w}=(0,c.mx)("useAttachments"),{t:M}=(0,d.Ht)("useAttachments"),{addNotification:y}=(0,u.uz)("useAttachments"),{channel:b,maxNumberOfFiles:C,multipleUploads:N}=(0,r.JN)("useAttachments"),S=N?C||10:1,x=Object.values(t.attachments).filter((({localMetadata:e})=>e.uploadState&&"failed"!==e.uploadState)).length,R=S-x,k=(0,s.useCallback)((e=>{e.length&&a({ids:e,type:"removeAttachments"})}),[a]),T=(0,s.useCallback)((e=>{e.length&&a({attachments:e.map(h),type:"upsertAttachments"})}),[a]),L=(0,s.useCallback)((async e=>{const{localMetadata:t,...a}=e;if(!t?.file)return e;const{file:s}=t,r=g(s);if(E&&!r)return e;if(!await(0,o.kx)({addNotification:y,file:s,getAppSettings:w,t:M,uploadType:r?"image":"file"}))return e;t.id=t?.id??(0,n.x0)();const l={type:(c=s.type,c.startsWith("image/")&&!c.endsWith(".photoshop")?"image":c.includes("video/")?"video":c.includes("audio/")?"audio":"file")};var c;let d;r?(t.previewUri=URL.createObjectURL?.(s),s instanceof File&&(l.fallback=s.name)):(l.file_size=s.size,l.mime_type=s.type,s instanceof File&&(l.title=s.name)),Object.assign(l,a),T([{...l,localMetadata:{...t,uploadState:"uploading"}}]);try{const e=r?f:_;d=e?await e(s,b):await b[r?"sendImage":"sendFile"](s)}catch(e){let a={message:M("Error uploading attachment"),name:"Error"};"string"==typeof e.message?a=e:"object"==typeof e&&(a=Object.assign(a,e)),m.error(a),y(a.message,"error");const n={...l,localMetadata:{...t,uploadState:"failed"}};return T([n]),v&&v(a,"upload-attachment",{...s,id:t.id}),n}if(!d)return void k([t.id]);const u={...l,localMetadata:{...t,uploadState:"finished"}};return(0,i.SW)(u)?(u.localMetadata.previewUri&&(URL.revokeObjectURL(u.localMetadata.previewUri),delete u.localMetadata.previewUri),u.image_url=d.file):u.asset_url=d.file,d.thumb_url&&(u.thumb_url=d.thumb_url),T([u]),u}),[y,b,_,f,v,w,E,k,M,T]),U=(0,s.useCallback)((e=>{(E?Array.from(e).filter(g):Array.from(e)).slice(0,R).forEach((e=>{L({localMetadata:{file:(0,l.rz)(e)?(0,l.au)({blobsArray:[e],fileName:(0,l.Y_)(e.type),mimeType:e.type}):e,id:(0,n.x0)()}})})),p.current?.focus()}),[R,E,p,L]);return{maxFilesLeft:R,numberOfUploads:x,removeAttachments:k,uploadAttachment:L,uploadNewFiles:U,upsertAttachments:T}})(e,L,U,I),{handleSubmit:j}=((e,t,a,n,o)=>{const{clearEditingState:i,message:l,overrideSubmitHandler:c,parent:m,publishTypingEvent:g}=e,{attachments:h,linkPreviews:p,mentioned_users:_,text:f}=t,{cancelURLEnrichment:E,findAndEnqueueURLsToEnrich:w}=o,{channel:M}=(0,r.JN)("useSubmitHandler"),{addNotification:y,editMessage:b,sendMessage:C}=(0,u.uz)("useSubmitHandler"),{t:N}=(0,d.Ht)("useSubmitHandler"),S=(0,s.useRef)({hasChanged:!1,initialText:f});return(0,s.useEffect)((()=>{S.current.initialText.length?S.current.hasChanged=f!==S.current.initialText:S.current.initialText=f}),[f]),{handleSubmit:async(e,t,s)=>{e?.preventDefault();const r=f.trim();if((""===r||">"===r||"``````"===r||"``"===r||"**"===r||"____"===r||"__"===r||"****"===r)&&0===n&&0===h.length&&!t?.poll_id)return;if(h.some((e=>"uploading"===e.localMetadata?.uploadState)))return y(N("Wait until all attachments have uploaded"),"error");const o=h.filter((e=>"failed"!==e.localMetadata?.uploadState||w&&!e.og_scrape_url)).map((e=>{const{localMetadata:t,...a}=e;return a})),d={...s};let u=[];if(w){E();const e=Array.from(p.values()).some((e=>[v.G.QUEUED,v.G.LOADING].includes(e.state))),t=Array.from(p.values()).some((e=>e.state===v.G.DISMISSED));u=e?[]:Array.from(p.values()).filter((e=>e.state===v.G.LOADED&&!o.find((t=>t.og_scrape_url===e.og_scrape_url)))).map((({state:e,...t})=>t)),d.skip_enrich_url=!e&&u.length>0||t}const S=[...o,...u],x=Array.from(new Set(_.filter((({id:e,name:t})=>f.includes(`@${e}`)||f.includes(`@${t}`))))),R={attachments:S,mentioned_users:x,text:f};if(l&&"error"!==l.type){delete l.i18n;try{await b({...l,...R,...t},d),i?.(),a({type:"clear"})}catch(e){y(N("Edit message request failed"),"error")}}else try{a({type:"clear"}),c?await c({...R,parent:m},M.cid,t,d):await C({...R,parent:m},t,d),g&&await M.stopTyping()}catch(e){a({getNewText:()=>f,type:"setText"}),x?.forEach((e=>{a({type:"addMentionedUser",user:e})})),y(N("Send message request failed"),"error")}}}})(e,L,U,q,A),Q=(({asyncMessagesMultiSendEnabled:e,enabled:t,generateRecordingTitle:a,handleSubmit:n,recordingConfig:r,uploadAttachment:o})=>{const{t:i}=(0,d.Ht)("useMediaRecorder"),[l,c]=(0,s.useState)(),[u,m]=(0,s.useState)(),[g,h]=(0,s.useState)(),[p,_]=(0,s.useState)(!1),f=(0,s.useMemo)((()=>t?new w.j_({config:r??{},generateRecordingTitle:a,t:i}):void 0),[r,t,a,i]),v=(0,s.useCallback)((async()=>{if(!f)return;const t=await f.stop();t&&(await o(t),e||_(!0),f.cleanUp())}),[e,f,o]);return(0,s.useEffect)((()=>{p&&(n(),_(!1))}),[n,p]),(0,s.useEffect)((()=>{if(!f)return;f.permission.watch();const e=f.recording.subscribe(c),t=f.recordingState.subscribe(m),a=f.permission.state.subscribe(h);return()=>{f.cancel(),f.permission.unwatch(),e.unsubscribe(),t.unsubscribe(),a.unsubscribe()}}),[f]),{completeRecording:v,permissionState:g,recorder:f,recording:l,recordingState:u}})({asyncMessagesMultiSendEnabled:a,enabled:!!M,handleSubmit:j,recordingConfig:_,uploadAttachment:$}),J=!!x["upload-file"],{onPaste:K}=((e,t,a,n)=>({onPaste:(0,s.useCallback)((s=>{(async s=>{const{items:r}=s.clipboardData;let o;s.preventDefault();for(let e=0;e<r.length;e++){const t=r[e];if("string"===t.kind&&"text/plain"===t.type){o=new Promise((e=>{t.getAsString((t=>{e(t)}))}));break}}const i=await(0,l.Yu)(Array.from(r));if(o){const e=await o;t(e),n?.(e,v.l.UPSERT),n?.flush()}else i.length&&a&&e(i)})(s)}),[n,t,a,e])}))(z,D,J,A.findAndEnqueueURLsToEnrich),W=(0,s.useCallback)((e=>{U({type:"addMentionedUser",user:e})}),[]),X=(0,s.useCallback)((e=>{U({getNewText:()=>e,type:"setText"})}),[]);return{...L,...A,closeCommandsList:()=>H(!1),closeMentionsList:()=>F(!1),handleChange:P,handleSubmit:j,insertText:D,isUploadEnabled:J,maxFilesLeft:G,numberOfUploads:q,onPaste:K,onSelectUser:W,openCommandsList:()=>{U({getNewText:()=>"/",type:"setText"}),H(!0)},openMentionsList:()=>{U({getNewText:e=>e+"@",type:"setText"}),F(!0)},recordingController:Q,removeAttachments:V,setText:X,showCommandsList:O,showMentionsList:B,textareaRef:I,uploadAttachment:$,uploadNewFiles:z,upsertAttachments:Z}}},844068:function(e,t,a){a.d(t,{i_:function(){return i},kx:function(){return l},zu:function(){return c}});var s=a(345853);const n={a:"á|à|ã|â|À|Á|Ã|Â",c:"ç|Ç",e:"é|è|ê|É|È|Ê",i:"í|ì|î|Í|Ì|Î",n:"ñ|Ñ",o:"ó|ò|ô|ő|õ|Ó|Ò|Ô|Õ",u:"ú|ù|û|ü|Ú|Ù|Û|Ü"},r=e=>e?Object.keys(n).reduce(((e,t)=>e.replace(new RegExp(n[t],"g"),t)),e):"",o=(e,t)=>{if(0===e.length)return t.length;if(0===t.length)return e.length;const a=[];let s,n;for(s=0;s<=t.length;s++)a[s]=[s];for(n=0;n<=e.length;n++)a[0][n]=n;for(s=1;s<=t.length;s++)for(n=1;n<=e.length;n++)t.charAt(s-1)===e.charAt(n-1)?a[s][n]=a[s-1][n-1]:a[s][n]=Math.min(a[s-1][n-1]+1,Math.min(a[s][n-1]+1,a[s-1][n]+1));return a[t.length][e.length]},i=e=>{const{ownUserId:t,query:s,text:n,useMentionsTransliteration:i,users:l}=e;return l.filter((e=>{if(e.id===t)return!1;if(!s)return!0;let l=r(e.id).toLowerCase(),c=r(e.name).toLowerCase(),d=r(s).toLowerCase();i&&(async()=>{const{default:t}=await Promise.all([a.e(6972),a.e(2138),a.e(98),a.e(4467),a.e(4492),a.e(4989),a.e(6966),a.e(6736),a.e(9496),a.e(3506),a.e(4561),a.e(731),a.e(9658),a.e(5647),a.e(8089),a.e(8126),a.e(8469),a.e(7884),a.e(7791),a.e(4796),a.e(6594),a.e(8790),a.e(624),a.e(2166),a.e(4835),a.e(9777),a.e(5991),a.e(6574),a.e(3479),a.e(4980),a.e(4412),a.e(8991),a.e(6273),a.e(4343),a.e(3365),a.e(2360),a.e(1439),a.e(1748),a.e(7841),a.e(8587),a.e(9657),a.e(5702),a.e(1142),a.e(3971),a.e(6381),a.e(457),a.e(6611),a.e(4137),a.e(4362),a.e(5851),a.e(9761),a.e(2935),a.e(3063),a.e(6387),a.e(5538),a.e(1978),a.e(5341),a.e(8212),a.e(1334)]).then(a.bind(a,992524));c=t(e.name||"").toLowerCase(),d=t(s).toLowerCase(),l=t(e.id).toLowerCase()})();const u=n.slice(-4).includes("@");if(c){const e=o(d,c);if(c.includes(d)||e<=3&&u)return!0}const m=o(d,l);return l.includes(d)||m<=3&&u}))},l=async e=>{const{addNotification:t,file:a,getAppSettings:n,t:r,uploadType:o}=e;let i=null;i=await n();const{allowed_file_extensions:l,allowed_mime_types:d,blocked_file_extensions:u,blocked_mime_types:m,size_limit:g}=("image"===o?i?.app?.image_upload_config:i?.app?.file_upload_config)||{},h=()=>t(r('Upload type: "{{ type }}" is not allowed',{type:a.type||"unknown type"}),"error");if(l?.length){if(!l.some((e=>a.name.toLowerCase().endsWith(e.toLowerCase()))))return h(),!1}if(u?.length){if(u.some((e=>a.name.toLowerCase().endsWith(e.toLowerCase()))))return h(),!1}if(d?.length){if(!d.some((e=>e.toLowerCase()===a.type?.toLowerCase())))return h(),!1}if(m?.length){if(m.some((e=>e.toLowerCase()===a.type?.toLowerCase())))return h(),!1}const p=g||s.yD;return!(a.size&&a.size>p)||(t(r("File is too large: {{ size }}, maximum upload size is {{ limit }}",{limit:c(p),size:c(a.size)}),"error"),!1)};function c(e,t=3){const a=["B","kB","MB","GB"],s=Math.min(Math.floor(Math.log(e)/Math.log(1024)),a.length-1),n=e/1024**s;return`${0===t?Math.round(n).toString():n.toPrecision(t)} ${a[s]}`}},345291:function(e,t,a){a.d(t,{Oe:function(){return c},Q9:function(){return h},Tw:function(){return l},VK:function(){return o},Vd:function(){return f},ZO:function(){return g},_8:function(){return d},fp:function(){return p},jE:function(){return m},o1:function(){return _},rG:function(){return i},xP:function(){return u}});var s=a(667294),n=a(900373),r=a(21681);const o=({size:e=20})=>{const t=(0,s.useMemo)((()=>(0,n.x0)()),[]);return s.createElement("div",{className:"str-chat__loading-indicator"},s.createElement("svg",{"data-testid":"loading-indicator",height:e,viewBox:"0 0 30 30",width:e,xmlns:"http://www.w3.org/2000/svg"},s.createElement("defs",null,s.createElement("linearGradient",{id:`${t}-linear-gradient`,x1:"50%",x2:"50%",y1:"0%",y2:"100%"},s.createElement("stop",{offset:"0%",stopColor:"#FFF",stopOpacity:"0"}),s.createElement("stop",{"data-testid":"stop-color",offset:"100%",stopOpacity:"1"}))),s.createElement("path",{d:"M2.518 23.321l1.664-1.11A12.988 12.988 0 0 0 15 28c7.18 0 13-5.82 13-13S22.18 2 15 2V0c8.284 0 15 6.716 15 15 0 8.284-6.716 15-15 15-5.206 0-9.792-2.652-12.482-6.679z",fill:`url(#${t}-linear-gradient)`,fillRule:"evenodd"})))},i=()=>{const{t:e}=(0,r.Ht)("UploadIcon");return s.createElement("svg",{"data-testid":"attach-icon",fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("title",null,e("Attach files")),s.createElement("g",{clipPath:"url(#clip0_10878_5)"},s.createElement("path",{d:"M12.9997 6.99993L10.9997 6.99993L10.9997 10.9999L6.99972 10.9999L6.99972 12.9999L10.9997 12.9999L10.9997 16.9999L12.9997 16.9999L12.9997 12.9999L16.9997 12.9999L16.9997 10.9999L12.9997 10.9999L12.9997 6.99993ZM11.9997 1.99992C6.47972 1.99992 1.99972 6.47993 1.99972 11.9999C1.99972 17.5199 6.47972 21.9999 11.9997 21.9999C17.5197 21.9999 21.9997 17.5199 21.9997 11.9999C21.9997 6.47993 17.5197 1.99992 11.9997 1.99992ZM11.9997 19.9999C7.58972 19.9999 3.99972 16.4099 3.99972 11.9999C3.99972 7.58993 7.58972 3.99993 11.9997 3.99993C16.4097 3.99993 19.9997 7.58993 19.9997 11.9999C19.9997 16.4099 16.4097 19.9999 11.9997 19.9999Z",fill:"black"})),s.createElement("defs",null,s.createElement("clipPath",{id:"clip0_10878_5"},s.createElement("rect",{fill:"white",height:"24",width:"24"}))))},l=()=>s.createElement("svg",{"data-testid":"close-no-outline",fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z",fill:"black"})),c=()=>s.createElement("svg",{"data-testid":"retry",fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M17.6449 6.35C16.1949 4.9 14.2049 4 11.9949 4C7.57488 4 4.00488 7.58 4.00488 12C4.00488 16.42 7.57488 20 11.9949 20C15.7249 20 18.8349 17.45 19.7249 14H17.6449C16.8249 16.33 14.6049 18 11.9949 18C8.68488 18 5.99488 15.31 5.99488 12C5.99488 8.69 8.68488 6 11.9949 6C13.6549 6 15.1349 6.69 16.2149 7.78L12.9949 11H19.9949V4L17.6449 6.35Z",fill:"black"})),d=()=>s.createElement("svg",{"data-testid":"download",fill:"none",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4C9.11 4 6.6 5.64 5.35 8.04C2.34 8.36 0 10.91 0 14C0 17.31 2.69 20 6 20H19C21.76 20 24 17.76 24 15C24 12.36 21.95 10.22 19.35 10.04ZM19 18H6C3.79 18 2 16.21 2 14C2 11.95 3.53 10.24 5.56 10.03L6.63 9.92L7.13 8.97C8.08 7.14 9.94 6 12 6C14.62 6 16.88 7.86 17.39 10.43L17.69 11.93L19.22 12.04C20.78 12.14 22 13.45 22 15C22 16.65 20.65 18 19 18ZM13.45 10H10.55V13H8L12 17L16 13H13.45V10Z",fill:"black"})),u=()=>s.createElement("svg",{fill:"none",height:"11",viewBox:"0 0 20 11",width:"20",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{clipRule:"evenodd",d:"M1.9 5.5C1.9 3.79 3.29 2.4 5 2.4H8.05C8.57467 2.4 9 1.97467 9 1.45C9 0.925329 8.57467 0.5 8.05 0.5H5C2.24 0.5 0 2.74 0 5.5C0 8.26 2.24 10.5 5 10.5H8.05C8.57467 10.5 9 10.0747 9 9.55C9 9.02533 8.57467 8.6 8.05 8.6H5C3.29 8.6 1.9 7.21 1.9 5.5ZM6 5.5C6 6.05228 6.44772 6.5 7 6.5H13C13.5523 6.5 14 6.05228 14 5.5C14 4.94772 13.5523 4.5 13 4.5H7C6.44772 4.5 6 4.94772 6 5.5ZM15 0.5H11.95C11.4253 0.5 11 0.925329 11 1.45C11 1.97467 11.4253 2.4 11.95 2.4H15C16.71 2.4 18.1 3.79 18.1 5.5C18.1 7.21 16.71 8.6 15 8.6H11.95C11.4253 8.6 11 9.02533 11 9.55C11 10.0747 11.4253 10.5 11.95 10.5H15C17.76 10.5 20 8.26 20 5.5C20 2.74 17.76 0.5 15 0.5Z",fill:"#005DFF",fillRule:"evenodd"})),m=()=>{const{t:e}=(0,r.Ht)("SendButton");return s.createElement("svg",{"data-testid":"send",fill:"currentColor",height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},s.createElement("title",null,e("Send")),s.createElement("path",{d:"M4.00952 22L24 12L4.00952 2L4 9.77778L18.2857 12L4 14.2222L4.00952 22Z"}))},g=()=>s.createElement("svg",{fill:"currentColor",viewBox:"0 0 14 20",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M7 12.5C8.66 12.5 10 11.16 10 9.5V3.5C10 1.84 8.66 0.5 7 0.5C5.34 0.5 4 1.84 4 3.5V9.5C4 11.16 5.34 12.5 7 12.5Z"}),s.createElement("path",{d:"M12 9.5C12 12.26 9.76 14.5 7 14.5C4.24 14.5 2 12.26 2 9.5H0C0 13.03 2.61 15.93 6 16.42V19.5H8V16.42C11.39 15.93 14 13.03 14 9.5H12Z"})),h=()=>s.createElement("svg",{fill:"currentColor",viewBox:"0 0 32 32",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M8.00033 25.3333C8.00033 26.8 9.20033 28 10.667 28H21.3337C22.8003 28 24.0003 26.8 24.0003 25.3333V12C24.0003 10.5333 22.8003 9.33333 21.3337 9.33333H10.667C9.20033 9.33333 8.00033 10.5333 8.00033 12V25.3333ZM24.0003 5.33333H20.667L19.7203 4.38667C19.4803 4.14667 19.1337 4 18.787 4H13.2137C12.867 4 12.5203 4.14667 12.2803 4.38667L11.3337 5.33333H8.00033C7.26699 5.33333 6.66699 5.93333 6.66699 6.66667C6.66699 7.4 7.26699 8 8.00033 8H24.0003C24.7337 8 25.3337 7.4 25.3337 6.66667C25.3337 5.93333 24.7337 5.33333 24.0003 5.33333Z"})),p=()=>s.createElement("svg",{"data-testid":"str-chat__pause-icon",fill:"currentColor",viewBox:"0 0 16 20",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M0 19.3333H5.33333V0.666626H0V19.3333ZM10.6667 0.666626V19.3333H16V0.666626H10.6667Z"})),_=()=>s.createElement("svg",{"data-testid":"str-chat__play-icon",fill:"currentColor",viewBox:"0 0 14 18",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M0.236328 2.09338V15.9067C0.236328 16.9601 1.39633 17.6001 2.28966 17.0267L13.143 10.1201C13.9697 9.60005 13.9697 8.40005 13.143 7.86672L2.28966 0.973385C1.39633 0.400051 0.236328 1.04005 0.236328 2.09338Z"})),f=()=>s.createElement("svg",{fill:"currentColor",viewBox:"0 0 18 14",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M5.79457 10.875L2.32457 7.40502C1.93457 7.01502 1.30457 7.01502 0.91457 7.40502C0.52457 7.79502 0.52457 8.42502 0.91457 8.81502L5.09457 12.995C5.48457 13.385 6.11457 13.385 6.50457 12.995L17.0846 2.41502C17.4746 2.02502 17.4746 1.39502 17.0846 1.00502C16.6946 0.615024 16.0646 0.615024 15.6746 1.00502L5.79457 10.875Z"}))},427882:function(e,t,a){var s,n;a.d(t,{G:function(){return s},l:function(){return n}}),function(e){e.DISMISSED="dismissed",e.FAILED="failed",e.LOADED="loaded",e.LOADING="loading",e.QUEUED="queued"}(s||(s={})),function(e){e[e.UPSERT=0]="UPSERT",e[e.SET=1]="SET",e[e.REMOVE=2]="REMOVE"}(n||(n={}))},135094:function(e,t,a){a.d(t,{r:function(){return U}});var s=a(770149),n=a(667294),r=a(983156);const o=e=>{const{loadMoreScrollThreshold:t,messages:a=[],scrolledUpThreshold:s=200,hasMoreNewer:o,suppressAutoscroll:i,listElement:l}=e,[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(),[g,h]=(0,n.useState)(!0),p=(0,n.useRef)(!1),_=(0,n.useRef)(!1),f=(0,n.useCallback)((()=>{!l?.scrollTo||o||i||(l.scrollTo({top:l.scrollHeight}),d(!1))}),[l,o,i]);(0,n.useLayoutEffect)((()=>{l&&(m(l.getBoundingClientRect()),f())}),[l,o]);const v=function(e){const{loadMoreScrollThreshold:t,onScrollBy:a,scrollContainerMeasures:s,scrolledUpThreshold:o,scrollToBottom:i,showNewMessages:l}=e,{client:c}=(0,r.mx)("useMessageListScrollManager"),d=(0,n.useRef)({offsetHeight:0,scrollHeight:0}),u=(0,n.useRef)(),m=(0,n.useRef)(0);return(0,n.useLayoutEffect)((()=>{const n=d.current,r=u.current,g=e.messages,h=g[g.length-1]||{},p=r?.[r.length-1],_=s(),f=n.scrollHeight-n.offsetHeight-m.current<o;if(void 0!==r)if(r.length<g.length)if(p?.id===h.id){if(m.current<t){const e=_.scrollHeight-n.scrollHeight;a(e)}}else h.user?.id===c.userID||f?i():l();else{const e=p?.latest_reactions?.length!==h.latest_reactions?.length,t=p?.reply_count!==h.reply_count;(e||t)&&f&&i()}u.current=g,d.current=_}),[d,u,e.messages]),e=>{m.current=e}}({loadMoreScrollThreshold:t,messages:a,onScrollBy:e=>{l?.scrollBy({top:e})},scrollContainerMeasures:()=>({offsetHeight:l?.offsetHeight||0,scrollHeight:l?.scrollHeight||0}),scrolledUpThreshold:s,scrollToBottom:f,showNewMessages:()=>d(!0)});return{hasNewMessages:c,isMessageListScrolledToBottom:g,onScroll:(0,n.useCallback)((e=>{const t=e.target,a=t.scrollTop;v(a);const n=t.offsetHeight,r=t.scrollHeight,o=p.current;p.current=r-(a+n)<s,_.current=a<s,p.current&&d(!1),o&&!p.current?h(!1):!o&&p.current&&h(!0)}),[v,_,p,s]),scrollToBottom:f,wrapperRect:u}};var i=a(387029),l=a(808961),c=a(215243);var d=a(25297),u=a(540239);var m=a(157508);var g=a(657545),h=a(254907),p=a(673836),_=a(219874),f=a(437495),v=a(193283),E=a(612824),w=a(728237),M=a(779883),y=a(944498),b=a(52127),C=a(916273),N=a(297747),S=a(696660),x=a(453207),R=a(196649);function k({channelUnreadUiState:e,components:t,customClasses:a,lastReceivedMessageId:s,messageGroupStyles:r,messages:o,readData:i,sharedMessageProps:l}){const{DateSeparator:u=S.Z,HeaderComponent:m,MessageSystem:g=x.B,UnreadMessagesSeparator:h=c.z}=t,p=[];let _;for(let t=0;t<o.length;t++){const c=o[t];if((0,d.Fr)(c))p.push(n.createElement("li",{key:`${c.date.toISOString()}-i`},n.createElement(u,{date:c.date,formatDate:l.formatDate,unread:c.unread})));else if(c.customType===R.L.intro&&m)p.push(n.createElement("li",{key:"intro"},n.createElement(m,null)));else if("system"===c.type)p.push(n.createElement("li",{"data-message-id":c.id,key:c.id||c.created_at},n.createElement(g,{message:c})));else{_||(_=c);const d=r[c.id]||"",u=a?.message||`str-chat__li str-chat__li--${d}`,m=c.created_at&&new Date(c.created_at).getTime(),g=e?.last_read.getTime(),f=_?.id&&_.id===c.id,v=t===o.length-1,E=e?.last_read_message_id===c.id||!e?.unread_messages&&m===g,w=e?.first_unread_message_id===c.id||!!e?.unread_messages&&!!m&&!!g&&m>g&&f,M=!e?.last_read_message_id&&w,y=E&&!v&&(e?.first_unread_message_id||!!e?.unread_messages);p.push(n.createElement(n.Fragment,{key:c.id||c.created_at},M&&h&&n.createElement("li",{className:"str-chat__li str-chat__unread-messages-separator-wrapper"},n.createElement(h,{unreadCount:e?.unread_messages})),n.createElement("li",{className:u,"data-message-id":c.id,"data-testid":u},n.createElement(N.v,{groupStyles:[d],lastReceivedId:s,message:c,readBy:i[c.id]||[],...l})),y&&h&&n.createElement("li",{className:"str-chat__li str-chat__unread-messages-separator-wrapper"},n.createElement(h,{unreadCount:e?.unread_messages}))))}}return p}var T=a(345853);const L=e=>{const{channel:t,channelUnreadUiState:a,disableDateSeparator:f=!1,groupStyles:N,hideDeletedMessages:S=!1,hideNewMessageSeparator:x=!1,internalInfiniteScrollProps:{threshold:R=T.su,...L}={},maxTimeBetweenGroupedMessages:U,messageActions:A=Object.keys(b.Xh),messages:P=[],notifications:D,noGroupByUser:I=!1,pinPermissions:O=b.Z1,returnAllReadData:H=!1,threadList:B=!1,unsafeHTML:F=!1,headerPosition:G,read:q,renderMessages:V=k,reviewProcessedMessage:$,messageLimit:z=T.cE,loadMore:Z,loadMoreNewer:j,hasMoreNewer:Q=!1,reactionDetailsSort:J,showUnreadNotificationAlways:K,sortReactionDetails:W,sortReactions:X,suppressAutoscroll:Y,highlightedMessageId:ee,jumpToLatestMessage:te=(()=>Promise.resolve())}=e,[ae,se]=n.useState(null),[ne,re]=n.useState(null),{customClasses:oe}=(0,r.mx)("MessageList"),{EmptyStateIndicator:ie=w.D,LoadingIndicator:le=y.T,MessageListNotifications:ce=p.T,MessageNotification:de=h.f,TypingIndicator:ue=C.c,UnreadMessagesNotification:me=_.N,MessageListMainPanel:ge=l.u}=(0,u.yM)("MessageList"),{hasNewMessages:he,isMessageListScrolledToBottom:pe,onScroll:_e,scrollToBottom:fe,wrapperRect:ve}=o({hasMoreNewer:Q,listElement:ae,loadMoreScrollThreshold:R,messages:P,scrolledUpThreshold:e.scrolledUpThreshold,suppressAutoscroll:Y}),{show:Ee}=(({isMessageListScrolledToBottom:e,showAlways:t,unreadCount:a})=>{const{messages:s}=(0,i.JN)("UnreadMessagesNotification"),[r,o]=(0,n.useState)(!1),d=(0,n.useRef)(!1),u="undefined"!=typeof IntersectionObserver;return(0,n.useEffect)((()=>{if(!a||!u)return void o(!1);const[e]=document.getElementsByClassName(l.S);if(!e)return;const[s]=document.getElementsByClassName(c.J);if(!s)return void o(!0);const n=(e=>{const{bottom:t}=e.getBoundingClientRect();return t<0})(s),r=((e,t)=>{const{top:a}=e.getBoundingClientRect(),{top:s}=t.getBoundingClientRect();return a>s})(s,e);o(t?n||r:n);const i=new IntersectionObserver((e=>{if(!e.length)return;const{boundingClientRect:a,isIntersecting:s}=e[0];if(s)return void o(!1);const n=a.bottom<0;o(t||n),d.current=n}),{root:e});return i.observe(s),()=>{i.disconnect()}}),[u,e,s,t,a]),(0,n.useEffect)((()=>{a&&e&&d.current&&(o(!0),d.current=!1)}),[e,a]),{show:r&&u}})({isMessageListScrolledToBottom:pe,showAlways:!!K,unreadCount:a?.unread_messages});(0,g.o)({isMessageListScrolledToBottom:pe,messageListIsThread:B,unreadCount:a?.unread_messages??0,wasMarkedUnread:!!a?.first_unread_message_id});const{messageGroupStyles:we,messages:Me}=(e=>{const{channel:t,disableDateSeparator:a,groupStyles:s,headerPosition:o,hideDeletedMessages:i,hideNewMessageSeparator:l,maxTimeBetweenGroupedMessages:c,messages:m,noGroupByUser:g,reviewProcessedMessage:h}=e,{client:p}=(0,r.mx)("useEnrichedMessages"),{HeaderComponent:_}=(0,u.yM)("useEnrichedMessages"),f=(0,n.useMemo)((()=>t.lastRead?.()),[t]),v=!a;let E=v||i||!l?(0,d.Ej)({enableDateSeparator:v,hideDeletedMessages:i,hideNewMessageSeparator:l,lastRead:f,messages:m,reviewProcessedMessage:h,userId:p.userID||""}):m;_&&(E=(0,d.c)(E,o));const w=s||d.db;return{messageGroupStyles:(0,n.useMemo)((()=>E.reduce(((e,t,a)=>{const s=w(t,E[a-1],E[a+1],g,c);return s&&(e[t.id]=s),e}),{})),[c,E,g]),messages:E}})({channel:t,disableDateSeparator:f,groupStyles:N,headerPosition:G,hideDeletedMessages:S,hideNewMessageSeparator:x,maxTimeBetweenGroupedMessages:U,messages:P,noGroupByUser:I,reviewProcessedMessage:$}),ye=(e=>{const{channelUnreadUiState:t,enrichedMessages:a,internalMessageProps:s,messageGroupStyles:o,read:i,renderMessages:l,returnAllReadData:c,threadList:g}=e,{client:h,customClasses:p}=(0,r.mx)("useMessageListElements"),_=(0,u.yM)("useMessageListElements"),f=(0,m.S)({messages:a,read:i,returnAllReadData:c,userID:h.userID}),v=(0,n.useMemo)((()=>(0,d.hR)(a)),[a]);return(0,n.useMemo)((()=>l({channelUnreadUiState:t,components:_,customClasses:p,lastReceivedMessageId:v,messageGroupStyles:o,messages:a,readData:f,sharedMessageProps:{...s,threadList:g}})),[a,s,v,o,t,f,l,g])})({channelUnreadUiState:a,enrichedMessages:Me,internalMessageProps:{additionalMessageInputProps:e.additionalMessageInputProps,closeReactionSelectorOnClick:e.closeReactionSelectorOnClick,customMessageActions:e.customMessageActions,disableQuotedMessages:e.disableQuotedMessages,formatDate:e.formatDate,getDeleteMessageErrorNotification:e.getDeleteMessageErrorNotification,getFlagMessageErrorNotification:e.getFlagMessageErrorNotification,getFlagMessageSuccessNotification:e.getFlagMessageSuccessNotification,getMarkMessageUnreadErrorNotification:e.getMarkMessageUnreadErrorNotification,getMarkMessageUnreadSuccessNotification:e.getMarkMessageUnreadSuccessNotification,getMuteUserErrorNotification:e.getMuteUserErrorNotification,getMuteUserSuccessNotification:e.getMuteUserSuccessNotification,getPinMessageErrorNotification:e.getPinMessageErrorNotification,Message:e.Message,messageActions:A,messageListRect:ve,onlySenderCanEdit:e.onlySenderCanEdit,onMentionsClick:e.onMentionsClick,onMentionsHover:e.onMentionsHover,onUserClick:e.onUserClick,onUserHover:e.onUserHover,openThread:e.openThread,pinPermissions:O,reactionDetailsSort:J,renderText:e.renderText,retrySendMessage:e.retrySendMessage,sortReactionDetails:W,sortReactions:X,unsafeHTML:F},messageGroupStyles:we,read:q,renderMessages:V,returnAllReadData:H,threadList:B}),be=oe?.messageList||"str-chat__list",Ce=n.useCallback((()=>{Z&&Z(z)}),[Z,z]),Ne=n.useCallback((()=>{j&&j(z)}),[j,z]),Se=n.useCallback((async()=>{Q?await te():fe()}),[fe,Q]);n.useLayoutEffect((()=>{if(ee){const e=ne?.querySelector(`[data-message-id='${ee}']`);e?.scrollIntoView({block:"center"})}}),[ee]);const xe=0===ye.length&&!B,Re=B?"message-list-dialog-manager-thread":"message-list-dialog-manager";return n.createElement(E.Ws,{value:{listElement:ae,scrollToBottom:fe}},n.createElement(ge,null,n.createElement(v.r,{id:Re},!B&&Ee&&n.createElement(me,{unreadCount:a?.unread_messages}),n.createElement("div",{className:(0,s.Z)(be,oe?.threadList),onScroll:_e,ref:se,tabIndex:0},xe?n.createElement(ie,{listType:B?"thread":"message"}):n.createElement(M.v,{className:"str-chat__message-list-scroll","data-testid":"reverse-infinite-scroll",hasNextPage:e.hasMoreNewer,hasPreviousPage:e.hasMore,head:e.head,isLoading:e.loadingMore,loader:n.createElement("div",{className:"str-chat__list__loading",key:"loading-indicator"},e.loadingMore&&n.createElement(le,{size:20})),loadNextPage:Ne,loadPreviousPage:Ce,threshold:R,...L},n.createElement("ul",{className:"str-chat__ul",ref:re},ye),n.createElement(ue,{threadList:B}),n.createElement("div",{key:"bottom"}))))),n.createElement(ce,{hasNewMessages:he,isMessageListScrolledToBottom:pe,isNotAtLatestMessageSet:Q,MessageNotification:de,notifications:D,scrollToBottom:Se,threadList:B,unreadCount:B?void 0:a?.unread_messages}))},U=e=>{const{jumpToLatestMessage:t,loadMore:a,loadMoreNewer:s}=(0,f.uz)("MessageList"),{members:r,mutes:o,watchers:l,...c}=(0,i.JN)("MessageList");return n.createElement(L,{jumpToLatestMessage:t,loadMore:a,loadMoreNewer:s,...c,...e})}},808961:function(e,t,a){a.d(t,{S:function(){return n},u:function(){return r}});var s=a(667294);const n="str-chat__main-panel-inner str-chat__message-list-main-panel",r=({children:e})=>s.createElement("div",{className:n},e)},673836:function(e,t,a){a.d(t,{T:function(){return c}});var s=a(667294),n=a(770149);const r=s.memo((e=>{const{active:t,children:a,className:r,type:o}=e;return t?s.createElement("div",{"aria-live":"polite",className:(0,n.Z)(`str-chat__custom-notification notification-${o}`,"str-chat__notification","str-chat-react__notification",r),"data-testid":"custom-notification"},a):null}));var o=a(983156),i=a(21681);const l=s.memo((()=>{const{client:e}=(0,o.mx)("ConnectionStatus"),{t:t}=(0,i.Ht)("ConnectionStatus"),[a,n]=(0,s.useState)(!0);return(0,s.useEffect)((()=>{const t=({online:e=!1})=>{a!==e&&n(e)};return e.on("connection.changed",t),()=>e.off("connection.changed",t)}),[e,a]),s.createElement(r,{active:!a,className:"str-chat__connection-status-notification",type:"error"},t("Connection failure, reconnecting now..."))})),c=e=>{const{hasNewMessages:t,isMessageListScrolledToBottom:a,isNotAtLatestMessageSet:n,MessageNotification:o,notifications:c,scrollToBottom:d,threadList:u,unreadCount:m}=e,{t:g}=(0,i.Ht)("MessageListNotifications");return s.createElement("div",{className:"str-chat__list-notifications"},c.map((e=>s.createElement(r,{active:!0,key:e.id,type:e.type},e.text))),s.createElement(l,null),s.createElement(o,{isMessageListScrolledToBottom:a,onClick:d,showNotification:t||n,threadList:u,unreadCount:m},g(n?"Latest Messages":"New Messages!")))}},254907:function(e,t,a){a.d(t,{f:function(){return n}});var s=a(667294);const n=s.memo((e=>{const{children:t,onClick:a,showNotification:n=!0}=e;return n?s.createElement("button",{"aria-live":"polite",className:"str-chat__message-notification","data-testid":"message-notification",onClick:a},t):null}))},219874:function(e,t,a){a.d(t,{N:function(){return i}});var s=a(667294);const n=()=>s.createElement("svg",{fill:"currentColor",viewBox:"0 0 14 13",xmlns:"http://www.w3.org/2000/svg"},s.createElement("path",{d:"M1.32227 12.3408C0.944336 11.9629 0.953125 11.3213 1.32227 10.9521L5.60254 6.66309L1.32227 2.38281C0.953125 2.01367 0.944336 1.37207 1.32227 0.994141C1.7002 0.616211 2.3418 0.625 2.71094 0.985352L7 5.27441L11.2803 0.994141C11.6494 0.625 12.291 0.616211 12.6689 0.994141C13.0469 1.37207 13.0381 2.01367 12.6689 2.38281L8.38867 6.66309L12.6689 10.9521C13.0381 11.3213 13.0469 11.9629 12.6689 12.3408C12.291 12.7188 11.6494 12.71 11.2803 12.3408L7 8.06055L2.71094 12.3408C2.3418 12.71 1.7002 12.7188 1.32227 12.3408Z"}));var r=a(437495),o=a(21681);const i=({queryMessageLimit:e,showCount:t,unreadCount:a})=>{const{jumpToFirstUnreadMessage:i,markRead:l}=(0,r.uz)("UnreadMessagesNotification"),{t:c}=(0,o.Ht)("UnreadMessagesNotification");return s.createElement("div",{className:"str-chat__unread-messages-notification","data-testid":"unread-messages-notification"},s.createElement("button",{onClick:()=>i(e)},a&&t?c("{{count}} unread",{count:a??0}):c("Unread messages")),s.createElement("button",{onClick:()=>l()},s.createElement(n,null)))}},215243:function(e,t,a){a.d(t,{J:function(){return r},z:function(){return o}});var s=a(667294),n=a(21681);const r="str-chat__unread-messages-separator",o=({showCount:e,unreadCount:t})=>{const{t:a}=(0,n.Ht)("UnreadMessagesSeparator");return s.createElement("div",{className:r,"data-testid":"unread-messages-separator"},t&&e?a("unreadMessagesSeparatorText",{count:t}):a("Unread messages"))}},400796:function(e,t,a){a.d(t,{f:function(){return V}});var s=a(667294),n=a(942263),r=a(297747);const o=e=>{const{message:t}=e;return s.createElement("div",{className:"giphy-preview-message"},s.createElement(r.v,{message:t}))};var i=a(157508);var l=a(983156);const c={failed:!0,sending:!0};var d=a(657545),u=a(254907),m=a(673836),g=a(808961),h=a(25297),p=a(800749),_=a(219874),f=a(770149),v=a(493096),E=a.n(v),w=a(728237),M=a(944498),y=a(52127),b=a(540239);const C=10**7;function N(e,t){return e+t-C}function S(e){return C-e}const x=({context:e,...t})=>{if(!e)return s.createElement(s.Fragment,null);const a=e.processedMessages[N(t["data-item-index"],e.numItemsPrepended)],n=e.messageGroupStyles[a.id];return s.createElement("div",{...t,className:e?.customClasses?.virtualMessage||(0,f.Z)("str-chat__virtual-list-message-wrapper str-chat__li",{[`str-chat__li--${n}`]:n})})},R=({context:e})=>{const{LoadingIndicator:t=M.T}=(0,b.yM)("VirtualizedMessageListHeader");return s.createElement(s.Fragment,null,e?.head,e?.loadingMore&&t&&s.createElement("div",{className:"str-chat__virtual-list__loading"},s.createElement(t,{size:20})))},k=({context:e})=>{const{EmptyStateIndicator:t=w.D}=(0,b.yM)("VirtualizedMessageList");return s.createElement(s.Fragment,null,t&&s.createElement(t,{listType:e?.threadList?"thread":"message"}))},T=(e,t,a)=>{const{additionalMessageInputProps:n,closeReactionSelectorOnClick:o,customMessageActions:i,customMessageRenderer:l,DateSeparator:c,firstUnreadMessageId:d,formatDate:u,lastReadDate:m,lastReadMessageId:g,lastReceivedMessageId:p,Message:_,messageActions:f,messageGroupStyles:v,MessageSystem:E,numItemsPrepended:w,openThread:M,ownMessagesReadByOthers:b,processedMessages:C,reactionDetailsSort:S,shouldGroupByUser:x,sortReactionDetails:R,sortReactions:k,threadList:T,unreadMessageCount:L=0,UnreadMessagesSeparator:U,virtuosoRef:A}=a,P=N(e,w);if(l)return l(C,P);const D=C[P];if(!D)return s.createElement("div",{style:{height:"1px"}});if((0,h.Fr)(D))return c?s.createElement(c,{date:D.date,unread:D.unread}):null;if("system"===D.type)return E?s.createElement(E,{message:D}):null;const I=x&&P>0&&D.user?.id===C[P-1].user?.id,O=C[P-1],H=C[P+1],B=x&&(D.user?.id!==O?.user?.id||O&&(0,y.$l)(O)),F=x&&(D.user?.id!==H?.user?.id||(0,y.$l)(D)),G=D.created_at&&new Date(D.created_at).getTime(),q=m?.getTime(),V=0===P,$=g===p,z=D.id===g||!L&&G===q,Z=d===D.id||!!L&&G&&q&&G>q&&V,j=!g&&Z,Q=z&&!$&&(d||!!L);return s.createElement(s.Fragment,null,j&&s.createElement("div",{className:"str-chat__unread-messages-separator-wrapper"},s.createElement(U,{unreadCount:L})),s.createElement(r.v,{additionalMessageInputProps:n,autoscrollToBottom:A.current?.autoscrollToBottom,closeReactionSelectorOnClick:o,customMessageActions:i,endOfGroup:F,firstOfGroup:B,formatDate:u,groupedByUser:I,groupStyles:[v[D.id]??""],lastReceivedId:p,message:D,Message:_,messageActions:f,openThread:M,reactionDetailsSort:S,readBy:b[D.id]||[],sortReactionDetails:R,sortReactions:k,threadList:T}),Q&&s.createElement("div",{className:"str-chat__unread-messages-separator-wrapper"},s.createElement(U,{unreadCount:L})))};var L=a(215243),U=a(696660),A=a(453207),P=a(193283),D=a(437495),I=a(387029),O=a(345853);function H(e){"ResizeObserver loop completed with undelivered notifications."!==e.message&&"ResizeObserver loop limit exceeded"!==e.message||e.stopImmediatePropagation()}function B(e){return e.getBoundingClientRect().height}function F(e,t){return e.findIndex((e=>e.id===t))}function G(e,t){if(t){const a=F(e,t);if(-1!==a)return{align:"center",index:a}}return e.length-1}const q=e=>{const{additionalMessageInputProps:t,additionalVirtuosoProps:a={},channel:r,channelUnreadUiState:f,closeReactionSelectorOnClick:v,customMessageActions:w,customMessageRenderer:M,defaultItemHeight:y,disableDateSeparator:D=!0,formatDate:I,groupStyles:q,hasMoreNewer:V,head:$,hideDeletedMessages:z=!1,hideNewMessageSeparator:Z=!1,highlightedMessageId:j,jumpToLatestMessage:Q,loadingMore:J,loadMore:K,loadMoreNewer:W,maxTimeBetweenGroupedMessages:X,Message:Y,messageActions:ee,messageLimit:te=O.cE,messages:ae,notifications:se,openThread:ne,overscan:re=0,read:oe,returnAllReadData:ie=!1,reviewProcessedMessage:le,scrollSeekPlaceHolder:ce,scrollToLatestMessageOnFocus:de=!1,separateGiphyPreview:ue=!1,shouldGroupByUser:me=!1,showUnreadNotificationAlways:ge,reactionDetailsSort:he,sortReactionDetails:pe,sortReactions:_e,stickToBottomScrollBehavior:fe="smooth",suppressAutoscroll:ve,threadList:Ee}=e,{components:we,...Me}=a;(0,s.useEffect)((()=>(window.addEventListener("error",H),()=>{window.removeEventListener("error",H)})),[]);const{DateSeparator:ye=U.Z,GiphyPreviewMessage:be=o,MessageListNotifications:Ce=m.T,MessageNotification:Ne=u.f,MessageSystem:Se=A.B,MessageListMainPanel:xe=g.u,UnreadMessagesNotification:Re=_.N,UnreadMessagesSeparator:ke=L.z,VirtualMessage:Te=p.u,TypingIndicator:Le}=(0,b.yM)("VirtualizedMessageList"),Ue=Y||Te,{client:Ae,customClasses:Pe}=(0,l.mx)("VirtualizedMessageList"),De=(0,s.useRef)(null),Ie=(0,s.useMemo)((()=>r.lastRead?.()),[r]),{show:Oe,toggleShowUnreadMessagesNotification:He}=(({lastRead:e,showAlways:t,unreadCount:a})=>{const[n,r]=(0,s.useState)(!1),o=(0,s.useCallback)((s=>{if(!a)return;const n=s[0],o=s.slice(-1)[0];if(!n||!o)return;const i=!!e&&new Date(n.created_at).getTime()>e.getTime(),l=!!e&&new Date(o.created_at).getTime()<e.getTime();r(t?i||l:i)}),[e,t,a]);return(0,s.useEffect)((()=>{a||r(!1)}),[a]),{show:n,toggleShowUnreadMessagesNotification:o}})({lastRead:f?.last_read,showAlways:!!ge,unreadCount:f?.unread_messages??0}),{giphyPreviewMessage:Be,setGiphyPreviewMessage:Fe}=(e=>{const[t,a]=(0,s.useState)(),{client:n}=(0,l.mx)("useGiphyPreview");return(0,s.useEffect)((()=>{const t=e=>{const{message:t,user:s}=e;"giphy"===t?.command&&s?.id===n.userID&&a(void 0)};return e&&n.on("message.new",t),()=>n.off("message.new",t)}),[n,e]),{giphyPreviewMessage:t,setGiphyPreviewMessage:e?a:void 0}})(ue),Ge=(0,s.useMemo)((()=>void 0===ae?[]:D&&!z&&Z&&!ue?ae:(0,h.Ej)({enableDateSeparator:!D,hideDeletedMessages:z,hideNewMessageSeparator:Z,lastRead:Ie,messages:ae,reviewProcessedMessage:le,setGiphyPreviewMessage:Fe,userId:Ae.userID||""})),[D,z,Z,Ie,ae,ae?.length,Ae.userID]),qe=(0,i.S)({messages:Ge,read:oe,returnAllReadData:ie,userID:Ae.userID}),Ve=(0,s.useMemo)((()=>(0,h.hR)(Ge)),[Ge]),$e=q||h.db,ze=(0,s.useMemo)((()=>Ge.reduce(((e,t,a)=>{const s=$e(t,Ge[a-1],Ge[a+1],!me,X);return s&&(e[t.id]=s),e}),{})),[X,Ge.length,me,$e]),{atBottom:Ze,isMessageListScrolledToBottom:je,newMessagesNotification:Qe,setIsMessageListScrolledToBottom:Je,setNewMessagesNotification:Ke}=function(e,t,a){const[n,r]=(0,s.useState)(!1),[o,i]=(0,s.useState)(!0),l=(0,s.useRef)(!1),c=(0,s.useRef)(""),d=(0,s.useRef)(!1);return(0,s.useEffect)((()=>{if(a)return void r(!0);if(!e?.length)return;const s=e[e.length-1],n=c.current;c.current=s.id||"",s.id!==n&&(d.current||(s.user?.id!==t&&l.current&&r(!0),l.current=!0))}),[t,e,a]),{atBottom:d,isMessageListScrolledToBottom:o,newMessagesNotification:n,setIsMessageListScrolledToBottom:i,setNewMessagesNotification:r}}(Ge,Ae.userID,V);(0,d.o)({isMessageListScrolledToBottom:je,messageListIsThread:!!Ee,unreadCount:f?.unread_messages??0,wasMarkedUnread:!!f?.first_unread_message_id});const We=(0,s.useCallback)((async()=>{V?await Q():(De.current&&De.current.scrollToIndex(Ge.length-1),Ke(!1))}),[De,Ge,Ke,Ge.length,V,Q]);(({messages:e,scrollToBottom:t,scrollToLatestMessageOnFocus:a})=>{const[n,r]=(0,s.useState)(!1),o=(0,s.useRef)();o.current=e=>{a&&n&&e.target===window&&setTimeout(t,100)},(0,s.useEffect)((()=>{r(!0)}),[e]),(0,s.useEffect)((()=>{const e=e=>{o.current?.(e)},t=()=>{r(!1)};return"undefined"!=typeof window&&(window.addEventListener("focus",e),window.addEventListener("blur",t)),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",t)}}),[])})({messages:ae,scrollToBottom:We,scrollToLatestMessageOnFocus:de});const Xe=function(e,t){const a=t?1:0,n=(0,s.useRef)(),r=(0,s.useRef)(),o=(0,s.useRef)(0);return(0,s.useMemo)((()=>{if(!e||!e.length)return o.current=0,0;const t=e?.[a],s=t?.id===r.current?.id,i=!(!t?.status||!c[t.status]);if(s||i)return o.current;n.current||(n.current=t),r.current=t;for(let t=o.current;t<e.length;t+=1)if(e[t].id===n.current?.id)return o.current=t-a,o.current;return n.current=t,o.current=0,0}),[a,e,e?.length])}(Ge,!D),{messageSetKey:Ye}=(({messages:e})=>{const[t,a]=(0,s.useState)(+new Date),n=(0,s.useRef)();return(0,s.useEffect)((()=>{const t=e?.find((e=>e.id===n.current));t||a(+new Date),n.current=e?.[0]?.id}),[e]),{messageSetKey:t}})({messages:ae}),et=function(e,t){const a=(0,s.useRef)(""),n=(0,s.useRef)(!1);function r(){if(e&&e.length>0){const s=e[e.length-1];if(s.user?.id===t&&a.current!==s.id)return a.current=s.id,!0}return!1}return(0,s.useEffect)((()=>{e&&e.length&&!n.current&&(n.current=!0,r())}),[e,e?.length]),r}(Ge,Ae.userID),tt=(0,s.useMemo)((()=>((e,t)=>E()((a=>{const s=a.map((e=>{if(e.originalIndex)return t[N(e.originalIndex,C)]})).filter((e=>!!e));e.forEach((e=>e(s)))}),200))([He],Ge)),[Ge,He]),at=(0,s.useCallback)(((e,t,{numItemsPrepended:a,processedMessages:s})=>s[N(e,a)].id),[]);if((0,s.useEffect)((()=>{let e;if(j){const t=F(Ge,j);-1!==t&&(e=setTimeout((()=>{De.current?.scrollToIndex({align:"center",index:t})}),0))}return()=>{clearTimeout(e)}}),[j,Ge]),!Ge)return null;const st=Ee?"virtualized-message-list-dialog-manager-thread":"virtualized-message-list-dialog-manager";return s.createElement(s.Fragment,null,s.createElement(xe,null,s.createElement(P.r,{id:st},!Ee&&Oe&&s.createElement(Re,{unreadCount:f?.unread_messages}),s.createElement("div",{className:Pe?.virtualizedMessageList||"str-chat__virtual-list"},s.createElement(n.OO,{atBottomStateChange:e=>{Ze.current=e,Je(e),e&&(W?.(te),Ke?.(!1))},atBottomThreshold:100,atTopStateChange:e=>{e&&K?.(te)},atTopThreshold:100,className:"str-chat__message-list-scroll",components:{EmptyPlaceholder:k,Header:R,Item:x,...we},computeItemKey:at,context:{additionalMessageInputProps:t,closeReactionSelectorOnClick:v,customClasses:Pe,customMessageActions:w,customMessageRenderer:M,DateSeparator:ye,firstUnreadMessageId:f?.first_unread_message_id,formatDate:I,head:$,lastReadDate:f?.last_read,lastReadMessageId:f?.last_read_message_id,lastReceivedMessageId:Ve,loadingMore:J,Message:Ue,messageActions:ee,messageGroupStyles:ze,MessageSystem:Se,numItemsPrepended:Xe,openThread:ne,ownMessagesReadByOthers:qe,processedMessages:Ge,reactionDetailsSort:he,shouldGroupByUser:me,sortReactionDetails:pe,sortReactions:_e,threadList:Ee,unreadMessageCount:f?.unread_messages,UnreadMessagesSeparator:ke,virtuosoRef:De},firstItemIndex:S(Xe),followOutput:e=>!V&&!ve&&(et()?e?fe:"auto":!!e&&fe),increaseViewportBy:{bottom:200,top:0},initialTopMostItemIndex:G(Ge,j),itemContent:T,itemSize:B,itemsRendered:tt,key:Ye,overscan:re,ref:De,style:{overflowX:"hidden"},totalCount:Ge.length,...Me,...ce?{scrollSeek:ce}:{},...y?{defaultItemHeight:y}:{}}))),Le&&s.createElement(Le,null)),s.createElement(Ce,{hasNewMessages:Qe,isMessageListScrolledToBottom:je,isNotAtLatestMessageSet:V,MessageNotification:Ne,notifications:se,scrollToBottom:We,threadList:Ee,unreadCount:Ee?void 0:f?.unread_messages}),Be&&s.createElement(be,{message:Be}))};function V(e){const{jumpToLatestMessage:t,loadMore:a,loadMoreNewer:n}=(0,D.uz)("VirtualizedMessageList"),{channel:r,channelUnreadUiState:o,hasMore:i,hasMoreNewer:l,highlightedMessageId:c,loadingMore:d,loadingMoreNewer:u,messages:m,notifications:g,read:h,suppressAutoscroll:p}=(0,I.JN)("VirtualizedMessageList"),_=e.messages||m;return s.createElement(q,{channel:r,channelUnreadUiState:e.channelUnreadUiState??o,hasMore:!!i,hasMoreNewer:!!l,highlightedMessageId:c,jumpToLatestMessage:t,loadingMore:!!d,loadingMoreNewer:!!u,loadMore:a,loadMoreNewer:n,messages:_,notifications:g,read:h,suppressAutoscroll:p,...e})}},157508:function(e,t,a){a.d(t,{S:function(){return r}});var s=a(667294),n=a(25297);const r=e=>{const{messages:t,read:a,returnAllReadData:r,userID:o}=e;return(0,s.useMemo)((()=>(0,n.Pi)(t.filter((({user:e})=>e?.id===o)),a,r)),[t,a,r,o])}},657545:function(e,t,a){a.d(t,{o:function(){return i}});var s=a(667294),n=a(983156),r=a(437495),o=a(387029);const i=({isMessageListScrolledToBottom:e,messageListIsThread:t,unreadCount:a,wasMarkedUnread:i})=>{const{client:l}=(0,n.mx)("useMarkRead"),{markRead:c,setChannelUnreadUiState:d}=(0,r.uz)("useMarkRead"),{channel:u}=(0,o.JN)("useMarkRead"),m=(0,s.useRef)(e);(0,s.useEffect)((()=>{const a=a=>!document.hidden&&!i&&!t&&e&&a>0,s=()=>{a(u.countUnread())&&c()},n=t=>{const s=t.cid===u.cid,n=t.user?.id&&t.user.id===l.user?.id,r=!t.message?.parent_id||t.message?.show_in_channel;n||(!e||i||document.hidden?d((e=>{const a=e?.unread_messages??0,s=function(e,t){if(!t)return;let a;for(let s=e.length-1;s>=0;s--){const n=e[s];if(!n?.id)break;if(n.id!==t.id){a=n;break}}return a}(u.state.messages,t.message);return{...e||{},last_read:e?.last_read??(0===a&&s?.created_at?new Date(s.created_at):new Date(0)),unread_messages:a+1}})):s&&r&&a(u.countUnread())&&c())};l.on("message.new",n),document.addEventListener("visibilitychange",s);return m.current!==e&&e&&a(u.countUnread())&&c(),m.current=e,()=>{l.off("message.new",n),document.removeEventListener("visibilitychange",s)}}),[u,l,e,c,t,d,a,i])}},25297:function(e,t,a){a.d(t,{Ej:function(){return i},Fr:function(){return h},Pi:function(){return d},Th:function(){return g},c:function(){return u},db:function(){return m},hR:function(){return c}});var s=a(900373),n=a(196649),r=a(52127),o=a(766722);const i=e=>{const{messages:t,reviewProcessedMessage:a,setGiphyPreviewMessage:s,...r}=e,{enableDateSeparator:i,hideDeletedMessages:c,hideNewMessageSeparator:d,lastRead:u,userId:m}=r;let g,h=!1,p=!1;const _=[];for(let e=0;e<t.length;e+=1){const f=t[e];if(c&&"deleted"===f.type)continue;if(s&&"ephemeral"===f.type&&"giphy"===f.command){p=!0,s(f);continue}const v=[],E=f.created_at&&(0,o.J_)(f.created_at)&&f.created_at.toDateString()||"",w=t[e-1];let M=E;i&&w?.created_at&&(0,o.J_)(w.created_at)&&(M=w.created_at.toDateString()),h||d||(h=u&&f.created_at&&new Date(u)<f.created_at||!1,i&&h&&f.user?.id!==m&&v.push({customType:n.L.date,date:f.created_at,id:l(f.created_at),unread:h})),i&&(0===e||E!==M||c&&"deleted"===w?.type&&g!==E)&&v[v.length-1]?.customType!==n.L.date?(g=E,v.push({customType:n.L.date,date:f.created_at,id:l(f.created_at)},f)):v.push(f),_.push(...a?.({changes:v,context:r,index:e,messages:t,processedMessages:_})||v)}return s&&!p&&s(void 0),_},l=e=>{let t;try{t=e?e instanceof Date?e.toISOString():e:(0,s.x0)()}catch(e){t=(0,s.x0)()}return`${n.L.date}-${t}`},c=e=>{for(let t=e.length-1;t>0;t-=1)if("received"===e[t].status)return e[t].id;return null},d=(e,t={},a)=>{const s={};return Object.values(t).forEach((t=>{if(!t.last_read)return;let n;e.forEach((e=>{e.created_at&&e.created_at<t.last_read&&(n=e.id,a&&(s[n]||(s[n]=[]),s[n].push(t.user)))})),n&&!a&&(s[n]||(s[n]=[]),s[n].push(t.user))})),s},u=(e,t)=>{const a=e,s={customType:n.L.intro};if(!t)return a.unshift(s),a;if(!a.length)return a.unshift(s),a;for(let r=0;r<e.length;r+=1){const i=e[r],l=i.created_at&&(0,o.J_)(i.created_at)?i.created_at.getTime():null,c=e[r+1],d=c.created_at&&(0,o.J_)(c.created_at)?c.created_at.getTime():null;if(l&&l<t){if(!(d&&d<t))return a.splice(r+1,0,s),a;if(e[r+1]&&e[r+1].customType===n.L.date)continue;if(!d)return a.push(s),a}}return a},m=(e,t,a,s,o)=>{if(e.customType===n.L.date)return"";if(e.customType===n.L.intro)return"";if(s||0!==e.attachments?.length)return"single";const i=!t||t.customType===n.L.intro||t.customType===n.L.date||"system"===t.type||"error"===t.type||0!==t.attachments?.length||e.user?.id!==t.user?.id||t.deleted_at||e.reaction_groups&&Object.keys(e.reaction_groups).length>0||(0,r.$l)(t)||void 0!==o&&t.created_at&&e.created_at&&new Date(e.created_at).getTime()-new Date(t.created_at).getTime()>o,l=!a||a.customType===n.L.intro||a.customType===n.L.date||"system"===a.type||"error"===a.type||0!==a.attachments?.length||e.user?.id!==a.user?.id||a.deleted_at||a.reaction_groups&&Object.keys(a.reaction_groups).length>0||(0,r.$l)(e)||void 0!==o&&a.created_at&&e.created_at&&new Date(a.created_at).getTime()-new Date(e.created_at).getTime()>o;return i||l?l?i||e.deleted_at||"error"===e.type?"single":"bottom":i?"top":"":e.deleted_at||"error"===e.type?"single":"middle"},g=(e,t)=>e>=t;function h(e){return e.customType===n.L.date&&!!e.date&&(0,o.J_)(e.date)}},827666:function(e,t,a){a.d(t,{u:function(){return l}});var s=a(770149),n=a(667294),r=a(337829);const o=()=>n.createElement("svg",{"data-testid":"close-icon-round",fill:"none",height:"28",viewBox:"0 0 28 28",width:"28",xmlns:"http://www.w3.org/2000/svg"},n.createElement("rect",{fill:"#72767E",height:"28",rx:"14",width:"28"}),n.createElement("circle",{cx:"14",cy:"14",fill:"#72767E",r:"12"}),n.createElement("path",{clipRule:"evenodd",d:"M28 14C28 21.732 21.732 28 14 28C6.26801 28 0 21.732 0 14C0 6.26801 6.26801 0 14 0C21.732 0 28 6.26801 28 14ZM26 14C26 20.6274 20.6274 26 14 26C7.37258 26 2 20.6274 2 14C2 7.37258 7.37258 2 14 2C20.6274 2 26 7.37258 26 14ZM19.59 7L21 8.41L15.41 14L21 19.59L19.59 21L14 15.41L8.41 21L7 19.59L12.59 14L7 8.41L8.41 7L14 12.59L19.59 7Z",fill:"white",fillRule:"evenodd"}));var i=a(21681);const l=({children:e,className:t,onClose:a,open:l})=>{const{t:c}=(0,i.Ht)("Modal"),d=(0,n.useRef)(null),u=(0,n.useRef)(null);return(0,n.useEffect)((()=>{if(!l)return;const e=e=>{"Escape"===e.key&&a?.(e)};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)}),[a,l]),l?n.createElement("div",{className:(0,s.Z)("str-chat__modal str-chat__modal--open",t),onClick:e=>{const t=e.target;d.current&&u.current&&(d.current.contains(t)&&!u.current.contains(t)||a?.(e))}},n.createElement(r.MT,{autoFocus:!0,contain:!0},n.createElement("button",{className:"str-chat__modal__close-button",ref:u,title:c("Close")},n.createElement(o,null)),n.createElement("div",{className:"str-chat__modal__inner str-chat-react__modal__inner",ref:d},e))):null}},238110:function(e,t,a){a.d(t,{x:function(){return r}});var s=a(667294),n=a(770149);const r=({className:e,close:t,goBack:a,title:r})=>s.createElement("div",{className:(0,n.Z)("str-chat__modal-header",e)},a&&s.createElement("button",{className:"str-chat__modal-header__go-back-button",onClick:a}),s.createElement("div",{className:"str-chat__modal-header__title"},r),t&&s.createElement("button",{className:"str-chat__modal-header__close-button",onClick:t}))},932313:function(e,t,a){a.d(t,{n:function(){return ue}});var s=a(667294),n=a(770149),r=a(21681),o=a(344843),i=a(159852);const l=e=>({enforce_unique_vote:e.enforce_unique_vote,is_closed:e.is_closed,max_votes_allowed:e.max_votes_allowed,name:e.name,options:e.options}),c=()=>{const{t:e}=(0,r.Ht)("PollHeader"),{poll:t}=(0,o.GF)(),{enforce_unique_vote:a,is_closed:n,max_votes_allowed:c,name:d,options:u}=(0,i.B)(t.state,l),m=(0,s.useMemo)((()=>n?e("Vote ended"):a?e("Select one"):c?e("Select up to {{count}}",{count:c>u.length?u.length:c}):e("Select one or more")),[n,a,c,u.length,e]);if(d)return s.createElement("div",{className:"str-chat__poll-header"},s.createElement("div",{className:"str-chat__poll-title"},d),s.createElement("div",{className:"str-chat__poll-subtitle"},m))};var d=a(827666);const u=({buttonText:e,children:t,closeModal:a,modalClassName:n,modalIsOpen:r,openModal:o})=>s.createElement(s.Fragment,null,s.createElement("button",{className:"str-chat__poll-action",onClick:o},e),s.createElement(d.u,{className:n,onClose:a,open:r},t));var m=a(484833);const g=e=>({ownAnswer:e.ownAnswer}),h=({close:e,messageId:t})=>{const{t:a}=(0,r.Ht)("AddCommentForm"),{poll:n}=(0,o.GF)(),{ownAnswer:l}=(0,i.B)(n.state,g);return s.createElement(m.D,{className:"str-chat__prompt-dialog str-chat__modal__poll-add-comment",close:e,fields:{comment:{element:"input",props:{id:"comment",name:"comment",required:!0,type:"text",value:l?.answer_text??""}}},onSubmit:async e=>{await n.addAnswer(e.comment,t)},shouldDisableSubmitButton:e=>!e.comment||e.comment===l?.answer_text,title:a(l?"Update your comment":"Add a comment")})};var p=a(983156);const _=e=>({options:e.options}),f=({close:e,messageId:t})=>{const{client:a}=(0,p.mx)("SuggestPollOptionForm"),{t:n}=(0,r.Ht)("SuggestPollOptionForm"),{poll:l}=(0,o.GF)(),{options:c}=(0,i.B)(l.state,_);return s.createElement(m.D,{className:"str-chat__prompt-dialog str-chat__modal__suggest-poll-option",close:e,fields:{optionText:{element:"input",props:{id:"optionText",name:"optionText",required:!0,type:"text",value:""},validator:e=>{if(!e)return;return c.find((t=>t.text===e.trim()))?new Error(n("Option already exists")):void 0}}},onSubmit:async e=>{const{poll_option:s}=await a.createPollOption(l.id,{text:e.optionText});l.castVote(s.id,t)},shouldDisableSubmitButton:e=>!e.optionText,title:n("Suggest an option")})};var v=a(239256);const E=({close:e})=>{const{t:t}=(0,r.Ht)("SuggestPollOptionForm"),{poll:a}=(0,o.GF)();return s.createElement(v.m,{actions:[{children:t("Cancel"),className:"str-chat__dialog__controls-button--cancel",onClick:e},{children:t("End"),className:".str-chat__dialog__controls-button--submit str-chat__dialog__controls-button--end-poll",onClick:a.close}],className:"str-chat__modal__end-vote",prompt:t("Nobody will be able to vote in this poll anymore."),title:t("End vote")})};var w=a(238110),M=a(613943),y=a(19382),b=a(451385);const C=({timestamp:e})=>{const{t:t}=(0,r.Ht)(),{handleEnter:a,handleLeave:n,tooltipVisible:o}=(0,b.r)(),[i,l]=(0,s.useState)(null),c=new Date(e);return s.createElement("div",{className:"str-chat__poll-vote__timestamp",onMouseEnter:a,onMouseLeave:n,ref:l},t("timestamp/PollVote",{timestamp:c}),s.createElement(y.X,{offset:[0,5],placement:"bottom",referenceElement:i,visible:o},t("timestamp/PollVoteTooltip",{timestamp:c})))},N=({vote:e})=>{const{t:t}=(0,r.Ht)(),{client:a}=(0,p.mx)(),{handleEnter:n,handleLeave:o,tooltipVisible:i}=(0,b.r)(),[l,c]=(0,s.useState)(null),d=a.user?.id&&a.user.id===e.user?.id?t("You"):e.user?.name||t("Anonymous");return s.createElement("div",{className:"str-chat__poll-vote__author",onMouseEnter:n,onMouseLeave:o,ref:c},e.user&&s.createElement(M.q,{className:"str-chat__avatar--poll-vote-author",image:e.user.image,key:`poll-vote-${e.id}-avatar-${e.user.id}`,name:e.user.name}),s.createElement("div",{className:"str-chat__poll-vote__author__name"},d),s.createElement(y.X,{offset:[0,5],placement:"bottom",referenceElement:l,visible:i},d))},S=({vote:e})=>s.createElement("div",{className:"str-chat__poll-vote"},s.createElement(N,{vote:e}),s.createElement(C,{timestamp:e.created_at})),x=({votes:e})=>s.createElement("div",{className:"str-chat__poll-vote-listing"},e.map((e=>s.createElement(S,{key:`poll-vote-${e.id}`,vote:e}))));var R=a(423274);function k(e,t,a){const{client:n}=(0,p.mx)(),[r,o]=(0,s.useState)(t?.getLatestValue().items??[]);return(0,s.useEffect)((()=>t?.subscribeWithSelector((e=>[e.latestPageItems]),(([e])=>o((t=>[...t,...e]))))),[t]),(0,s.useEffect)((()=>{const t=t=>{if(!t.poll_vote)return;const s=(0,R.l7)(t.poll_vote);"answer"===e&&!s||"vote"===e&&(s||t.poll_vote.option_id!==a)||("poll.vote_removed"===t.type&&o((e=>t.poll_vote?e.filter((e=>e.id!==t.poll_vote.id)):e)),"poll.vote_changed"===t.type&&o((e=>t.poll_vote?e.filter((e=>e.id!==t.poll_vote.id)):e)),["poll.vote_casted","poll.vote_changed"].includes(t.type)&&o((e=>t.poll_vote?[t.poll_vote,...e]:e)))},s=n.on("poll.vote_casted",t),r=n.on("poll.vote_removed",t),i=n.on("poll.vote_changed",t);return()=>{s.unsubscribe(),r.unsubscribe(),i.unsubscribe()}}),[n,a,e]),r}var T=a(350986);const L=e=>[e.error,e.hasNextPage,e.loading];var U=a(152027),A=a(944498);const P=e=>({is_closed:e.is_closed,ownAnswer:e.ownAnswer}),D=({close:e,onUpdateOwnAnswerClick:t})=>{const{t:a}=(0,r.Ht)(),{poll:n}=(0,o.GF)(),{is_closed:l,ownAnswer:c}=(0,i.B)(n.state,P),{answers:d,error:u,hasNextPage:m,loading:g,loadMore:h}=(({paginationParams:e}={})=>{const{poll:t}=(0,o.GF)(),a=(0,s.useCallback)((async a=>{const{next:s,votes:n}=await t.queryAnswers({filter:e?.filter,options:a?{...e?.options,next:a}:e?.options,sort:{created_at:-1,...e?.sort}});return{items:n,next:s}}),[e,t]),{cursorPaginatorState:n,loadMore:r}=(0,T.l)(a,!0),l=k("answer",n),[c,d,u]=(0,i.B)(n,L);return{answers:l,error:c,hasNextPage:d,loading:u,loadMore:r}})();return s.createElement("div",{className:"str-chat__modal__poll-answer-list"},s.createElement(w.x,{close:e,title:a("Poll comments")}),s.createElement("div",{className:"str-chat__modal__poll-answer-list__body"},s.createElement(U.P,{loadNextOnScrollToBottom:h,threshold:40},s.createElement("div",{className:"str-chat__poll-answer-list"},d.map((e=>s.createElement("div",{className:"str-chat__poll-answer",key:`comment-${e.id}`},e.answer_text&&s.createElement("p",{className:"str-chat__poll-answer__text"},e.answer_text),s.createElement(S,{key:`poll-vote-${e.id}`,vote:e}))))),m&&s.createElement("div",{className:"str-chat__loading-indicator-placeholder"},g&&s.createElement(A.T,null))),u?.message&&s.createElement("div",null,u?.message)),d.length>0&&!l&&s.createElement("button",{className:"str-chat__poll-action",onClick:t},a(c?"Update your comment":"Add a comment")))};var I=a(691296),O=a.n(I),H=a(387029),B=a(112239);const F=({amount:e,className:t})=>s.createElement("div",{className:(0,n.Z)("str-chat__amount-bar",t),"data-testid":"amount-bar",role:"progressbar",style:{"--str-chat__amount-bar-fulfillment":e+"%"}}),G=({checked:e})=>s.createElement("div",{className:(0,n.Z)("str-chat__checkmark",{"str-chat__checkmark--checked":e})}),q=e=>({is_closed:e.is_closed,latest_votes_by_option:e.latest_votes_by_option,maxVotedOptionIds:e.maxVotedOptionIds,ownVotesByOptionId:e.ownVotesByOptionId,vote_counts_by_option:e.vote_counts_by_option,voting_visibility:e.voting_visibility}),V=({displayAvatarCount:e,option:t,voteCountVerbose:a})=>{const{t:l}=(0,r.Ht)(),{channelCapabilities:c={}}=(0,H.JN)("PollOptionsShortlist"),{message:d}=(0,B.fr)(),{poll:u}=(0,o.GF)(),{is_closed:m,latest_votes_by_option:g,maxVotedOptionIds:h,ownVotesByOptionId:p,vote_counts_by_option:_,voting_visibility:f}=(0,i.B)(u.state,q),v=c["cast-poll-vote"]&&!m,E=h[0]?_[h[0]]:0,w=(0,s.useMemo)((()=>O()((()=>{if(!v)return;return!!p[t.id]?u.removeVote(p[t.id].id,d.id):u.castVote(t.id,d.id)}),100)),[v,d.id,t.id,p,u]);return s.createElement("div",{className:(0,n.Z)("str-chat__poll-option",{"str-chat__poll-option--votable":v}),key:`base-poll-option-${t.id}`,onClick:w},v&&s.createElement(G,{checked:!!p[t.id]}),s.createElement("div",{className:"str-chat__poll-option-data"},s.createElement("p",{className:"str-chat__poll-option-text"},t.text),e&&"public"===f&&s.createElement("div",{className:"str-chat__poll-option-voters"},g?.[t.id]&&g[t.id].filter((e=>!!e.user&&!(0,R.l7)(e))).slice(0,e).map((({user:e})=>s.createElement(M.q,{image:e?.image,key:`poll-option-${t.id}-avatar-${e?.id}`,name:e?.name})))),s.createElement("div",{className:"str-chat__poll-option-vote-count"},a?l("{{count}} votes",{count:_[t.id]??0}):_[t.id]??0)),s.createElement(F,{amount:100*(E&&(_[t.id]??0)/E),className:(0,n.Z)("str-chat__poll-option__votes-bar",{"str-chat__poll-option__votes-bar--winner":m&&1===h.length&&h[0]===t.id})}))};var $=a(540239);const z=e=>({options:e.options}),Z=({optionsDisplayCount:e})=>{const{PollOptionSelector:t=V}=(0,$.yM)(),{poll:a}=(0,o.GF)(),{options:r}=(0,i.B)(a.state,z);return s.createElement("div",{className:(0,n.Z)("str-chat__poll-option-list",{"str-chat__poll-option-list--full":void 0===e})},r.slice(0,e??r.length).map((e=>s.createElement(t,{displayAvatarCount:3,key:`poll-option-${e.id}`,option:e}))))},j=e=>({name:e.name}),Q=({close:e})=>{const{t:t}=(0,r.Ht)(),{poll:a}=(0,o.GF)(),{name:n}=(0,i.B)(a.state,j);return s.createElement("div",{className:"str-chat__modal__poll-option-list"},s.createElement(w.x,{close:e,title:t("Poll options")}),s.createElement("div",{className:"str-chat__modal__poll-option-list__body"},s.createElement("div",{className:"str-chat__modal__poll-option-list__title"},n),s.createElement(Z,null)))},J=e=>[e.error,e.hasNextPage,e.loading],K=e=>({maxVotedOptionIds:e.maxVotedOptionIds,vote_counts_by_option:e.vote_counts_by_option}),W=({optionId:e})=>{const{t:t}=(0,r.Ht)(),{poll:a}=(0,o.GF)(),{maxVotedOptionIds:n,vote_counts_by_option:l}=(0,i.B)(a.state,K);return s.createElement("div",{className:"str-chat__poll-result-option-vote-counter"},1===n.length&&n[0]===e&&s.createElement("div",{className:"str-chat__poll-result-winning-option-icon"}),s.createElement("span",{className:"str-chat__poll-result-option-vote-count"},t("{{count}} votes",{count:l[e]??0})))},X=({option:e})=>s.createElement("div",{className:"str-chat__poll-option__header"},s.createElement("div",{className:"str-chat__poll-option__option-text"},e.text),s.createElement(W,{optionId:e.id})),Y=({option:e})=>{const t=(0,s.useMemo)((()=>({filter:{option_id:e.id}})),[e.id]),{error:a,hasNextPage:n,loading:r,loadMore:l,votes:c}=(({paginationParams:e})=>{const{poll:t}=(0,o.GF)(),a=(0,s.useCallback)((async a=>{const{next:s,votes:n}=await t.queryOptionVotes({filter:e.filter,options:a?{...e?.options,next:a}:e?.options,sort:{created_at:-1,...e?.sort}});return{items:n,next:s}}),[e,t]),{cursorPaginatorState:n,loadMore:r}=(0,T.l)(a,!0),l=k("vote",n,e.filter.option_id),[c,d,u]=(0,i.B)(n,J);return{error:c,hasNextPage:d,loading:u,loadMore:r,votes:l}})({paginationParams:t});return s.createElement("div",{className:"str-chat__poll-option str-chat__poll-option--full-vote-list"},s.createElement(X,{option:e}),s.createElement(U.P,{loadNextOnScrollToBottom:l,threshold:40},s.createElement(x,{votes:c}),n&&s.createElement("div",{className:"str-chat__loading-indicator-placeholder"},r&&s.createElement(A.T,null))),a&&a.message)},ee=e=>({latest_votes_by_option:e.latest_votes_by_option}),te=({countVotesPreview:e=5,option:t,showAllVotes:a})=>{const{t:n}=(0,r.Ht)(),{channelCapabilities:l={}}=(0,H.JN)("PollOptionWithLatestVotes"),{poll:c}=(0,o.GF)(),{latest_votes_by_option:d}=(0,i.B)(c.state,ee),u=d&&d[t.id];return s.createElement("div",{className:"str-chat__poll-option"},s.createElement(X,{option:t}),u&&s.createElement(x,{votes:u.slice(0,e)}),l["query-poll-votes"]&&a&&u?.length>e&&s.createElement("button",{className:"str-chat__poll-option__show-all-votes-button",onClick:a},n("Show all")))},ae=e=>({name:e.name,options:e.options,vote_counts_by_option:e.vote_counts_by_option}),se=({close:e})=>{const{t:t}=(0,r.Ht)(),{poll:a}=(0,o.GF)(),{name:l,options:c,vote_counts_by_option:d}=(0,i.B)(a.state,ae),[u,m]=(0,s.useState)(),g=(0,s.useCallback)((()=>m(void 0)),[]);return s.createElement("div",{className:(0,n.Z)("str-chat__modal__poll-results",{"str-chat__modal__poll-results--option-detail":u})},u?s.createElement(s.Fragment,null,s.createElement(w.x,{close:e,goBack:g,title:u.text}),s.createElement("div",{className:"str-chat__modal__poll-results__body"},s.createElement(Y,{key:`poll-option-detail-${u.id}`,option:u}))):s.createElement(s.Fragment,null,s.createElement(w.x,{close:e,title:t("Poll results")}),s.createElement("div",{className:"str-chat__modal__poll-results__body"},s.createElement("div",{className:"str-chat__modal__poll-results__title"},l),s.createElement("div",{className:"str-chat__modal__poll-results__option-list"},c.sort(((e,t)=>(d[t.id]??0)>=(d[e.id]??0)?1:-1)).map((e=>s.createElement(te,{key:`poll-option-${e.id}`,option:e,showAllVotes:()=>m(e)})))))))};var ne=a(864351);const re=e=>({allow_answers:e.allow_answers,allow_user_suggested_options:e.allow_user_suggested_options,answers_count:e.answers_count,created_by_id:e.created_by_id,is_closed:e.is_closed,options:e.options,ownAnswer:e.ownAnswer}),oe=({AddCommentForm:e=h,EndPollDialog:t=E,PollAnswerList:a=D,PollOptionsFullList:n=Q,PollResults:l=se,SuggestPollOptionForm:c=f})=>{const{client:d}=(0,p.mx)(),{t:m}=(0,r.Ht)("PollActions"),{channelCapabilities:g={}}=(0,H.JN)("PollActions"),{message:_}=(0,B.fr)("PollActions"),{poll:v}=(0,o.GF)(),{allow_answers:w,allow_user_suggested_options:M,answers_count:y,created_by_id:b,is_closed:C,options:N,ownAnswer:S}=(0,i.B)(v.state,re),[x,R]=(0,s.useState)(),k=(0,s.useCallback)((()=>R(void 0)),[]),T=(0,s.useCallback)((()=>R("add-comment")),[]);return s.createElement("div",{className:"str-chat__poll-actions"},N.length>ne.om&&s.createElement(u,{buttonText:m("See all options ({{count}})",{count:N.length}),closeModal:k,modalIsOpen:"view-all-options"===x,openModal:()=>R("view-all-options")},s.createElement(n,{close:k})),!C&&M&&N.length<ne.wj&&s.createElement(u,{buttonText:m("Suggest an option"),closeModal:k,modalClassName:"str-chat__suggest-poll-option-modal",modalIsOpen:"suggest-option"===x,openModal:()=>R("suggest-option")},s.createElement(c,{close:k,messageId:_.id})),!C&&w&&s.createElement(u,{buttonText:m(S?"Update your comment":"Add a comment"),closeModal:k,modalClassName:"str-chat__add-poll-answer-modal",modalIsOpen:"add-comment"===x,openModal:()=>R("add-comment")},s.createElement(e,{close:k,messageId:_.id})),y>0&&g["query-poll-votes"]&&s.createElement(u,{buttonText:m("View {{count}} comments",{count:y}),closeModal:k,modalClassName:"str-chat__poll-answer-list-modal",modalIsOpen:"view-comments"===x,openModal:()=>R("view-comments")},s.createElement(a,{close:k,onUpdateOwnAnswerClick:T})),s.createElement(u,{buttonText:m("View results"),closeModal:k,modalClassName:"str-chat__poll-results-modal",modalIsOpen:"view-results"===x,openModal:()=>R("view-results")},s.createElement(l,{close:k})),!C&&b===d.user?.id&&s.createElement(u,{buttonText:m("End vote"),closeModal:k,modalClassName:"str-chat__end-poll-modal",modalIsOpen:"end-vote"===x,openModal:()=>R("end-vote")},s.createElement(t,{close:k})))},ie=e=>({is_closed:e.is_closed}),le=()=>{const{PollHeader:e=c,PollActions:t=oe}=(0,$.yM)(),{poll:a}=(0,o.GF)(),{is_closed:r}=(0,i.B)(a.state,ie);return s.createElement("div",{className:(0,n.Z)("str-chat__poll",{"str-chat__poll--closed":r})},s.createElement(e,null),s.createElement(Z,{optionsDisplayCount:ne.om}),s.createElement(t,null))},ce=e=>({is_closed:e.is_closed,name:e.name}),de=()=>{const{poll:e}=(0,o.GF)(),{is_closed:t,name:a}=(0,i.B)(e.state,ce);return s.createElement("div",{className:(0,n.Z)("str-chat__quoted-poll-preview",{"str-chat__quoted-poll-preview--closed":t})},s.createElement("div",{className:"str-chat__quoted-poll-preview__icon"},"📊"),s.createElement("div",{className:"str-chat__quoted-poll-preview__name"},a))},ue=({isQuoted:e,poll:t})=>{const{PollContent:a=le,QuotedPoll:n=de}=(0,$.yM)();return t?s.createElement(o.Cd,{poll:t},e?s.createElement(n,null):s.createElement(a,null)):null}},864351:function(e,t,a){a.d(t,{BV:function(){return n},om:function(){return r},wj:function(){return s}});const s=100,n=/^([2-9]|10)$/,r=10},803897:function(e,t,a){a.d(t,{h:function(){return r}});var s=a(667294),n=a(973935);const r=({children:e,getPortalDestination:t,isOpen:a})=>{const[r,o]=(0,s.useState)(null);return(0,s.useLayoutEffect)((()=>{const e=t();e&&a&&o(e)}),[t,a]),r?(0,n.createPortal)(e,r):null}}}]);
//# sourceMappingURL=vendors-fbf81488-c70359f4cf6fb121.bundle.js.map