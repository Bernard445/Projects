!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="e9794a80-71a7-4973-ab5e-34b52dd7c44e",e._sentryDebugIdIdentifier="sentry-dbid-e9794a80-71a7-4973-ab5e-34b52dd7c44e")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"c646149fa3031067f714bcac03e9e2fa3f5da1d0"},(self.webpackChunkdisco=self.webpackChunkdisco||[]).push([[2935],{423274:function(e,t,n){n.d(t,{NV:function(){return P},c8:function(){return Ot},gj:function(){return ze},l7:function(){return vt},oF:function(){return O},t1:function(){return T}});var r=n(679742),s=n(115861),i=n(215671),a=n(143144),o=n(204942),c=n(887757),u=n.n(c),l=n(487462),d=n(671002),h=n(145987),p=n(241451),f=n(287066),v=n(386854),g=n(206230),m=n.n(g),y=n(746792),b=n.n(y),w=n(497326),_=n(360136),k=n(182963),x=n(661120),Z=n(516512),C=n(425108),S=n(348764).Buffer,R=n(734155);function U(e){return"string"==typeof e}function I(e,t){return!!t&&U(e)}var O=function(e){return(0,r.fromByteArray)(new Uint8Array(function(e,t){var n=[];if(U(e)&&I(e,t)){for(var r=0,s=e.length;r<s;r++)if(e.charAt(r)){var i=t(e.charAt(r),r,e);n[r]=i}}else if(!U(e)&&!I(e,t))for(var a=0,o=e.length;a<o;a++)if(a in e){var c=t(e[a],a,e);n[a]=c}return n}(e,(function(e){return e.charCodeAt(0)}))))},P=function(e){var t,n,r,s={},i=String.fromCharCode,a=e.length,o=0,c=0,u="";for(t=0;t<64;t++)s["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(n=0;n<a;n++)for(o=(o<<6)+s[e.charAt(n)],c+=6;c>=8;)((r=o>>>(c-=8)&255)||n<a-2)&&(u+=i(r));return u},L=function(){function e(t,n,r){(0,i.Z)(this,e),(0,o.Z)(this,"id",void 0),(0,o.Z)(this,"data",void 0),(0,o.Z)(this,"client",void 0),this.client=t,this.id=n,this.data=r}var t,n,r,c,l,d;return(0,a.Z)(e,[{key:"create",value:(d=(0,s.Z)(u().mark((function e(){var t,n,r,s,i,a,o,c,l,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l={id:this.id,message_template:null===(t=this.data)||void 0===t?void 0:t.message_template,segment_ids:null===(n=this.data)||void 0===n?void 0:n.segment_ids,sender_id:null===(r=this.data)||void 0===r?void 0:r.sender_id,channel_template:null===(s=this.data)||void 0===s?void 0:s.channel_template,create_channels:null===(i=this.data)||void 0===i?void 0:i.create_channels,description:null===(a=this.data)||void 0===a?void 0:a.description,name:null===(o=this.data)||void 0===o?void 0:o.name,user_ids:null===(c=this.data)||void 0===c?void 0:c.user_ids},e.next=3,this.client.createCampaign(l);case 3:return d=e.sent,this.id=d.campaign.id,this.data=d.campaign,e.abrupt("return",d);case 7:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"verifyCampaignId",value:function(){if(!this.id)throw new Error("Campaign id is missing. Either create the campaign using campaign.create() or set the id during instantiation - const campaign = client.campaign(id)")}},{key:"start",value:(l=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.next=3,this.client.startCampaign(this.id,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"update",value:(c=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.updateCampaign(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"delete",value:(r=(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.next=3,this.client.deleteCampaign(this.id);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"stop",value:(n=(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.stopCampaign(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"get",value:(t=(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.getCampaign(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){o=!0,i=e})),f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function T(e,t){e.then().catch((function(e){C.warn("failed to do ".concat(t,", ran into error: "),e)}))}var j=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function F(e){return e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function)}var q=40,N=1e3;function V(e,t,n){var r,s=new(m());return null!==(r=e)&&"object"===(0,d.Z)(r)&&(r.readable||"function"==typeof r._read)||function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}(e)||function(e){return"undefined"!=typeof window&&"File"in window&&e instanceof File}(e)||function(e){return"undefined"!=typeof window&&"Blob"in window&&e instanceof Blob}(e)?t?s.append("file",e,t):s.append("file",e):s.append("file",{uri:e,name:t||e.split("/").reverse()[0],contentType:n||void 0,type:n||void 0}),s}function B(e){var t,n=[],r=A(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var s=t.value,i=Object.entries(s);i.length>1&&C.warn("client._buildSort() - multiple fields in a single sort object detected. Object's field order is not guaranteed");for(var a=0,o=i;a<o.length;a++){var c=(0,v.Z)(o[a],2),u=c[0],l=c[1];n.push({field:u,direction:l})}}}catch(e){r.e(e)}finally{r.f()}return n}function W(e){var t=Math.min(500+2e3*e,25e3),n=Math.min(Math.max(250,2e3*(e-1)),25e3);return Math.floor(Math.random()*(t-n)+n)}function z(){return(e=function(e){var t=new Uint8Array(e);return Q(t),t}(16))[6]=15&e[6]|64,e[8]=191&e[8]|128,H(e.subarray(0,4))+"-"+H(e.subarray(4,6))+"-"+H(e.subarray(6,8))+"-"+H(e.subarray(8,10))+"-"+H(e.subarray(10,16));var e}function H(e){for(var t="",n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t}function J(e){for(var t=Math.pow(2,8*e.byteLength/e.length),n=0;n<e.length;n++)e[n]=Math.random()*t}var G,Q="undefined"!=typeof crypto&&void 0!==(null===(G=crypto)||void 0===G?void 0:G.getRandomValues)?crypto.getRandomValues.bind(crypto):"undefined"!=typeof msCrypto?msCrypto.getRandomValues.bind(msCrypto):J;function $(e){var t={};if(!e)return t;try{Object.getOwnPropertyNames(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)}))}catch(e){return{error:"failed to serialize the error"}}return t}function K(e){"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("offline",e),window.addEventListener("online",e))}function Y(e){"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("offline",e),window.removeEventListener("online",e))}var X=function(e){var t=[];for(var n in e)void 0!==e[n]&&(Array.isArray(e[n])||"object"===(0,d.Z)(e[n])?t.push("".concat(n,"=").concat(encodeURIComponent(JSON.stringify(e[n])))):t.push("".concat(n,"=").concat(encodeURIComponent(e[n]))));return t.join("&")};function ee(e){return D(D({},e),{},{__html:e.html,pinned_at:e.pinned_at?new Date(e.pinned_at):null,created_at:e.created_at?new Date(e.created_at):new Date,updated_at:e.updated_at?new Date(e.updated_at):new Date,deleted_at:e.deleted_at?new Date(e.deleted_at):null,status:e.status||"received",reaction_groups:re(e.reaction_groups,e.reaction_counts,e.reaction_scores)})}var te=function(e){var t=e.needle,n=e.sortedArray,r=e.selectValueToCompare,s=void 0===r?function(e){return e}:r,i=e.sortDirection,a=void 0===i?"ascending":i;if(!n.length)return 0;for(var o=0,c=n.length-1,u=0,l=s(t);o<=c;){var d=s(n[u=Math.round((o+c)/2)]);"ascending"===a&&l<d||"descending"===a&&l>d?c=u-1:o=u+1}return o};function ne(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"created_at",s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4]||n,i=(0,p.Z)(e);if(n&&(i=i.filter((function(e){return!(e.id&&t.id===e.id)}))),0===i.length&&s)return i.concat(t);if(0===i.length)return i;var a=t[r].getTime(),o=i.at(-1)[r].getTime()<a;if(o&&s)return i.concat(t);if(o)return i;var c=te({needle:t,sortedArray:i,sortDirection:"ascending",selectValueToCompare:function(e){return e[r].getTime()}});if(!n&&t.id){if(i[c]&&t.id===i[c].id)return i[c]=t,i;if(i[c-1]&&t.id===i[c-1].id)return i[c-1]=t,i}return s&&i.splice(c,0,t),i}function re(e,t,n){if(e)return e;if(t&&n){for(var r={},s=0,i=Object.keys(t);s<i.length;s++){var a=i[s];r[a]={count:t[a],sum_scores:n[a]}}return r}return null}var se=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.leading,s=void 0===r||r,i=n.trailing,a=void 0!==i&&i,o=null,c=null;return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];if(o)a&&(c=r);else{s&&e.apply(void 0,r);o=setTimeout((function n(){if(c)return e.apply(void 0,(0,p.Z)(c)),c=null,void(o=setTimeout(n,t));o=null}),t)}}};var ie=function(e){var t,n,r,s,i=e.parentSet,a=e.requestedPageSize,o=e.returnedPage,c=e.messagePaginationOptions,u=D({},i.pagination);if(null==c||!c.created_at_around)return u;var l=new Date(c.created_at_around),d=[o[0],o.slice(-1)[0]],h=d[0],p=d[1],f=!(null==h||!h.created_at)&&new Date(h.created_at)>l,v=!(null==p||!p.created_at)&&new Date(p.created_at)<l,g=a>i.messages.length&&a>o.length,m=(a>i.messages.length||i.messages.length>=o.length)&&a>o.length;if(f)t=!1,r=!0,g&&(n=!1,s=!0);else if(v)n=!1,s=!0,g&&(t=!1,r=!0);else if(m)n=t=!1,r=s=!0;else{var y,b;r=(null==h?void 0:h.id)&&h.id===(null===(y=i.messages[0])||void 0===y?void 0:y.id),s=(null==p?void 0:p.id)&&p.id===(null===(b=i.messages.slice(-1)[0])||void 0===b?void 0:b.id);var w=Math.floor(o.length/2),_=function(e,t){for(var n=0,r=e.length-1;n<=r;){var s=Math.floor((n+r)/2),i=e[s].created_at;if(i){var a=new Date(i);if(a.getTime()===t.getTime())return s;a.getTime()<t.getTime()?n=s+1:r=s-1}else n+=1}return n}(o,l);-1!==_&&(t=w<=_,n=w>=_)}return r&&void 0!==t&&(u.hasPrev=t),s&&void 0!==n&&(u.hasNext=n),u},ae=function(e){var t,n,r;return e.parentSet.messages.length<e.returnedPage.length?(null===(r=e.logger)||void 0===r||r.call(e,"error","Corrupted message set state: parent set size < returned page size"),e.parentSet.pagination):null!==(t=e.messagePaginationOptions)&&void 0!==t&&t.created_at_around?ie(e):null!==(n=e.messagePaginationOptions)&&void 0!==n&&n.id_around?function(e){var t,n,r,s,i=e.parentSet,a=e.requestedPageSize,o=e.returnedPage,c=e.messagePaginationOptions,u=D({},i.pagination),l=(c||{}).id_around;if(!l)return u;var d=[o[0],o.slice(-1)[0]],h=d[0],p=d[1],f=(null==h?void 0:h.id)===(null===(t=i.messages[0])||void 0===t?void 0:t.id),v=(null==p?void 0:p.id)===(null===(n=i.messages.slice(-1)[0])||void 0===n?void 0:n.id),g=Math.floor(o.length/2);if((a>i.messages.length||i.messages.length>=o.length)&&a>o.length)s=r=!1,f=v=!0;else{if(!o[g])return u;if(o[g].id===l)r=s=!0;else{var m,y=[o.slice(0,g),o.slice(g)];r=s=!0;for(var b=0;b<y.length;b++)(m=y[b].find((function(e){return e.id===l})))&&0===b&&(r=!1),m&&1===b&&(s=!1)}}return f&&void 0!==r&&(u.hasPrev=r),v&&void 0!==s&&(u.hasNext=s),u}(e):function(e){var t,n,r,s,i=e.parentSet,a=e.requestedPageSize,o=e.returnedPage,c=e.messagePaginationOptions,u=D({},i.pagination),l=[o[0],o.slice(-1)[0]],d=l[0],h=l[1],p=(null==d?void 0:d.id)&&d.id===(null===(t=i.messages[0])||void 0===t?void 0:t.id),f=(null==h?void 0:h.id)&&h.id===(null===(n=i.messages.slice(-1)[0])||void 0===n?void 0:n.id),v=c&&(c.created_at_after_or_equal||c.created_at_after||c.id_gt||c.id_gte),g=void 0===c||c.created_at_before_or_equal||c.created_at_before||c.id_lt||c.id_lte||c.offset,m=!(v||g||null!=c&&c.id_around||null!=c&&c.created_at_around),y=o.length>=a;(void 0!==g||m)&&(r=y),void 0!==v&&(s=y);var b=0===o.length;return(p||b)&&void 0!==r&&(u.hasPrev=r),(f||b)&&void 0!==s&&(u.hasNext=s),u}(e)},oe={hasNext:!0,hasPrev:!0};function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var le=function(){function e(t){var n,r=this;(0,i.Z)(this,e),(0,o.Z)(this,"_channel",void 0),(0,o.Z)(this,"watcher_count",void 0),(0,o.Z)(this,"typing",void 0),(0,o.Z)(this,"read",void 0),(0,o.Z)(this,"pinnedMessages",void 0),(0,o.Z)(this,"pending_messages",void 0),(0,o.Z)(this,"threads",void 0),(0,o.Z)(this,"mutedUsers",void 0),(0,o.Z)(this,"watchers",void 0),(0,o.Z)(this,"members",void 0),(0,o.Z)(this,"unreadCount",void 0),(0,o.Z)(this,"membership",void 0),(0,o.Z)(this,"last_message_at",void 0),(0,o.Z)(this,"isUpToDate",void 0),(0,o.Z)(this,"messageSets",[]),(0,o.Z)(this,"formatMessage",(function(e){return ee(e)})),(0,o.Z)(this,"setIsUpToDate",(function(e){r.isUpToDate=e})),(0,o.Z)(this,"removeMessageFromArray",(function(e,t){var n=e.filter((function(e){return!(e.id&&t.id&&e.id===t.id)}));return{removed:n.length<e.length,result:n}})),(0,o.Z)(this,"updateUserMessages",(function(e){var t=function(e,t){for(var n=0;n<e.length;n++){var r,s=e[n];(null===(r=s.user)||void 0===r?void 0:r.id)===t.id&&(e[n]=ue(ue({},s),{},{user:t}))}};for(var n in r.messageSets.forEach((function(n){return t(n.messages,e)})),r.threads)t(r.threads[n],e);t(r.pinnedMessages,e)})),(0,o.Z)(this,"deleteUserMessages",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0;r<e.length;r++){var s,i=e[r];(null===(s=i.user)||void 0===s?void 0:s.id)===t.id&&(e[r]=n?{cid:i.cid,created_at:i.created_at,deleted_at:t.deleted_at,id:i.id,latest_reactions:[],mentioned_users:[],own_reactions:[],parent_id:i.parent_id,reply_count:i.reply_count,status:i.status,thread_participants:i.thread_participants,type:"deleted",updated_at:i.updated_at,user:i.user}:ue(ue({},i),{},{type:"deleted",deleted_at:t.deleted_at?new Date(t.deleted_at):null}))}};for(var s in r.messageSets.forEach((function(r){return n(r.messages,e,t)})),r.threads)n(r.threads[s],e,t);n(r.pinnedMessages,e,t)})),this._channel=t,this.watcher_count=0,this.typing={},this.read={},this.initMessages(),this.pinnedMessages=[],this.pending_messages=[],this.threads={},this.mutedUsers=[],this.watchers={},this.members={},this.membership={},this.unreadCount=0,this.isUpToDate=!0,this.last_message_at=null!=(null==t||null===(n=t.state)||void 0===n?void 0:n.last_message_at)?new Date(t.state.last_message_at):null}var t;return(0,a.Z)(e,[{key:"messages",get:function(){var e;return(null===(e=this.messageSets.find((function(e){return e.isCurrent})))||void 0===e?void 0:e.messages)||[]},set:function(e){var t=this.messageSets.findIndex((function(e){return e.isCurrent}));this.messageSets[t].messages=e}},{key:"latestMessages",get:function(){var e;return(null===(e=this.messageSets.find((function(e){return e.isLatest})))||void 0===e?void 0:e.messages)||[]},set:function(e){var t=this.messageSets.findIndex((function(e){return e.isLatest}));this.messageSets[t].messages=e}},{key:"messagePagination",get:function(){var e;return(null===(e=this.messageSets.find((function(e){return e.isCurrent})))||void 0===e?void 0:e.pagination)||oe}},{key:"addMessageSorted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"latest";return this.addMessagesSorted([e],t,!1,n,r)}},{key:"addMessagesSorted",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"current",i=this.findTargetMessageSet(e,r,s),a=i.messagesToAdd,o=i.targetMessageSetIndex,c=0;c<a.length;c+=1){if(!a[c].shadowed){var u,l=void 0;if(a[c].created_at instanceof Date)l=a[c];else(l=this.formatMessage(a[c])).user&&null!==(u=this._channel)&&void 0!==u&&u.cid&&this._channel.getClient().state.updateUserReference(l.user,this._channel.cid),n&&l.id&&this.threads[l.id]&&delete this.threads[l.id],this.last_message_at||(this.last_message_at=new Date(l.created_at.getTime())),l.created_at.getTime()>this.last_message_at.getTime()&&(this.last_message_at=new Date(l.created_at.getTime()));var d=l.parent_id;if(d&&!l.show_in_channel||-1===o||(this.messageSets[o].messages=this._addToMessageList(this.messageSets[o].messages,l,t,"created_at",r)),d&&!n){var h=this.threads[d]||[];this.threads[d]=this._addToMessageList(h,l,t,"created_at",r)}}}return{messageSet:this.messageSets[o]}}},{key:"addPinnedMessages",value:function(e){for(var t=0;t<e.length;t+=1)this.addPinnedMessage(e[t])}},{key:"addPinnedMessage",value:function(e){this.pinnedMessages=this._addToMessageList(this.pinnedMessages,this.formatMessage(e),!1,"pinned_at")}},{key:"removePinnedMessage",value:function(e){var t=this.removeMessageFromArray(this.pinnedMessages,e).result;this.pinnedMessages=t}},{key:"addReaction",value:function(e,t,n){var r=this;if(t){var s=t;return this._updateMessage(t,(function(t){return s.own_reactions=r._addOwnReactionToMessage(t.own_reactions,e,n),r.formatMessage(s)})),s}}},{key:"_addOwnReactionToMessage",value:function(e,t,n){return e=(e=n?[]:this._removeOwnReactionFromMessage(e,t))||[],this._channel.getClient().userID===t.user_id&&e.push(t),e}},{key:"_removeOwnReactionFromMessage",value:function(e,t){return e?e.filter((function(e){return e.user_id!==t.user_id||e.type!==t.type})):e}},{key:"removeReaction",value:function(e,t){var n=this;if(t){var r=t;return this._updateMessage(t,(function(t){return r.own_reactions=n._removeOwnReactionFromMessage(t.own_reactions,e),n.formatMessage(r)})),r}}},{key:"_updateQuotedMessageReferences",value:function(e){var t=this,n=e.message,r=e.remove,s=function(e){var s=e.reduce((function(e,t){var s,i,a;return t.quoted_message_id===n.id&&e.push(ue(ue({},ue(ue({},s=t),{},{created_at:s.created_at.toISOString(),pinned_at:null===(i=s.pinned_at)||void 0===i?void 0:i.toISOString(),updated_at:null===(a=s.updated_at)||void 0===a?void 0:a.toISOString()})),{},{quoted_message:r?ue(ue({},n),{},{attachments:[]}):n})),e}),[]);t.addMessagesSorted(s,!0)};n.parent_id?n.parent_id&&this.threads[n.parent_id]&&s(this.threads[n.parent_id]):this.messageSets.forEach((function(e){return s(e.messages)}))}},{key:"removeQuotedMessageReferences",value:function(e){this._updateQuotedMessageReferences({message:e,remove:!0})}},{key:"_updateMessage",value:function(e,t){var n=e.parent_id,r=e.show_in_channel,s=e.pinned;if(n&&this.threads[n]){var i=this.threads[n],a=i.findIndex((function(t){return t.id===e.id}));-1!==a&&(i[a]=t(i[a]),this.threads[n]=i)}if(!r&&!n||r){var o=this.findMessageSetIndex(e);if(-1!==o){var c=this.messageSets[o].messages.findIndex((function(t){return t.id===e.id}));-1!==c&&(this.messageSets[o].messages[c]=t(this.messageSets[o].messages[c]))}}if(s){var u=this.pinnedMessages.findIndex((function(t){return t.id===e.id}));-1!==u&&(this.pinnedMessages[u]=t(this.pinnedMessages[u]))}}},{key:"_addToMessageList",value:function(e,t){return ne(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"created_at",!(arguments.length>4&&void 0!==arguments[4])||arguments[4])}},{key:"removeMessage",value:function(e){var t=!1;if(e.parent_id&&this.threads[e.parent_id]){var n=this.removeMessageFromArray(this.threads[e.parent_id],e),r=n.removed,s=n.result;this.threads[e.parent_id]=s,t=r}else{var i,a=null!==(i=e.messageSetIndex)&&void 0!==i?i:this.findMessageSetIndex(e);if(-1!==a){var o=this.removeMessageFromArray(this.messageSets[a].messages,e),c=o.removed,u=o.result;this.messageSets[a].messages=u,t=c}}return t}},{key:"filterErrorMessages",value:function(){var e=this.latestMessages.filter((function(e){return"error"!==e.type}));this.latestMessages=e}},{key:"clean",value:function(){for(var e=new Date,t=0,n=Object.entries(this.typing);t<n.length;t++){var r=(0,v.Z)(n[t],2),s=r[0],i=r[1],a="string"==typeof i.received_at?new Date(i.received_at):i.received_at||new Date;e.getTime()-a.getTime()>7e3&&(delete this.typing[s],this._channel.getClient().dispatchEvent({cid:this._channel.cid,type:"typing.stop",user:{id:s}}))}}},{key:"clearMessages",value:function(){this.initMessages(),this.pinnedMessages=[]}},{key:"initMessages",value:function(){this.messageSets=[{messages:[],isLatest:!0,isCurrent:!0,pagination:oe}]}},{key:"loadMessageIntoState",value:(t=(0,s.Z)(u().mark((function e(t,n){var r,s,i,a,o,c,l=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=l.length>2&&void 0!==l[2]?l[2]:25,a=!1,o=!1,c=n||t,"latest"!==t){e.next=10;break}if(this.messages!==this.latestMessages){e.next=7;break}return e.abrupt("return");case 7:i=this.messageSets.findIndex((function(e){return e.isLatest})),e.next=11;break;case 10:i=this.findMessageSetIndex({id:c});case 11:if(-1!==i&&(this.switchToMessageSet(i),a=!0),o=!n||!(null===(r=this.threads[n])||void 0===r||!r.find((function(e){return e.id===t}))),!a||!o){e.next=15;break}return e.abrupt("return");case 15:if(a){e.next=18;break}return e.next=18,this._channel.query({messages:{id_around:c,limit:s}},"new");case 18:if(o||!n){e.next=21;break}return e.next=21,this._channel.getReplies(n,{id_around:t,limit:s});case 21:-1!==(i=this.findMessageSetIndex({id:c}))&&this.switchToMessageSet(i);case 23:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"findMessage",value:function(e,t){if(t){var n=this.threads[t];if(!n)return;return n.find((function(t){return t.id===e}))}var r=this.findMessageSetIndex({id:e});if(-1!==r)return this.messageSets[r].messages.find((function(t){return t.id===e}))}},{key:"switchToMessageSet",value:function(e){var t=this.messageSets.find((function(e){return e.isCurrent}));t&&(t.isCurrent=!1,this.messageSets[e].isCurrent=!0)}},{key:"areMessageSetsOverlap",value:function(e,t){return e.some((function(e){return t.find((function(t){return e.id===t.id}))}))}},{key:"findMessageSetIndex",value:function(e){return this.messageSets.findIndex((function(t){return!!t.messages.find((function(t){return t.id===e.id}))}))}},{key:"findTargetMessageSet",value:function(e){var t,n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"current",s=e;if(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]){var i=this.messageSets.map((function(e,t){return t})).filter((function(t){return n.areMessageSetsOverlap(n.messageSets[t].messages,e)}));switch(r){case"new":i.length>0?t=i[0]:e.some((function(e){return!e.parent_id}))&&(this.messageSets.push({messages:[],isCurrent:!1,isLatest:!1,pagination:oe}),t=this.messageSets.length-1);break;case"current":t=this.messageSets.findIndex((function(e){return e.isCurrent}));break;case"latest":t=this.messageSets.findIndex((function(e){return e.isLatest}));break;default:t=-1}var a=i.splice(0,1)[0],o=(0,p.Z)(i);if(void 0!==a&&a!==t&&o.push(t),o.length>0){var c=this.messageSets[a],u=this.messageSets.filter((function(e,t){return-1!==o.indexOf(t)}));u.forEach((function(e){c.isLatest=c.isLatest||e.isLatest,c.isCurrent=c.isCurrent||e.isCurrent,c.pagination.hasPrev=e.messages[0].created_at<c.messages[0].created_at?e.pagination.hasPrev:c.pagination.hasPrev,c.pagination.hasNext=c.messages.slice(-1)[0].created_at<e.messages.slice(-1)[0].created_at?e.pagination.hasNext:c.pagination.hasNext,s=[].concat((0,p.Z)(s),(0,p.Z)(e.messages))})),u.forEach((function(e){return n.messageSets.splice(n.messageSets.indexOf(e),1)})),t=this.messageSets.findIndex((function(t){return n.areMessageSetsOverlap(t.messages,e)}))}}else t=this.findMessageSetIndex(e[0]);return{targetMessageSetIndex:t,messagesToAdd:s}}}]),e}();function de(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return he(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ve=function(){function e(t,n,r,a){var c=this;(0,i.Z)(this,e),(0,o.Z)(this,"_client",void 0),(0,o.Z)(this,"type",void 0),(0,o.Z)(this,"id",void 0),(0,o.Z)(this,"data",void 0),(0,o.Z)(this,"_data",void 0),(0,o.Z)(this,"cid",void 0),(0,o.Z)(this,"listeners",void 0),(0,o.Z)(this,"state",void 0),(0,o.Z)(this,"initialized",void 0),(0,o.Z)(this,"offlineMode",void 0),(0,o.Z)(this,"lastKeyStroke",void 0),(0,o.Z)(this,"lastTypingEvent",void 0),(0,o.Z)(this,"isTyping",void 0),(0,o.Z)(this,"disconnected",void 0),(0,o.Z)(this,"create",function(){var e=(0,s.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=fe(fe({},t),{},{watch:!1,state:!1,presence:!1}),e.next=3,c.query(n,"latest");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"_callChannelListeners",(function(e){var t=c,n=[];t.listeners.all&&n.push.apply(n,(0,p.Z)(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,(0,p.Z)(t.listeners[e.type]));for(var r=0,s=n;r<s.length;r++){var i=s[r];"string"!=typeof i&&i(e)}})),(0,o.Z)(this,"_channelURL",(function(){if(!c.id)throw new Error("channel id is not defined");return"".concat(c.getClient().baseURL,"/channels/").concat(encodeURIComponent(c.type),"/").concat(encodeURIComponent(c.id))}));if(!/^[\w_-]+$/.test(n))throw new Error("Invalid chat type ".concat(n,', letters, numbers and "_-" are allowed'));if("string"==typeof r&&!/^[\w!_-]+$/.test(r))throw new Error("Invalid chat id ".concat(r,', letters, numbers and "!-_" are allowed'));this._client=t,this.type=n,this.id=r,this.data=a,this._data=fe({},a),this.cid="".concat(n,":").concat(r),this.listeners={},this.state=new le(this),this.initialized=!1,this.offlineMode=!1,this.lastTypingEvent=null,this.isTyping=!1,this.disconnected=!1}var t,n,r,c,l,h,f,v,g,m,y,b,w,_,k,x,Z,C,S,R,U,I,O,P,L,M,D,A,E,j,F,q,N,V,W,z,H,J,G,Q,$,K,Y,X,ee;return(0,a.Z)(e,[{key:"getClient",value:function(){if(!0===this.disconnected)throw Error("You can't use a channel after client.disconnect() was called");return this._client}},{key:"getConfig",value:function(){return this.getClient().configs[this.cid]}},{key:"sendMessage",value:(ee=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/message",fe({message:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ee.apply(this,arguments)})},{key:"sendFile",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/file"),e,t,n,r)}},{key:"sendImage",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/image"),e,t,n,r)}},{key:"deleteFile",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/file"),{url:e})}},{key:"deleteImage",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/image"),{url:e})}},{key:"sendEvent",value:(X=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().post(this._channelURL()+"/event",{event:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"search",value:(Y=(0,s.Z)(u().mark((function e(t){var n,r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=s.length>1&&void 0!==s[1]?s[1]:{}).offset||!n.next){e.next=3;break}throw Error("Cannot specify offset with next");case 3:if(r=fe(fe({filter_conditions:{cid:this.cid}},n),{},{sort:n.sort?B(n.sort):void 0}),"string"!=typeof t){e.next=8;break}r.query=t,e.next=13;break;case 8:if("object"!==(0,d.Z)(t)){e.next=12;break}r.message_filter_conditions=t,e.next=13;break;case 12:throw Error("Invalid type ".concat((0,d.Z)(t)," for query parameter"));case 13:return e.next=15,this.getClient().wsPromise;case 15:return e.next=17,this.getClient().get(this.getClient().baseURL+"/search",{payload:r});case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"queryMembers",value:(K=(0,s.Z)(u().mark((function e(t){var n,r,s,i,a,o,c=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.length>1&&void 0!==c[1]?c[1]:[],s=c.length>2&&void 0!==c[2]?c[2]:{},a=this.type,this.id?i=this.id:null!==(n=this.data)&&void 0!==n&&n.members&&Array.isArray(this.data.members)&&(o=this.data.members),e.next=6,this.getClient().get(this.getClient().baseURL+"/members",{payload:fe({type:a,id:i,members:o,sort:B(r),filter_conditions:t},s)});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"partialUpdateMember",value:($=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the user id");case 2:return e.next=4,this.getClient().patch(this._channelURL()+"/member/".concat(encodeURIComponent(t)),n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return $.apply(this,arguments)})},{key:"sendReaction",value:(Q=(0,s.Z)(u().mark((function e(t,n,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Message id is missing");case 2:if(n&&0!==Object.keys(n).length){e.next=4;break}throw Error("Reaction object is missing");case 4:return e.next=6,this.getClient().post(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(t),"/reaction"),fe({reaction:n},r));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return Q.apply(this,arguments)})},{key:"deleteReaction",value:function(e,t,n){if(this._checkInitialized(),!t||!e)throw Error("Deleting a reaction requires specifying both the message and reaction type");var r=this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/reaction/").concat(encodeURIComponent(t));return n?this.getClient().delete(r,{user_id:n}):this.getClient().delete(r,{})}},{key:"update",value:(G=(0,s.Z)(u().mark((function e(){var t,n,r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1?s[1]:void 0,r=s.length>2?s[2]:void 0,["config","cid","created_by","id","member_count","type","created_at","updated_at","last_message_at","own_capabilities"].forEach((function(e){delete t[e]})),e.next=7,this._update(fe({message:n,data:t},r));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(){return G.apply(this,arguments)})},{key:"updatePartial",value:(J=(0,s.Z)(u().mark((function e(t){var n,r,s,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().patch(this._channelURL(),t);case 2:return s=e.sent,i=(0,p.Z)(s.channel.own_capabilities||[]).sort().join()!==(0,p.Z)(Array.isArray(null===(n=this.data)||void 0===n?void 0:n.own_capabilities)?null===(r=this.data)||void 0===r?void 0:r.own_capabilities:[]).sort().join(),this.data=s.channel,i&&this.getClient().dispatchEvent({type:"capabilities.changed",cid:this.cid,own_capabilities:s.channel.own_capabilities}),e.abrupt("return",s);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"enableSlowMode",value:(H=(0,s.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:t});case 2:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return H.apply(this,arguments)})},{key:"disableSlowMode",value:(z=(0,s.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:0});case 2:return t=e.sent,this.data=t.channel,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return z.apply(this,arguments)})},{key:"delete",value:(W=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().delete(this._channelURL(),fe({},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"truncate",value:(V=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this._channelURL()+"/truncate",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return V.apply(this,arguments)})},{key:"acceptInvite",value:(N=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this._update(fe({accept_invite:!0},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"rejectInvite",value:(q=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this._update(fe({reject_invite:!0},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return q.apply(this,arguments)})},{key:"addMembers",value:(F=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(fe({add_members:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return F.apply(this,arguments)})},{key:"addModerators",value:(j=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(fe({add_moderators:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return j.apply(this,arguments)})},{key:"assignRoles",value:(E=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(fe({assign_roles:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"inviteMembers",value:(A=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(fe({invites:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return A.apply(this,arguments)})},{key:"removeMembers",value:(D=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(fe({remove_members:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"demoteModerators",value:(M=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this._update(fe({demote_moderators:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"_update",value:(L=(0,s.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),t);case 2:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"mute",value:(P=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/mute/channel",fe({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"unmute",value:(O=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/unmute/channel",fe({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return O.apply(this,arguments)})},{key:"archive",value:(I=(0,s.Z)(u().mark((function e(){var t,n,r,s,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw Error("A user_id is required for archiving a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{archived:!0}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"unarchive",value:(U=(0,s.Z)(u().mark((function e(){var t,n,r,s,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw Error("A user_id is required for unarchiving a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{archived:!1}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"pin",value:(R=(0,s.Z)(u().mark((function e(){var t,n,r,s,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw new Error("A user_id is required for pinning a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{pinned:!0}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"unpin",value:(S=(0,s.Z)(u().mark((function e(){var t,n,r,s,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},n=this.getClient(),r=t.user_id||n.userID){e.next=5;break}throw new Error("A user_id is required for unpinning a channel");case 5:return e.next=7,this.partialUpdateMember(r,{set:{pinned:!1}});case 7:return s=e.sent,e.abrupt("return",s.channel_member);case 9:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"muteStatus",value:function(){return this._checkInitialized(),this.getClient()._muteStatus(this.cid)}},{key:"sendAction",value:function(e,t){if(this._checkInitialized(),!e)throw Error("Message id is missing");return this.getClient().post(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/action"),{message_id:e,form_data:t,id:this.id,type:this.type})}},{key:"keystroke",value:(C=(0,s.Z)(u().mark((function e(t,n){var r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isTypingIndicatorsEnabled()){e.next=2;break}return e.abrupt("return");case 2:if(r=new Date,s=this.lastTypingEvent&&r.getTime()-this.lastTypingEvent.getTime(),this.lastKeyStroke=r,this.isTyping=!0,!(null===s||s>2e3)){e.next=10;break}return this.lastTypingEvent=new Date,e.next=10,this.sendEvent(fe({type:"typing.start",parent_id:t},n||{}));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"stopTyping",value:(Z=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isTypingIndicatorsEnabled()){e.next=2;break}return e.abrupt("return");case 2:return this.lastTypingEvent=null,this.isTyping=!1,e.next=6,this.sendEvent(fe({type:"typing.stop",parent_id:t},n||{}));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return Z.apply(this,arguments)})},{key:"_isTypingIndicatorsEnabled",value:function(){var e,t,n,r,s;return!(null===(e=this.getConfig())||void 0===e||!e.typing_events)&&(null===(t=null===(n=this.getClient().user)||void 0===n||null===(r=n.privacy_settings)||void 0===r||null===(s=r.typing_indicators)||void 0===s?void 0:s.enabled)||void 0===t||t)}},{key:"lastMessage",value:function(){var e=this.state.latestMessages.length-5;e<0&&(e=0);var t=this.state.latestMessages.length+1,n=this.state.latestMessages.slice(e,t);return n.sort((function(e,t){return t.created_at.getTime()-e.created_at.getTime()})),n[0]}},{key:"markRead",value:(x=(0,s.Z)(u().mark((function e(){var t,n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>0&&void 0!==r[0]?r[0]:{},this._checkInitialized(),null!==(t=this.getConfig())&&void 0!==t&&t.read_events||this.getClient()._isUsingServerAuth()){e.next=4;break}return e.abrupt("return",Promise.resolve(null));case 4:return e.next=6,this.getClient().post(this._channelURL()+"/read",fe({},n));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"markUnread",value:(k=(0,s.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._checkInitialized(),null!==(n=this.getConfig())&&void 0!==n&&n.read_events||this.getClient()._isUsingServerAuth()){e.next=3;break}return e.abrupt("return",Promise.resolve(null));case 3:return e.next=5,this.getClient().post(this._channelURL()+"/unread",fe({},t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"clean",value:function(){this.lastKeyStroke&&((new Date).getTime()-this.lastKeyStroke.getTime()>1e3&&this.isTyping&&T(this.stopTyping(),"stop typing event"));this.state.clean()}},{key:"watch",value:(_=(0,s.Z)(u().mark((function e(t){var n,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={state:!0,watch:!0,presence:!1},e.next=3,this.getClient().wsPromise;case 3:return this.getClient()._hasConnectionID()||(n.watch=!1),r=fe(fe({},n),t),e.next=7,this.query(r,"latest");case 7:return s=e.sent,this.initialized=!0,this.data=s.channel,this._client.logger("info","channel:watch() - started watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",s);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"stopWatching",value:(w=(0,s.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/stop-watching",{});case 2:return t=e.sent,this._client.logger("info","channel:watch() - stopped watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"getReplies",value:(b=(0,s.Z)(u().mark((function e(t,n,r){var s,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r?B(r):void 0,e.next=3,this.getClient().get(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(t),"/replies"),fe({sort:s},n));case 3:return(i=e.sent).messages&&this.state.addMessagesSorted(i.messages),e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return b.apply(this,arguments)})},{key:"getPinnedMessages",value:(y=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:[],e.next=3,this.getClient().get(this._channelURL()+"/pinned_messages",{payload:fe(fe({},t),{},{sort:B(n)})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getReactions",value:function(e,t){return this.getClient().get(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/reactions"),fe({},t))}},{key:"getMessagesById",value:function(e){return this.getClient().get(this._channelURL()+"/messages",{ids:e.join(",")})}},{key:"lastRead",value:function(){var e=this.getClient().userID;if(e)return this.state.read[e]?this.state.read[e].last_read:null}},{key:"_countMessageAsUnread",value:function(e){var t,n,r,s;return!e.shadowed&&(!e.silent&&(!(e.parent_id&&!e.show_in_channel)&&((null===(t=e.user)||void 0===t?void 0:t.id)!==this.getClient().userID&&((null===(n=e.user)||void 0===n||!n.id||!this.getClient().userMuteStatus(e.user.id))&&(!(Array.isArray(null===(r=this.data)||void 0===r?void 0:r.own_capabilities)&&(null===(s=this.data)||void 0===s||!s.own_capabilities.includes("read-events")))&&!this.muteStatus().muted)))))}},{key:"countUnread",value:function(e){if(!e)return this.state.unreadCount;for(var t=0,n=0;n<this.state.latestMessages.length;n+=1){var r=this.state.latestMessages[n];r.created_at>e&&this._countMessageAsUnread(r)&&t++}return t}},{key:"countUnreadMentions",value:function(){for(var e=this.lastRead(),t=this.getClient().userID,n=0,r=0;r<this.state.latestMessages.length;r+=1){var s,i=this.state.latestMessages[r];this._countMessageAsUnread(i)&&(!e||i.created_at>e)&&null!==(s=i.mentioned_users)&&void 0!==s&&s.some((function(e){return e.id===t}))&&n++}return n}},{key:"query",value:(m=(0,s.Z)(u().mark((function e(t){var n,r,s,i,a,o,c,l,d,h,f,v,g=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>1&&void 0!==g[1]?g[1]:"current",e.next=3,this.getClient().wsPromise;case 3:return o="".concat(this.getClient().baseURL,"/channels/").concat(encodeURIComponent(this.type)),this.id&&(o+="/".concat(encodeURIComponent(this.id))),e.next=7,this.getClient().post(o+"/query",fe({data:this._data,state:!0},t));case 7:return c=e.sent,this.id||(this.id=c.channel.id,this.cid=c.channel.cid,l=c.members.map((function(e){var t;return e.user_id||(null===(t=e.user)||void 0===t?void 0:t.id)})).sort().join(","),(d="".concat(this.type,":!members-").concat(l))in this.getClient().activeChannels&&delete this.getClient().activeChannels[d],this.cid in this.getClient().activeChannels||(this.getClient().activeChannels[this.cid]=this)),this.getClient()._addChannelConfig(c.channel),h=this._initializeState(c,a),(f=h.messageSet).pagination=fe(fe({},f.pagination),ae({parentSet:f,messagePaginationOptions:null==t?void 0:t.messages,requestedPageSize:null!==(n=null==t||null===(r=t.messages)||void 0===r?void 0:r.limit)&&void 0!==n?n:100,returnedPage:c.messages,logger:this.getClient().logger})),this.getClient().polls.hydratePollCache(f.messages,!0),v=(0,p.Z)(c.channel.own_capabilities||[]).sort().join()!==(0,p.Z)(Array.isArray(null===(s=this.data)||void 0===s?void 0:s.own_capabilities)?null===(i=this.data)||void 0===i?void 0:i.own_capabilities:[]).sort().join(),this.data=c.channel,this.offlineMode=!1,v&&this.getClient().dispatchEvent({type:"capabilities.changed",cid:this.cid,own_capabilities:c.channel.own_capabilities}),this.getClient().dispatchEvent({type:"channels.queried",queriedChannels:{channels:[c],isLatestMessageSet:f.isLatest}}),e.abrupt("return",c);case 19:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"banUser",value:(g=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().banUser(t,fe(fe({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"hide",value:(v=(0,s.Z)(u().mark((function e(){var t,n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:null,n=r.length>1&&void 0!==r[1]&&r[1],this._checkInitialized(),e.next=5,this.getClient().post("".concat(this._channelURL(),"/hide"),{user_id:t,clear_history:n});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"show",value:(f=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,this._checkInitialized(),e.next=4,this.getClient().post("".concat(this._channelURL(),"/show"),{user_id:t});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"unbanUser",value:(h=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().unbanUser(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"shadowBan",value:(l=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().shadowBan(t,fe(fe({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"removeShadowBan",value:(c=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().removeShadowBan(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"createCall",value:(r=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/call",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"vote",value:(n=(0,s.Z)(u().mark((function e(t,n,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().castPollVote(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"removeVote",value:(t=(0,s.Z)(u().mark((function e(t,n,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().removePollVote(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"on",value:function(e,t){var n=this,r=t?e:"all",s=t||e;return r in this.listeners||(this.listeners[r]=[]),this._client.logger("info","Attaching listener for ".concat(r," event on channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[r].push(s),{unsubscribe:function(){n._client.logger("info","Removing listener for ".concat(r," event from channel ").concat(n.cid),{tags:["event","channel"],channel:n}),n.listeners[r]=n.listeners[r].filter((function(e){return e!==s}))}}}},{key:"off",value:function(e,t){var n=t?e:"all",r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Removing listener for ".concat(n," event from channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n]=this.listeners[n].filter((function(e){return e!==r}))}},{key:"_handleChannelEvent",value:function(e){var t,n,r,s,i,a,c,u,l,d,h,p,f=this;this._client.logger("info","channel:_handleChannelEvent - Received event of type { ".concat(e.type," } on ").concat(this.cid),{tags:["event","channel"],channel:this});var v=f.state;switch(e.type){case"typing.start":null!==(t=e.user)&&void 0!==t&&t.id&&(v.typing[e.user.id]=e);break;case"typing.stop":null!==(n=e.user)&&void 0!==n&&n.id&&delete v.typing[e.user.id];break;case"message.read":var g,m;if(null!==(r=e.user)&&void 0!==r&&r.id&&e.created_at)v.read[e.user.id]={last_read:new Date(e.created_at),last_read_message_id:e.last_read_message_id,user:e.user,unread_messages:0},(null===(g=e.user)||void 0===g?void 0:g.id)===(null===(m=this.getClient().user)||void 0===m?void 0:m.id)&&(v.unreadCount=0);break;case"user.watching.start":case"user.updated":null!==(s=e.user)&&void 0!==s&&s.id&&(v.watchers[e.user.id]=e.user);break;case"user.watching.stop":null!==(i=e.user)&&void 0!==i&&i.id&&delete v.watchers[e.user.id];break;case"message.deleted":e.message&&(this._extendEventWithOwnReactions(e),e.hard_delete?v.removeMessage(e.message):v.addMessageSorted(e.message,!1,!1),v.removeQuotedMessageReferences(e.message),e.message.pinned&&v.removePinnedMessage(e.message));break;case"message.new":if(e.message){var y,b,w,_=(null===(y=e.user)||void 0===y?void 0:y.id)===(null===(b=this.getClient().user)||void 0===b?void 0:b.id),k=e.message.parent_id&&!e.message.show_in_channel;if((this.state.isUpToDate||k)&&v.addMessageSorted(e.message,_),e.message.pinned&&v.addPinnedMessage(e.message),_||k)break;if(null!==(w=e.user)&&void 0!==w&&w.id)for(var x in v.read)x===e.user.id?v.read[e.user.id]={last_read:new Date(e.created_at),user:e.user,unread_messages:0}:v.read[x].unread_messages+=1;this._countMessageAsUnread(e.message)&&(v.unreadCount=v.unreadCount+1)}break;case"message.updated":case"message.undeleted":e.message&&(this._extendEventWithOwnReactions(e),v.addMessageSorted(e.message,!1,!1),v._updateQuotedMessageReferences({message:e.message}),e.message.pinned?v.addPinnedMessage(e.message):v.removePinnedMessage(e.message));break;case"channel.truncated":if(null!==(a=e.channel)&&void 0!==a&&a.truncated_at){var Z=+new Date(e.channel.truncated_at);v.messageSets.forEach((function(e,t){e.messages.forEach((function(e){var n=e.created_at,r=e.id;Z>+n&&v.removeMessage({id:r,messageSetIndex:t})}))})),v.pinnedMessages.forEach((function(e){var t=e.id,n=e.created_at;Z>+n&&v.removePinnedMessage({id:t})}))}else v.clearMessages();v.unreadCount=0,e.message&&(v.addMessageSorted(e.message),e.message.pinned&&v.addPinnedMessage(e.message));break;case"member.added":case"member.updated":null!==(c=e.member)&&void 0!==c&&c.user_id&&(v.members=fe(fe({},v.members),{},(0,o.Z)({},e.member.user_id,e.member)));break;case"member.removed":if(null!==(u=e.user)&&void 0!==u&&u.id){var C=fe({},v.members);delete C[e.user.id],v.members=C}break;case"notification.mark_unread":var S,R,U;if(!((null===(S=e.user)||void 0===S?void 0:S.id)===(null===(R=this.getClient().user)||void 0===R?void 0:R.id))||!e.user)break;var I=null!==(U=e.unread_messages)&&void 0!==U?U:0;v.read[e.user.id]={first_unread_message_id:e.first_unread_message_id,last_read:new Date(e.last_read_at),last_read_message_id:e.last_read_message_id,user:e.user,unread_messages:I},v.unreadCount=I;break;case"channel.updated":var O,P,L,M,D,A,E,T;if(e.channel)void 0!==(null===(O=e.channel)||void 0===O?void 0:O.frozen)&&e.channel.frozen!==(null===(P=f.data)||void 0===P?void 0:P.frozen)&&this.query({state:!1,messages:{limit:0},watchers:{limit:0}}),f.data=fe(fe({},e.channel),{},{hidden:null!==(L=null===(M=e.channel)||void 0===M?void 0:M.hidden)&&void 0!==L?L:null===(D=f.data)||void 0===D?void 0:D.hidden,own_capabilities:null!==(A=null===(E=e.channel)||void 0===E?void 0:E.own_capabilities)&&void 0!==A?A:null===(T=f.data)||void 0===T?void 0:T.own_capabilities});break;case"reaction.new":e.message&&e.reaction&&(e.message=v.addReaction(e.reaction,e.message));break;case"reaction.deleted":e.reaction&&(e.message=v.removeReaction(e.reaction,e.message));break;case"reaction.updated":e.reaction&&(e.message=v.addReaction(e.reaction,e.message,!0));break;case"channel.hidden":f.data=fe(fe({},f.data),{},{hidden:!0}),e.clear_history&&v.clearMessages();break;case"channel.visible":f.data=fe(fe({},f.data),{},{hidden:!1});break;case"user.banned":if(null===(l=e.user)||void 0===l||!l.id)break;v.members[e.user.id]=fe(fe({},v.members[e.user.id]||{}),{},{shadow_banned:!!e.shadow,banned:!e.shadow,user:fe(fe({},(null===(d=v.members[e.user.id])||void 0===d?void 0:d.user)||{}),e.user)});break;case"user.unbanned":if(null===(h=e.user)||void 0===h||!h.id)break;v.members[e.user.id]=fe(fe({},v.members[e.user.id]||{}),{},{shadow_banned:!1,banned:!1,user:fe(fe({},(null===(p=v.members[e.user.id])||void 0===p?void 0:p.user)||{}),e.user)})}void 0!==e.watcher_count&&(f.state.watcher_count=e.watcher_count)}},{key:"_checkInitialized",value:function(){if(!this.initialized&&!this.offlineMode&&!this.getClient()._isUsingServerAuth())throw Error("Channel ".concat(this.cid," hasn't been initialized yet. Make sure to call .watch() and wait for it to resolve"))}},{key:"_initializeState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"latest",n=this.getClient(),r=n.state,s=n.user,i=n.userID;if(e.members){var a,o=de(e.members);try{for(o.s();!(a=o.n()).done;){var c=a.value;c.user&&r.updateUserReference(c.user,this.cid)}}catch(e){o.e(e)}finally{o.f()}}this.state.membership=e.membership||{};var u=e.messages||[];this.state.messages||this.state.initMessages();var l=this.state.addMessagesSorted(u,!1,!0,!0,t).messageSet;if(this.state.pinnedMessages||(this.state.pinnedMessages=[]),this.state.addPinnedMessages(e.pinned_messages||[]),e.pending_messages&&(this.state.pending_messages=e.pending_messages),void 0!==e.watcher_count&&(this.state.watcher_count=e.watcher_count),e.watchers){var d,h=de(e.watchers);try{for(h.s();!(d=h.n()).done;){var p=d.value;p&&(r.updateUserReference(p,this.cid),this.state.watchers[p.id]=p)}}catch(e){h.e(e)}finally{h.f()}}if(null!=i){var f=this.state.last_message_at||new Date;s&&(this.state.read[s.id]={user:s,last_read:f,unread_messages:0})}if(e.read){var v,g=de(e.read);try{for(g.s();!(v=g.n()).done;){var m,y=v.value;this.state.read[y.user.id]={last_read:new Date(y.last_read),last_read_message_id:y.last_read_message_id,unread_messages:null!==(m=y.unread_messages)&&void 0!==m?m:0,user:y.user},y.user.id===(null==s?void 0:s.id)&&(this.state.unreadCount=this.state.read[y.user.id].unread_messages)}}catch(e){g.e(e)}finally{g.f()}}return e.members&&this._hydrateMembers(e.members),{messageSet:l}}},{key:"_extendEventWithOwnReactions",value:function(e){if(e.message){var t=this.state.findMessage(e.message.id,e.message.parent_id);t&&(e.message.own_reactions=t.own_reactions)}}},{key:"_hydrateMembers",value:function(e){this.state.members=e.reduce((function(e,t){return t.user&&(e[t.user.id]=t),e}),{})}},{key:"_disconnect",value:function(){this._client.logger("info","channel:disconnect() - Disconnecting the channel ".concat(this.cid),{tags:["connection","channel"],channel:this}),this.disconnected=!0,this.state.setIsUpToDate(!1)}}]),e}();function ge(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return me(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ye=function(){function e(){(0,i.Z)(this,e),(0,o.Z)(this,"users",void 0),(0,o.Z)(this,"userChannelReferences",void 0),this.users={},this.userChannelReferences={}}return(0,a.Z)(e,[{key:"updateUsers",value:function(e){var t,n=ge(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.updateUser(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"updateUser",value:function(e){null!=e&&(this.users[e.id]=e)}},{key:"updateUserReference",value:function(e,t){null!=e&&(this.updateUser(e),this.userChannelReferences[e.id]||(this.userChannelReferences[e.id]={}),this.userChannelReferences[e.id][t]=!0)}},{key:"deleteAllChannelReference",value:function(e){for(var t in this.userChannelReferences)delete this.userChannelReferences[t][e]}}]),e}();function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _e=function e(){(0,i.Z)(this,e),(0,o.Z)(this,"connectionStartTimestamp",void 0),(0,o.Z)(this,"wsConsecutiveFailures",void 0),(0,o.Z)(this,"wsTotalFailures",void 0),(0,o.Z)(this,"instanceClientId",void 0),this.connectionStartTimestamp=null,this.wsTotalFailures=0,this.wsConsecutiveFailures=0,this.instanceClientId=z()},ke=function(){var e=(0,s.Z)(u().mark((function e(t,n){var r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=3,s=0;case 2:if(!(s<r)){e.next=17;break}return e.prev=3,e.next=6,f.Z.post("https://chat-insights.getstream.io/insights/".concat(t),n);case 6:e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(3),e.next=12,j(3e3*(s+1));case 12:return e.abrupt("continue",14);case 13:return e.abrupt("break",17);case 14:s++,e.next=2;break;case 17:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(t,n){return e.apply(this,arguments)}}();function xe(e,t){return we(we({},t),Ze(e))}function Ze(e){var t,n,r,s=e.client;return{ready_state:null===(t=e.ws)||void 0===t?void 0:t.readyState,url:e._buildUrl(),api_key:s.key,start_ts:s.insightMetrics.connectionStartTimestamp,end_ts:(new Date).getTime(),auth_type:s.getAuthType(),token:s.tokenManager.token,user_id:s.userID,user_details:s._user,device:s.options.device,client_id:e.connectionID,ws_details:e.ws,ws_consecutive_failures:s.insightMetrics.wsConsecutiveFailures,ws_total_failures:s.insightMetrics.wsTotalFailures,request_id:e.requestID,online:"undefined"!=typeof navigator?null===(n=navigator)||void 0===n?void 0:n.onLine:null,user_agent:"undefined"!=typeof navigator?null===(r=navigator)||void 0===r?void 0:r.userAgent:null,instance_client_id:s.insightMetrics.instanceClientId}}function Ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Se=function(){function e(t){var n=this,r=t.client;(0,i.Z)(this,e),(0,o.Z)(this,"client",void 0),(0,o.Z)(this,"connectionID",void 0),(0,o.Z)(this,"connectionOpen",void 0),(0,o.Z)(this,"consecutiveFailures",void 0),(0,o.Z)(this,"pingInterval",void 0),(0,o.Z)(this,"healthCheckTimeoutRef",void 0),(0,o.Z)(this,"isConnecting",void 0),(0,o.Z)(this,"isDisconnected",void 0),(0,o.Z)(this,"isHealthy",void 0),(0,o.Z)(this,"isResolved",void 0),(0,o.Z)(this,"lastEvent",void 0),(0,o.Z)(this,"connectionCheckTimeout",void 0),(0,o.Z)(this,"connectionCheckTimeoutRef",void 0),(0,o.Z)(this,"rejectPromise",void 0),(0,o.Z)(this,"requestID",void 0),(0,o.Z)(this,"resolvePromise",void 0),(0,o.Z)(this,"totalFailures",void 0),(0,o.Z)(this,"ws",void 0),(0,o.Z)(this,"wsID",void 0),(0,o.Z)(this,"_buildUrl",(function(){var e=encodeURIComponent(n.client._buildWSPayload(n.requestID)),t=n.client.tokenManager.getToken();return"".concat(n.client.wsBaseURL,"/connect?json=").concat(e,"&api_key=").concat(n.client.key,"&authorization=").concat(t,"&stream-auth-type=").concat(n.client.getAuthType(),"&X-Stream-Client=").concat(n.client.getUserAgent())})),(0,o.Z)(this,"onlineStatusChanged",(function(e){"offline"===e.type?(n._log("onlineStatusChanged() - Status changing to offline"),n._setHealth(!1)):"online"===e.type&&(n._log("onlineStatusChanged() - Status changing to online. isHealthy: ".concat(n.isHealthy)),n.isHealthy||n._reconnect({interval:10}))})),(0,o.Z)(this,"onopen",(function(e){n.wsID===e&&n._log("onopen() - onopen callback",{wsID:e})})),(0,o.Z)(this,"onmessage",(function(e,t){if(n.wsID===e){n._log("onmessage() - onmessage callback",{event:t,wsID:e});var r="string"==typeof t.data?JSON.parse(t.data):null;if(!n.isResolved&&r){var s,i;if(n.isResolved=!0,r.error)return void(null===(i=n.rejectPromise)||void 0===i||i.call(n,n._errorFromWSEvent(r,!1)));null===(s=n.resolvePromise)||void 0===s||s.call(n,r),n._setHealth(!0)}n.lastEvent=new Date,r&&"health.check"===r.type&&n.scheduleNextPing(),n.client.handleEvent(t),n.scheduleConnectionCheck()}})),(0,o.Z)(this,"onclose",(function(e,t){if(n.wsID===e)if(n._log("onclose() - onclose callback - "+t.code,{event:t,wsID:e}),t.code===N){var r,s=new Error("WS connection reject with error ".concat(t.reason));s.reason=t.reason,s.code=t.code,s.wasClean=t.wasClean,s.target=t.target,null===(r=n.rejectPromise)||void 0===r||r.call(n,s),n._log("onclose() - WS connection reject with error ".concat(t.reason),{event:t})}else{var i;n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.isConnecting=!1,null===(i=n.rejectPromise)||void 0===i||i.call(n,n._errorFromWSEvent(t)),n._log("onclose() - WS connection closed. Calling reconnect ...",{event:t}),n._reconnect()}})),(0,o.Z)(this,"onerror",(function(e,t){var r;n.wsID===e&&(n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.isConnecting=!1,null===(r=n.rejectPromise)||void 0===r||r.call(n,n._errorFromWSEvent(t)),n._log("onerror() - WS connection resulted into error",{event:t}),n._reconnect())})),(0,o.Z)(this,"_setHealth",(function(e){e!==n.isHealthy&&(n.isHealthy=e,n.isHealthy?n.client.dispatchEvent({type:"connection.changed",online:n.isHealthy}):setTimeout((function(){n.isHealthy||n.client.dispatchEvent({type:"connection.changed",online:n.isHealthy})}),5e3))})),(0,o.Z)(this,"_errorFromWSEvent",(function(e){var t,r,s,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];void 0!==e.code&&(t=e.code,r="unknown",s=e.reason),function(e){return void 0!==e.error}(e)&&(t=e.error.code,r=e.error.StatusCode,s=e.error.message),n._log("_errorFromWSEvent() - WS failed with code ".concat(t),{event:e},"warn");var a=new Error("WS failed with code ".concat(t," and reason - ").concat(s));return a.code=t,a.StatusCode=r,a.isWSFailure=i,a})),(0,o.Z)(this,"_setupConnectionPromise",(function(){n.isResolved=!1,n.connectionOpen=new Promise((function(e,t){n.resolvePromise=e,n.rejectPromise=t}))})),(0,o.Z)(this,"scheduleNextPing",(function(){n.healthCheckTimeoutRef&&clearTimeout(n.healthCheckTimeoutRef),n.healthCheckTimeoutRef=setTimeout((function(){var e=[{type:"health.check",client_id:n.client.clientID}];try{var t;null===(t=n.ws)||void 0===t||t.send(JSON.stringify(e))}catch(e){}}),n.pingInterval)})),(0,o.Z)(this,"scheduleConnectionCheck",(function(){n.connectionCheckTimeoutRef&&clearTimeout(n.connectionCheckTimeoutRef),n.connectionCheckTimeoutRef=setTimeout((function(){var e=new Date;n.lastEvent&&e.getTime()-n.lastEvent.getTime()>n.connectionCheckTimeout&&(n._log("scheduleConnectionCheck - going to reconnect"),n._setHealth(!1),n._reconnect())}),n.connectionCheckTimeout)})),this.client=r,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isDisconnected=!1,this.isResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25e3,this.connectionCheckTimeout=this.pingInterval+1e4,K(this.onlineStatusChanged)}var t,n,r,c;return(0,a.Z)(e,[{key:"_log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(n,"connection:"+e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({tags:["connection"]},t))}},{key:"setClient",value:function(e){this.client=e}},{key:"connect",value:(c=(0,s.Z)(u().mark((function e(){var t,n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:15e3,!this.isConnecting){e.next=3;break}throw Error("You've called connect twice, can only attempt 1 connection at the time");case 3:return this.isDisconnected=!1,e.prev=4,e.next=7,this._connect();case 7:n=e.sent,this.consecutiveFailures=0,this._log("connect() - Established ws connection with healthcheck: ".concat(n)),e.next=23;break;case 12:if(e.prev=12,e.t0=e.catch(4),this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==q||this.client.tokenManager.isStatic()){e.next=21;break}this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}),e.next=23;break;case 21:if(e.t0.isWSFailure){e.next=23;break}throw new Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 23:return e.next=25,this._waitForHealthy(t);case 25:return e.abrupt("return",e.sent);case 26:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(){return c.apply(this,arguments)})},{key:"_waitForHealthy",value:(r=(0,s.Z)(u().mark((function e(){var t,n=this,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:15e3,e.abrupt("return",Promise.race([(0,s.Z)(u().mark((function e(){var r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=50,s=0;case 2:if(!(s<=t)){e.next=18;break}return e.prev=3,e.next=6,n.connectionOpen;case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),s!==t){e.next=13;break}throw new Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 13:return e.next=15,j(r);case 15:s+=r,e.next=2;break;case 18:case"end":return e.stop()}}),e,null,[[3,9]])})))(),(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j(t);case 2:throw n.isConnecting=!1,new Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}));case 4:case"end":return e.stop()}}),e)})))()]));case 2:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"disconnect",value:function(e){var t,n=this;this._log("disconnect() - Closing the websocket connection for wsID ".concat(this.wsID)),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),Y(this.onlineStatusChanged),this.isHealthy=!1,this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners();var r=this.ws;return r&&r.close&&r.readyState===r.OPEN?(t=new Promise((function(t){var s=function(e){n._log("disconnect() - resolving isClosedPromise ".concat(e?"with":"without"," close frame"),{event:e}),t()};r.onclose=s,setTimeout(s,null!=e?e:1e3)})),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),r.close(N,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),t=Promise.resolve()),delete this.ws,t}},{key:"_connect",value:(n=(0,s.Z)(u().mark((function e(){var t,n,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.isConnecting||this.isDisconnected&&this.client.options.enableWSFallback)){e.next=2;break}return e.abrupt("return");case 2:return this.isConnecting=!0,this.requestID=z(),this.client.insightMetrics.connectionStartTimestamp=(new Date).getTime(),t=!1,e.prev=6,this._log("_connect() - waiting for token"),e.next=10,this.client.tokenManager.tokenReady();case 10:t=!0,e.next=15;break;case 13:e.prev=13,e.t0=e.catch(6);case 15:if(e.prev=15,t){e.next=20;break}return this._log("_connect() - tokenProvider failed before, so going to retry"),e.next=20,this.client.tokenManager.loadToken();case 20:return this._setupConnectionPromise(),n=this._buildUrl(),this._log("_connect() - Connecting to ".concat(n),{wsURL:n,requestID:this.requestID}),this.ws=new(b())(n),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID),e.next=30,this.connectionOpen;case 30:if(r=e.sent,this.isConnecting=!1,!r){e.next=36;break}return this.connectionID=r.connection_id,this.client.insightMetrics.wsConsecutiveFailures>0&&this.client.options.enableInsights&&(ke("ws_success_after_failure",Ze(this)),this.client.insightMetrics.wsConsecutiveFailures=0),e.abrupt("return",r);case 36:e.next=44;break;case 38:throw e.prev=38,e.t1=e.catch(15),this.isConnecting=!1,this._log("_connect() - Error - ",e.t1),this.client.options.enableInsights&&(this.client.insightMetrics.wsConsecutiveFailures++,this.client.insightMetrics.wsTotalFailures++,s=xe(this,$(e.t1)),null==ke||ke("ws_fatal",s)),e.t1;case 44:case"end":return e.stop()}}),e,this,[[6,13],[15,38]])}))),function(){return n.apply(this,arguments)})},{key:"_reconnect",value:(t=(0,s.Z)(u().mark((function e(){var t,n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},this._log("_reconnect() - Initiating the reconnect"),!this.isConnecting&&!this.isHealthy){e.next=5;break}return this._log("_reconnect() - Abort (1) since already connecting or healthy"),e.abrupt("return");case 5:return(n=t.interval)||(n=W(this.consecutiveFailures)),e.next=9,j(n);case 9:if(!this.isConnecting&&!this.isHealthy){e.next=12;break}return this._log("_reconnect() - Abort (2) since already connecting or healthy"),e.abrupt("return");case 12:if(!this.isDisconnected||!this.client.options.enableWSFallback){e.next=15;break}return this._log("_reconnect() - Abort (3) since disconnect() is called"),e.abrupt("return");case 15:if(this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),!t.refreshToken){e.next=20;break}return e.next=20,this.client.tokenManager.loadToken();case 20:return e.prev=20,e.next=23,this._connect();case 23:return this._log("_reconnect() - Waiting for recoverCallBack"),e.next=26,this.client.recoverState();case 26:this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0,e.next=38;break;case 30:if(e.prev=30,e.t0=e.catch(20),this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==q||this.client.tokenManager.isStatic()){e.next=37;break}return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),e.abrupt("return",this._reconnect({refreshToken:!0}));case 37:e.t0.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect());case 38:this._log("_reconnect() - == END ==");case 39:case"end":return e.stop()}}),e,this,[[20,30]])}))),function(){return t.apply(this,arguments)})},{key:"_destroyCurrentWSConnection",value:function(){this.wsID+=1;try{var e,t;null==this||null===(e=this.ws)||void 0===e||e.removeAllListeners(),null==this||null===(t=this.ws)||void 0===t||t.close()}catch(e){}}}]),e}();function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof t)throw new TypeError("userId should be a string");!function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}}({user_id:t},n);throw Error("Unable to find jwt crypto, if you are getting this error is probably because you are trying to generate tokens on browser or React Native (or other environment where crypto functions are not available). Please Note: token should only be generated server-side.")}function Ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,l.Z)({algorithm:"HS256",noTimestamp:!0},t);return null.sign({server:!0},e,n)}var Oe,Pe=function e(t){var n=this;(0,i.Z)(this,e),(0,o.Z)(this,"loadTokenPromise",void 0),(0,o.Z)(this,"type",void 0),(0,o.Z)(this,"secret",void 0),(0,o.Z)(this,"token",void 0),(0,o.Z)(this,"tokenProvider",void 0),(0,o.Z)(this,"user",void 0),(0,o.Z)(this,"setTokenOrProvider",function(){var e=(0,s.Z)(u().mark((function e(t,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.validateToken(t,r),n.user=r,F(t)&&(n.tokenProvider=t,n.type="provider"),"string"==typeof t&&(n.token=t,n.type="static"),!t&&n.user&&n.secret&&(n.token=Ue(n.secret,r.id,{},{}),n.type="static"),e.next=7,n.loadToken();case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,o.Z)(this,"reset",(function(){n.token=void 0,n.tokenProvider=void 0,n.type="static",n.user=void 0,n.loadTokenPromise=null})),(0,o.Z)(this,"validateToken",(function(e,t){if(!t||!t.anon||e){if(!n.secret&&!e)throw new Error("User token can not be empty");if(e&&"string"!=typeof e&&!F(e))throw new Error("user token should either be a string or a function");if("string"==typeof e){if(t.anon&&""===e)return;var r=function(e){var t=e.split(".");if(3!==t.length)return"";var n=t[1],r=P(n);return JSON.parse(r).user_id}(e);if(null!=e&&(null==r||""===r||r!==t.id))throw new Error("userToken does not have a user_id or is not matching with user.id")}}})),(0,o.Z)(this,"tokenReady",(function(){return n.loadTokenPromise})),(0,o.Z)(this,"loadToken",(function(){return n.loadTokenPromise=new Promise(function(){var e=(0,s.Z)(u().mark((function e(t,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("static"!==n.type){e.next=2;break}return e.abrupt("return",t(n.token));case 2:if(!n.tokenProvider||"string"==typeof n.tokenProvider){e.next=13;break}return e.prev=3,e.next=6,n.tokenProvider();case 6:n.token=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",r(new Error("Call to tokenProvider failed with message: ".concat(e.t0))));case 12:t(n.token);case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t,n){return e.apply(this,arguments)}}()),n.loadTokenPromise})),(0,o.Z)(this,"getToken",(function(){if(n.token)return n.token;if(n.user&&n.user.anon&&!n.token)return n.token;if(n.secret)return Ie(n.secret);throw new Error("Both secret and user tokens are not set. Either client.connectUser wasn't called or client.disconnect was called")})),(0,o.Z)(this,"isStatic",(function(){return"static"===n.type})),this.loadTokenPromise=null,t&&(this.secret=t),this.type="static",this.secret&&(this.token=Ie(this.secret))},Le={"-1":{name:"InternalSystemError",retryable:!0},2:{name:"AccessKeyError",retryable:!1},3:{name:"AuthenticationFailedError",retryable:!0},4:{name:"InputError",retryable:!1},6:{name:"DuplicateUsernameError",retryable:!1},9:{name:"RateLimitError",retryable:!0},16:{name:"DoesNotExistError",retryable:!1},17:{name:"NotAllowedError",retryable:!1},18:{name:"EventNotSupportedError",retryable:!1},19:{name:"ChannelFeatureNotSupportedError",retryable:!1},20:{name:"MessageTooLongError",retryable:!1},21:{name:"MultipleNestingLevelError",retryable:!1},22:{name:"PayloadTooBigError",retryable:!1},23:{name:"RequestTimeoutError",retryable:!0},24:{name:"MaxHeaderSizeExceededError",retryable:!1},40:{name:"AuthErrorTokenExpired",retryable:!1},41:{name:"AuthErrorTokenNotValidYet",retryable:!1},42:{name:"AuthErrorTokenUsedBeforeIssuedAt",retryable:!1},43:{name:"AuthErrorTokenSignatureInvalid",retryable:!1},44:{name:"CustomCommandEndpointMissingError",retryable:!1},45:{name:"CustomCommandEndpointCallError",retryable:!0},46:{name:"ConnectionIDNotFoundError",retryable:!1},60:{name:"CoolDownError",retryable:!0},69:{name:"ErrWrongRegion",retryable:!1},70:{name:"ErrQueryChannelPermissions",retryable:!1},71:{name:"ErrTooManyConnections",retryable:!0},99:{name:"AppSuspendedError",retryable:!1}};function Me(e){return void 0!==e.code}function De(e){if(!e.code)return!1;var t=Le["".concat(e.code)];return!!t&&t.retryable}function Ae(e){if("boolean"==typeof e.isWSFailure)return e.isWSFailure;try{return JSON.parse(e.message).isWSFailure}catch(e){return!1}}function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Closed="CLOSED",e.Connected="CONNECTED",e.Connecting="CONNECTING",e.Disconnected="DISCONNECTED",e.Init="INIT"}(Oe||(Oe={}));var je=function(){function e(t){var n=this,r=t.client;(0,i.Z)(this,e),(0,o.Z)(this,"client",void 0),(0,o.Z)(this,"state",void 0),(0,o.Z)(this,"consecutiveFailures",void 0),(0,o.Z)(this,"connectionID",void 0),(0,o.Z)(this,"cancelToken",void 0),(0,o.Z)(this,"_onlineStatusChanged",(function(e){var t;if(n._log("_onlineStatusChanged() - ".concat(e.type)),"offline"===e.type)return n._setState(Oe.Closed),null===(t=n.cancelToken)||void 0===t||t.cancel("disconnect() is called"),void(n.cancelToken=void 0);"online"===e.type&&n.state===Oe.Closed&&n.connect(!0)})),(0,o.Z)(this,"_req",function(){var e=(0,s.Z)(u().mark((function e(t,r,s){var i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.cancelToken||t.close||(n.cancelToken=f.Z.CancelToken.source()),e.prev=1,e.next=4,n.client.doAxiosRequest("get",n.client.baseURL.replace(":3030",":8900")+"/longpoll",void 0,{config:Te(Te({},r),{},{cancelToken:null===(i=n.cancelToken)||void 0===i?void 0:i.token}),params:t});case 4:return a=e.sent,n.consecutiveFailures=0,e.abrupt("return",a);case 9:if(e.prev=9,e.t0=e.catch(1),n.consecutiveFailures+=1,!s||!De(e.t0)){e.next=17;break}return n._log("_req() - Retryable error, retrying request"),e.next=16,j(W(n.consecutiveFailures));case 16:return e.abrupt("return",n._req(t,r,s));case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n,r){return e.apply(this,arguments)}}()),(0,o.Z)(this,"_poll",(0,s.Z)(u().mark((function e(){var t,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.state!==Oe.Connected){e.next=25;break}return e.prev=1,e.next=4,n._req({},{timeout:3e4},!0);case 4:if(r=e.sent,null!==(t=r.events)&&void 0!==t&&t.length)for(s=0;s<r.events.length;s++)n.client.dispatchEvent(r.events[s]);e.next=23;break;case 8:if(e.prev=8,e.t0=e.catch(1),!f.Z.isCancel(e.t0)){e.next=13;break}return n._log("_poll() - axios canceled request"),e.abrupt("return");case 13:if(46!==e.t0.code){e.next=18;break}return n._log("_poll() - ConnectionID error, connecting without ID..."),n._setState(Oe.Disconnected),n.connect(!0),e.abrupt("return");case 18:if(!Me(e.t0)||De(e.t0)){e.next=21;break}return n._setState(Oe.Closed),e.abrupt("return");case 21:return e.next=23,j(W(n.consecutiveFailures));case 23:e.next=0;break;case 25:case"end":return e.stop()}}),e,null,[[1,8]])})))),(0,o.Z)(this,"connect",(0,s.Z)(u().mark((function e(){var t,r,s,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],n.state!==Oe.Connecting){e.next=4;break}return n._log("connect() - connecting already in progress",{reconnect:t},"warn"),e.abrupt("return");case 4:if(n.state!==Oe.Connected){e.next=7;break}return n._log("connect() - already connected and polling",{reconnect:t},"warn"),e.abrupt("return");case 7:return n._setState(Oe.Connecting),n.connectionID=void 0,e.prev=9,e.next=12,n._req({json:n.client._buildWSPayload()},{timeout:8e3},t);case 12:return r=e.sent,s=r.event,n._setState(Oe.Connected),n.connectionID=s.connection_id,n.client.dispatchEvent(s),n._poll(),t&&n.client.recoverState(),e.abrupt("return",s);case 22:throw e.prev=22,e.t0=e.catch(9),n._setState(Oe.Closed),e.t0;case 26:case"end":return e.stop()}}),e,null,[[9,22]])})))),(0,o.Z)(this,"isHealthy",(function(){return!!n.connectionID&&n.state===Oe.Connected})),(0,o.Z)(this,"disconnect",(0,s.Z)(u().mark((function e(){var t,r,s,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:2e3,Y(n._onlineStatusChanged),n._setState(Oe.Disconnected),null===(t=n.cancelToken)||void 0===t||t.cancel("disconnect() is called"),n.cancelToken=void 0,s=n.connectionID,n.connectionID=void 0,e.prev=7,e.next=10,n._req({close:!0,connection_id:s},{timeout:r},!1);case 10:n._log("disconnect() - Closed connectionID"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),n._log("disconnect() - Failed",{err:e.t0},"error");case 16:case"end":return e.stop()}}),e,null,[[7,13]])})))),this.client=r,this.state=Oe.Init,this.consecutiveFailures=0,K(this._onlineStatusChanged)}return(0,a.Z)(e,[{key:"_log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(n,"WSConnectionFallback:"+e,Te({tags:["connection_fallback","connection"]},t))}},{key:"_setState",value:function(e){this._log("_setState() - ".concat(e)),this.state===Oe.Connecting&&e===Oe.Connected&&this.client.dispatchEvent({type:"connection.changed",online:!0}),e!==Oe.Closed&&e!==Oe.Disconnected||this.client.dispatchEvent({type:"connection.changed",online:!1}),this.state=e}}]),e}(),Fe=function(){function e(t,n,r,s){(0,i.Z)(this,e),(0,o.Z)(this,"type",void 0),(0,o.Z)(this,"id",void 0),(0,o.Z)(this,"client",void 0),(0,o.Z)(this,"data",void 0),this.client=t,this.type=n,this.id=r,this.data=s}var t,n,r,c,l,d,h,p;return(0,a.Z)(e,[{key:"create",value:(p=(0,s.Z)(u().mark((function e(){var t,n,r,s,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:null===(t=this.data)||void 0===t?void 0:t.name,filter:null===(n=this.data)||void 0===n?void 0:n.filter,description:null===(r=this.data)||void 0===r?void 0:r.description,all_sender_channels:null===(s=this.data)||void 0===s?void 0:s.all_sender_channels,all_users:null===(i=this.data)||void 0===i?void 0:i.all_users},e.abrupt("return",this.client.createSegment(this.type,this.id,a));case 2:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"verifySegmentId",value:function(){if(!this.id)throw new Error("Segment id is missing. Either create the segment using segment.create() or set the id during instantiation - const segment = client.segment(id)")}},{key:"get",value:(h=(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.getSegment(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"update",value:(d=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.updateSegment(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"addTargets",value:(l=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.addSegmentTargets(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"removeTargets",value:(c=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.removeSegmentTargets(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"delete",value:(r=(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.deleteSegment(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"targetExists",value:(n=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.segmentTargetExists(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"queryTargets",value:(t=(0,s.Z)(u().mark((function e(){var t,n,r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},this.verifySegmentId(),e.abrupt("return",this.client.querySegmentTargets(this.id,t,n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function qe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,x.Z)(e);if(t){var s=(0,x.Z)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return(0,k.Z)(this,n)}}var Ne,Ve=function(e){(0,_.Z)(n,e);var t=qe(n);function n(){var e;(0,i.Z)(this,n);for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return e=t.call.apply(t,[this].concat(s)),(0,o.Z)((0,w.Z)(e),"code",void 0),(0,o.Z)((0,w.Z)(e),"response",void 0),(0,o.Z)((0,w.Z)(e),"status",void 0),e}return n}((0,Z.Z)(Error));function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function We(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.anonymous="anonymous",e.public="public"}(Ne||(Ne={}));var ze=function e(t){var n=this;(0,i.Z)(this,e),this.value=t,(0,o.Z)(this,"handlerSet",new Set),(0,o.Z)(this,"next",(function(e){var t=function(e){return"function"==typeof e}(e)?e(n.value):e;if(t!==n.value){var r=n.value;n.value=t,n.handlerSet.forEach((function(e){return e(n.value,r)}))}})),(0,o.Z)(this,"partialNext",(function(e){return n.next((function(t){return We(We({},t),e)}))})),(0,o.Z)(this,"getLatestValue",(function(){return n.value})),(0,o.Z)(this,"subscribe",(function(e){return e(n.value,void 0),n.handlerSet.add(e),function(){n.handlerSet.delete(e)}})),(0,o.Z)(this,"subscribeWithSelector",(function(t,r){var s;return n.subscribe((function(n){var i=t(n),a=!s;for(var o in Array.isArray(i)&&e.logCount>0&&(C.warn("[StreamChat]: The API of our StateStore has changed. Instead of returning an array in the selector, please return a named object of properties."),e.logCount--),s)if(s[o]!==i[o]){a=!0;break}if(a){var c=s;s=i,r(i,c)}}))}))};(0,o.Z)(ze,"logCount",5);var He=["limit","sort"];function Je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Qe=[{created_at:-1}],$e=function(){function e(t){var n,r,a=this,c=t.client,l=t.threadData;(0,i.Z)(this,e),(0,o.Z)(this,"state",void 0),(0,o.Z)(this,"id",void 0),(0,o.Z)(this,"client",void 0),(0,o.Z)(this,"unsubscribeFunctions",new Set),(0,o.Z)(this,"failedRepliesMap",new Map),(0,o.Z)(this,"activate",(function(){a.state.partialNext({active:!0})})),(0,o.Z)(this,"deactivate",(function(){a.state.partialNext({active:!1})})),(0,o.Z)(this,"reload",(0,s.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.state.getLatestValue().isLoading){e.next=2;break}return e.abrupt("return");case 2:return a.state.partialNext({isLoading:!0}),e.prev=3,e.next=6,a.client.getThread(a.id,{watch:!0});case 6:t=e.sent,a.hydrateState(t);case 8:return e.prev=8,a.state.partialNext({isLoading:!1}),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[3,,8,11]])})))),(0,o.Z)(this,"hydrateState",(function(e){if(e!==a){if(e.id!==a.id)throw new Error("Cannot hydrate thread state with using thread's state");var t=e.state.getLatestValue(),n=t.read,r=t.replyCount,s=t.replies,i=t.parentMessage,o=t.participants,c=t.createdAt,u=t.deletedAt,l=t.updatedAt,d=Array.from(a.failedRepliesMap.values());a.state.partialNext({read:n,replyCount:r,replies:d.length?s.concat(d):s,parentMessage:i,participants:o,createdAt:c,deletedAt:u,updatedAt:l,isStateStale:!1})}})),(0,o.Z)(this,"registerSubscriptions",(function(){a.unsubscribeFunctions.size||(a.unsubscribeFunctions.add(a.subscribeMarkActiveThreadRead()),a.unsubscribeFunctions.add(a.subscribeReloadActiveStaleThread()),a.unsubscribeFunctions.add(a.subscribeMarkThreadStale()),a.unsubscribeFunctions.add(a.subscribeNewReplies()),a.unsubscribeFunctions.add(a.subscribeRepliesRead()),a.unsubscribeFunctions.add(a.subscribeMessageDeleted()),a.unsubscribeFunctions.add(a.subscribeMessageUpdated()))})),(0,o.Z)(this,"subscribeMarkActiveThreadRead",(function(){return a.state.subscribeWithSelector((function(e){return{active:e.active,unreadMessageCount:Xe(a.client.userID)(e)}}),(function(e){var t=e.active,n=e.unreadMessageCount;t&&n&&a.throttledMarkAsRead()}))})),(0,o.Z)(this,"subscribeReloadActiveStaleThread",(function(){return a.state.subscribeWithSelector((function(e){return{active:e.active,isStateStale:e.isStateStale}}),(function(e){var t=e.active,n=e.isStateStale;t&&n&&a.reload()}))})),(0,o.Z)(this,"subscribeMarkThreadStale",(function(){return a.client.on("user.watching.stop",(function(e){var t,n,r=a.state.getLatestValue().channel;a.client.userID&&a.client.userID===(null===(t=e.user)||void 0===t?void 0:t.id)&&(null===(n=e.channel)||void 0===n?void 0:n.cid)===r.cid&&a.state.partialNext({isStateStale:!0})})).unsubscribe})),(0,o.Z)(this,"subscribeNewReplies",(function(){return a.client.on("message.new",(function(e){var t,n;if(a.client.userID&&(null===(t=e.message)||void 0===t?void 0:t.parent_id)===a.id){var r=(null===(n=e.message.user)||void 0===n?void 0:n.id)===a.client.userID,s=a.state.getLatestValue(),i=s.active,o=s.read;a.upsertReplyLocally({message:e.message,timestampChanged:r}),i&&a.throttledMarkAsRead();for(var c={},u=0,l=Object.keys(o);u<l.length;u++){var d=l[u],h=o[d];if(h){var p,f=h;d===(null===(p=e.user)||void 0===p?void 0:p.id)?f=Ge(Ge({},f),{},{lastReadAt:e.created_at?new Date(e.created_at):new Date,user:e.user,unreadMessageCount:0}):i&&d===a.client.userID||(f=Ge(Ge({},f),{},{unreadMessageCount:h.unreadMessageCount+1})),c[d]=f}}a.state.partialNext({read:c})}})).unsubscribe})),(0,o.Z)(this,"subscribeRepliesRead",(function(){return a.client.on("message.read",(function(e){if(e.user&&e.created_at&&e.thread&&e.thread.parent_message_id===a.id){var t=e.user.id,n=e.created_at,r=e.user;a.state.next((function(s){return Ge(Ge({},s),{},{read:Ge(Ge({},s.read),{},(0,o.Z)({},t,{lastReadAt:new Date(n),user:r,lastReadMessageId:e.last_read_message_id,unreadMessageCount:0}))})}))}})).unsubscribe})),(0,o.Z)(this,"subscribeMessageDeleted",(function(){return a.client.on("message.deleted",(function(e){e.message&&(e.message.parent_id===a.id&&(e.hard_delete?a.deleteReplyLocally({message:e.message}):a.upsertReplyLocally({message:e.message})),e.message.id===a.id&&a.updateParentMessageLocally({message:e.message}))})).unsubscribe})),(0,o.Z)(this,"subscribeMessageUpdated",(function(){var e=["message.updated","reaction.new","reaction.deleted","reaction.updated"].map((function(e){return a.client.on(e,(function(e){e.message&&a.updateParentMessageOrReplyLocally(e.message)})).unsubscribe}));return function(){return e.forEach((function(e){return e()}))}})),(0,o.Z)(this,"unregisterSubscriptions",(function(){a.unsubscribeFunctions.forEach((function(e){return e()})),a.unsubscribeFunctions.clear()})),(0,o.Z)(this,"deleteReplyLocally",(function(e){var t,n,r=e.message,s=a.state.getLatestValue().replies,i=te({needle:ee(r),sortedArray:s,sortDirection:"ascending",selectValueToCompare:function(e){return e.created_at.getTime()}}),o=(null===(t=s[i])||void 0===t?void 0:t.id)===r.id?i:(null===(n=s[i-1])||void 0===n?void 0:n.id)===r.id?i-1:null;if(null!==o){var c=(0,p.Z)(s);c.splice(o,1),a.state.partialNext({replies:c})}})),(0,o.Z)(this,"upsertReplyLocally",(function(e){var t=e.message,n=e.timestampChanged,r=void 0!==n&&n;if(t.parent_id!==a.id)throw new Error("Reply does not belong to this thread");var s=ee(t);"failed"===t.status?a.failedRepliesMap.set(s.id,s):a.failedRepliesMap.has(t.id)&&a.failedRepliesMap.delete(t.id),a.state.next((function(e){return Ge(Ge({},e),{},{replies:ne(e.replies,s,r)})}))})),(0,o.Z)(this,"updateParentMessageLocally",(function(e){var t=e.message;if(t.id!==a.id)throw new Error("Message does not belong to this thread");a.state.next((function(e){var n,r=ee(t);return Ge(Ge({},e),{},{deletedAt:r.deleted_at,parentMessage:r,replyCount:null!==(n=t.reply_count)&&void 0!==n?n:e.replyCount})}))})),(0,o.Z)(this,"updateParentMessageOrReplyLocally",(function(e){e.parent_id===a.id&&a.upsertReplyLocally({message:e}),e.parent_id||e.id!==a.id||a.updateParentMessageLocally({message:e})})),(0,o.Z)(this,"markAsRead",(0,s.Z)(u().mark((function e(){var t,n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(r.length>0&&void 0!==r[0]?r[0]:{}).force,n=void 0!==t&&t,0!==a.ownUnreadCount||n){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,a.channel.markRead({thread_id:a.id});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))),(0,o.Z)(this,"throttledMarkAsRead",se((function(){return a.markAsRead()}),1e3,{trailing:!0})),(0,o.Z)(this,"queryReplies",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=void 0===t?50:t,r=e.sort,s=void 0===r?Qe:r,i=(0,h.Z)(e,He);return a.channel.getReplies(a.id,Ge({limit:n},i),s)})),(0,o.Z)(this,"loadNextPage",(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).limit,t=void 0===e?50:e;return a.loadPage(t)})),(0,o.Z)(this,"loadPrevPage",(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).limit,t=void 0===e?50:e;return a.loadPage(-t)})),(0,o.Z)(this,"loadPage",function(){var e=(0,s.Z)(u().mark((function e(t){var n,r,s,i,c,l,d,h,f,g,m,y,b,w;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state.getLatestValue(),r=n.pagination,s=t>0?["isLoadingNext","nextCursor","push"]:["isLoadingPrev","prevCursor","unshift"],i=(0,v.Z)(s,3),c=i[0],l=i[1],d=i[2],!r[c]&&null!==r[l]){e.next=4;break}return e.abrupt("return");case 4:return h=(0,o.Z)({},t>0?"id_gt":"id_lt",r[l]),f=Math.abs(t),a.state.partialNext({pagination:Ge(Ge({},r),{},(0,o.Z)({},c,!0))}),e.prev=7,e.next=10,a.queryReplies(Ge(Ge({},h),{},{limit:f}));case 10:y=e.sent,b=y.messages.map(ee),w=null!==(g=null===(m=b.at(t>0?-1:0))||void 0===m?void 0:m.id)&&void 0!==g?g:null,a.state.next((function(e){var t,n,r=e.replies;b.length>0&&(n=r=(0,p.Z)(e.replies))[d].apply(n,(0,p.Z)(b));return Ge(Ge({},e),{},{replies:r,pagination:Ge(Ge({},e.pagination),{},(t={},(0,o.Z)(t,l,y.messages.length<f?null:w),(0,o.Z)(t,c,!1),t))})})),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(7),a.client.logger("error",e.t0.message),a.state.next((function(e){return Ge(Ge({},e),{},{pagination:Ge(Ge({},e.pagination),{},(0,o.Z)({},c,!1))})}));case 20:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(t){return e.apply(this,arguments)}}());var d=c.channel(l.channel.type,l.channel.id,{name:l.channel.name});d._hydrateMembers(null!==(n=l.channel.members)&&void 0!==n?n:[]);var f=c.userID?[{user:{id:c.userID},unread_messages:0,last_read:(new Date).toISOString()}]:[];this.state=new ze({active:!1,channel:d,createdAt:new Date(l.created_at),deletedAt:l.deleted_at?new Date(l.deleted_at):null,isLoading:!1,isStateStale:!1,pagination:Ye(l),parentMessage:ee(l.parent_message),participants:l.thread_participants,read:Ke(l.read&&0!==l.read.length?l.read:f),replies:l.latest_replies.map(ee),replyCount:null!==(r=l.reply_count)&&void 0!==r?r:0,updatedAt:l.updated_at?new Date(l.updated_at):null}),this.id=l.parent_message_id,this.client=c}return(0,a.Z)(e,[{key:"channel",get:function(){return this.state.getLatestValue().channel}},{key:"hasStaleState",get:function(){return this.state.getLatestValue().isStateStale}},{key:"ownUnreadCount",get:function(){return Xe(this.client.userID)(this.state.getLatestValue())}}]),e}(),Ke=function(e){return e.reduce((function(e,t){var n;return e[t.user.id]={user:t.user,lastReadMessageId:t.last_read_message_id,unreadMessageCount:null!==(n=t.unread_messages)&&void 0!==n?n:0,lastReadAt:new Date(t.last_read)},e}),{})},Ye=function(e){var t,n;return{nextCursor:null,prevCursor:e.latest_replies.length===e.reply_count?null:null!==(t=null===(n=e.latest_replies.at(0))||void 0===n?void 0:n.id)&&void 0!==t?t:null,isLoadingNext:!1,isLoadingPrev:!1}},Xe=function(e){return function(t){var n;return e&&(null===(n=t.read[e])||void 0===n?void 0:n.unreadMessageCount)||0}};function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nt="stream:user",rt="stream:chat:v1:message",st=function(){function e(t){(0,i.Z)(this,e),(0,o.Z)(this,"client",void 0),this.client=t}var t,n,r,c,l,d,h,p,f,v,g,m,y;return(0,a.Z)(e,[{key:"flagUser",value:(y=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.abrupt("return",this.flag(nt,t,"",n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return y.apply(this,arguments)})},{key:"flagMessage",value:(m=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.abrupt("return",this.flag(rt,t,"",n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"flag",value:(g=(0,s.Z)(u().mark((function e(t,n,r,s){var i,a=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>4&&void 0!==a[4]?a[4]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/flag",tt({entity_type:t,entity_id:n,entity_creator_id:r,reason:s},i));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return g.apply(this,arguments)})},{key:"muteUser",value:(v=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/mute",tt({target_ids:[t]},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"unmuteUser",value:(f=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/unmute",tt({target_ids:[t]},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"getUserModerationReport",value:(p=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.client.get(this.client.baseURL+"/api/v2/moderation/user_report",tt({user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"queryReviewQueue",value:(h=(0,s.Z)(u().mark((function e(){var t,n,r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=5,this.client.post(this.client.baseURL+"/api/v2/moderation/review_queue",tt({filter:t,sort:B(n)},r));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"upsertConfig",value:(d=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/config",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"getConfig",value:(l=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(this.client.baseURL+"/api/v2/moderation/config/"+t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"deleteConfig",value:(c=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.delete(this.client.baseURL+"/api/v2/moderation/config/"+t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"queryConfigs",value:(r=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/configs",tt({filter:t,sort:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"submitAction",value:(n=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/submit_action",tt({action_type:t,item_id:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"check",value:(t=(0,s.Z)(u().mark((function e(t,n,r,s,i,a){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/check",{entity_type:t,entity_id:n,entity_creator_id:r,moderation_payload:s,config_key:i,options:a});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,n,r,s,i,a){return t.apply(this,arguments)})}]),e}();function it(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return at(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return at(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function at(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ct(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ut={active:!1,isThreadOrderStale:!1,threads:[],unreadThreadCount:0,unseenThreadIds:[],lastConnectionDropAt:null,pagination:{isLoading:!1,isLoadingNext:!1,nextCursor:null},ready:!1},lt=function(){function e(t){var n=this,r=t.client;(0,i.Z)(this,e),(0,o.Z)(this,"state",void 0),(0,o.Z)(this,"client",void 0),(0,o.Z)(this,"unsubscribeFunctions",new Set),(0,o.Z)(this,"threadsByIdGetterCache",void 0),(0,o.Z)(this,"resetState",(function(){n.state.next(ut)})),(0,o.Z)(this,"activate",(function(){n.state.partialNext({active:!0})})),(0,o.Z)(this,"deactivate",(function(){n.state.partialNext({active:!1})})),(0,o.Z)(this,"registerSubscriptions",(function(){n.unsubscribeFunctions.size||(n.unsubscribeFunctions.add(n.subscribeUnreadThreadsCountChange()),n.unsubscribeFunctions.add(n.subscribeManageThreadSubscriptions()),n.unsubscribeFunctions.add(n.subscribeReloadOnActivation()),n.unsubscribeFunctions.add(n.subscribeNewReplies()),n.unsubscribeFunctions.add(n.subscribeRecoverAfterConnectionDrop()),n.unsubscribeFunctions.add(n.subscribeChannelDeleted()))})),(0,o.Z)(this,"subscribeUnreadThreadsCountChange",(function(){var e,t=(null!==(e=n.client.user)&&void 0!==e?e:{}).unread_threads,r=void 0===t?0:t;n.state.partialNext({unreadThreadCount:r});var s=["health.check","notification.mark_read","notification.thread_message_new","notification.channel_deleted"].map((function(e){return n.client.on(e,(function(e){var t,r=(null!==(t=e.me)&&void 0!==t?t:e).unread_threads;"number"==typeof r&&n.state.partialNext({unreadThreadCount:r})})).unsubscribe}));return function(){return s.forEach((function(e){return e()}))}})),(0,o.Z)(this,"subscribeChannelDeleted",(function(){return n.client.on("notification.channel_deleted",(function(e){var t=e.cid,r=n.state.getLatestValue().threads.filter((function(e){return e.channel.cid!==t}));n.state.partialNext({threads:r})})).unsubscribe})),(0,o.Z)(this,"subscribeManageThreadSubscriptions",(function(){return n.state.subscribeWithSelector((function(e){return{threads:e.threads}}),(function(e,t){var r=e.threads,s=(null!=t?t:{}).threads,i=(void 0===s?[]:s).filter((function(e){return e!==n.threadsById[e.id]}));r.forEach((function(e){return e.registerSubscriptions()})),i.forEach((function(e){return e.unregisterSubscriptions()}))}))})),(0,o.Z)(this,"subscribeReloadOnActivation",(function(){return n.state.subscribeWithSelector((function(e){return{active:e.active}}),(function(e){e.active&&n.reload()}))})),(0,o.Z)(this,"subscribeNewReplies",(function(){return n.client.on("notification.thread_message_new",(function(e){var t,r=null===(t=e.message)||void 0===t?void 0:t.parent_id;if(r){var s=n.state.getLatestValue(),i=s.unseenThreadIds;s.ready&&(n.threadsById[r]?n.state.partialNext({isThreadOrderStale:!0}):i.includes(r)||n.state.partialNext({unseenThreadIds:i.concat(r)}))}})).unsubscribe})),(0,o.Z)(this,"subscribeRecoverAfterConnectionDrop",(function(){var e=n.client.on("connection.changed",(function(e){!1===e.online&&n.state.next((function(e){return e.lastConnectionDropAt?e:ct(ct({},e),{},{lastConnectionDropAt:new Date})}))})).unsubscribe,t=se((function(){n.state.getLatestValue().lastConnectionDropAt&&n.reload({force:!0})}),1e3,{trailing:!0}),r=n.client.on("connection.recovered",t).unsubscribe;return function(){e(),r()}})),(0,o.Z)(this,"unregisterSubscriptions",(function(){n.state.getLatestValue().threads.forEach((function(e){return e.unregisterSubscriptions()})),n.unsubscribeFunctions.forEach((function(e){return e()})),n.unsubscribeFunctions.clear()})),(0,o.Z)(this,"reload",(0,s.Z)(u().mark((function e(){var t,r,s,i,a,o,c,l,d,h,p,f,v,g,m,y,b=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(b.length>0&&void 0!==b[0]?b[0]:{}).force,r=void 0!==t&&t,s=n.state.getLatestValue(),i=s.threads,a=s.unseenThreadIds,o=s.isThreadOrderStale,c=s.pagination,l=s.ready,!c.isLoading){e.next=4;break}return e.abrupt("return");case 4:if(r||!l||a.length||o){e.next=6;break}return e.abrupt("return");case 6:return d=i.length+a.length,e.prev=7,n.state.next((function(e){return ct(ct({},e),{},{pagination:ct(ct({},e.pagination),{},{isLoading:!0})})})),e.next=11,n.queryThreads({limit:Math.min(d,25)||25});case 11:h=e.sent,p=n.threadsById,f=[],v=it(h.threads);try{for(v.s();!(g=v.n()).done;)m=g.value,(y=p[m.id])?(f.push(y),y.hasStaleState&&y.hydrateState(m)):f.push(m)}catch(e){v.e(e)}finally{v.f()}n.state.next((function(e){var t;return ct(ct({},e),{},{threads:f,unseenThreadIds:[],isThreadOrderStale:!1,pagination:ct(ct({},e.pagination),{},{isLoading:!1,nextCursor:null!==(t=h.next)&&void 0!==t?t:null}),ready:!0})})),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),n.client.logger("error",e.t0.message),n.state.next((function(e){return ct(ct({},e),{},{pagination:ct(ct({},e.pagination),{},{isLoading:!1})})}));case 23:case"end":return e.stop()}}),e,null,[[7,19]])})))),(0,o.Z)(this,"queryThreads",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.client.queryThreads(ct({limit:25,participant_limit:10,reply_limit:10,watch:!0},e))})),(0,o.Z)(this,"loadNextPage",(0,s.Z)(u().mark((function e(){var t,r,s,i,a=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},r=n.state.getLatestValue(),!(s=r.pagination).isLoadingNext&&s.nextCursor){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,n.state.partialNext({pagination:ct(ct({},s),{},{isLoadingNext:!0})}),e.next=8,n.queryThreads(ct(ct({},t),{},{next:s.nextCursor}));case 8:i=e.sent,n.state.next((function(e){var t;return ct(ct({},e),{},{threads:i.threads.length?e.threads.concat(i.threads):e.threads,pagination:ct(ct({},e.pagination),{},{nextCursor:null!==(t=i.next)&&void 0!==t?t:null,isLoadingNext:!1})})})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),n.client.logger("error",e.t0.message),n.state.next((function(e){return ct(ct({},e),{},{pagination:ct(ct({},e.pagination),{},{isLoadingNext:!1})})}));case 16:case"end":return e.stop()}}),e,null,[[4,12]])})))),this.client=r,this.state=new ze(ut),this.threadsByIdGetterCache={threads:[],threadsById:{}}}return(0,a.Z)(e,[{key:"threadsById",get:function(){var e=this.state.getLatestValue().threads;if(e===this.threadsByIdGetterCache.threads)return this.threadsByIdGetterCache.threadsById;var t=e.reduce((function(e,t){return e[t.id]=t,e}),{});return this.threadsByIdGetterCache.threads=e,this.threadsByIdGetterCache.threadsById=t,t}}]),e}(),dt=["own_votes","id"],ht=["id"];function pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pt(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var vt=function(e){return!(null==e||!e.answer_text)},gt=function(){function e(t){var n=this,r=t.client,a=t.poll;(0,i.Z)(this,e),(0,o.Z)(this,"state",void 0),(0,o.Z)(this,"id",void 0),(0,o.Z)(this,"client",void 0),(0,o.Z)(this,"unsubscribeFunctions",new Set),(0,o.Z)(this,"getInitialStateFromPollResponse",(function(e){var t,n=e.own_votes;e.id;var r=(0,h.Z)(e,dt),s=null!==(t=null==n?void 0:n.reduce((function(e,t){return vt(t)?e.ownAnswer=t:e.ownVotes.push(t),e}),{ownVotes:[]}))&&void 0!==t?t:{ownVotes:[]},i=s.ownAnswer,a=s.ownVotes;return ft(ft({},r),{},{lastActivityAt:new Date,maxVotedOptionIds:mt(r.vote_counts_by_option),ownAnswer:i,ownVotesByOptionId:yt(a)})})),(0,o.Z)(this,"reinitializeState",(function(e){n.state.partialNext(n.getInitialStateFromPollResponse(e))})),(0,o.Z)(this,"handlePollUpdated",(function(e){var t;if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===n.id)&&"poll.updated"===e.type){var r,s={allow_answers:(r=e.poll).allow_answers,allow_user_suggested_options:r.allow_user_suggested_options,description:r.description,enforce_unique_vote:r.enforce_unique_vote,id:r.id,is_closed:r.is_closed,max_votes_allowed:r.max_votes_allowed,name:r.name,options:r.options,voting_visibility:r.voting_visibility},i=(0,h.Z)(s,ht);n.state.partialNext(ft(ft({},i),{},{lastActivityAt:new Date(e.created_at)}))}})),(0,o.Z)(this,"handlePollClosed",(function(e){var t;null!==(t=e.poll)&&void 0!==t&&t.id&&e.poll.id!==n.id||"poll.closed"===e.type&&n.state.partialNext({is_closed:!0,lastActivityAt:new Date(e.created_at)})})),(0,o.Z)(this,"handleVoteCasted",(function(e){var t;if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===n.id)&&"poll.vote_casted"===e.type){var r=n.data,s=e.poll_vote.user_id===n.client.userID,i=(0,p.Z)(r.latest_answers),a=r.ownAnswer,o=r.ownVotesByOptionId,c=r.maxVotedOptionIds;s&&(vt(e.poll_vote)?a=e.poll_vote:e.poll_vote.option_id&&(o[e.poll_vote.option_id]=e.poll_vote)),vt(e.poll_vote)?i=[e.poll_vote].concat((0,p.Z)(i)):c=mt(e.poll.vote_counts_by_option);var u=bt(e.poll);n.state.partialNext(ft(ft({},u),{},{latest_answers:i,lastActivityAt:new Date(e.created_at),ownAnswer:a,ownVotesByOptionId:o,maxVotedOptionIds:c}))}})),(0,o.Z)(this,"handleVoteChanged",(function(e){var t;if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===n.id)&&"poll.vote_changed"===e.type){var r=n.data,s=e.poll_vote.user_id===n.client.userID,i=(0,p.Z)(r.latest_answers),a=r.ownAnswer,c=r.ownVotesByOptionId,u=r.maxVotedOptionIds;if(s){if(vt(e.poll_vote))i=[e.poll_vote].concat((0,p.Z)(i.filter((function(t){return t.id!==e.poll_vote.id})))),a=e.poll_vote;else if(e.poll_vote.option_id){var l;e.poll.enforce_unique_votes?c=(0,o.Z)({},e.poll_vote.option_id,e.poll_vote):(c=Object.entries(c).reduce((function(t,n){var r=(0,v.Z)(n,2),s=r[0],i=r[1];return s!==e.poll_vote.option_id&&i.id===e.poll_vote.id||(t[s]=i),t}),{}))[e.poll_vote.option_id]=e.poll_vote,(null===(l=a)||void 0===l?void 0:l.id)===e.poll_vote.id&&(a=void 0),u=mt(e.poll.vote_counts_by_option)}}else vt(e.poll_vote)?i=[e.poll_vote].concat((0,p.Z)(i)):u=mt(e.poll.vote_counts_by_option);var d=bt(e.poll);n.state.partialNext(ft(ft({},d),{},{latest_answers:i,lastActivityAt:new Date(e.created_at),ownAnswer:a,ownVotesByOptionId:c,maxVotedOptionIds:u}))}})),(0,o.Z)(this,"handleVoteRemoved",(function(e){var t;if((null===(t=e.poll)||void 0===t||!t.id||e.poll.id===n.id)&&"poll.vote_removed"===e.type){var r=n.data,s=e.poll_vote.user_id===n.client.userID,i=(0,p.Z)(r.latest_answers),a=r.ownAnswer,o=ft({},r.ownVotesByOptionId),c=r.maxVotedOptionIds;vt(e.poll_vote)?(i=i.filter((function(t){return t.id!==e.poll_vote.id})),s&&(a=void 0)):(c=mt(e.poll.vote_counts_by_option),s&&e.poll_vote.option_id&&delete o[e.poll_vote.option_id]);var u=bt(e.poll);n.state.partialNext(ft(ft({},u),{},{latest_answers:i,lastActivityAt:new Date(e.created_at),ownAnswer:a,ownVotesByOptionId:o,maxVotedOptionIds:c}))}})),(0,o.Z)(this,"query",function(){var e=(0,s.Z)(u().mark((function e(t){var r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.getPoll(t);case 2:return r=e.sent,s=r.poll,n.state.partialNext(ft(ft({},s),{},{lastActivityAt:new Date})),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"update",function(){var e=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.updatePoll(ft(ft({},t),{},{id:n.id}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"partialUpdate",function(){var e=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.partialUpdatePoll(n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"close",(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.closePoll(n.id);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))),(0,o.Z)(this,"delete",(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.deletePoll(n.id);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))),(0,o.Z)(this,"createOption",function(){var e=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.createPollOption(n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"updateOption",function(){var e=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.updatePollOption(n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"deleteOption",function(){var e=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.deletePollOption(n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"castVote",function(){var e=(0,s.Z)(u().mark((function e(t,r){var s,i,a,o,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=n.data,i=s.max_votes_allowed,a=s.ownVotesByOptionId,!(i&&i===Object.keys(a).length)){e.next=8;break}if(c=Object.values(a)[0],Object.values(a).slice(1).forEach((function(e){var t;(null===(t=c)||void 0===t||!t.created_at||new Date(e.created_at)<new Date(c.created_at))&&(c=e)})),null===(o=c)||void 0===o||!o.id){e.next=8;break}return e.next=8,n.removeVote(c.id,r);case 8:return e.next=10,n.client.castPollVote(r,n.id,{option_id:t});case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,o.Z)(this,"removeVote",function(){var e=(0,s.Z)(u().mark((function e(t,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.removePollVote(r,n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,o.Z)(this,"addAnswer",function(){var e=(0,s.Z)(u().mark((function e(t,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.addPollAnswer(r,n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,o.Z)(this,"removeAnswer",function(){var e=(0,s.Z)(u().mark((function e(t,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.removePollVote(r,n.id,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,o.Z)(this,"queryAnswers",function(){var e=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.queryPollAnswers(n.id,t.filter,t.sort,t.options);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"queryOptionVotes",function(){var e=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.queryPollVotes(n.id,t.filter,t.sort,t.options);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.client=r,this.id=a.id,this.state=new ze(this.getInitialStateFromPollResponse(a))}return(0,a.Z)(e,[{key:"data",get:function(){return this.state.getLatestValue()}}]),e}();function mt(e){for(var t=0,n=[],r=0,s=Object.entries(null!=e?e:{});r<s.length;r++){var i=(0,v.Z)(s[r],2),a=i[0],o=i[1];o>t?(n=[a],t=o):o===t&&n.push(a)}return n}function yt(e){return e?e.reduce((function(e,t){return vt(t)||!t.option_id||(e[t.option_id]=t),e}),{}):{}}function bt(e){return{answers_count:e.answers_count,latest_votes_by_option:e.latest_votes_by_option,vote_count:e.vote_count,vote_counts_by_option:e.vote_counts_by_option}}function wt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return _t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _t(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var kt=function(){function e(t){var n=this,r=t.client;(0,i.Z)(this,e),(0,o.Z)(this,"client",void 0),(0,o.Z)(this,"pollCache",new Map),(0,o.Z)(this,"unsubscribeFunctions",new Set),(0,o.Z)(this,"fromState",(function(e){return n.pollCache.get(e)})),(0,o.Z)(this,"registerSubscriptions",(function(){n.unsubscribeFunctions.size||(n.unsubscribeFunctions.add(n.subscribeMessageNew()),n.unsubscribeFunctions.add(n.subscribePollUpdated()),n.unsubscribeFunctions.add(n.subscribePollClosed()),n.unsubscribeFunctions.add(n.subscribeVoteCasted()),n.unsubscribeFunctions.add(n.subscribeVoteChanged()),n.unsubscribeFunctions.add(n.subscribeVoteRemoved()))})),(0,o.Z)(this,"unregisterSubscriptions",(function(){n.unsubscribeFunctions.forEach((function(e){return e()})),n.unsubscribeFunctions.clear()})),(0,o.Z)(this,"createPoll",function(){var e=(0,s.Z)(u().mark((function e(t){var r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.client.createPoll(t);case 2:return r=e.sent,s=r.poll,e.abrupt("return",new gt({client:n.client,poll:s}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"getPoll",function(){var e=(0,s.Z)(u().mark((function e(t){var r,s,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=n.fromState(t))){e.next=4;break}return n.client.getPoll(t).then((function(e){var t=e.poll;return n.setOrOverwriteInCache(t,!0)})),e.abrupt("return",r);case 4:return e.next=6,n.client.getPoll(t);case 6:return s=e.sent,i=s.poll,n.setOrOverwriteInCache(i),e.abrupt("return",n.fromState(t));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"queryPolls",function(){var e=(0,s.Z)(u().mark((function e(t){var r,s,i,a,o,c,l=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:[],s=l.length>2&&void 0!==l[2]?l[2]:{},e.next=4,n.client.queryPolls(t,r,s);case 4:return i=e.sent,a=i.polls,o=i.next,c=a.map((function(e){return n.setOrOverwriteInCache(e,!0),n.fromState(e.id)})),e.abrupt("return",{polls:c,next:o});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"hydratePollCache",(function(e,t){var r,s=wt(e);try{for(s.s();!(r=s.n()).done;){var i=r.value;if(i.poll){var a=i.poll;n.setOrOverwriteInCache(a,t)}}}catch(e){s.e(e)}finally{s.f()}})),(0,o.Z)(this,"setOrOverwriteInCache",(function(e,t){var r=n.fromState(e.id);if(r)t&&r.reinitializeState(e);else{var s=new gt({client:n.client,poll:e});n.pollCache.set(s.id,s)}})),(0,o.Z)(this,"subscribePollUpdated",(function(){return n.client.on("poll.updated",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handlePollUpdated(e))})).unsubscribe})),(0,o.Z)(this,"subscribePollClosed",(function(){return n.client.on("poll.closed",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handlePollClosed(e))})).unsubscribe})),(0,o.Z)(this,"subscribeVoteCasted",(function(){return n.client.on("poll.vote_casted",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handleVoteCasted(e))})).unsubscribe})),(0,o.Z)(this,"subscribeVoteChanged",(function(){return n.client.on("poll.vote_changed",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handleVoteChanged(e))})).unsubscribe})),(0,o.Z)(this,"subscribeVoteRemoved",(function(){return n.client.on("poll.vote_removed",(function(e){var t,r;null!==(t=e.poll)&&void 0!==t&&t.id&&(null===(r=n.fromState(e.poll.id))||void 0===r||r.handleVoteRemoved(e))})).unsubscribe})),(0,o.Z)(this,"subscribeMessageNew",(function(){return n.client.on("message.new",(function(e){var t=e.message;if(t){var r=ee(t);n.hydratePollCache([r])}})).unsubscribe})),this.client=r}return(0,a.Z)(e,[{key:"data",get:function(){return this.pollCache}}]),e}(),xt=["created_at","updated_at","last_active","online"],Zt=["params","headers"];function Ct(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return St(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return St(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,s=function(){};return{s:s,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw i}}}}function St(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ut(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){(0,o.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function It(e){return"string"==typeof e||e instanceof String}var Ot=function(){function e(t,n,r){var a,c=this;(0,i.Z)(this,e),(0,o.Z)(this,"_user",void 0),(0,o.Z)(this,"activeChannels",void 0),(0,o.Z)(this,"threads",void 0),(0,o.Z)(this,"polls",void 0),(0,o.Z)(this,"anonymous",void 0),(0,o.Z)(this,"persistUserOnConnectionFailure",void 0),(0,o.Z)(this,"axiosInstance",void 0),(0,o.Z)(this,"baseURL",void 0),(0,o.Z)(this,"browser",void 0),(0,o.Z)(this,"cleaningIntervalRef",void 0),(0,o.Z)(this,"clientID",void 0),(0,o.Z)(this,"configs",void 0),(0,o.Z)(this,"key",void 0),(0,o.Z)(this,"listeners",void 0),(0,o.Z)(this,"logger",void 0),(0,o.Z)(this,"recoverStateOnReconnect",void 0),(0,o.Z)(this,"moderation",void 0),(0,o.Z)(this,"mutedChannels",void 0),(0,o.Z)(this,"mutedUsers",void 0),(0,o.Z)(this,"node",void 0),(0,o.Z)(this,"options",void 0),(0,o.Z)(this,"secret",void 0),(0,o.Z)(this,"setUserPromise",void 0),(0,o.Z)(this,"state",void 0),(0,o.Z)(this,"tokenManager",void 0),(0,o.Z)(this,"user",void 0),(0,o.Z)(this,"userAgent",void 0),(0,o.Z)(this,"userID",void 0),(0,o.Z)(this,"wsBaseURL",void 0),(0,o.Z)(this,"wsConnection",void 0),(0,o.Z)(this,"wsFallback",void 0),(0,o.Z)(this,"wsPromise",void 0),(0,o.Z)(this,"consecutiveFailures",void 0),(0,o.Z)(this,"insightMetrics",void 0),(0,o.Z)(this,"defaultWSTimeoutWithFallback",void 0),(0,o.Z)(this,"defaultWSTimeout",void 0),(0,o.Z)(this,"nextRequestAbortController",null),(0,o.Z)(this,"_getConnectionID",(function(){var e,t;return(null===(e=c.wsConnection)||void 0===e?void 0:e.connectionID)||(null===(t=c.wsFallback)||void 0===t?void 0:t.connectionID)})),(0,o.Z)(this,"_hasConnectionID",(function(){return Boolean(c._getConnectionID())})),(0,o.Z)(this,"connectUser",function(){var e=(0,s.Z)(u().mark((function e(t,n){var r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw new Error('The "id" field on the user is missing');case 2:if(c.userID!==t.id||!c.setUserPromise){e.next=5;break}return C.warn("Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),e.abrupt("return",c.setUserPromise);case 5:if(!c.userID){e.next=7;break}throw new Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");case 7:return!c._isUsingServerAuth()&&!c.node||c.options.allowServerSideConnect||C.warn('Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),c.userID=t.id,c.anonymous=!1,r=c._setToken(t,n),c._setUser(t),s=c.openConnection(),c.setUserPromise=Promise.all([r,s]).then((function(e){return e[1]})),e.prev=14,e.next=17,c.setUserPromise;case 17:return e.abrupt("return",e.sent);case 20:throw e.prev=20,e.t0=e.catch(14),c.persistUserOnConnectionFailure?c.closeConnection():c.disconnectUser(),e.t0;case 24:case"end":return e.stop()}}),e,null,[[14,20]])})));return function(t,n){return e.apply(this,arguments)}}()),(0,o.Z)(this,"setUser",this.connectUser),(0,o.Z)(this,"_setToken",(function(e,t){return c.tokenManager.setTokenOrProvider(t,e)})),(0,o.Z)(this,"closeConnection",function(){var e=(0,s.Z)(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=c.cleaningIntervalRef&&(clearInterval(c.cleaningIntervalRef),c.cleaningIntervalRef=void 0),e.next=3,Promise.all([null===(n=c.wsConnection)||void 0===n?void 0:n.disconnect(t),null===(r=c.wsFallback)||void 0===r?void 0:r.disconnect(t)]);case 3:return e.abrupt("return",Promise.resolve());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"openConnection",(0,s.Z)(u().mark((function e(){var t,n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.userID){e.next=2;break}throw Error("User is not set on client, use client.connectUser or client.connectAnonymousUser instead");case 2:if(null===(t=c.wsConnection)||void 0===t||!t.isConnecting||!c.wsPromise){e.next=5;break}return c.logger("info","client:openConnection() - connection already in progress",{tags:["connection","client"]}),e.abrupt("return",c.wsPromise);case 5:if(!(null!==(n=c.wsConnection)&&void 0!==n&&n.isHealthy||null!==(r=c.wsFallback)&&void 0!==r&&r.isHealthy())||!c._hasConnectionID()){e.next=8;break}return c.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists",{tags:["connection","client"]}),e.abrupt("return");case 8:return c.clientID="".concat(c.userID,"--").concat(z()),c.wsPromise=c.connect(),c._startCleaning(),e.abrupt("return",c.wsPromise);case 12:case"end":return e.stop()}}),e)})))),(0,o.Z)(this,"_setupConnection",this.openConnection),(0,o.Z)(this,"_normalizeDate",(function(e){if(e instanceof Date&&(e=e.toISOString()),""===e)throw new Error("Don't pass blank string for since, use null instead if resetting the token revoke");return e})),(0,o.Z)(this,"disconnectUser",function(){var e=(0,s.Z)(u().mark((function e(t){var n,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(c.logger("info","client:disconnect() - Disconnecting the client",{tags:["connection","client"]}),delete c.user,delete c._user,delete c.userID,c.anonymous=!1,n=c.closeConnection(t),r=0,s=Object.values(c.activeChannels);r<s.length;r++)s[r]._disconnect();return c.activeChannels={},c.state=new ye,c.threads.resetState(),setTimeout(c.tokenManager.reset),e.abrupt("return",n);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,o.Z)(this,"disconnect",this.disconnectUser),(0,o.Z)(this,"connectAnonymousUser",(function(){!c._isUsingServerAuth()&&!c.node||c.options.allowServerSideConnect||C.warn('Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),c.anonymous=!0,c.userID=z();var e={id:c.userID,anon:!0};return c._setToken(e,""),c._setUser(e),c._setupConnection()})),(0,o.Z)(this,"setAnonymousUser",this.connectAnonymousUser),(0,o.Z)(this,"doAxiosRequest",function(){var e=(0,s.Z)(u().mark((function e(t,n,r){var s,i,a,o,l=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l.length>3&&void 0!==l[3]?l[3]:{},e.next=3,c.tokenManager.tokenReady();case 3:i=c._enrichAxiosOptions(s),e.prev=4,c._logApiRequest(t,n,r,i),e.t0=t,e.next="get"===e.t0?9:"delete"===e.t0?13:"post"===e.t0?17:"postForm"===e.t0?21:"put"===e.t0?25:"patch"===e.t0?29:"options"===e.t0?33:37;break;case 9:return e.next=11,c.axiosInstance.get(n,i);case 11:case 15:case 19:case 23:case 27:case 31:case 35:return a=e.sent,e.abrupt("break",38);case 13:return e.next=15,c.axiosInstance.delete(n,i);case 17:return e.next=19,c.axiosInstance.post(n,r,i);case 21:return e.next=23,c.axiosInstance.postForm(n,r,i);case 25:return e.next=27,c.axiosInstance.put(n,r,i);case 29:return e.next=31,c.axiosInstance.patch(n,r,i);case 33:return e.next=35,c.axiosInstance.options(n,i);case 37:throw new Error("Invalid request type");case 38:return c._logApiResponse(t,n,a),c.consecutiveFailures=0,e.abrupt("return",c.handleResponse(a));case 43:if(e.prev=43,e.t1=e.catch(4),e.t1.client_request_id=null===(o=i.headers)||void 0===o?void 0:o["x-client-request-id"],c._logApiError(t,n,e.t1),c.consecutiveFailures+=1,!e.t1.response){e.next=60;break}if(e.t1.response.data.code!==q||c.tokenManager.isStatic()){e.next=57;break}if(!(c.consecutiveFailures>1)){e.next=53;break}return e.next=53,j(W(c.consecutiveFailures));case 53:return c.tokenManager.loadToken(),e.next=56,c.doAxiosRequest(t,n,r,s);case 56:return e.abrupt("return",e.sent);case 57:return e.abrupt("return",c.handleResponse(e.t1.response));case 60:throw e.t1;case 61:case"end":return e.stop()}}),e,null,[[4,43]])})));return function(t,n,r){return e.apply(this,arguments)}}()),(0,o.Z)(this,"dispatchEvent",(function(e){e.received_at||(e.received_at=new Date);var t=c._handleClientEvent(e),n=e.cid,r=n?c.activeChannels[n]:void 0;r&&r._handleChannelEvent(e),c._callClientListeners(e),r&&r._callChannelListeners(e),t.forEach((function(e){return e()}))})),(0,o.Z)(this,"handleEvent",(function(e){var t=e.data,n=JSON.parse(t);c.dispatchEvent(n)})),(0,o.Z)(this,"_updateMemberWatcherReferences",(function(e){var t=c.state.userChannelReferences[e.id]||{};for(var n in t){var r=c.activeChannels[n];null!=r&&r.state&&(r.state.members[e.id]&&(r.state.members[e.id].user=e),r.state.watchers[e.id]&&(r.state.watchers[e.id]=e),r.state.read[e.id]&&(r.state.read[e.id].user=e))}})),(0,o.Z)(this,"_updateUserReferences",this._updateMemberWatcherReferences),(0,o.Z)(this,"_updateUserMessageReferences",(function(e){var t=c.state.userChannelReferences[e.id]||{};for(var n in t){var r=c.activeChannels[n];if(r){var s=r.state;null==s||s.updateUserMessages(e)}}})),(0,o.Z)(this,"_deleteUserMessageReference",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=c.state.userChannelReferences[e.id]||{};for(var r in n){var s=c.activeChannels[r].state;null==s||s.deleteUserMessages(e,t)}})),(0,o.Z)(this,"_handleUserEvent",(function(e){if(e.user){if("user.presence.changed"===e.type||"user.updated"===e.type){if(e.user.id===c.userID){var t=Ut({},c.user||{}),n=Ut({},c._user||{});for(var r in c.user)r in e.user||{channel_mutes:!0,devices:!0,mutes:!0,total_unread_count:!0,unread_channels:!0,unread_count:!0,unread_threads:!0,invisible:!0,privacy_settings:!0,roles:!0}[r]||(delete t[r],delete n[r]);for(var s in e.user)n&&s in n&&(n[s]=e.user[s]);c._user=Ut({},n),c.user=Ut(Ut({},t),e.user)}c.state.updateUser(e.user),c._updateMemberWatcherReferences(e.user)}"user.updated"===e.type&&c._updateUserMessageReferences(e.user),"user.deleted"===e.type&&e.user.deleted_at&&(e.mark_messages_deleted||e.hard_delete)&&c._deleteUserMessageReference(e.user,e.hard_delete)}})),(0,o.Z)(this,"_callClientListeners",(function(e){var t=c,n=[];t.listeners.all&&n.push.apply(n,(0,p.Z)(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,(0,p.Z)(t.listeners[e.type]));for(var r=0,s=n;r<s.length;r++){(0,s[r])(e)}})),(0,o.Z)(this,"recoverState",(0,s.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.logger("info","client:recoverState() - Start of recoverState with connectionID ".concat(c._getConnectionID()),{tags:["connection"]}),!(t=Object.keys(c.activeChannels)).length||!c.recoverStateOnReconnect){e.next=10;break}return c.logger("info","client:recoverState() - Start the querying of ".concat(t.length," channels"),{tags:["connection","client"]}),e.next=6,c.queryChannels({cid:{$in:t}},{last_message_at:-1},{limit:30});case 6:c.logger("info","client:recoverState() - Querying channels finished",{tags:["connection","client"]}),c.dispatchEvent({type:"connection.recovered"}),e.next=11;break;case 10:c.dispatchEvent({type:"connection.recovered"});case 11:c.wsPromise=Promise.resolve(),c.setUserPromise=Promise.resolve();case 13:case"end":return e.stop()}}),e)})))),(0,o.Z)(this,"getChannelByMembers",(function(e,t){var n=(0,p.Z)(t.members||[]).sort().join(","),r="".concat(e,":!members-").concat(n);if(!n)throw Error("Please specify atleast one member when creating unique conversation");for(var s in c.activeChannels){var i=c.activeChannels[s];if(!i.disconnected){if(s===r)return i;if(0===s.indexOf("".concat(e,":!members-")))if(Object.keys(i.state.members).sort().join(",")===n)return i}}var a=new ve(c,e,void 0,t);return c.activeChannels[r]=a,a})),(0,o.Z)(this,"getChannelById",(function(e,t,n){if("string"==typeof t&&~t.indexOf(":"))throw Error("Invalid channel id ".concat(t,", can't contain the : character"));var r="".concat(e,":").concat(t);if(r in c.activeChannels&&!c.activeChannels[r].disconnected){var s=c.activeChannels[r];return Object.keys(n).length>0&&(s.data=Ut(Ut({},s.data),n),s._data=Ut(Ut({},s._data),n)),s}var i=new ve(c,e,t,n);return c.activeChannels[i.cid]=i,i})),(0,o.Z)(this,"updateUsers",this.upsertUsers),(0,o.Z)(this,"updateUser",this.upsertUser),(0,o.Z)(this,"_unblockMessage",this.unblockMessage),(0,o.Z)(this,"markAllRead",this.markChannelsRead),(0,o.Z)(this,"_isUsingServerAuth",(function(){return!!c.secret})),(0,o.Z)(this,"_buildWSPayload",(function(e){return JSON.stringify({user_id:c.userID,user_details:c._user,device:c.options.device,client_request_id:e})})),this.key=t,this.listeners={},this.state=new ye,this.mutedChannels=[],this.mutedUsers=[],this.moderation=new st(this),n&&It(n)&&(this.secret=n);var l=r||(n&&!It(n)?n:{});this.browser=void 0!==l.browser?l.browser:"undefined"!=typeof window,this.node=!this.browser,this.options=Ut({timeout:3e3,withCredentials:!1,warmUp:!1,recoverStateOnReconnect:!0},l),this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new null.Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.axiosInstance=f.Z.create(this.options),this.setBaseURL(this.options.baseURL||"https://chat.stream-io-api.com"),void 0!==R&&"env"in R&&R.env.STREAM_LOCAL_TEST_RUN&&this.setBaseURL("http://localhost:3030"),void 0!==R&&"env"in R&&R.env.STREAM_LOCAL_TEST_HOST&&this.setBaseURL("http://"+R.env.STREAM_LOCAL_TEST_HOST),this.wsConnection=null,this.wsPromise=null,this.setUserPromise=null,this.activeChannels={},this.configs={},this.anonymous=!1,this.persistUserOnConnectionFailure=null===(a=this.options)||void 0===a?void 0:a.persistUserOnConnectionFailure,this.tokenManager=new Pe(this.secret),this.consecutiveFailures=0,this.insightMetrics=new _e,this.defaultWSTimeoutWithFallback=6e3,this.defaultWSTimeout=15e3,this.axiosInstance.defaults.paramsSerializer=X,this.logger=F(l.logger)?l.logger:function(){return null},this.recoverStateOnReconnect=this.options.recoverStateOnReconnect,this.threads=new lt({client:this}),this.polls=new kt({client:this})}var t,n,r,c,v,g,m,y,b,w,_,k,x,Z,U,I,P,M,D,A,E,T,N,H,J,G,Q,$,K,Y,ee,te,ne,re,se,ie,oe,ce,ue,le,de,he,pe,fe,ge,me,be,we,xe,Ze,Ce,Re,Ie,Oe,Le,Me,De,Ee,Te,qe,Ne,Be,We,ze,He,Je,Ge,Qe,Ke,Ye,Xe,et,tt,nt,rt,it,at,ot,ct,ut,dt,ht,pt,ft,vt,gt,mt,yt,bt,wt,_t,St,Rt,Ot,Pt,Lt,Mt,Dt,At,Et,Tt,jt,Ft,qt,Nt,Vt,Bt,Wt,zt;return(0,a.Z)(e,[{key:"devToken",value:function(e){return t=e,["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",O(JSON.stringify({user_id:t})),"devtoken"].join(".");var t}},{key:"getAuthType",value:function(){return this.anonymous?"anonymous":"jwt"}},{key:"setBaseURL",value:function(e){this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")}},{key:"_setUser",value:function(e){this.user=e,this.userID=e.id,this._user=Ut({},e)}},{key:"updateAppSettings",value:(zt=(0,s.Z)(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=(n=t.apn_config)&&n.p12_cert&&(t=Ut(Ut({},t),{},{apn_config:Ut(Ut({},n),{},{p12_cert:S.from(n.p12_cert).toString("base64")})})),e.next=4,this.patch(this.baseURL+"/app",t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return zt.apply(this,arguments)})},{key:"revokeTokens",value:(Wt=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateAppSettings({revoke_tokens_issued_before:this._normalizeDate(t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Wt.apply(this,arguments)})},{key:"revokeUserToken",value:(Bt=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.revokeUsersToken([t],n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Bt.apply(this,arguments)})},{key:"revokeUsersToken",value:(Vt=(0,s.Z)(u().mark((function e(t,n){var r,s,i,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=void 0===n?(new Date).toISOString():this._normalizeDate(n),r=[],s=Ct(t);try{for(s.s();!(i=s.n()).done;)a=i.value,r.push({id:a,set:{revoke_tokens_issued_before:n}})}catch(e){s.e(e)}finally{s.f()}return e.next=6,this.partialUpdateUsers(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return Vt.apply(this,arguments)})},{key:"getAppSettings",value:(Nt=(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/app");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return Nt.apply(this,arguments)})},{key:"testPushSettings",value:(qt=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/check_push",Ut(Ut(Ut(Ut(Ut(Ut(Ut({user_id:t},n.messageID?{message_id:n.messageID}:{}),n.apnTemplate?{apn_template:n.apnTemplate}:{}),n.firebaseTemplate?{firebase_template:n.firebaseTemplate}:{}),n.firebaseDataTemplate?{firebase_data_template:n.firebaseDataTemplate}:{}),n.skipDevices?{skip_devices:!0}:{}),n.pushProviderName?{push_provider_name:n.pushProviderName}:{}),n.pushProviderType?{push_provider_type:n.pushProviderType}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return qt.apply(this,arguments)})},{key:"testSQSSettings",value:(Ft=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/check_sqs",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return Ft.apply(this,arguments)})},{key:"testSNSSettings",value:(jt=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/check_sns",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return jt.apply(this,arguments)})},{key:"setGuestUser",value:(Tt=(0,s.Z)(u().mark((function e(t){var n,r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.anonymous=!0,e.prev=1,e.next=4,this.post(this.baseURL+"/guest",{user:t});case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this.anonymous=!1,e.t0;case 11:return this.anonymous=!1,(r=n.user).created_at,r.updated_at,r.last_active,r.online,s=(0,h.Z)(r,xt),e.next=15,this.connectUser(s,n.access_token);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return Tt.apply(this,arguments)})},{key:"createToken",value:function(e,t,n){if(null==this.secret)throw Error("tokens can only be created server-side using the API Secret");var r={};return t&&(r.exp=t),n&&(r.iat=n),Ue(this.secret,e,r,{})}},{key:"on",value:function(e,t){var n=this,r=t?e:"all",s=t||e;return r in this.listeners||(this.listeners[r]=[]),this.logger("info","Attaching listener for ".concat(r," event"),{tags:["event","client"]}),this.listeners[r].push(s),{unsubscribe:function(){n.logger("info","Removing listener for ".concat(r," event"),{tags:["event","client"]}),n.listeners[r]=n.listeners[r].filter((function(e){return e!==s}))}}}},{key:"off",value:function(e,t){var n=t?e:"all",r=t||e;n in this.listeners||(this.listeners[n]=[]),this.logger("info","Removing listener for ".concat(n," event"),{tags:["event","client"]}),this.listeners[n]=this.listeners[n].filter((function(e){return e!==r}))}},{key:"_logApiRequest",value:function(e,t,n,r){this.logger("info","client: ".concat(e," - Request - ").concat(t),{tags:["api","api_request","client"],url:t,payload:n,config:r})}},{key:"_logApiResponse",value:function(e,t,n){this.logger("info","client:".concat(e," - Response - url: ").concat(t," > status ").concat(n.status),{tags:["api","api_response","client"],url:t,response:n})}},{key:"_logApiError",value:function(e,t,n){this.logger("error","client:".concat(e," - Error - url: ").concat(t),{tags:["api","api_response","client"],url:t,error:n})}},{key:"get",value:function(e,t){return this.doAxiosRequest("get",e,null,{params:t})}},{key:"put",value:function(e,t){return this.doAxiosRequest("put",e,t)}},{key:"post",value:function(e,t){return this.doAxiosRequest("post",e,t)}},{key:"patch",value:function(e,t){return this.doAxiosRequest("patch",e,t)}},{key:"delete",value:function(e,t){return this.doAxiosRequest("delete",e,null,{params:t})}},{key:"sendFile",value:function(e,t,n,r,s){var i=V(t,n,r||"multipart/form-data");return null!=s&&i.append("user",JSON.stringify(s)),this.doAxiosRequest("postForm",e,i,{headers:i.getHeaders?i.getHeaders():{},config:{timeout:0,maxContentLength:1/0,maxBodyLength:1/0}})}},{key:"errorFromResponse",value:function(e){var t;return t=new Ve("StreamChat error HTTP code: ".concat(e.status)),e.data&&e.data.code&&((t=new Error("StreamChat error code ".concat(e.data.code,": ").concat(e.data.message))).code=e.data.code),t.response=e,t.status=e.status,t}},{key:"handleResponse",value:function(e){var t,n=e.data;if(!(t=e).status||t.status<200||300<=t.status)throw this.errorFromResponse(e);return n}},{key:"_handleClientEvent",value:function(e){var t,n,r,s=this,i=this,a=[];(this.logger("info","client:_handleClientEvent - Received event of type { ".concat(e.type," }"),{tags:["event","client"],event:e}),"user.presence.changed"!==e.type&&"user.updated"!==e.type&&"user.deleted"!==e.type||this._handleUserEvent(e),"health.check"===e.type&&e.me&&(i.user=e.me,i.state.updateUser(e.me),i.mutedChannels=e.me.channel_mutes,i.mutedUsers=e.me.mutes),e.channel&&"notification.message_new"===e.type&&this._addChannelConfig(e.channel),"notification.channel_mutes_updated"===e.type&&null!==(t=e.me)&&void 0!==t&&t.channel_mutes&&(this.mutedChannels=e.me.channel_mutes),"notification.mutes_updated"===e.type&&null!==(n=e.me)&&void 0!==n&&n.mutes&&(this.mutedUsers=e.me.mutes),"notification.mark_read"===e.type&&0===e.unread_channels)&&Object.keys(this.activeChannels).forEach((function(e){return s.activeChannels[e].state.unreadCount=0}));"channel.deleted"!==e.type&&"notification.channel_deleted"!==e.type||!e.cid||(i.state.deleteAllChannelReference(e.cid),null===(r=this.activeChannels[e.cid])||void 0===r||r._disconnect(),a.push((function(){e.cid&&delete s.activeChannels[e.cid]})));return a}},{key:"_muteStatus",value:function(e){for(var t,n=0;n<this.mutedChannels.length;n++){var r,s=this.mutedChannels[n];if((null===(r=s.channel)||void 0===r?void 0:r.cid)===e){t={muted:!s.expires||new Date(s.expires).getTime()>(new Date).getTime(),createdAt:s.created_at?new Date(s.created_at):new Date,expiresAt:s.expires?new Date(s.expires):null};break}}return t||{muted:!1,createdAt:null,expiresAt:null}}},{key:"connect",value:(Et=(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.userID&&this._user){e.next=2;break}throw Error("Call connectUser or connectAnonymousUser before starting the connection");case 2:if(this.wsBaseURL){e.next=4;break}throw Error("Websocket base url not set");case 4:if(this.clientID){e.next=6;break}throw Error("clientID is not set");case 6:if(this.wsConnection||!this.options.warmUp&&!this.options.enableInsights||this._sayHi(),this.options.wsConnection&&this.node?(this.options.wsConnection.setClient(this),this.wsConnection=this.options.wsConnection):this.wsConnection=new Se({client:this}),e.prev=8,!this.wsFallback){e.next=13;break}return e.next=12,this.wsFallback.connect();case 12:case 15:case 28:return e.abrupt("return",e.sent);case 13:return e.next=15,this.wsConnection.connect(this.options.enableWSFallback?this.defaultWSTimeoutWithFallback:this.defaultWSTimeout);case 18:if(e.prev=18,e.t0=e.catch(8),!(this.options.enableWSFallback&&Ae(e.t0)&&(t=void 0,t="undefined"!=typeof navigator?navigator:"undefined"!=typeof window&&window.navigator?window.navigator:void 0,t?"boolean"!=typeof t.onLine||t.onLine:(C.warn("isOnline failed to access window.navigator and assume browser is online"),1)))){e.next=29;break}return this.logger("info","client:connect() - WS failed, fallback to longpoll",{tags:["connection","client"]}),this.dispatchEvent({type:"transport.changed",mode:"longpoll"}),this.wsConnection._destroyCurrentWSConnection(),this.wsConnection.disconnect().then(),this.wsFallback=new je({client:this}),e.next=28,this.wsFallback.connect();case 29:throw e.t0;case 30:case"end":return e.stop()}var t}),e,this,[[8,18]])}))),function(){return Et.apply(this,arguments)})},{key:"_sayHi",value:function(){var e=this,t=z(),n={headers:{"x-client-request-id":t}};this.doAxiosRequest("get",this.baseURL+"/hi",null,n).catch((function(n){e.options.enableInsights&&ke("http_hi_failed",{api_key:e.key,err:n,client_request_id:t})}))}},{key:"queryUsers",value:(At=(0,s.Z)(u().mark((function e(t){var n,r,s,i,a=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},s={presence:!1},e.next=5,this.wsPromise;case 5:return this._hasConnectionID()||(s.presence=!1),e.next=8,this.get(this.baseURL+"/users",{payload:Ut(Ut({filter_conditions:t,sort:B(n)},s),r)});case 8:return i=e.sent,this.state.updateUsers(i.users),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return At.apply(this,arguments)})},{key:"queryBannedUsers",value:(Dt=(0,s.Z)(u().mark((function e(){var t,n,r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=5,this.get(this.baseURL+"/query_banned_users",{payload:Ut({filter_conditions:t,sort:B(n)},r)});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return Dt.apply(this,arguments)})},{key:"queryMessageFlags",value:(Mt=(0,s.Z)(u().mark((function e(){var t,n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.get(this.baseURL+"/moderation/flags/message",{payload:Ut({filter_conditions:t},n)});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return Mt.apply(this,arguments)})},{key:"queryChannels",value:(Lt=(0,s.Z)(u().mark((function e(t){var n,r,s,i,a,o,c=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:[],r=c.length>2&&void 0!==c[2]?c[2]:{},s=c.length>3&&void 0!==c[3]?c[3]:{},i={state:!0,watch:!0,presence:!1},e.next=6,this.wsPromise;case 6:return this._hasConnectionID()||(i.watch=!1),a=Ut(Ut({filter_conditions:t,sort:B(n)},i),r),e.next=10,this.post(this.baseURL+"/channels",a);case 10:return o=e.sent,this.dispatchEvent({type:"channels.queried",queriedChannels:{channels:o.channels,isLatestMessageSet:!0}}),e.abrupt("return",this.hydrateActiveChannels(o.channels,s,r));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return Lt.apply(this,arguments)})},{key:"queryReactions",value:(Pt=(0,s.Z)(u().mark((function e(t,n){var r,s,i,a=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:[],s=a.length>3&&void 0!==a[3]?a[3]:{},e.next=4,this.wsPromise;case 4:return i=Ut({filter:n,sort:B(r)},s),e.next=7,this.post(this.baseURL+"/messages/"+encodeURIComponent(t)+"/reactions",i);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return Pt.apply(this,arguments)})},{key:"hydrateActiveChannels",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,s=n.skipInitialization,i=n.offlineMode,a=void 0!==i&&i,o=[],c=Ct(t);try{for(c.s();!(e=c.n()).done;){var u=e.value;this._addChannelConfig(u.channel);var l=this.channel(u.channel.type,u.channel.id);l.data=u.channel,l.offlineMode=a,l.initialized=!a;var d=void 0;if(void 0===s)d=l._initializeState(u,"latest").messageSet;else if(!s.includes(u.channel.id)){l.state.clearMessages(),d=l._initializeState(u,"latest").messageSet}d&&(d.pagination=Ut(Ut({},d.pagination),ae({parentSet:d,requestedPageSize:(null==r?void 0:r.message_limit)||25,returnedPage:u.messages,logger:this.logger})),this.polls.hydratePollCache(d.messages,!0)),o.push(l)}}catch(e){c.e(e)}finally{c.f()}return o}},{key:"search",value:(Ot=(0,s.Z)(u().mark((function e(t,n){var r,s,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=i.length>2&&void 0!==i[2]?i[2]:{}).offset||!r.next){e.next=3;break}throw Error("Cannot specify offset with next");case 3:if(s=Ut(Ut({filter_conditions:t},r),{},{sort:r.sort?B(r.sort):void 0}),"string"!=typeof n){e.next=8;break}s.query=n,e.next=13;break;case 8:if("object"!==(0,d.Z)(n)){e.next=12;break}s.message_filter_conditions=n,e.next=13;break;case 12:throw Error("Invalid type ".concat((0,d.Z)(n)," for query parameter"));case 13:return e.next=15,this.wsPromise;case 15:return e.next=17,this.get(this.baseURL+"/search",{payload:s});case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ot.apply(this,arguments)})},{key:"setLocalDevice",value:function(e){var t,n,r;if(null!==(t=this.wsConnection)&&void 0!==t&&t.isConnecting&&this.wsPromise||(null!==(n=this.wsConnection)&&void 0!==n&&n.isHealthy||null!==(r=this.wsFallback)&&void 0!==r&&r.isHealthy())&&this._hasConnectionID())throw new Error("you can only set device before opening a websocket connection");this.options.device=e}},{key:"addDevice",value:(Rt=(0,s.Z)(u().mark((function e(t,n,r,s){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/devices",Ut(Ut({id:t,push_provider:n},null!=r?{user_id:r}:{}),null!=s?{push_provider_name:s}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return Rt.apply(this,arguments)})},{key:"getDevices",value:(St=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/devices",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return St.apply(this,arguments)})},{key:"getUnreadCount",value:(_t=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/unread",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return _t.apply(this,arguments)})},{key:"getUnreadCountBatch",value:(wt=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/unread_batch",{user_ids:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return wt.apply(this,arguments)})},{key:"removeDevice",value:(bt=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/devices",Ut({id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return bt.apply(this,arguments)})},{key:"getRateLimits",value:(yt=(0,s.Z)(u().mark((function e(t){var n,r,s,i,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t||{}).serverSide,s=n.web,i=n.android,a=n.ios,o=n.endpoints,e.abrupt("return",this.get(this.baseURL+"/rate_limits",{server_side:r,web:s,android:i,ios:a,endpoints:o?o.join(","):void 0}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return yt.apply(this,arguments)})},{key:"_addChannelConfig",value:function(e){var t=e.cid,n=e.config;this.configs[t]=n}},{key:"channel",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.userID&&!this._isUsingServerAuth())throw Error("Call connectUser or connectAnonymousUser before creating a channel");if(~e.indexOf(":"))throw Error("Invalid channel group ".concat(e,", can't contain the : character"));return t&&"object"===(0,d.Z)(t)?this.getChannelByMembers(e,t):!t&&"object"===(0,d.Z)(r)&&null!==(n=r.members)&&void 0!==n&&n.length?this.getChannelByMembers(e,r):t?this.getChannelById(e,t,r):new ve(this,e,void 0,r)}},{key:"partialUpdateUser",value:(mt=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.partialUpdateUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return mt.apply(this,arguments)})},{key:"upsertUsers",value:(gt=(0,s.Z)(u().mark((function e(t){var n,r,s,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=Ct(t),e.prev=2,r.s();case 4:if((s=r.n()).done){e.next=11;break}if((i=s.value).id){e.next=8;break}throw Error("User ID is required when updating a user");case 8:n[i.id]=i;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:return e.next=21,this.post(this.baseURL+"/users",{users:n});case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e,this,[[2,13,16,19]])}))),function(e){return gt.apply(this,arguments)})},{key:"upsertUser",value:function(e){return this.upsertUsers([e])}},{key:"partialUpdateUsers",value:(vt=(0,s.Z)(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ct(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}if(r.value.id){e.next=7;break}throw Error("User ID is required when updating a user");case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:return e.next=19,this.patch(this.baseURL+"/users",{users:t});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(e){return vt.apply(this,arguments)})},{key:"deleteUser",value:(ft=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/users/".concat(encodeURIComponent(t)),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ft.apply(this,arguments)})},{key:"restoreUsers",value:(pt=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/restore",{user_ids:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return pt.apply(this,arguments)})},{key:"reactivateUser",value:(ht=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(encodeURIComponent(t),"/reactivate"),Ut({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ht.apply(this,arguments)})},{key:"reactivateUsers",value:(dt=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/reactivate",Ut({user_ids:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return dt.apply(this,arguments)})},{key:"deactivateUser",value:(ut=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(encodeURIComponent(t),"/deactivate"),Ut({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ut.apply(this,arguments)})},{key:"deactivateUsers",value:(ct=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/deactivate",Ut({user_ids:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ct.apply(this,arguments)})},{key:"exportUser",value:(ot=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/".concat(encodeURIComponent(t),"/export"),Ut({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ot.apply(this,arguments)})},{key:"banUser",value:(at=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/ban",Ut({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return at.apply(this,arguments)})},{key:"unbanUser",value:(it=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/moderation/ban",Ut({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return it.apply(this,arguments)})},{key:"shadowBan",value:(rt=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.banUser(t,Ut({shadow:!0},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return rt.apply(this,arguments)})},{key:"removeShadowBan",value:(nt=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.unbanUser(t,Ut({shadow:!0},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return nt.apply(this,arguments)})},{key:"blockUser",value:(tt=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/block",Ut({blocked_user_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return tt.apply(this,arguments)})},{key:"getBlockedUsers",value:(et=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/block",Ut({},t?{user_id:t}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return et.apply(this,arguments)})},{key:"unBlockUser",value:(Xe=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/unblock",Ut({blocked_user_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Xe.apply(this,arguments)})},{key:"muteUser",value:(Ye=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.post(this.baseURL+"/moderation/mute",Ut(Ut({target_id:t},n?{user_id:n}:{}),r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ye.apply(this,arguments)})},{key:"unmuteUser",value:(Ke=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/unmute",Ut({target_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ke.apply(this,arguments)})},{key:"userMuteStatus",value:function(e){if(!this.user||!this.wsPromise)throw new Error("Make sure to await connectUser() first.");for(var t=0;t<this.mutedUsers.length;t+=1)if(this.mutedUsers[t].target.id===e)return!0;return!1}},{key:"flagMessage",value:(Qe=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",Ut({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Qe.apply(this,arguments)})},{key:"flagUser",value:(Ge=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",Ut({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Ge.apply(this,arguments)})},{key:"unflagMessage",value:(Je=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",Ut({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Je.apply(this,arguments)})},{key:"unflagUser",value:(He=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",Ut({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return He.apply(this,arguments)})},{key:"getCallToken",value:(ze=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/calls/".concat(encodeURIComponent(t)),Ut({},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return ze.apply(this,arguments)})},{key:"_queryFlags",value:(We=(0,s.Z)(u().mark((function e(){var t,n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.post(this.baseURL+"/moderation/flags",Ut({filter_conditions:t},n));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return We.apply(this,arguments)})},{key:"_queryFlagReports",value:(Be=(0,s.Z)(u().mark((function e(){var t,n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.post(this.baseURL+"/moderation/reports",Ut({filter_conditions:t},n));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return Be.apply(this,arguments)})},{key:"_reviewFlagReport",value:(Ne=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.patch(this.baseURL+"/moderation/reports/".concat(encodeURIComponent(t)),Ut({review_result:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ne.apply(this,arguments)})},{key:"unblockMessage",value:(qe=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unblock_message",Ut({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return qe.apply(this,arguments)})},{key:"markChannelsRead",value:(Te=(0,s.Z)(u().mark((function e(){var t,n=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/channels/read",Ut({},t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return Te.apply(this,arguments)})},{key:"createCommand",value:function(e){return this.post(this.baseURL+"/commands",e)}},{key:"getCommand",value:function(e){return this.get(this.baseURL+"/commands/".concat(encodeURIComponent(e)))}},{key:"updateCommand",value:function(e,t){return this.put(this.baseURL+"/commands/".concat(encodeURIComponent(e)),t)}},{key:"deleteCommand",value:function(e){return this.delete(this.baseURL+"/commands/".concat(encodeURIComponent(e)))}},{key:"listCommands",value:function(){return this.get(this.baseURL+"/commands")}},{key:"createChannelType",value:function(e){var t=(0,l.Z)({},{commands:["all"]},e);return this.post(this.baseURL+"/channeltypes",t)}},{key:"getChannelType",value:function(e){return this.get(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)))}},{key:"updateChannelType",value:function(e,t){return this.put(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)),t)}},{key:"deleteChannelType",value:function(e){return this.delete(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)))}},{key:"listChannelTypes",value:function(){return this.get(this.baseURL+"/channeltypes")}},{key:"translateMessage",value:(Ee=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/translate"),{language:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ee.apply(this,arguments)})},{key:"_normalizeExpiration",value:function(e){var t=null;if("number"==typeof e){var n=new Date;n.setSeconds(n.getSeconds()+e),t=n.toISOString()}else It(e)?t=e:e instanceof Date&&(t=e.toISOString());return t}},{key:"_validateAndGetMessageId",value:function(e,t){var n;if("string"==typeof e)n=e;else{if(!e.id)throw Error(t);n=e.id}return n}},{key:"pinMessage",value:function(e,t,n,r){var s=this._validateAndGetMessageId(e,"Please specify the message id when calling unpinMessage");return this.partialUpdateMessage(s,{set:{pinned:!0,pin_expires:this._normalizeExpiration(t),pinned_at:this._normalizeExpiration(r)}},n)}},{key:"unpinMessage",value:function(e,t){var n=this._validateAndGetMessageId(e,"Please specify the message id when calling unpinMessage");return this.partialUpdateMessage(n,{set:{pinned:!1}},t)}},{key:"updateMessage",value:(De=(0,s.Z)(u().mark((function e(t,n,r){var s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw Error("Please specify the message id when calling updateMessage");case 2:return delete(s=(0,l.Z)({},t)).id,["command","created_at","html","latest_reactions","own_reactions","quoted_message","reaction_counts","reply_count","type","updated_at","user","__html"].forEach((function(e){null!=s[e]&&delete s[e]})),null!=n&&(It(n)?s.user_id=n:s.user={id:n.id}),Array.isArray(s.mentioned_users)&&!It(s.mentioned_users[0])&&(s.mentioned_users=s.mentioned_users.map((function(e){return e.id}))),e.next=10,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t.id)),Ut({message:s},r));case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return De.apply(this,arguments)})},{key:"partialUpdateMessage",value:(Me=(0,s.Z)(u().mark((function e(t,n,r,s){var i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the message id when calling partialUpdateMessage");case 2:return i=r,null!=r&&It(r)&&(i={id:r}),e.next=6,this.put(this.baseURL+"/messages/".concat(encodeURIComponent(t)),Ut(Ut(Ut({},n),s),{},{user:i}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return Me.apply(this,arguments)})},{key:"deleteMessage",value:(Le=(0,s.Z)(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r={hard:!0}),e.next=4,this.delete(this.baseURL+"/messages/".concat(encodeURIComponent(t)),r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return Le.apply(this,arguments)})},{key:"undeleteMessage",value:(Oe=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/undelete"),{undeleted_by:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Oe.apply(this,arguments)})},{key:"getMessage",value:(Ie=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/messages/".concat(encodeURIComponent(t)),Ut({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ie.apply(this,arguments)})},{key:"queryThreads",value:(Re=(0,s.Z)(u().mark((function e(t){var n,r,s=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ut({limit:10,participant_limit:10,reply_limit:3,watch:!0},t),e.next=3,this.post(this.baseURL+"/threads",n);case 3:return r=e.sent,e.abrupt("return",{threads:r.threads.map((function(e){return new $e({client:s,threadData:e})})),next:r.next});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return Re.apply(this,arguments)})},{key:"getThread",value:(Ce=(0,s.Z)(u().mark((function e(t){var n,r,s,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},t){e.next=3;break}throw Error("Please specify the message id when calling partialUpdateThread");case 3:return r=Ut({participant_limit:100,reply_limit:3,watch:!0},n),e.next=6,this.get(this.baseURL+"/threads/".concat(encodeURIComponent(t)),r);case 6:return s=e.sent,e.abrupt("return",new $e({client:this,threadData:s.thread}));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return Ce.apply(this,arguments)})},{key:"partialUpdateThread",value:(Ze=(0,s.Z)(u().mark((function e(t,n){var r,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the message id when calling partialUpdateThread");case 2:r=["created_at","id","last_message_at","type","updated_at","user","reply_count","participants","channel"],e.t0=u().keys(Ut(Ut({},n.set),n.unset));case 4:if((e.t1=e.t0()).done){e.next=10;break}if(s=e.t1.value,!r.includes(s)){e.next=8;break}throw Error("You cannot set ".concat(s," field on Thread object. ").concat(s," is reserved for server-side use. Please omit ").concat(s," from your set object."));case 8:e.next=4;break;case 10:return e.next=12,this.patch(this.baseURL+"/threads/".concat(encodeURIComponent(t)),n);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ze.apply(this,arguments)})},{key:"getUserAgent",value:function(){return this.userAgent||"stream-chat-javascript-client-".concat(this.node?"node":"browser","-","8.45.1")}},{key:"setUserAgent",value:function(e){this.userAgent=e}},{key:"_enrichAxiosOptions",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{params:{},headers:{},config:{}},n=this._getToken(),r=n?{Authorization:n}:void 0,s=null;null!==this.nextRequestAbortController&&(s=this.nextRequestAbortController.signal,this.nextRequestAbortController=null),null!==(e=t.headers)&&void 0!==e&&e["x-client-request-id"]||(t.headers=Ut(Ut({},t.headers),{},{"x-client-request-id":z()}));var i=this.options.axiosRequestConfig||{},a=i.params,o=i.headers,c=(0,h.Z)(i,Zt);return Ut(Ut(Ut({params:Ut(Ut({user_id:this.userID,connection_id:this._getConnectionID(),api_key:this.key},t.params),a||{}),headers:Ut(Ut(Ut({},r),{},{"stream-auth-type":this.getAuthType(),"X-Stream-Client":this.getUserAgent()},t.headers),o||{})},s?{signal:s}:{}),t.config),c||{})}},{key:"_getToken",value:function(){return!this.tokenManager||this.anonymous?null:this.tokenManager.getToken()}},{key:"_startCleaning",value:function(){var e=this;null==this.cleaningIntervalRef&&(this.cleaningIntervalRef=setInterval((function(){for(var t=0,n=Object.values(e.activeChannels);t<n.length;t++){n[t].clean()}}),500))}},{key:"verifyWebhook",value:function(e,t){return!!this.secret&&function(e,t,n){var r=S.from(t,"utf8"),s=null.createHmac("sha256",r).update(e).digest("hex");try{return null.timingSafeEqual(S.from(s),S.from(n))}catch(e){return!1}}(e,this.secret,t)}},{key:"getPermission",value:function(e){return this.get("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)))}},{key:"createPermission",value:function(e){return this.post("".concat(this.baseURL,"/permissions"),Ut({},e))}},{key:"updatePermission",value:function(e,t){return this.put("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)),Ut({},t))}},{key:"deletePermission",value:function(e){return this.delete("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)))}},{key:"listPermissions",value:function(){return this.get("".concat(this.baseURL,"/permissions"))}},{key:"createRole",value:function(e){return this.post("".concat(this.baseURL,"/roles"),{name:e})}},{key:"listRoles",value:function(){return this.get("".concat(this.baseURL,"/roles"))}},{key:"deleteRole",value:function(e){return this.delete("".concat(this.baseURL,"/roles/").concat(encodeURIComponent(e)))}},{key:"sync",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.post("".concat(this.baseURL,"/sync"),Ut({channel_cids:e,last_sync_at:t},n))}},{key:"sendUserCustomEvent",value:(xe=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post("".concat(this.baseURL,"/users/").concat(encodeURIComponent(t),"/event"),{event:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return xe.apply(this,arguments)})},{key:"createBlockList",value:function(e){return this.post("".concat(this.baseURL,"/blocklists"),e)}},{key:"listBlockLists",value:function(){return this.get("".concat(this.baseURL,"/blocklists"))}},{key:"getBlockList",value:function(e){return this.get("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)))}},{key:"updateBlockList",value:function(e,t){return this.put("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)),t)}},{key:"deleteBlockList",value:function(e){return this.delete("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)))}},{key:"exportChannels",value:function(e){var t=Ut({channels:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return this.post("".concat(this.baseURL,"/export_channels"),t)}},{key:"exportUsers",value:function(e){return this.post("".concat(this.baseURL,"/export/users"),e)}},{key:"exportChannel",value:function(e,t){return this.exportChannels([e],t)}},{key:"getExportChannelStatus",value:function(e){return this.get("".concat(this.baseURL,"/export_channels/").concat(encodeURIComponent(e)))}},{key:"campaign",value:function(e,t){return e&&"object"===(0,d.Z)(e)?new L(this,null,e):new L(this,e,t)}},{key:"segment",value:function(e,t,n){return"string"==typeof t?new Fe(this,e,t,n):new Fe(this,e,null,t)}},{key:"validateServerSideAuth",value:function(){if(!this.secret)throw new Error("Campaigns is a server-side only feature. Please initialize the client with a secret to use this feature.")}},{key:"createSegment",value:(we=(0,s.Z)(u().mark((function e(t,n,r){var s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),s=Ut({id:n,type:t},r),e.abrupt("return",this.post(this.baseURL+"/segments",s));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return we.apply(this,arguments)})},{key:"createUserSegment",value:(be=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.createSegment("user",t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return be.apply(this,arguments)})},{key:"createChannelSegment",value:(me=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.createSegment("channel",t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return me.apply(this,arguments)})},{key:"getSegment",value:(ge=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/segments/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return ge.apply(this,arguments)})},{key:"updateSegment",value:(fe=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.put(this.baseURL+"/segments/".concat(encodeURIComponent(t)),n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return fe.apply(this,arguments)})},{key:"addSegmentTargets",value:(pe=(0,s.Z)(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),r={target_ids:n},e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/addtargets"),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return pe.apply(this,arguments)})},{key:"querySegmentTargets",value:(he=(0,s.Z)(u().mark((function e(t){var n,r,s,i=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:[],s=i.length>3&&void 0!==i[3]?i[3]:{},this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/targets/query"),Ut({filter:n||{},sort:r||[]},s)));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return he.apply(this,arguments)})},{key:"removeSegmentTargets",value:(de=(0,s.Z)(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),r={target_ids:n},e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/deletetargets"),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return de.apply(this,arguments)})},{key:"querySegments",value:(le=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/segments/query",Ut({filter:t,sort:n},r)));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return le.apply(this,arguments)})},{key:"deleteSegment",value:(ue=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.delete(this.baseURL+"/segments/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return ue.apply(this,arguments)})},{key:"segmentTargetExists",value:(ce=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/target/").concat(encodeURIComponent(n))));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ce.apply(this,arguments)})},{key:"createCampaign",value:(oe=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns",Ut({},t)));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return oe.apply(this,arguments)})},{key:"getCampaign",value:(ie=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/campaigns/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return ie.apply(this,arguments)})},{key:"startCampaign",value:(se=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns/".concat(encodeURIComponent(t),"/start"),{scheduled_for:null==n?void 0:n.scheduledFor,stop_at:null==n?void 0:n.stopAt}));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return se.apply(this,arguments)})},{key:"queryCampaigns",value:(re=(0,s.Z)(u().mark((function e(t,n,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.next=3,this.post(this.baseURL+"/campaigns/query",Ut({filter:t,sort:n},r||{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return re.apply(this,arguments)})},{key:"updateCampaign",value:(ne=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.put(this.baseURL+"/campaigns/".concat(encodeURIComponent(t)),n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return ne.apply(this,arguments)})},{key:"deleteCampaign",value:(te=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.delete(this.baseURL+"/campaigns/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return te.apply(this,arguments)})},{key:"stopCampaign",value:(ee=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns/".concat(encodeURIComponent(t),"/stop")));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return ee.apply(this,arguments)})},{key:"enrichURL",value:(Y=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get(this.baseURL+"/og",{url:t}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"getTask",value:(K=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get("".concat(this.baseURL,"/tasks/").concat(encodeURIComponent(t))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return K.apply(this,arguments)})},{key:"deleteChannels",value:($=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/channels/delete",Ut({cids:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return $.apply(this,arguments)})},{key:"deleteUsers",value:(Q=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=r.length>1&&void 0!==r[1]?r[1]:{}).user||["soft","hard","pruning"].includes(n.user)){e.next=3;break}throw new Error("Invalid delete user options. user must be one of [soft hard pruning]");case 3:if(void 0===n.conversations||["soft","hard"].includes(n.conversations)){e.next=5;break}throw new Error("Invalid delete user options. conversations must be one of [soft hard]");case 5:if(void 0===n.messages||["soft","hard","pruning"].includes(n.messages)){e.next=7;break}throw new Error("Invalid delete user options. messages must be one of [soft hard pruning]");case 7:return e.next=9,this.post(this.baseURL+"/users/delete",Ut({user_ids:t},n));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"_createImportURL",value:(G=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/import_urls",{filename:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"_createImport",value:(J=(0,s.Z)(u().mark((function e(t){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{mode:"upsert"},e.next=3,this.post(this.baseURL+"/imports",Ut({path:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"_getImport",value:(H=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/imports/".concat(encodeURIComponent(t)));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return H.apply(this,arguments)})},{key:"_listImports",value:(N=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/imports",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return N.apply(this,arguments)})},{key:"upsertPushProvider",value:(T=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/push_providers",{push_provider:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"deletePushProvider",value:(E=(0,s.Z)(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.name,e.next=3,this.delete(this.baseURL+"/push_providers/".concat(encodeURIComponent(n),"/").concat(encodeURIComponent(r)));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"listPushProviders",value:(A=(0,s.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/push_providers");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"createAbortControllerForNextRequest",value:function(){return this.nextRequestAbortController=new AbortController}},{key:"commitMessage",value:(D=(0,s.Z)(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/commit"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"createPoll",value:(M=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/polls",Ut(Ut({},t),n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return M.apply(this,arguments)})},{key:"getPoll",value:(P=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/polls/".concat(encodeURIComponent(t)),n?{user_id:n}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"updatePoll",value:(I=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.put(this.baseURL+"/polls",Ut(Ut({},t),n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"partialUpdatePoll",value:(U=(0,s.Z)(u().mark((function e(t,n,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.patch(this.baseURL+"/polls/".concat(encodeURIComponent(t)),Ut(Ut({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return U.apply(this,arguments)})},{key:"deletePoll",value:(Z=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/polls/".concat(encodeURIComponent(t)),Ut({},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Z.apply(this,arguments)})},{key:"closePoll",value:(x=(0,s.Z)(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.partialUpdatePoll(t,{set:{is_closed:!0}},n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"createPollOption",value:(k=(0,s.Z)(u().mark((function e(t,n,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options"),Ut(Ut({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return k.apply(this,arguments)})},{key:"getPollOption",value:(_=(0,s.Z)(u().mark((function e(t,n,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options/").concat(encodeURIComponent(n)),r?{user_id:r}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return _.apply(this,arguments)})},{key:"updatePollOption",value:(w=(0,s.Z)(u().mark((function e(t,n,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.put(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options"),Ut(Ut({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return w.apply(this,arguments)})},{key:"deletePollOption",value:(b=(0,s.Z)(u().mark((function e(t,n,r){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options/").concat(encodeURIComponent(n)),r?{user_id:r}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return b.apply(this,arguments)})},{key:"castPollVote",value:(y=(0,s.Z)(u().mark((function e(t,n,r,s){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/polls/").concat(encodeURIComponent(n),"/vote"),Ut({vote:r},s?{user_id:s}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return y.apply(this,arguments)})},{key:"addPollAnswer",value:(m=(0,s.Z)(u().mark((function e(t,n,r,s){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.castPollVote(t,n,{answer_text:r},s));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return m.apply(this,arguments)})},{key:"removePollVote",value:(g=(0,s.Z)(u().mark((function e(t,n,r,s){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/polls/").concat(encodeURIComponent(n),"/vote/").concat(encodeURIComponent(r)),Ut({},s?{user_id:s}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return g.apply(this,arguments)})},{key:"queryPolls",value:(v=(0,s.Z)(u().mark((function e(){var t,n,r,s,i,a=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},i=(s=a.length>3?a[3]:void 0)?"?user_id=".concat(s):"",e.next=7,this.post(this.baseURL+"/polls/query".concat(i),Ut({filter:t,sort:B(n)},r));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"queryPollVotes",value:(c=(0,s.Z)(u().mark((function e(t){var n,r,s,i,a,o=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:[],s=o.length>3&&void 0!==o[3]?o[3]:{},a=(i=o.length>4?o[4]:void 0)?"?user_id=".concat(i):"",e.next=7,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/votes").concat(a),Ut({filter:n,sort:B(r)},s));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"queryPollAnswers",value:(r=(0,s.Z)(u().mark((function e(t){var n,r,s,i,a,o=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:[],s=o.length>3&&void 0!==o[3]?o[3]:{},a=(i=o.length>4?o[4]:void 0)?"?user_id=".concat(i):"",e.next=7,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/votes").concat(a),Ut({filter:Ut(Ut({},n),{},{is_answer:!0}),sort:B(r)},s));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"queryMessageHistory",value:(n=(0,s.Z)(u().mark((function e(){var t,n,r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},n=s.length>1&&void 0!==s[1]?s[1]:[],r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=5,this.post(this.baseURL+"/messages/history",Ut({filter:t,sort:B(n)},r));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateFlags",value:(t=(0,s.Z)(u().mark((function e(t,n){var r,s=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>2&&void 0!==s[2]?s[2]:{},e.next=3,this.post(this.baseURL+"/automod/v1/moderation/update_flags",Ut({message_ids:t,reviewed_by:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}],[{key:"getInstance",value:function(t,n,r){return e._instance||(e._instance="string"==typeof n?new e(t,n,r):new e(t,n)),e._instance}}]),e}();(0,o.Z)(Ot,"_instance",void 0);var Pt="Allow",Lt=["*"],Mt=["*"],Dt=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Lt,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mt,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Pt;(0,i.Z)(this,e),(0,o.Z)(this,"name",void 0),(0,o.Z)(this,"action",void 0),(0,o.Z)(this,"owner",void 0),(0,o.Z)(this,"priority",void 0),(0,o.Z)(this,"resources",void 0),(0,o.Z)(this,"roles",void 0),this.name=t,this.action=c,this.owner=a,this.priority=n,this.resources=r,this.roles=s};new Dt("Allow all",999,Lt,Mt,!1,Pt),new Dt("Deny all",1,Lt,Mt,!1,"Deny")}}]);
//# sourceMappingURL=vendors-62482c67-c2b58f5acee1a12d.bundle.js.map