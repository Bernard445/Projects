/*! For license information please see vendors-b08b683e-3bc5944910fc6768.bundle.js.LICENSE.txt */
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="23baa7ce-8325-4d1b-9100-3373c28a6b34",e._sentryDebugIdIdentifier="sentry-dbid-23baa7ce-8325-4d1b-9100-3373c28a6b34")}catch(e){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"c646149fa3031067f714bcac03e9e2fa3f5da1d0"},(self.webpackChunkdisco=self.webpackChunkdisco||[]).push([[6387],{831987:function(e,t,r){r.d(t,{_:function(){return rt},a2:function(){return A},a9:function(){return nt},aA:function(){return Re},aB:function(){return Le},aC:function(){return Ge},aD:function(){return qe},aE:function(){return Ye},aF:function(){return Ve},aG:function(){return Je},aH:function(){return Xe},aI:function(){return ze},aJ:function(){return Qe},aK:function(){return Ze},aL:function(){return st},aa:function(){return Ue},ab:function(){return me},ac:function(){return $e},ad:function(){return je},ae:function(){return Fe},af:function(){return Ie},ag:function(){return Ce},ah:function(){return Oe},ai:function(){return Ae},aj:function(){return ae},ak:function(){return oe},al:function(){return Q},am:function(){return X},an:function(){return $},ao:function(){return ee},ap:function(){return Z},aq:function(){return Te},ar:function(){return te},as:function(){return re},at:function(){return Pe},au:function(){return Se},av:function(){return et},aw:function(){return Ee},ax:function(){return Ne},ay:function(){return Ke},az:function(){return We},e:function(){return o},i:function(){return xe},l:function(){return ke}});var n,i,s,o,a,c,u,d=r(425108);function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function h(e,t,r){return t=function(e){var t=function(e,t){if("object"!=l(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==l(t)?t:String(t)}(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function f(e,t,r){return Object.defineProperty(e,"prototype",{writable:!1}),e}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t,r){return t=w(t),function(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}(e,y()?Reflect.construct(t,r||[],w(e).constructor):t.apply(e,r))}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}function g(e){var t="function"==typeof Map?new Map:void 0;return g=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(y())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&k(i,r.prototype),i}(e,arguments,w(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),k(r,e)},g(e)}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(y=function(){return!!e})()}function k(e,t){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},k(e,t)}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}!function(e){e.emailMagicLinks="emailMagicLinks",e.oauth="oauth",e.otp="otp",e.crypto="crypto",e.passwords="passwords",e.passkeys="passkeys"}(n||(n={})),function(e){e.Google="google",e.Microsoft="microsoft",e.Apple="apple",e.Github="github",e.GitLab="gitlab",e.Facebook="facebook",e.Discord="discord",e.Salesforce="salesforce",e.Slack="slack",e.Amazon="amazon",e.Bitbucket="bitbucket",e.LinkedIn="linkedin",e.Coinbase="coinbase",e.Twitch="twitch",e.Twitter="twitter",e.TikTok="tiktok",e.Snapchat="snapchat",e.Figma="figma",e.Yahoo="yahoo"}(i||(i={})),function(e){e.Vessel="Vessel",e.Phantom="Phantom",e.Metamask="Metamask",e.Coinbase="Coinbase",e.Binance="Binance",e.GenericEthereumWallet="Other Ethereum Wallet",e.GenericSolanaWallet="Other Solana Wallet"}(s||(s={})),function(e){e.embedded="embedded",e.floating="floating",e.embeddedOnly="embeddedOnly",e.floatingOrEmbedded="floatingOrEmbedded",e.forceLegacyEmbedded="forceLegacyEmbedded"}(o||(o={})),function(e){e.SMS="sms",e.WhatsApp="whatsapp",e.Email="email"}(a||(a={})),function(e){e.MagicLinkLoginOrCreateEvent="MAGIC_LINK_LOGIN_OR_CREATE",e.OTPsLoginOrCreateEvent="OTP_LOGIN_OR_CREATE",e.OTPsAuthenticate="OTP_AUTHENTICATE",e.CryptoWalletAuthenticateStart="CRYPTO_WALLET_AUTHENTICATE_START",e.CryptoWalletAuthenticate="CRYPTO_WALLET_AUTHENTICATE",e.PasswordCreate="PASSWORD_CREATE",e.PasswordAuthenticate="PASSWORD_AUTHENTICATE",e.PasswordResetByEmailStart="PASSWORD_RESET_BY_EMAIL_START",e.PasswordResetByEmail="PASSWORD_RESET_BY_EMAIL",e.PasskeyRegister="PASSKEY_REGISTER",e.PasskeyAuthenticate="PASSKEY_AUTHENTICATE",e.PasskeySkip="PASSKEY_SKIP",e.PasskeyDone="PASSKEY_DONE",e.B2BMagicLinkEmailLoginOrSignup="B2B_MAGIC_LINK_EMAIL_LOGIN_OR_SIGNUP",e.B2BMagicLinkAuthenticate="B2B_MAGIC_LINK_AUTHENTICATE",e.B2BMagicLinkEmailDiscoverySend="B2B_MAGIC_LINK_EMAIL_DISCOVERY_SEND",e.B2BMagicLinkDiscoveryAuthenticate="B2B_MAGIC_LINK_DISCOVERY_AUTHENTICATE",e.B2BSSOStart="B2B_SSO_START",e.B2BSSOAuthenticate="B2B_SSO_AUTHENTICATE",e.B2BOAuthAuthenticate="B2B_OAUTH_AUTHENTICATE",e.B2BOAuthDiscoveryAuthenticate="B2B_OAUTH_DISCOVERY_AUTHENTICATE",e.B2BDiscoveryOrganizationsCreate="B2B_DISCOVERY_ORGANIZATIONS_CREATE",e.B2BDiscoveryIntermediateSessionExchange="B2B_DISCOVERY_INTERMEDIATE_SESSION_EXCHANGE",e.B2BPasswordAuthenticate="B2B_PASSWORD_AUTHENTICATE",e.B2BPasswordResetByEmailStart="B2B_PASSWORD_RESET_BY_EMAIL_START",e.B2BPasswordResetByEmail="B2B_PASSWORD_RESET_BY_EMAIL",e.B2BPasswordResetBySession="B2B_PASSWORD_RESET_BY_SESSION",e.B2BSMSOTPSend="B2B_SMS_OTP_SEND",e.B2BSMSOTPAuthenticate="B2B_SMS_OTP_AUTHENTICATE",e.B2BTOTPCreate="B2B_TOTP_CREATE",e.B2BTOTPAuthenticate="B2B_TOTP_AUTHENTICATE",e.B2BRecoveryCodesRecover="B2B_RECOVERY_CODES_RECOVER"}(c||(c={})),function(e){e[e.emailMagicLinks=0]="emailMagicLinks",e[e.oauth=1]="oauth",e[e.otp=2]="otp",e[e.passwords=3]="passwords"}(u||(u={}));var S,P,x,C,O=function(e){function t(e,r){var n;return _(this,t),(n=m(this,t,[e+"\n"+r])).message=e+"\n"+r,n.name="SDKAPIUnreachableError",n.details=r,Object.setPrototypeOf(b(n),t.prototype),n}return v(t,e),f(t)}(g(Error)),A=function(e){function t(e,r){var n;return _(this,t),(n=m(this,t)).name="StytchSDKUsageError",n.message="Invalid call to ".concat(e,"\n")+r,n}return v(t,e),f(t)}(g(Error)),T=function(e){function t(e){var r,n;_(this,t),(r=m(this,t)).name="StytchSDKSchemaError";var i=null===(n=e.body)||void 0===n?void 0:n.map((function(e){return"".concat(e.dataPath,": ").concat(e.message)})).join("\n");return r.message="[400] Request does not match expected schema\n".concat(i),r}return v(t,e),f(t)}(g(Error)),E=function(e){function t(e){var r;_(this,t),(r=m(this,t)).name="StytchSDKAPIError";var n=e.status_code,i=e.error_type,s=e.error_message,o=e.error_url,a=e.request_id;return r.error_type=i,r.error_message=s,r.error_url=o,r.request_id=a,r.status_code=n,r.message="[".concat(n,"] ").concat(i,"\n")+"".concat(s,"\n")+"See ".concat(o," for more information.\n")+(a?"request_id: ".concat(a,"\n"):""),r}return v(t,e),f(t)}(g(Error)),D=["unauthorized_credentials","user_unauthenticated","invalid_secret_authentication","session_not_found"],M=function(e){function t(e,r){var n;return _(this,t),(n=m(this,t,[r])).name=e,n}return v(t,e),f(t)}(g(Error)),F=function(e){function t(e){var r;return _(this,t),r=m(this,t,["StytchAPIUnreachableError",e]),Object.setPrototypeOf(b(r),t.prototype),r}return v(t,e),f(t)}(M),I=function(e){function t(e){var r;_(this,t);var n=null===(r=e.body)||void 0===r?void 0:r.map((function(e){return"".concat(e.dataPath,": ").concat(e.message)})).join("\n");return m(this,t,["StytchAPISchemaError","Request does not match expected schema\n".concat(n)])}return v(t,e),f(t)}(M),j=function(e){function t(e){var r;_(this,t);var n=e.status_code,i=e.error_type,s=e.error_message,o=e.error_url,a=e.request_id;return(r=m(this,t,["StytchAPIError","[".concat(n,"] ").concat(i,"\n")+"".concat(s,"\n")+"See ".concat(o," for more information.\n")+(a?"request_id: ".concat(a,"\n"):"")])).error_type=i,r.error_message=s,r.error_url=o,r.request_id=a,r.status_code=n,r}return v(t,e),f(t)}(M);function B(e,t){if(e){if("string"==typeof e)return R(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?R(e,t):void 0}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function L(){L=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,i=Object.defineProperty||function(e,t,r){e[t]=r.value},s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag";function u(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var s=t&&t.prototype instanceof b?t:b,o=Object.create(s.prototype),a=new E(n||[]);return i(o,"_invoke",{value:C(e,r,a)}),o}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=d;var h="suspendedStart",p="suspendedYield",f="executing",_="completed",m={};function b(){}function v(){}function g(){}var y={};u(y,o,(function(){return this}));var k=Object.getPrototypeOf,w=k&&k(k(D([])));w&&w!==r&&n.call(w,o)&&(y=w);var S=g.prototype=b.prototype=Object.create(y);function P(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function r(i,s,o,a){var c=l(e[i],e,s);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==K(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,a)}),(function(e){r("throw",e,o,a)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return r("throw",e,o,a)}))}a(c.arg)}var s;i(this,"_invoke",{value:function(e,n){function i(){return new t((function(t,i){r(e,n,t,i)}))}return s=s?s.then(i,i):i()}})}function C(t,r,n){var i=h;return function(s,o){if(i===f)throw new Error("Generator is already running");if(i===_){if("throw"===s)throw o;return{value:e,done:!0}}for(n.method=s,n.arg=o;;){var a=n.delegate;if(a){var c=O(a,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=_,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var u=l(t,r,n);if("normal"===u.type){if(i=n.done?_:p,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=_,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,i=t.iterator[n];if(i===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var s=l(i,t.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,m;var o=s.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,m):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function E(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function D(t){if(t||""===t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,s=function r(){for(;++i<t.length;)if(n.call(t,i))return r.value=t[i],r.done=!1,r;return r.value=e,r.done=!0,r};return s.next=s}}throw new TypeError(K(t)+" is not iterable")}return v.prototype=g,i(S,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:v,configurable:!0}),v.displayName=u(g,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,c,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},P(x.prototype),u(x.prototype,a,(function(){return this})),t.AsyncIterator=x,t.async=function(e,r,n,i,s){void 0===s&&(s=Promise);var o=new x(d(e,r,n,i),s);return t.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},P(S),u(S,c,"Generator"),u(S,o,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=D,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(T),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function i(n,i){return a.type="throw",a.arg=t,r.next=n,i&&(r.method="next",r.arg=e),!!i}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=n.call(o,"catchLoc"),u=n.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;T(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:D(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),m}},t}function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,U(n.key),n)}}function N(e,t,r){return t&&z(e.prototype,t),r&&z(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function U(e){var t=function(e,t){if("object"!=K(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==K(t)?t:String(t)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t,r){return t=V(t),function(e,t){if(t&&("object"===K(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,q()?Reflect.construct(t,r||[],V(e).constructor):t.apply(e,r))}function H(e){var t="function"==typeof Map?new Map:void 0;return H=function(e){if(null===e||!function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return function(e,t,r){if(q())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var i=new(e.bind.apply(e,n));return r&&Y(i,r.prototype),i}(e,arguments,V(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Y(r,e)},H(e)}function q(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(q=function(){return!!e})()}function Y(e,t){return Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Y(e,t)}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}!function(e){e.emailMagicLinks="emailMagicLinks",e.sso="sso",e.passwords="passwords",e.oauth="oauth"}(S||(S={})),function(e){e.Discovery="Discovery",e.Organization="Organization",e.PasswordReset="PasswordReset"}(P||(P={})),function(e){e.smsOtp="smsOtp",e.totp="totp"}(x||(x={})),function(e){e.Google="google",e.Microsoft="microsoft"}(C||(C={}));var J,X="https://test.stytch.com",$="https://api.stytch.com",Z="https://js.stytch.com/clientside-services/index.html",Q="https://web.stytch.com",ee="https://telemetry.stytch.com",te="https://accounts.google.com/gsi",re="".concat(te,"/client");function ne(e,t,r,n){return new(r||(r=Promise))((function(t,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function o(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,o)}a((n=n.apply(e,[])).next())}))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.RequiredCatcha="Catcha Required"}(J||(J={}));var ie,se=function(e){function t(e){var r;return W(this,t),(r=G(this,t,[e])).type=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Y(e,t)}(t,e),N(t)}(H(Error));function oe(e){var t=e.method,r=e.errorMessage,n=e.finalURL,i=e.basicAuthHeader,s=e.xSDKClientHeader,o=e.xSDKParentHostHeader,a=e.body,c=e.retryCallback;return ne(this,0,void 0,L().mark((function e(){var u;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u={method:t,errorMessage:r,finalURL:n,basicAuthHeader:i,xSDKClientHeader:s,xSDKParentHostHeader:o,body:a},e.prev=1,e.next=4,ae(u);case 4:case 15:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),!(e.t0 instanceof se)){e.next=16;break}return e.next=12,c(e.t0,u);case 12:return u=e.sent,e.next=15,ae(u);case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,null,[[1,7]])})))}function ae(e){var t,r=e.method,n=e.finalURL,i=e.basicAuthHeader,s=e.xSDKClientHeader,o=e.xSDKParentHostHeader,a=e.body;return ne(this,0,void 0,L().mark((function e(){var c,u,d,l,h,p;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c={Authorization:i,"Content-Type":"application/json","X-SDK-Client":s},o&&(c["X-SDK-Parent-Host"]=o),u={method:r,headers:c,body:a&&JSON.stringify(a)},e.prev=3,e.next=6,fetch(n,u);case 6:d=e.sent,e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(3),"Failed to fetch"!==e.t0.message){e.next=13;break}throw new F("Unable to contact the Stytch servers. Are you online?");case 13:throw e.t0;case 14:if(!(d.status<=299)){e.next=25;break}return e.prev=15,e.next=18,d.json();case 18:return l=e.sent,e.abrupt("return",l.data);case 22:throw e.prev=22,e.t1=e.catch(15),new F("Invalid JSON response from the Stytch servers.");case 25:if(200===d.status||!(null===(t=d.headers.get("content-type"))||void 0===t?void 0:t.includes("application/json"))){e.next=38;break}return e.prev=26,e.next=29,d.json();case 29:h=e.sent,e.next=35;break;case 32:throw e.prev=32,e.t2=e.catch(26),new F("Invalid or no response from server");case 35:if(!("body"in h||"params"in h||"query"in h)){e.next=37;break}throw new I(h);case 37:throw new j(h);case 38:return e.prev=38,e.next=41,d.text();case 41:p=e.sent,e.next=47;break;case 44:throw e.prev=44,e.t3=e.catch(38),new F("Invalid response from the Stytch servers.");case 47:if(!p.includes("Captcha required")){e.next=49;break}throw new se(J.RequiredCatcha);case 49:throw new F("Invalid response from the Stytch servers.");case 50:case"end":return e.stop()}}),e,null,[[3,9],[15,22],[26,32],[38,44]])})))}var ce=new Uint8Array(16);function ue(){if(!ie&&!(ie="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ie(ce)}var de=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var le=[],he=0;he<256;++he)le.push((he+256).toString(16).substr(1));function pe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(le[e[t+0]]+le[e[t+1]]+le[e[t+2]]+le[e[t+3]]+"-"+le[e[t+4]]+le[e[t+5]]+"-"+le[e[t+6]]+le[e[t+7]]+"-"+le[e[t+8]]+le[e[t+9]]+"-"+le[e[t+10]]+le[e[t+11]]+le[e[t+12]]+le[e[t+13]]+le[e[t+14]]+le[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&de.test(e)}(r))throw TypeError("Stringified UUID is invalid");return r}function fe(e,t,r){var n=(e=e||{}).random||(e.rng||ue)();return n[6]=15&n[6]|64,n[8]=63&n[8]|128,pe(n)}var _e={};function me(e,t){return ne(this,0,void 0,L().mark((function r(){return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0===_e[e]){r.next=2;break}return r.abrupt("return",_e[e]);case 2:return _e[e]=be(e,t),r.abrupt("return",_e[e]);case 4:case"end":return r.stop()}}),r)})))}function be(e,t){return new Promise((function(r,n){var i=function(e){var t=ve(e);if(t[0])return t[0]}(e);if(i&&"true"===i.dataset.loaded)try{r(t())}catch(t){return n(new Error("".concat(e," already loaded, but module was not found in global scope: ").concat(t)))}var s=function(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("async","true"),t.setAttribute("defer","true"),document.head.appendChild(t),t}(e);s.addEventListener("load",(function(){s.dataset.loaded="true";try{r(t())}catch(t){n(new Error("".concat(e," was loaded, but module was not found in global scope: ").concat(t)))}})),s.addEventListener("error",(function(t){n(new Error("".concat(e," could not be loaded: ").concat(t)))}))}))}var ve=function(e){return document.querySelectorAll('script[src="'.concat(e,'"]'))};var ge,ye=["[Stytch]"],ke={debug:function(){return false},log:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=d).log.apply(e,ye.concat(r))},warn:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=d).warn.apply(e,ye.concat(r))},error:function(){for(var e,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return(e=d).error.apply(e,ye.concat(r))}},we="\nYou can find your public token at https://stytch.com/dashboard/api-keys.",Se=function(e){"string"!=typeof e?ke.warn("Public token is malformed. Expected a string, got ".concat(K(e),".").concat(we)):""===e?ke.warn('Public token is malformed. Expected "public-token-...", got an empty string.'.concat(we)):e.startsWith("public-token-")||ke.warn('Public token is malformed. Expected "public-token-...", got '.concat(e,".").concat(we))},Pe=function(e){if("undefined"==typeof window)throw new Error("The ".concat(e," is not compatible with server-side environments.\nIf using nextjs, use the create").concat(e," method instead.\n```\n").concat("import { createStytchB2BHeadlessClient } from '@stytch/nextjs/b2b';\n    \n  const stytch = createStytchB2BHeadlessClient('public-token-...');\n  ","\n```\n"))},xe=function(e){return e.includes("public-token-test")},Ce=function(){return"event-id-".concat(fe())},Oe=function(){return"app-session-id-".concat(fe())},Ae=function(){return"persistent-id-".concat(fe())},Te=function(e){var t={isObject:function(r,n){var i="object"===K(n)&&!Array.isArray(n)&&null!==n;if(!i)throw new A(e,r+" must be an object.");return t},isOptionalObject:function(e,r){return void 0===r?t:t.isObject(e,r)},isString:function(r,n){if("string"!=typeof n)throw new A(e,r+" must be a string.");return t},isOptionalString:function(e,r){return void 0===r?t:t.isString(e,r)},isStringArray:function(r,n){if(!Array.isArray(n))throw new A(e,r+" must be an array of strings.");var i,s=function(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=B(e))||t){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}(n);try{for(s.s();!(i=s.n()).done;){if("string"!=typeof i.value)throw new A(e,r+" must be an array of strings.")}}catch(e){s.e(e)}finally{s.f()}return t},isOptionalStringArray:function(e,r){return void 0===r?t:t.isStringArray(e,r)},isNumber:function(r,n){if("number"!=typeof n)throw new A(e,r+" must be a number.");return t},isOptionalNumber:function(e,r){return void 0===r?t:t.isNumber(e,r)},isBoolean:function(r,n){if("boolean"!=typeof n)throw new A(e,r+" must be a boolean.");return t},isOptionalBoolean:function(e,r){return void 0===r?t:t.isBoolean(e,r)}};return t},Ee=N((function e(t,r,n){var i=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){return Promise.resolve(void 0)};W(this,e),this.bootstrapPromise=n,this.isEnabled=function(){return ne(i,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.state.then((function(e){return e.enabled})));case 1:case"end":return e.stop()}}),e,this)})))},this.getTelemetryID=function(){return ne(i,0,void 0,L().mark((function e(){var t,r,n,i;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.state;case 2:if(t=e.sent,r=t.publicToken,n=t.enabled,i=t.dfpBackendURL,n){e.next=8;break}return e.abrupt("return",void 0);case 8:return e.next=10,window.GetTelemetryID(r,"".concat(i,"/submit"));case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)})))},this.getDFPTelemetryIDAndCaptcha=function(){return ne(i,0,void 0,L().mark((function e(){var t,r,n,i,s,o;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.state;case 2:if(t=e.sent,r=t.enabled,n=t.executeRecaptcha,i=t.mode,s=void 0,o=void 0,r){e.next=12;break}return e.next=11,n();case 11:o=e.sent;case 12:if("DECISIONING"!==i){e.next=18;break}return e.next=15,this.getTelemetryID();case 15:s=e.sent,e.next=25;break;case 18:if("OBSERVATION"!==i){e.next=25;break}return e.next=21,this.getTelemetryID();case 21:return s=e.sent,e.next=24,n();case 24:o=e.sent;case 25:return e.abrupt("return",{dfp_telemetry_id:s,captcha_token:o});case 26:case"end":return e.stop()}}),e,this)})))},this.retryWithCaptchaAndDFP=function(e,t){return ne(i,0,void 0,L().mark((function r(){var n,i,s;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.state;case 2:if(n=r.sent,i=n.enabled,s=n.executeRecaptcha,e.type!==J.RequiredCatcha||!i){r.next=14;break}if(!t.body){r.next=13;break}return r.next=9,this.getTelemetryID();case 9:return t.body.dfp_telemetry_id=r.sent,r.next=12,s();case 12:t.body.captcha_token=r.sent;case 13:return r.abrupt("return",t);case 14:throw new Error("Unable to query captcha and/or dfp telemetry ID");case 15:case"end":return r.stop()}}),r,this)})))},this.state=n.then((function(e){return ne(i,0,void 0,L().mark((function n(){return L().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.runDFPProtectedAuth){n.next=2;break}return n.abrupt("return",{publicToken:t,dfpBackendURL:r,enabled:!1,loaded:!1,executeRecaptcha:s});case 2:return n.next=4,me("".concat("https://elements.stytch.com","/telemetry.js"),(function(){return window.GetTelemetryID}));case 4:return n.abrupt("return",{publicToken:t,dfpBackendURL:r,enabled:!0,mode:e.dfpProtectedAuthMode||"OBSERVATION",loaded:!0,executeRecaptcha:s});case 5:case"end":return n.stop()}}),n)})))}))})),De=function(){return{isEnabled:function(){return ne(void 0,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})))},getTelemetryID:function(){return ne(void 0,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)})))},getDFPTelemetryIDAndCaptcha:function(){return ne(void 0,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{dfp_telemetry_id:void 0,captcha_token:void 0});case 1:case"end":return e.stop()}}),e)})))},retryWithCaptchaAndDFP:function(){return ne(void 0,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("DFP protected auth is disabled");case 1:case"end":return e.stop()}}),e)})))}}},Me=function(){function e(){W(this,e)}return N(e,null,[{key:"marshall",value:function(e){return Object.assign(Object.assign({},e),{name:e.name,message:e.message,stack:e.stack})}},{key:"inflate",value:function(e,t){var r=new e(t);return Object.assign(r,t),Object.setPrototypeOf(r,e.prototype),r}},{key:"unmarshall",value:function(t){if("name"in t)switch(t.name){case"SDKAPIUnreachableError":return e.inflate(O,t);case"StytchSDKSchemaError":return e.inflate(T,t);case"StytchAPIUnreachableError":return e.inflate(F,t);case"StytchAPISchemaError":return e.inflate(I,t);case"StytchSDKAPIError":return e.inflate(E,t);case"StytchAPIError":return e.inflate(j,t);case"TypeError":return e.inflate(TypeError,t);case"SyntaxError":return e.inflate(SyntaxError,t);case"ReferenceError":return e.inflate(ReferenceError,t);case"RangeError":return e.inflate(RangeError,t);case"EvalError":return e.inflate(EvalError,t);case"URIError":return e.inflate(URIError,t)}return e.inflate(Error,t)}}]),e}(),Fe=15,Ie=800,je=function(){function e(t){W(this,e),this.maxBatchSize=t.maxBatchSize,this.logEventURL=t.logEventURL,setInterval(this.flush.bind(this),t.intervalDurationMs),this.batch=[]}return N(e,[{key:"logEvent",value:function(e,t){this.batch.push({telemetry:e,event:t}),this.batch.length>=this.maxBatchSize&&this.flush()}},{key:"flush",value:function(){return ne(this,0,void 0,L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.batch.length){e.next=2;break}return e.abrupt("return");case 2:return t=this.batch,this.batch=[],e.prev=4,e.next=7,fetch(this.logEventURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 7:e.next=11;break;case 9:e.prev=9,e.t0=e.catch(4);case 11:case"end":return e.stop()}}),e,this,[[4,9]])})))}}]),e}();!function(e){e.LoginOrCreateEML="login_or_create_eml",e.LoginOrCreateOTP="login_or_create_otp",e.ResetPassword="reset_password"}(ge||(ge={})),Promise.resolve({pkceRequiredForEmailMagicLinks:!1}),Promise.resolve({pkceRequiredForPasswordResets:!1});var Be=Promise.resolve({pkceRequiredForEmailMagicLinks:!1}),Re=function(){function e(t,r,n,i){var s=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Be,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:De();W(this,e),this._networkClient=t,this._subscriptionService=r,this._pkceManager=n,this._passwordResetPKCEManager=i,this._config=o,this.dfpProtectedAuth=a,this.email={invite:function(e){return ne(s,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.magicLinks.email.loginOrSignup").isString("email_address",e.email_address).isOptionalString("invite_redirect_url",e.invite_redirect_url).isOptionalString("invite_template_id",e.invite_template_id).isOptionalString("name",e.name).isOptionalString("locale",e.locale).isOptionalStringArray("roles",e.roles),t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/magic_links/email/invite",body:e,errorMessage:"Failed to send invite.",method:"POST"}));case 2:case"end":return t.stop()}}),t,this)})))},loginOrSignup:function(e){return ne(s,0,void 0,L().mark((function t(){var r,n;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.magicLinks.email.loginOrSignup").isString("email_address",e.email_address).isString("organization_id",e.organization_id).isOptionalString("login_redirect_url",e.login_redirect_url).isOptionalString("login_template_id",e.login_template_id).isOptionalString("signup_redirect_url",e.signup_redirect_url).isOptionalString("signup_template_id",e.signup_template_id).isOptionalString("locale",e.locale),t.next=3,this.getCodeChallenge();case 3:return r=t.sent,n=Object.assign(Object.assign({},e),{pkce_code_challenge:r}),t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/magic_links/email/login_or_signup",body:n,errorMessage:"Failed to send magic link",method:"POST"}));case 6:case"end":return t.stop()}}),t,this)})))},discovery:{send:function(e){return ne(s,0,void 0,L().mark((function t(){var r,n,i,s,o;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.magicLinks.email.discovery.send").isString("email_address",e.email_address).isOptionalString("discovery_redirect_url",e.discovery_redirect_url).isOptionalString("login_template_id",e.login_template_id).isOptionalString("locale",e.locale),t.next=3,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 3:return r=t.sent,n=r.dfp_telemetry_id,i=r.captcha_token,t.next=8,this.getCodeChallenge();case 8:return s=t.sent,o=Object.assign(Object.assign({},e),{pkce_code_challenge:s,dfp_telemetry_id:n,captcha_token:i}),t.abrupt("return",this._networkClient.retriableFetchSDK({url:"/b2b/magic_links/email/discovery/send",body:o,errorMessage:"Failed to send discovery magic link",method:"POST",retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP}));case 11:case"end":return t.stop()}}),t,this)})))}}},this.authenticate=function(e){return ne(s,0,void 0,L().mark((function t(){var r,n;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.magicLinks.authenticate").isString("magic_links_token",e.magic_links_token).isNumber("session_duration_minutes",e.session_duration_minutes).isOptionalString("locale",e.locale),t.next=3,this._passwordResetPKCEManager.getPKPair();case 3:if(r=t.sent,n=null,!(null==r?void 0:r.code_verifier)){t.next=19;break}return t.prev=6,t.next=9,this.handlePKCEForAuthenticate(this._passwordResetPKCEManager,e);case 9:n=t.sent,t.next=19;break;case 12:if(t.prev=12,t.t0=t.catch(6),!t.t0.message.includes("pkce")){t.next=18;break}d.log("Authenticate with passwords pkce namespace failed. Falling back to authenticate with magic_links namespace."),t.next=19;break;case 18:throw t.t0;case 19:if(n){t.next=23;break}return t.next=22,this.handlePKCEForAuthenticate(this._pkceManager,e);case 22:n=t.sent;case 23:return n.member_session?this._subscriptionService.updateStateAndTokens({state:{session:n.member_session,member:n.member,organization:n.organization},session_token:n.session_token,session_jwt:n.session_jwt,intermediate_session_token:null}):this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:n.intermediate_session_token}),t.abrupt("return",n);case 25:case"end":return t.stop()}}),t,this,[[6,12]])})))},this.discovery={authenticate:function(e){return ne(s,0,void 0,L().mark((function t(){var r,n,i,s,o,a;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.magicLinks.discovery.authenticate").isString("discovery_magic_links_token",e.discovery_magic_links_token),t.next=3,this._pkceManager.getPKPair();case 3:return r=t.sent,t.next=6,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 6:return n=t.sent,i=n.dfp_telemetry_id,s=n.captcha_token,o=Object.assign({pkce_code_verifier:null==r?void 0:r.code_verifier,dfp_telemetry_id:i,captcha_token:s},e),t.next=12,this._networkClient.retriableFetchSDK({url:"/b2b/magic_links/discovery/authenticate",body:o,errorMessage:"Failed to authenticate intermediate magic link token",method:"POST",retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP});case 12:return a=t.sent,this._pkceManager.clearPKPair(),this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:a.intermediate_session_token}),t.abrupt("return",a);case 16:case"end":return t.stop()}}),t,this)})))}}}return N(e,[{key:"getCodeChallenge",value:function(){return ne(this,0,void 0,L().mark((function e(){var t,r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._config;case 2:if(t=e.sent,t.pkceRequiredForEmailMagicLinks){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.next=8,this._pkceManager.getPKPair();case 8:if(!(r=e.sent)){e.next=11;break}return e.abrupt("return",r.code_challenge);case 11:return e.next=13,this._pkceManager.startPKCETransaction();case 13:return r=e.sent,e.abrupt("return",r.code_challenge);case 15:case"end":return e.stop()}}),e,this)})))}},{key:"handlePKCEForAuthenticate",value:function(e,t){return ne(this,0,void 0,L().mark((function r(){var n,i,s,o,a,c;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.getPKPair();case 2:return n=r.sent,r.next=5,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 5:return i=r.sent,s=i.dfp_telemetry_id,o=i.captcha_token,r.t0=Object,r.t1=null==n?void 0:n.code_verifier,r.t2=s,r.t3=o,r.next=14,this._subscriptionService.getIntermediateSessionToken();case 14:if(r.t4=r.sent,r.t4){r.next=17;break}r.t4=void 0;case 17:return r.t5=r.t4,r.t6={pkce_code_verifier:r.t1,dfp_telemetry_id:r.t2,captcha_token:r.t3,intermediate_session_token:r.t5},r.t7=t,a=r.t0.assign.call(r.t0,r.t6,r.t7),r.next=23,this._networkClient.retriableFetchSDK({url:"/b2b/magic_links/authenticate",body:a,errorMessage:"Failed to authenticate token",method:"POST",retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP});case 23:return c=r.sent,e.clearPKPair(),r.abrupt("return",c);case 26:case"end":return r.stop()}}),r,this)})))}}]),e}(),Ke=N((function e(t,r){var n=this;W(this,e),this._networkClient=t,this._subscriptionService=r,this.get=function(){return ne(n,0,void 0,L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._networkClient.fetchSDK({url:"/b2b/organizations/members/me",errorMessage:"Failed to retrieve member info.",method:"GET"});case 2:return t=e.sent,this._subscriptionService.updateMember(t.member),e.abrupt("return",t.member);case 5:case"end":return e.stop()}}),e,this)})))},this.getSync=function(){return n._subscriptionService.getMember()},this.getInfo=function(){return{member:n.getSync(),fromCache:n._subscriptionService.getFromCache()}},this.onChange=function(e){return n._subscriptionService.subscribeToState((function(t){var r;return e(null!==(r=null==t?void 0:t.member)&&void 0!==r?r:null)}))},this.update=function(e){return ne(n,0,void 0,L().mark((function t(){var r;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.self.update").isOptionalString("name",e.name).isOptionalObject("untrusted_metadata",e.untrusted_metadata).isOptionalBoolean("mfa_enrolled",e.mfa_enrolled).isOptionalString("mfa_phone_number",e.mfa_phone_number).isOptionalString("default_mfa_method",e.default_mfa_method),t.next=3,this._networkClient.fetchSDK({url:"/b2b/organizations/members/update",body:e,errorMessage:"Failed to update member.",method:"PUT"});case 3:return r=t.sent,this._subscriptionService.updateMember(r.member),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)})))},this.deleteMFAPhoneNumber=function(){return ne(n,0,void 0,L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._networkClient.fetchSDK({url:"/b2b/organizations/members/deletePhoneNumber",errorMessage:"Failed to delete member phone number.",method:"DELETE"});case 2:return t=e.sent,this._subscriptionService.updateMember(t.member),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))},this.deleteMFATOTP=function(){return ne(n,0,void 0,L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._networkClient.fetchSDK({url:"/b2b/organizations/members/deleteTOTP",errorMessage:"Failed to delete member totp.",method:"DELETE"});case 2:return t=e.sent,this._subscriptionService.updateMember(t.member),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))},this.deletePassword=function(e){return ne(n,0,void 0,L().mark((function t(){var r;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._networkClient.fetchSDK({url:"/b2b/organizations/members/passwords/".concat(e),errorMessage:"Failed to delete member password.",method:"DELETE"});case 2:return r=t.sent,this._subscriptionService.updateMember(r.member),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)})))}})),Le=function(){function e(t,r,n,i,s){var o=this,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:De();W(this,e),this._networkClient=t,this._subscriptionService=r,this._pkceManager=n,this._dynamicConfig=i,this._config=s,this.dfpProtectedAuth=a,this.saml={createConnection:function(e){return ne(o,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._networkClient.fetchSDK({url:"/b2b/sso/saml",method:"POST",body:e,errorMessage:"Failed to create SAML Connection."});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},updateConnection:function(e){return ne(o,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._networkClient.fetchSDK({url:"/b2b/sso/saml/".concat(e.connection_id),method:"PUT",body:e,errorMessage:"Failed to update SAML Connection."});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},updateConnectionByURL:function(e){return ne(o,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._networkClient.fetchSDK({url:"/b2b/sso/saml/".concat(e.connection_id,"/url"),method:"PUT",body:e,errorMessage:"Failed to update SAML Connection."});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},deleteVerificationCertificate:function(e){return ne(o,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._networkClient.fetchSDK({url:"/b2b/sso/saml/".concat(e.connection_id,"/verification_certificates/").concat(e.certificate_id),method:"DELETE",errorMessage:"Failed to delete SAML Verification Certificate."});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},this.oidc={createConnection:function(e){return ne(o,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._networkClient.fetchSDK({url:"/b2b/sso/oidc",method:"POST",body:e,errorMessage:"Failed to create OIDC Connection."});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))},updateConnection:function(e){return ne(o,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._networkClient.fetchSDK({url:"/b2b/sso/oidc/".concat(e.connection_id),method:"PUT",body:e,errorMessage:"Failed to update OIDC Connection."});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}}}return N(e,[{key:"authenticate",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i,s,o;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.sso.authenticate").isString("sso_token",e.sso_token).isNumber("session_duration_minutes",e.session_duration_minutes).isOptionalString("locale",e.locale),t.next=3,this._pkceManager.getPKPair();case 3:return(r=t.sent)||ke.warn("No code verifier found in local storage for SSO flow.\nConsider using stytch.sso.start() to add PKCE to your SSO flows for added security.\nSee https://stytch.com/docs/oauth#guides_pkce for more information."),t.next=7,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 7:return n=t.sent,i=n.dfp_telemetry_id,s=n.captcha_token,t.t0=this._networkClient,t.t1=Object,t.t2=Object.assign({pkce_code_verifier:null==r?void 0:r.code_verifier},e),t.t3=i,t.t4=s,t.next=17,this._subscriptionService.getIntermediateSessionToken();case 17:if(t.t5=t.sent,t.t5){t.next=20;break}t.t5=void 0;case 20:return t.t6=t.t5,t.t7={dfp_telemetry_id:t.t3,captcha_token:t.t4,intermediate_session_token:t.t6},t.t8=t.t1.assign.call(t.t1,t.t2,t.t7),t.t9=this.dfpProtectedAuth.retryWithCaptchaAndDFP,t.t10={url:"/b2b/sso/authenticate",method:"POST",body:t.t8,errorMessage:"Failed to authenticate token",retryCallback:t.t9},t.next=27,t.t0.retriableFetchSDK.call(t.t0,t.t10);case 27:return o=t.sent,this._pkceManager.clearPKPair(),o.member_session?this._subscriptionService.updateStateAndTokens({state:{session:o.member_session,member:o.member,organization:o.organization},session_token:o.session_token,session_jwt:o.session_jwt,intermediate_session_token:null}):this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:o.intermediate_session_token}),t.abrupt("return",o);case 31:case"end":return t.stop()}}),t,this)})))}},{key:"getBaseApiUrl",value:function(){return ne(this,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!xe(this._config.publicToken)){e.next=2;break}return e.abrupt("return",this._config.testAPIURL);case 2:return e.abrupt("return",this._config.liveAPIURL);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"start",value:function(e){var t=e.connection_id,r=e.login_redirect_url,n=e.signup_redirect_url;return ne(this,0,void 0,L().mark((function e(){var i,s,o,a,c;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._dynamicConfig;case 2:return i=e.sent,s=i.pkceRequiredForSso,e.next=6,this.getBaseApiUrl();case 6:if(o=e.sent,(a=new URL("".concat(o,"/v1/public/sso/start"))).searchParams.set("public_token",this._config.publicToken),a.searchParams.set("connection_id",t),!s){e.next=17;break}return e.next=13,this._pkceManager.startPKCETransaction();case 13:c=e.sent,a.searchParams.set("pkce_code_challenge",c.code_challenge),e.next=18;break;case 17:this._pkceManager.clearPKPair();case 18:r&&a.searchParams.set("login_redirect_url",r),n&&a.searchParams.set("signup_redirect_url",n),window.location.href=a.toString();case 21:case"end":return e.stop()}}),e,this)})))}},{key:"getConnections",value:function(){return ne(this,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._networkClient.fetchSDK({url:"/b2b/sso",method:"GET",errorMessage:"Failed to get SSO Connections."});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"deleteConnection",value:function(e){return ne(this,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/sso/".concat(e),method:"DELETE",errorMessage:"Failed to delete SSO Connection."}));case 1:case"end":return t.stop()}}),t,this)})))}}]),e}(),ze=function(){function e(t,r){W(this,e),this._networkClient=t,this._subscriptionService=r}return N(e,[{key:"createConnection",value:function(e){return ne(this,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.scim.createConnection").isOptionalString("display_name",e.display_name).isOptionalString("identity_provider",e.identity_provider),t.next=3,this._networkClient.fetchSDK({url:"/b2b/scim",method:"POST",body:e,errorMessage:"Failed to create SCIM Connection."});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"updateConnection",value:function(e){return ne(this,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.scim.updateConnection").isString("connection_id",e.connection_id).isOptionalString("display_name",e.display_name).isOptionalString("identity_provider",e.identity_provider),t.next=3,this._networkClient.fetchSDK({url:"/b2b/scim/".concat(e.connection_id),method:"PUT",body:e,errorMessage:"Failed to update SCIM Connection."});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"deleteConnection",value:function(e){return ne(this,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.scim.deleteConnection").isString("connection_id",e),t.next=3,this._networkClient.fetchSDK({url:"/b2b/scim/".concat(e),method:"DELETE",errorMessage:"Failed to delete SCIM Connection."});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getConnection",value:function(){return ne(this,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._networkClient.fetchSDK({url:"/b2b/scim",method:"GET",errorMessage:"Failed to get SCIM Connection."});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})))}},{key:"getConnectionGroups",value:function(e){return ne(this,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.scim.getConnectionGroups").isOptionalNumber("limit",e.limit).isOptionalString("cursor",e.cursor),t.next=3,this._networkClient.fetchSDK({url:"/b2b/scim/groups",method:"POST",body:e,errorMessage:"Failed to get SCIM Connection groups."});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"rotateStart",value:function(e){return ne(this,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.scim.rotateStart").isString("connectionId",e),t.next=3,this._networkClient.fetchSDK({url:"/b2b/scim/rotate/start",method:"POST",errorMessage:"Failed to start SCIM token rotation."});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"rotateComplete",value:function(e){return ne(this,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.scim.rotateComplete").isString("connectionId",e),t.next=3,this._networkClient.fetchSDK({url:"/b2b/scim/rotate/complete",method:"POST",errorMessage:"Failed to complete SCIM token rotation."});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"rotateCancel",value:function(e){return ne(this,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.scim.rotateCancel").isString("connectionId",e),t.next=3,this._networkClient.fetchSDK({url:"/b2b/scim/rotate/cancel",method:"POST",errorMessage:"Failed to cancel SCIM token rotation."});case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)})))}}]),e}(),Ne=N((function e(t,r){var n=this;W(this,e),this._networkClient=t,this._subscriptionService=r,this.get=function(){return ne(n,0,void 0,L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._networkClient.fetchSDK({url:"/b2b/organizations/me",errorMessage:"Failed to retrieve organization info.",method:"GET"});case 2:return t=e.sent,this._subscriptionService.updateOrganization(t.organization),e.abrupt("return",t.organization);case 5:case"end":return e.stop()}}),e,this)})))},this.getSync=function(){return n._subscriptionService.getOrganization()},this.getInfo=function(){return{organization:n.getSync(),fromCache:n._subscriptionService.getFromCache()}},this.onChange=function(e){return n._subscriptionService.subscribeToState((function(t){var r;return e(null!==(r=null==t?void 0:t.organization)&&void 0!==r?r:null)}))},this.update=function(e){return ne(n,0,void 0,L().mark((function t(){var r;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._networkClient.fetchSDK({url:"/b2b/organizations/me",errorMessage:"Failed to update organization info.",method:"PUT",body:e});case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)})))},this.delete=function(){return ne(n,0,void 0,L().mark((function e(){var t;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._networkClient.fetchSDK({url:"/b2b/organizations/me",errorMessage:"Failed to delete organization.",method:"DELETE"});case 2:return t=e.sent,this._subscriptionService.destroyState(),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})))},this.getBySlug=function(e){return ne(n,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.organization.getBySlug").isString("organization_slug",e.organization_slug),t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/organizations/search",errorMessage:"Failed to get organization by slug.",method:"POST",body:e}));case 2:case"end":return t.stop()}}),t,this)})))},this.members={create:function(e){return ne(n,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/organizations/members",errorMessage:"Failed to create member.",method:"POST",body:e}));case 1:case"end":return t.stop()}}),t,this)})))},search:function(e){return ne(n,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/organizations/me/members/search",errorMessage:"Failed to search members.",method:"POST",body:e}));case 1:case"end":return t.stop()}}),t,this)})))},update:function(e){return ne(n,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/organizations/members/".concat(e.member_id),errorMessage:"Failed to update member.",method:"PUT",body:e}));case 1:case"end":return t.stop()}}),t,this)})))},deletePassword:function(e){return ne(n,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/organizations/members/passwords/".concat(e),errorMessage:"Failed to delete member password.",method:"DELETE"}));case 1:case"end":return t.stop()}}),t,this)})))},deleteMFAPhoneNumber:function(e){return ne(n,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/organizations/members/mfa_phone_numbers/".concat(e),errorMessage:"Failed to delete member MFA Phone number.",method:"DELETE"}));case 1:case"end":return t.stop()}}),t,this)})))},deleteMFATOTP:function(e){return ne(n,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/organizations/members/totp/".concat(e),errorMessage:"Failed to delete member totp.",method:"DELETE"}));case 1:case"end":return t.stop()}}),t,this)})))},delete:function(e){return ne(n,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/organizations/members/".concat(e),errorMessage:"Failed to delete member.",method:"DELETE"}));case 1:case"end":return t.stop()}}),t,this)})))},reactivate:function(e){return ne(n,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/organizations/members/".concat(e,"/reactivate"),errorMessage:"Failed to reactivate member.",method:"PUT"}));case 1:case"end":return t.stop()}}),t,this)})))}}})),Ue=function(){function e(t,r,n,i,s){var o=this,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:De();W(this,e),this._networkClient=t,this._subscriptionService=r,this._pkceManager=n,this._dynamicConfig=i,this._config=s,this.dfpProtectedAuth=a,this.discovery={authenticate:function(e){return ne(o,0,void 0,L().mark((function t(){var r,n,i,s,o,a;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.oauth.discovery.authenticate").isString("discovery_oauth_token",e.discovery_oauth_token),t.next=3,this._pkceManager.getPKPair();case 3:return r=t.sent,t.next=6,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 6:return n=t.sent,i=n.dfp_telemetry_id,s=n.captcha_token,o=Object.assign({pkce_code_verifier:null==r?void 0:r.code_verifier,dfp_telemetry_id:i,captcha_token:s},e),t.next=12,this._networkClient.retriableFetchSDK({url:"/b2b/oauth/discovery/authenticate",body:o,errorMessage:"Failed to authenticate discovery oauth token",method:"POST",retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP});case 12:return a=t.sent,this._pkceManager.clearPKPair(),this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:a.intermediate_session_token}),t.abrupt("return",a);case 16:case"end":return t.stop()}}),t,this)})))}},this.google={start:this.startOAuthFlow(C.Google),discovery:{start:this.startDiscoveryOAuthFlow(C.Google)}},this.microsoft={start:this.startOAuthFlow(C.Microsoft),discovery:{start:this.startDiscoveryOAuthFlow(C.Microsoft)}}}return N(e,[{key:"authenticate",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i,s,o;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.oauth.authenticate").isString("oauth_token",e.oauth_token).isNumber("session_duration_minutes",e.session_duration_minutes).isOptionalString("locale",e.locale),t.next=3,this._pkceManager.getPKPair();case 3:return(r=t.sent)||ke.warn("No code verifier found in local storage for OAuth flow.\nConsider using stytch.oauth.$provider.start() to add PKCE to your OAuth flows for added security.\nSee https://stytch.com/docs/oauth#guides_pkce for more information."),t.next=7,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 7:return n=t.sent,i=n.dfp_telemetry_id,s=n.captcha_token,t.t0=this._networkClient,t.t1=Object,t.t2=null==r?void 0:r.code_verifier,t.t3=i,t.t4=s,t.next=17,this._subscriptionService.getIntermediateSessionToken();case 17:if(t.t5=t.sent,t.t5){t.next=20;break}t.t5=void 0;case 20:return t.t6=t.t5,t.t7={pkce_code_verifier:t.t2,dfp_telemetry_id:t.t3,captcha_token:t.t4,intermediate_session_token:t.t6},t.t8=e,t.t9=t.t1.assign.call(t.t1,t.t7,t.t8),t.t10=this.dfpProtectedAuth.retryWithCaptchaAndDFP,t.t11={url:"/b2b/oauth/authenticate",method:"POST",body:t.t9,errorMessage:"Failed to authenticate token",retryCallback:t.t10},t.next=28,t.t0.retriableFetchSDK.call(t.t0,t.t11);case 28:return o=t.sent,this._pkceManager.clearPKPair(),o.member_session?this._subscriptionService.updateStateAndTokens({state:{session:o.member_session,member:o.member,organization:o.organization},session_token:o.session_token,session_jwt:o.session_jwt,intermediate_session_token:null}):this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:o.intermediate_session_token}),t.abrupt("return",o);case 32:case"end":return t.stop()}}),t,this)})))}},{key:"getBaseApiUrl",value:function(){return ne(this,0,void 0,L().mark((function e(){var t,r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._dynamicConfig;case 2:if(t=e.sent,!(r=t.cnameDomain)){e.next=6;break}return e.abrupt("return","https://".concat(r));case 6:if(!xe(this._config.publicToken)){e.next=8;break}return e.abrupt("return",this._config.testAPIURL);case 8:return e.abrupt("return",this._config.liveAPIURL);case 9:case"end":return e.stop()}}),e,this)})))}},{key:"startOAuthFlow",value:function(e){var t=this;return function(r){var n=r.organization_id,i=r.organization_slug,s=r.login_redirect_url,o=r.signup_redirect_url,a=r.custom_scopes,c=r.provider_params;return ne(t,0,void 0,L().mark((function t(){var r,u,d,l,h,p;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._dynamicConfig;case 2:return r=t.sent,u=r.pkceRequiredForOAuth,t.next=6,this.getBaseApiUrl();case 6:if(d=t.sent,(l=new URL("".concat(d,"/v1/b2b/public/oauth/").concat(e,"/start"))).searchParams.set("public_token",this._config.publicToken),n&&""!=n&&l.searchParams.set("organization_id",n),i&&""!=i&&l.searchParams.set("slug",i),a&&(Te("startOAuthFlow").isStringArray("custom_scopes",a),l.searchParams.set("custom_scopes",a.join(" "))),c)for(h in Te("startOAuthFlow").isOptionalObject("provider_params",c),c)l.searchParams.set("provider_"+h,c[h]);if(!u){t.next=20;break}return t.next=16,this._pkceManager.startPKCETransaction();case 16:p=t.sent,l.searchParams.set("pkce_code_challenge",p.code_challenge),t.next=21;break;case 20:this._pkceManager.clearPKPair();case 21:s&&l.searchParams.set("login_redirect_url",s),o&&l.searchParams.set("signup_redirect_url",o),window.location.href=l.toString();case 24:case"end":return t.stop()}}),t,this)})))}}},{key:"startDiscoveryOAuthFlow",value:function(e){var t=this;return function(r){var n=r.discovery_redirect_url,i=r.custom_scopes,s=r.provider_params;return ne(t,0,void 0,L().mark((function t(){var r,o,a,c,u,d;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._dynamicConfig;case 2:return r=t.sent,o=r.pkceRequiredForOAuth,t.next=6,this.getBaseApiUrl();case 6:if(a=t.sent,(c=new URL("".concat(a,"/v1/b2b/public/oauth/").concat(e,"/discovery/start"))).searchParams.set("public_token",this._config.publicToken),i&&(Te("startOAuthFlow").isStringArray("custom_scopes",i),c.searchParams.set("custom_scopes",i.join(" "))),s)for(u in Te("startOAuthFlow").isOptionalObject("provider_params",s),s)c.searchParams.set("provider_"+u,s[u]);if(!o){t.next=18;break}return t.next=14,this._pkceManager.startPKCETransaction();case 14:d=t.sent,c.searchParams.set("pkce_code_challenge",d.code_challenge),t.next=19;break;case 18:this._pkceManager.clearPKPair();case 19:n&&c.searchParams.set("discovery_redirect_url",n),window.location.href=c.toString();case 21:case"end":return t.stop()}}),t,this)})))}}}]),e}(),We=function(){function e(t,r){var n=this;W(this,e),this._networkClient=t,this._subscriptionService=r,this.getSync=function(){return n._subscriptionService.getSession()},this.getInfo=function(){return{session:n.getSync(),fromCache:n._subscriptionService.getFromCache()}},this.onChange=function(e){return n._subscriptionService.subscribeToState((function(t){var r;return e(null!==(r=null==t?void 0:t.session)&&void 0!==r?r:null)}))},this.revoke=function(e){return ne(n,0,void 0,L().mark((function t(){var r;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._networkClient.fetchSDK({url:"/b2b/sessions/revoke",errorMessage:"Error revoking session",method:"POST"});case 3:return r=t.sent,this._subscriptionService.destroyState(),t.abrupt("return",r);case 8:throw t.prev=8,t.t0=t.catch(0),((null==e?void 0:e.forceClear)||D.includes(t.t0.error_type))&&this._subscriptionService.destroyState(),t.t0;case 12:case"end":return t.stop()}}),t,this,[[0,8]])})))},this.authenticate=function(e){return ne(n,0,void 0,L().mark((function t(){var r,n,i,s,o=this;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._subscriptionService.getSession(),n=function(){var e;return(null==r?void 0:r.member_session_id)!==(null===(e=o._subscriptionService.getSession())||void 0===e?void 0:e.member_session_id)},t.prev=2,i={session_duration_minutes:null==e?void 0:e.session_duration_minutes},t.next=6,this._networkClient.fetchSDK({url:"/b2b/sessions/authenticate",body:i,errorMessage:"Error authenticating session",method:"POST"});case 6:if(s=t.sent,!n()){t.next=9;break}return t.abrupt("return",this.authenticate(e));case 9:return this._subscriptionService.updateStateAndTokens({state:{session:s.member_session,member:s.member,organization:s.organization},session_token:s.session_token,session_jwt:s.session_jwt,intermediate_session_token:null}),t.abrupt("return",s);case 13:if(t.prev=13,t.t0=t.catch(2),!n()){t.next=17;break}return t.abrupt("return",this.authenticate(e));case 17:throw D.includes(t.t0.error_type)&&this._subscriptionService.destroySession(),t.t0;case 19:case"end":return t.stop()}}),t,this,[[2,13]])})))},this.exchange=function(e){return ne(n,0,void 0,L().mark((function t(){var r;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.sessions.exchange").isString("organization_id",e.organization_id).isNumber("session_duration_minutes",e.session_duration_minutes).isOptionalString("locale",e.locale),t.prev=1,t.next=4,this._networkClient.fetchSDK({url:"/b2b/sessions/exchange",body:e,errorMessage:"Failed to exchange session",method:"POST"});case 4:return(r=t.sent).member_session?this._subscriptionService.updateStateAndTokens({state:{session:r.member_session,member:r.member,organization:r.organization},session_token:r.session_token,session_jwt:r.session_jwt,intermediate_session_token:null}):this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:r.intermediate_session_token}),t.abrupt("return",r);case 9:throw t.prev=9,t.t0=t.catch(1),t.t0;case 12:case"end":return t.stop()}}),t,this,[[1,9]])})))}}return N(e,[{key:"getTokens",value:function(){return this._subscriptionService.getTokens()}},{key:"updateSession",value:function(e){var t;Te("stytch.sessions.updateSession").isString("session_token",e.session_token).isOptionalString("session_jwt",null!==(t=e.session_jwt)&&void 0!==t?t:void 0),this._subscriptionService.updateTokens(e)}}]),e}(),Ge=N((function e(t,r){var n=this;W(this,e),this._networkClient=t,this._subscriptionService=r,this.organizations={list:function(){return ne(n,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this._networkClient,e.next=3,this._subscriptionService.getIntermediateSessionToken();case 3:if(e.t1=e.sent,e.t1){e.next=6;break}e.t1=void 0;case 6:return e.t2=e.t1,e.t3={intermediate_session_token:e.t2},e.t4={url:"/b2b/discovery/organizations",body:e.t3,errorMessage:"Failed to retrieve discovered organizations",method:"POST"},e.abrupt("return",e.t0.fetchSDK.call(e.t0,e.t4));case 10:case"end":return e.stop()}}),e,this)})))},create:function(e){return ne(n,0,void 0,L().mark((function t(){var r,n;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.discovery.organizations.create").isNumber("session_duration_minutes",e.session_duration_minutes).isOptionalString("organization_name",e.organization_name).isOptionalString("organization_slug",e.organization_slug).isOptionalString("organization_logo_url",e.organization_logo_url).isOptionalString("sso_jit_provisioning",e.sso_jit_provisioning).isOptionalStringArray("email_allowed_domains",e.email_allowed_domains).isOptionalString("email_invites",e.email_invites).isOptionalString("auth_methods",e.auth_methods).isOptionalStringArray("allowed_auth_methods",e.allowed_auth_methods).isOptionalString("mfa_policy",e.mfa_policy),t.t0=Object,t.t1=Object.assign({},e),t.next=5,this._subscriptionService.getIntermediateSessionToken();case 5:if(t.t2=t.sent,t.t2){t.next=8;break}t.t2=void 0;case 8:return t.t3=t.t2,t.t4={intermediate_session_token:t.t3},r=t.t0.assign.call(t.t0,t.t1,t.t4),t.next=13,this._networkClient.fetchSDK({url:"/b2b/discovery/organizations/create",body:r,errorMessage:"Failed to create organization and member",method:"POST"});case 13:return(n=t.sent).member_session?this._subscriptionService.updateStateAndTokens({state:{session:n.member_session,member:n.member,organization:n.organization},session_token:n.session_token,session_jwt:n.session_jwt,intermediate_session_token:null}):this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:n.intermediate_session_token}),t.abrupt("return",n);case 16:case"end":return t.stop()}}),t,this)})))}},this.intermediateSessions={exchange:function(e){return ne(n,0,void 0,L().mark((function t(){var r,n;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.discovery.intermediateSessions.exchange").isString("organization_id",e.organization_id).isNumber("session_duration_minutes",e.session_duration_minutes).isOptionalString("locale",e.locale),t.t0=Object,t.t1=Object.assign({},e),t.next=5,this._subscriptionService.getIntermediateSessionToken();case 5:if(t.t2=t.sent,t.t2){t.next=8;break}t.t2=void 0;case 8:return t.t3=t.t2,t.t4={intermediate_session_token:t.t3},r=t.t0.assign.call(t.t0,t.t1,t.t4),t.next=13,this._networkClient.fetchSDK({url:"/b2b/discovery/intermediate_sessions/exchange",body:r,errorMessage:"Failed to exchange intermediate session",method:"POST"});case 13:return(n=t.sent).member_session?this._subscriptionService.updateStateAndTokens({state:{session:n.member_session,member:n.member,organization:n.organization},session_token:n.session_token,session_jwt:n.session_jwt,intermediate_session_token:null}):this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:n.intermediate_session_token}),t.abrupt("return",n);case 16:case"end":return t.stop()}}),t,this)})))}}})),He=Promise.resolve({pkceRequiredForPasswordResets:!1}),qe=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:He,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:De();W(this,e),this._networkClient=t,this._subscriptionService=r,this._pkceManager=n,this._config=i,this.dfpProtectedAuth=s}return N(e,[{key:"getCodeChallenge",value:function(){return ne(this,0,void 0,L().mark((function e(){var t,r;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._config;case 2:if(t=e.sent,t.pkceRequiredForPasswordResets){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.next=8,this._pkceManager.getPKPair();case 8:if(!(r=e.sent)){e.next=11;break}return e.abrupt("return",r.code_challenge);case 11:return e.next=13,this._pkceManager.startPKCETransaction();case 13:return r=e.sent,e.abrupt("return",r.code_challenge);case 15:case"end":return e.stop()}}),e,this)})))}},{key:"authenticate",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i,s,o,a;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.passwords.authenticate").isString("org_id",e.organization_id).isString("password",e.password).isString("email_address",e.email_address).isNumber("session_duration_minutes",e.session_duration_minutes).isOptionalString("locale",e.locale),t.next=3,this._pkceManager.getPKPair();case 3:return r=t.sent,n=null==r?void 0:r.code_verifier,t.next=7,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 7:return i=t.sent,s=i.dfp_telemetry_id,o=i.captcha_token,t.t0=this._networkClient,t.t1=e.organization_id,t.t2=e.email_address,t.t3=e.password,t.t4=e.session_duration_minutes,t.t5=e.locale,t.t6=o,t.t7=s,t.t8=n,t.next=21,this._subscriptionService.getIntermediateSessionToken();case 21:if(t.t9=t.sent,t.t9){t.next=24;break}t.t9=void 0;case 24:return t.t10=t.t9,t.t11={organization_id:t.t1,email_address:t.t2,password:t.t3,session_duration_minutes:t.t4,locale:t.t5,captcha_token:t.t6,dfp_telemetry_id:t.t7,code_verifier:t.t8,intermediate_session_token:t.t10},t.t12=this.dfpProtectedAuth.retryWithCaptchaAndDFP,t.t13={url:"/b2b/passwords/authenticate",method:"POST",errorMessage:"Failed to authenticate password.",body:t.t11,retryCallback:t.t12},t.next=30,t.t0.retriableFetchSDK.call(t.t0,t.t13);case 30:return(a=t.sent).member_session?this._subscriptionService.updateStateAndTokens({state:{session:a.member_session,member:a.member,organization:a.organization},session_token:a.session_token,session_jwt:a.session_jwt,intermediate_session_token:null}):this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:a.intermediate_session_token}),t.abrupt("return",a);case 33:case"end":return t.stop()}}),t,this)})))}},{key:"resetByEmailStart",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i,s;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.passwords.resetByEmailStart").isString("email",e.email_address).isOptionalString("login_redirect_url",e.login_redirect_url).isOptionalString("reset_password_redirect_url",e.reset_password_redirect_url).isOptionalString("reset_password_template_id",e.reset_password_template_id).isOptionalNumber("reset_password_expiration_minutes",e.reset_password_expiration_minutes),t.next=3,this.getCodeChallenge();case 3:return r=t.sent,t.next=6,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 6:return n=t.sent,i=n.dfp_telemetry_id,s=n.captcha_token,t.abrupt("return",this._networkClient.retriableFetchSDK({url:"/b2b/passwords/email/reset/start",method:"POST",errorMessage:"Failed to start password reset flow.",body:{organization_id:e.organization_id,email_address:e.email_address,login_redirect_url:e.login_redirect_url,reset_password_redirect_url:e.reset_password_redirect_url,reset_password_expiration_minutes:e.reset_password_expiration_minutes,reset_password_template_id:e.reset_password_template_id,code_challenge:r,captcha_token:s,dfp_telemetry_id:i},retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP}));case 10:case"end":return t.stop()}}),t,this)})))}},{key:"resetByEmail",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i,s,o,a;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.passwords.resetByEmail").isString("password_reset_token",e.password_reset_token).isString("password",e.password).isNumber("session_duration_minutes",e.session_duration_minutes).isOptionalString("locale",e.locale),t.next=3,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 3:return r=t.sent,n=r.dfp_telemetry_id,i=r.captcha_token,t.next=8,this._pkceManager.getPKPair();case 8:return s=t.sent,o=null==s?void 0:s.code_verifier,t.t0=this._networkClient,t.t1=e.password_reset_token,t.t2=e.password,t.t3=e.session_duration_minutes,t.t4=e.locale,t.t5=i,t.t6=n,t.t7=o,t.next=20,this._subscriptionService.getIntermediateSessionToken();case 20:if(t.t8=t.sent,t.t8){t.next=23;break}t.t8=void 0;case 23:return t.t9=t.t8,t.t10={password_reset_token:t.t1,password:t.t2,session_duration_minutes:t.t3,locale:t.t4,captcha_token:t.t5,dfp_telemetry_id:t.t6,code_verifier:t.t7,intermediate_session_token:t.t9},t.t11=this.dfpProtectedAuth.retryWithCaptchaAndDFP,t.t12={url:"/b2b/passwords/email/reset",method:"POST",errorMessage:"Failed to reset password.",body:t.t10,retryCallback:t.t11},t.next=29,t.t0.retriableFetchSDK.call(t.t0,t.t12);case 29:return a=t.sent,this._pkceManager.clearPKPair(),a.member_session?this._subscriptionService.updateStateAndTokens({state:{session:a.member_session,member:a.member,organization:a.organization},session_token:a.session_token,session_jwt:a.session_jwt,intermediate_session_token:null}):this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:a.intermediate_session_token}),t.abrupt("return",a);case 33:case"end":return t.stop()}}),t,this)})))}},{key:"resetByExistingPassword",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i,s;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.passwords.resetByExistingPassword").isString("email",e.email_address).isString("existing_password",e.existing_password).isString("new_password",e.new_password).isOptionalString("locale",e.locale),t.next=3,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 3:return r=t.sent,n=r.dfp_telemetry_id,i=r.captcha_token,t.next=8,this._networkClient.retriableFetchSDK({url:"/b2b/passwords/existing_password/reset",method:"POST",errorMessage:"Failed to reset password.",body:{organization_id:e.organization_id,email_address:e.email_address,existing_password:e.existing_password,new_password:e.new_password,locale:e.locale,session_duration_minutes:e.session_duration_minutes,captcha_token:i,dfp_telemetry_id:n},retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP});case 8:return(s=t.sent).member_session?this._subscriptionService.updateStateAndTokens({state:{session:s.member_session,member:s.member,organization:s.organization},session_token:s.session_token,session_jwt:s.session_jwt,intermediate_session_token:null}):this._subscriptionService.updateStateAndTokens({state:null,session_token:null,session_jwt:null,intermediate_session_token:s.intermediate_session_token}),t.abrupt("return",s);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"resetBySession",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i,s;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.passwords.resetBySession").isString("password",e.password),t.next=3,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 3:return r=t.sent,n=r.dfp_telemetry_id,i=r.captcha_token,t.next=8,this._networkClient.retriableFetchSDK({url:"/b2b/passwords/session/reset",method:"POST",errorMessage:"Failed to reset by session.",body:{password:e.password,captcha_token:i,dfp_telemetry_id:n},retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP});case 8:return s=t.sent,this._subscriptionService.updateStateAndTokens({state:{session:s.member_session,member:s.member,organization:s.organization},session_token:s.session_token,session_jwt:s.session_jwt,intermediate_session_token:null}),t.abrupt("return",s);case 11:case"end":return t.stop()}}),t,this)})))}},{key:"strengthCheck",value:function(e){return ne(this,0,void 0,L().mark((function t(){return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.passwords.strengthCheck").isOptionalString("email",e.email_address).isString("password",e.password),t.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/passwords/strength_check",method:"POST",errorMessage:"Failed to check password strength.",body:{email_address:e.email_address,password:e.password}}));case 2:case"end":return t.stop()}}),t,this)})))}}]),e}(),Ye=N((function e(t,r){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De();W(this,e),this._networkClient=t,this._subscriptionService=r,this.dfpProtectedAuth=i,this.sms={send:function(e){return ne(n,0,void 0,L().mark((function t(){var r,n,i;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.otps.sms.send").isString("organization_id",e.organization_id).isString("member_id",e.member_id).isOptionalString("mfa_phone_number",e.mfa_phone_number).isOptionalString("locale",e.locale),t.next=3,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 3:return r=t.sent,n=r.dfp_telemetry_id,i=r.captcha_token,t.t0=this._networkClient,t.t1=Object,t.t2=Object.assign({},e),t.t3=n,t.t4=i,t.next=13,this._subscriptionService.getIntermediateSessionToken();case 13:if(t.t5=t.sent,t.t5){t.next=16;break}t.t5=void 0;case 16:return t.t6=t.t5,t.t7={dfp_telemetry_id:t.t3,captcha_token:t.t4,intermediate_session_token:t.t6},t.t8=t.t1.assign.call(t.t1,t.t2,t.t7),t.t9=this.dfpProtectedAuth.retryWithCaptchaAndDFP,t.t10={url:"/b2b/otps/sms/send",body:t.t8,errorMessage:"Failed to send one time passcode",method:"POST",retryCallback:t.t9},t.abrupt("return",t.t0.retriableFetchSDK.call(t.t0,t.t10));case 22:case"end":return t.stop()}}),t,this)})))},authenticate:function(e){return ne(n,0,void 0,L().mark((function t(){var r,n,i,s,o;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.otps.sms.authenticate").isString("organization_id",e.organization_id).isString("member_id",e.member_id).isString("code",e.code).isOptionalString("set_mfa_enrollment",e.set_mfa_enrollment),t.next=3,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 3:return r=t.sent,n=r.dfp_telemetry_id,i=r.captcha_token,t.t0=Object,t.t1=Object.assign({},e),t.t2=n,t.t3=i,t.next=12,this._subscriptionService.getIntermediateSessionToken();case 12:if(t.t4=t.sent,t.t4){t.next=15;break}t.t4=void 0;case 15:return t.t5=t.t4,t.t6={dfp_telemetry_id:t.t2,captcha_token:t.t3,intermediate_session_token:t.t5},s=t.t0.assign.call(t.t0,t.t1,t.t6),t.next=20,this._networkClient.retriableFetchSDK({url:"/b2b/otps/sms/authenticate",body:s,errorMessage:"Failed to authenticate one time passcode",method:"POST",retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP});case 20:return o=t.sent,this._subscriptionService.updateStateAndTokens({state:{session:o.member_session,member:o.member,organization:o.organization},session_token:o.session_token,session_jwt:o.session_jwt,intermediate_session_token:null}),t.abrupt("return",o);case 23:case"end":return t.stop()}}),t,this)})))}}})),Ve=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De();W(this,e),this._networkClient=t,this._subscriptionService=r,this.dfpProtectedAuth=n}return N(e,[{key:"create",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.totp.create").isString("organization_id",e.organization_id).isString("member_id",e.member_id).isOptionalNumber("expiration_minutes",e.expiration_minutes),t.next=3,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 3:return r=t.sent,n=r.dfp_telemetry_id,i=r.captcha_token,t.t0=this._networkClient,t.t1=Object,t.t2=Object.assign({},e),t.t3=n,t.t4=i,t.next=13,this._subscriptionService.getIntermediateSessionToken();case 13:if(t.t5=t.sent,t.t5){t.next=16;break}t.t5=void 0;case 16:return t.t6=t.t5,t.t7={dfp_telemetry_id:t.t3,captcha_token:t.t4,intermediate_session_token:t.t6},t.t8=t.t1.assign.call(t.t1,t.t2,t.t7),t.t9=this.dfpProtectedAuth.retryWithCaptchaAndDFP,t.t10={url:"/b2b/totp",body:t.t8,errorMessage:"Failed to create TOTP",method:"POST",retryCallback:t.t9},t.abrupt("return",t.t0.retriableFetchSDK.call(t.t0,t.t10));case 22:case"end":return t.stop()}}),t,this)})))}},{key:"authenticate",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i,s,o;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.totp.authenticate").isString("organization_id",e.organization_id).isString("member_id",e.member_id).isString("code",e.code).isOptionalString("set_mfa_enrollment",e.set_mfa_enrollment).isOptionalBoolean("set_default_mfa",e.set_default_mfa),t.next=3,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 3:return r=t.sent,n=r.dfp_telemetry_id,i=r.captcha_token,t.t0=Object,t.t1=Object.assign({},e),t.t2=n,t.t3=i,t.next=12,this._subscriptionService.getIntermediateSessionToken();case 12:if(t.t4=t.sent,t.t4){t.next=15;break}t.t4=void 0;case 15:return t.t5=t.t4,t.t6={dfp_telemetry_id:t.t2,captcha_token:t.t3,intermediate_session_token:t.t5},s=t.t0.assign.call(t.t0,t.t1,t.t6),t.next=20,this._networkClient.retriableFetchSDK({url:"/b2b/totp/authenticate",body:s,errorMessage:"Failed to authenticate TOTP",method:"POST",retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP});case 20:return o=t.sent,this._subscriptionService.updateStateAndTokens({state:{session:o.member_session,member:o.member,organization:o.organization},session_token:o.session_token,session_jwt:o.session_jwt,intermediate_session_token:null}),t.abrupt("return",o);case 23:case"end":return t.stop()}}),t,this)})))}}]),e}(),Je=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De();W(this,e),this._networkClient=t,this._subscriptionService=r,this.dfpProtectedAuth=n}return N(e,[{key:"recover",value:function(e){return ne(this,0,void 0,L().mark((function t(){var r,n,i,s,o;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Te("stytch.recoveryCodes.recover").isString("organization_id",e.organization_id).isString("member_id",e.member_id).isString("recovery_code",e.recovery_code),t.next=3,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 3:return r=t.sent,n=r.dfp_telemetry_id,i=r.captcha_token,t.t0=Object,t.t1=Object.assign({},e),t.t2=n,t.t3=i,t.next=12,this._subscriptionService.getIntermediateSessionToken();case 12:if(t.t4=t.sent,t.t4){t.next=15;break}t.t4=void 0;case 15:return t.t5=t.t4,t.t6={dfp_telemetry_id:t.t2,captcha_token:t.t3,intermediate_session_token:t.t5},s=t.t0.assign.call(t.t0,t.t1,t.t6),t.next=20,this._networkClient.retriableFetchSDK({url:"/b2b/recovery_codes/recover",body:s,errorMessage:"Failed to recover using recovery code",method:"POST",retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP});case 20:return o=t.sent,this._subscriptionService.updateStateAndTokens({state:{session:o.member_session,member:o.member,organization:o.organization},session_token:o.session_token,session_jwt:o.session_jwt,intermediate_session_token:null}),t.abrupt("return",o);case 23:case"end":return t.stop()}}),t,this)})))}},{key:"rotate",value:function(){return ne(this,0,void 0,L().mark((function e(){var t,r,n;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha();case 2:return t=e.sent,r=t.dfp_telemetry_id,n=t.captcha_token,e.abrupt("return",this._networkClient.retriableFetchSDK({url:"/b2b/recovery_codes/rotate",body:{dfp_telemetry_id:r,captcha_token:n},errorMessage:"Failed to rotate recovery codes",method:"POST",retryCallback:this.dfpProtectedAuth.retryWithCaptchaAndDFP}));case 6:case"end":return e.stop()}}),e,this)})))}},{key:"get",value:function(){return ne(this,0,void 0,L().mark((function e(){return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._networkClient.fetchSDK({url:"/b2b/recovery_codes",errorMessage:"Failed to get recovery codes",method:"GET"}));case 1:case"end":return e.stop()}}),e,this)})))}}]),e}(),Xe=function(){function e(t,r,n){var i=this;W(this,e),this._subscriptionService=n,this.isAuthorizedSync=function(e,t){var r;return!!(null===(r=i.cachedPolicy)||void 0===r?void 0:r.callerIsAuthorized(i.roleIds(),e,t))},this.isAuthorized=function(e,t){return i.policyPromise.then((function(r){return r.callerIsAuthorized(i.roleIds(),e,t)}))},this.cachedPolicy=t.rbacPolicy?tt.fromJSON(t.rbacPolicy):null,this.policyPromise=r.then((function(e){return e.rbacPolicy?(i.cachedPolicy=tt.fromJSON(e.rbacPolicy),i.cachedPolicy):(ke.error("Unable to retrieve RBAC policy from servers. Assuming caller has no permissions."),new tt([],[]))}))}return N(e,[{key:"allPermissions",value:function(){var e=this;return this.policyPromise.then((function(t){return t.allPermissionsForCaller(e.roleIds())}))}},{key:"roleIds",value:function(){var e,t=this._subscriptionService.getSession();return t&&null!==(e=t.roles)&&void 0!==e?e:[]}}]),e}(),$e=function(){function e(t){W(this,e),this.iframeURL=t,this.createIframe()}return N(e,[{key:"createIframe",value:function(){var e=document.querySelector('[src~="'.concat(this.iframeURL,'"]'));e?ke.warn("It looks like you're creating multiple copies of the Stytch client. This behavior is unsupported, and unintended side effects may occur. Make sure you are creating the Stytch client at the global level, and not inside a component's render function."):((e=document.createElement("iframe")).src=this.iframeURL,e.style.position="absolute",e.style.width="0",e.style.height="0",e.style.border="0",document.body.appendChild(e)),"true"!==e.dataset.loaded?this.frame=new Promise((function(t){e.addEventListener("load",(function(){e.dataset.loaded="true",t(e)}),{once:!0})})):this.frame=Promise.resolve(e)}},{key:"call",value:function(e,t){return ne(this,0,void 0,L().mark((function r(){var n,i,s=this;return L().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.frame;case 2:return n=r.sent,i=new MessageChannel,r.abrupt("return",new Promise((function(r,o){var a;i.port1.onmessage=function(e){var t=e.data;i.port1.close(),t.success?r(t.payload):o(Me.unmarshall(t.error))};var c={method:e,args:t};null===(a=n.contentWindow)||void 0===a||a.postMessage(c,s.iframeURL,[i.port2])})));case 5:case"end":return r.stop()}}),r,this)})))}}]),e}(),Ze=function(){function e(t,r){W(this,e),this._networkClient=t,this.dfpProtectedAuth=r}return N(e,[{key:"searchUser",value:function(e){var t=this;return this.dfpProtectedAuth.getDFPTelemetryIDAndCaptcha().then((function(r){var n=r.dfp_telemetry_id,i=r.captcha_token;return t._networkClient.fetchSDK({url:"/users/search",method:"POST",body:{email:e,dfp_telemetry_id:n,captcha_token:i},errorMessage:"Error searching for user ".concat(e)})}))}},{key:"searchMember",value:function(e,t){return this._networkClient.fetchSDK({url:"/b2b/organizations/members/search",method:"POST",body:{email_address:e,organization_id:t},errorMessage:"Error searching for member ".concat(e)})}}]),e}(),Qe=function(){function e(t,r){var n=this;W(this,e),this._subscriptionService=t,this._headlessSessionClient=r,this._onDataChange=function(e){!function(e){return!!(null==e?void 0:e.session)}(e)?n.cancelBackgroundRefresh():n.scheduleBackgroundRefresh()},this._reauthenticateWithBackoff=function(){return ne(n,0,void 0,L().mark((function t(){var r;return L().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:return t.prev=2,t.next=5,this._headlessSessionClient.authenticate();case 5:return t.abrupt("return",t.sent);case 8:if(t.prev=8,t.t0=t.catch(2),!e.isUnrecoverableError(t.t0)){t.next=12;break}return t.abrupt("return",Promise.reject(t.t0));case 12:return r++,t.next=15,new Promise((function(t){return setTimeout(t,e.timeoutForAttempt(r))}));case 15:t.next=1;break;case 17:case"end":return t.stop()}}),t,this,[[2,8]])})))},this.timeout=null,this._subscriptionService.subscribeToState(this._onDataChange)}return N(e,[{key:"performBackgroundRefresh",value:function(){var e=this;this._reauthenticateWithBackoff().then((function(){e.scheduleBackgroundRefresh()})).catch((function(t){ke.warn("Session background refresh failed. Signalling to app that user is logged out.",{error:t}),e._subscriptionService.destroySession()}))}},{key:"scheduleBackgroundRefresh",value:function(){var t=this;this.cancelBackgroundRefresh(),this.timeout=setTimeout((function(){t.performBackgroundRefresh()}),e.REFRESH_INTERVAL_MS)}},{key:"cancelBackgroundRefresh",value:function(){null!==this.timeout&&(clearTimeout(this.timeout),this.timeout=null)}}],[{key:"timeoutForAttempt",value:function(e){return e=Math.min(e,7),Math.floor(350*Math.random())-175+2e3*Math.pow(2,e)}},{key:"isUnrecoverableError",value:function(e){return D.includes(e.error_type)}}]),e}();Qe.REFRESH_INTERVAL_MS=18e4;var et=N((function e(t,r){var n=this;W(this,e),this._subscriptionService=t,this.emptyState=r,this.onStateChange=function(e){return n._subscriptionService.subscribeToState((function(t){e(null!=t?t:n.emptyState)}))}})),tt=function(){function e(t,r){var n=this;W(this,e),this.roles=t,this.resources=r,this.rolesByID={},t.forEach((function(e){return n.rolesByID[e.role_id]=e}))}return N(e,[{key:"callerIsAuthorized",value:function(e,t,r){var n=this;return!!e.map((function(e){return n.rolesByID[e]})).filter((function(e){return e})).flatMap((function(e){return e.permissions})).filter((function(e){return e.resource_id===t})).find((function(e){return e.actions.includes(r)||e.actions.includes("*")}))}},{key:"allPermissionsForCaller",value:function(e){var t=this,r={};return this.resources.forEach((function(n){r[n.resource_id]={},n.actions.forEach((function(i){r[n.resource_id][i]=t.callerIsAuthorized(e,n.resource_id,i)}))})),r}}],[{key:"fromJSON",value:function(t){return new e(t.roles,t.resources)}}]),e}();function rt(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;var nt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat("stytch_sdk_state_").concat(e).concat(t?"::".concat(t):"")},it=Symbol.for("stytch__internal_b2b"),st=function(e,t){Object.assign(e,h({},it,t))}}}]);
//# sourceMappingURL=vendors-b08b683e-3bc5944910fc6768.bundle.js.map