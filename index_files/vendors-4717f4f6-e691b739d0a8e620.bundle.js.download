/*! For license information please see vendors-4717f4f6-e691b739d0a8e620.bundle.js.LICENSE.txt */
!function(){try{var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},e=(new Error).stack;e&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[e]="98a8c6af-7f66-4ae7-a03d-bfb6c990e00a",t._sentryDebugIdIdentifier="sentry-dbid-98a8c6af-7f66-4ae7-a03d-bfb6c990e00a")}catch(t){}}();var _global="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};_global.SENTRY_RELEASE={id:"2d35608ac72a88a1862ab1667a4d7d397cfe0cce"},(self.webpackChunkdisco=self.webpackChunkdisco||[]).push([[4343],{727418:function(t){var e=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},s=0;s<10;s++)e["_"+String.fromCharCode(s)]=s;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,i){for(var r,o,a=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),c=1;c<arguments.length;c++){for(var h in r=Object(arguments[c]))s.call(r,h)&&(a[h]=r[h]);if(e){o=e(r);for(var u=0;u<o.length;u++)n.call(r,o[u])&&(a[o[u]]=r[o[u]])}}return a}},724244:function(t){var e=function(t){return t!=t};t.exports=function(t,s){return 0===t&&0===s?1/t==1/s:t===s||!(!e(t)||!e(s))}},420609:function(t,e,s){var n=s(404289),i=s(155559),r=s(724244),o=s(375624),a=s(152281),c=i(o(),Object);n(c,{getPolyfill:o,implementation:r,shim:a}),t.exports=c},375624:function(t,e,s){var n=s(724244);t.exports=function(){return"function"==typeof Object.is?Object.is:n}},152281:function(t,e,s){var n=s(375624),i=s(404289);t.exports=function(){var t=n();return i(Object,{is:t},{is:function(){return Object.is!==t}}),t}},618987:function(t,e,s){var n;if(!Object.keys){var i=Object.prototype.hasOwnProperty,r=Object.prototype.toString,o=s(21414),a=Object.prototype.propertyIsEnumerable,c=!a.call({toString:null},"toString"),h=a.call((function(){}),"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],l=function(t){var e=t.constructor;return e&&e.prototype===t},d={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var t in window)try{if(!d["$"+t]&&i.call(window,t)&&null!==window[t]&&"object"==typeof window[t])try{l(window[t])}catch(t){return!0}}catch(t){return!0}return!1}();n=function(t){var e=null!==t&&"object"==typeof t,s="[object Function]"===r.call(t),n=o(t),a=e&&"[object String]"===r.call(t),d=[];if(!e&&!s&&!n)throw new TypeError("Object.keys called on a non-object");var f=h&&s;if(a&&t.length>0&&!i.call(t,0))for(var g=0;g<t.length;++g)d.push(String(g));if(n&&t.length>0)for(var m=0;m<t.length;++m)d.push(String(m));else for(var y in t)f&&"prototype"===y||!i.call(t,y)||d.push(String(y));if(c)for(var b=function(t){if("undefined"==typeof window||!p)return l(t);try{return l(t)}catch(t){return!1}}(t),v=0;v<u.length;++v)b&&"constructor"===u[v]||!i.call(t,u[v])||d.push(u[v]);return d}}t.exports=n},482215:function(t,e,s){var n=Array.prototype.slice,i=s(21414),r=Object.keys,o=r?function(t){return r(t)}:s(618987),a=Object.keys;o.shim=function(){if(Object.keys){var t=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);t||(Object.keys=function(t){return i(t)?a(n.call(t)):a(t)})}else Object.keys=o;return Object.keys||o},t.exports=o},21414:function(t){var e=Object.prototype.toString;t.exports=function(t){var s=e.call(t),n="[object Arguments]"===s;return n||(n="[object Array]"!==s&&null!==t&&"object"==typeof t&&"number"==typeof t.length&&t.length>=0&&"[object Function]"===e.call(t.callee)),n}},774524:function(t,e,s){s.d(e,{ZP:function(){return yr}});var n=s(425108),i={},r=Uint8Array,o=Uint16Array,a=Int32Array,c=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),h=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),u=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(t,e){for(var s=new o(31),n=0;n<31;++n)s[n]=e+=1<<t[n-1];var i=new a(s[30]);for(n=1;n<30;++n)for(var r=s[n];r<s[n+1];++r)i[r]=r-s[n]<<5|n;return{b:s,r:i}},d=l(c,2),p=d.b,f=d.r;p[28]=258,f[258]=28;for(var g=l(h,0).r,m=new o(32768),y=0;y<32768;++y){var b=(43690&y)>>1|(21845&y)<<1;b=(61680&(b=(52428&b)>>2|(13107&b)<<2))>>4|(3855&b)<<4,m[y]=((65280&b)>>8|(255&b)<<8)>>1}var v=function(t,e,s){for(var n=t.length,i=0,r=new o(e);i<n;++i)t[i]&&++r[t[i]-1];var a,c=new o(e);for(i=1;i<e;++i)c[i]=c[i-1]+r[i-1]<<1;if(s){a=new o(1<<e);var h=15-e;for(i=0;i<n;++i)if(t[i])for(var u=i<<4|t[i],l=e-t[i],d=c[t[i]-1]++<<l,p=d|(1<<l)-1;d<=p;++d)a[m[d]>>h]=u}else for(a=new o(n),i=0;i<n;++i)t[i]&&(a[i]=m[c[t[i]-1]++]>>15-t[i]);return a},w=new r(288);for(y=0;y<144;++y)w[y]=8;for(y=144;y<256;++y)w[y]=9;for(y=256;y<280;++y)w[y]=7;for(y=280;y<288;++y)w[y]=8;var S=new r(32);for(y=0;y<32;++y)S[y]=5;var k=v(w,9,0),T=v(S,5,0),I=function(t){return(t+7)/8|0},x=function(t,e,s){return(null==e||e<0)&&(e=0),(null==s||s>t.length)&&(s=t.length),new r(t.subarray(e,s))},E=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],C=function(t,e,s){var n=new Error(e||E[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,C),!s)throw n;return n},_=function(t,e,s){s<<=7&e;var n=e/8|0;t[n]|=s,t[n+1]|=s>>8},O=function(t,e,s){s<<=7&e;var n=e/8|0;t[n]|=s,t[n+1]|=s>>8,t[n+2]|=s>>16},N=function(t,e){for(var s=[],n=0;n<t.length;++n)t[n]&&s.push({s:n,f:t[n]});var i=s.length,a=s.slice();if(!i)return{t:F,l:0};if(1==i){var c=new r(s[0].s+1);return c[s[0].s]=1,{t:c,l:1}}s.sort((function(t,e){return t.f-e.f})),s.push({s:-1,f:25001});var h=s[0],u=s[1],l=0,d=1,p=2;for(s[0]={s:-1,f:h.f+u.f,l:h,r:u};d!=i-1;)h=s[s[l].f<s[p].f?l++:p++],u=s[l!=d&&s[l].f<s[p].f?l++:p++],s[d++]={s:-1,f:h.f+u.f,l:h,r:u};var f=a[0].s;for(n=1;n<i;++n)a[n].s>f&&(f=a[n].s);var g=new o(f+1),m=R(s[d-1],g,0);if(m>e){n=0;var y=0,b=m-e,v=1<<b;for(a.sort((function(t,e){return g[e.s]-g[t.s]||t.f-e.f}));n<i;++n){var w=a[n].s;if(!(g[w]>e))break;y+=v-(1<<m-g[w]),g[w]=e}for(y>>=b;y>0;){var S=a[n].s;g[S]<e?y-=1<<e-g[S]++-1:++n}for(;n>=0&&y;--n){var k=a[n].s;g[k]==e&&(--g[k],++y)}m=e}return{t:new r(g),l:m}},R=function(t,e,s){return-1==t.s?Math.max(R(t.l,e,s+1),R(t.r,e,s+1)):e[t.s]=s},M=function(t){for(var e=t.length;e&&!t[--e];);for(var s=new o(++e),n=0,i=t[0],r=1,a=function(t){s[n++]=t},c=1;c<=e;++c)if(t[c]==i&&c!=e)++r;else{if(!i&&r>2){for(;r>138;r-=138)a(32754);r>2&&(a(r>10?r-11<<5|28690:r-3<<5|12305),r=0)}else if(r>3){for(a(i),--r;r>6;r-=6)a(8304);r>2&&(a(r-3<<5|8208),r=0)}for(;r--;)a(i);r=1,i=t[c]}return{c:s.subarray(0,n),n:e}},D=function(t,e){for(var s=0,n=0;n<e.length;++n)s+=t[n]*e[n];return s},A=function(t,e,s){var n=s.length,i=I(e+2);t[i]=255&n,t[i+1]=n>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var r=0;r<n;++r)t[i+r+4]=s[r];return 8*(i+4+n)},j=function(t,e,s,n,i,r,a,l,d,p,f){_(e,f++,s),++i[256];for(var g=N(i,15),m=g.t,y=g.l,b=N(r,15),I=b.t,x=b.l,E=M(m),C=E.c,R=E.n,j=M(I),L=j.c,F=j.n,P=new o(19),B=0;B<C.length;++B)++P[31&C[B]];for(B=0;B<L.length;++B)++P[31&L[B]];for(var $=N(P,7),H=$.t,U=$.l,z=19;z>4&&!H[u[z-1]];--z);var q,W,K,V,X=p+5<<3,J=D(i,w)+D(r,S)+a,G=D(i,m)+D(r,I)+a+14+3*z+D(P,H)+2*P[16]+3*P[17]+7*P[18];if(d>=0&&X<=J&&X<=G)return A(e,f,t.subarray(d,d+p));if(_(e,f,1+(G<J)),f+=2,G<J){q=v(m,y,0),W=m,K=v(I,x,0),V=I;var Y=v(H,U,0);_(e,f,R-257),_(e,f+5,F-1),_(e,f+10,z-4),f+=14;for(B=0;B<z;++B)_(e,f+3*B,H[u[B]]);f+=3*z;for(var Q=[C,L],Z=0;Z<2;++Z){var tt=Q[Z];for(B=0;B<tt.length;++B){var et=31&tt[B];_(e,f,Y[et]),f+=H[et],et>15&&(_(e,f,tt[B]>>5&127),f+=tt[B]>>12)}}}else q=k,W=w,K=T,V=S;for(B=0;B<l;++B){var st=n[B];if(st>255){O(e,f,q[(et=st>>18&31)+257]),f+=W[et+257],et>7&&(_(e,f,st>>23&31),f+=c[et]);var nt=31&st;O(e,f,K[nt]),f+=V[nt],nt>3&&(O(e,f,st>>5&8191),f+=h[nt])}else O(e,f,q[st]),f+=W[st]}return O(e,f,q[256]),f+W[256]},L=new a([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new r(0),P=function(t,e,s,n,i,u){var l=u.z||t.length,d=new r(n+l+5*(1+Math.ceil(l/7e3))+i),p=d.subarray(n,d.length-i),m=u.l,y=7&(u.r||0);if(e){y&&(p[0]=u.r>>3);for(var b=L[e-1],v=b>>13,w=8191&b,S=(1<<s)-1,k=u.p||new o(32768),T=u.h||new o(S+1),E=Math.ceil(s/3),C=2*E,_=function(e){return(t[e]^t[e+1]<<E^t[e+2]<<C)&S},O=new a(25e3),N=new o(288),R=new o(32),M=0,D=0,F=u.i||0,P=0,B=u.w||0,$=0;F+2<l;++F){var H=_(F),U=32767&F,z=T[H];if(k[U]=z,T[H]=U,B<=F){var q=l-F;if((M>7e3||P>24576)&&(q>423||!m)){y=j(t,p,0,O,N,R,D,P,$,F-$,y),P=M=D=0,$=F;for(var W=0;W<286;++W)N[W]=0;for(W=0;W<30;++W)R[W]=0}var K=2,V=0,X=w,J=U-z&32767;if(q>2&&H==_(F-J))for(var G=Math.min(v,q)-1,Y=Math.min(32767,F),Q=Math.min(258,q);J<=Y&&--X&&U!=z;){if(t[F+K]==t[F+K-J]){for(var Z=0;Z<Q&&t[F+Z]==t[F+Z-J];++Z);if(Z>K){if(K=Z,V=J,Z>G)break;var tt=Math.min(J,Z-2),et=0;for(W=0;W<tt;++W){var st=F-J+W&32767,nt=st-k[st]&32767;nt>et&&(et=nt,z=st)}}}J+=(U=z)-(z=k[U])&32767}if(V){O[P++]=268435456|f[K]<<18|g[V];var it=31&f[K],rt=31&g[V];D+=c[it]+h[rt],++N[257+it],++R[rt],B=F+K,++M}else O[P++]=t[F],++N[t[F]]}}for(F=Math.max(F,B);F<l;++F)O[P++]=t[F],++N[t[F]];y=j(t,p,m,O,N,R,D,P,$,F-$,y),m||(u.r=7&y|p[y/8|0]<<3,y-=7,u.h=T,u.p=k,u.i=F,u.w=B)}else{for(F=u.w||0;F<l+m;F+=65535){var ot=F+65535;ot>=l&&(p[y/8|0]=m,ot=l),y=A(p,y+1,t.subarray(F,ot))}u.i=l}return x(d,0,n+I(y)+i)},B=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var s=e,n=9;--n;)s=(1&s&&-306674912)^s>>>1;t[e]=s}return t}(),$=function(){var t=-1;return{p:function(e){for(var s=t,n=0;n<e.length;++n)s=B[255&s^e[n]]^s>>>8;t=s},d:function(){return~t}}},H=function(t,e,s,n,i){if(!i&&(i={l:1},e.dictionary)){var o=e.dictionary.subarray(-32768),a=new r(o.length+t.length);a.set(o),a.set(t,o.length),t=a,i.w=o.length}return P(t,null==e.level?6:e.level,null==e.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+e.mem,s,n,i)},U=function(t,e,s){for(var n=t(),i=t.toString(),r=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<n.length;++o){var a=n[o],c=r[o];if("function"==typeof a){e+=";"+c+"=";var h=a.toString();if(a.prototype)if(-1!=h.indexOf("[native code]")){var u=h.indexOf(" ",8)+1;e+=h.slice(u,h.indexOf("(",u))}else for(var l in e+=h,a.prototype)e+=";"+c+".prototype."+l+"="+a.prototype[l].toString();else e+=h}else s[c]=a}return e},z=[],q=function(t,e,s,n){if(!z[s]){for(var r="",o={},a=t.length-1,c=0;c<a;++c)r=U(t[c],r,o);z[s]={c:U(t[a],r,o),e:o}}var h=function(t,e){var s={};for(var n in t)s[n]=t[n];for(var n in e)s[n]=e[n];return s}({},z[s].e);return function(t,e,s,n,r){var o=new Worker(i[e]||(i[e]=URL.createObjectURL(new Blob([t+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return o.onmessage=function(t){var e=t.data,s=e.$e$;if(s){var n=new Error(s[0]);n.code=s[1],n.stack=s[2],r(n,null)}else r(null,e)},o.postMessage(s,n),o}(z[s].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",s,h,function(t){var e=[];for(var s in t)t[s].buffer&&e.push((t[s]=new t[s].constructor(t[s])).buffer);return e}(h),n)},W=function(){return[r,o,a,c,h,u,f,g,k,w,T,S,m,L,F,v,_,O,N,R,M,D,A,j,I,x,P,H,Y,V]},K=function(){return[J,G,X,$,B]},V=function(t){return postMessage(t,[t.buffer])},X=function(t,e,s){for(;s;++e)t[e]=s,s>>>=8},J=function(t,e){var s=e.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=e.level<2?4:9==e.level?2:0,t[9]=3,0!=e.mtime&&X(t,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),s){t[3]=8;for(var n=0;n<=s.length;++n)t[n+10]=s.charCodeAt(n)}},G=function(t){return 10+(t.filename?t.filename.length+1:0)};function Y(t,e){return H(t,e||{},0,0)}function Q(t,e,s){return s||(s=e,e={}),"function"!=typeof s&&C(7),function(t,e,s,n,i,r){var o=q(s,n,i,(function(t,e){o.terminate(),r(t,e)}));return o.postMessage([t,e],e.consume?[t.buffer]:[]),function(){o.terminate()}}(t,e,[W,K,function(){return[Z]}],(function(t){return V(Z(t.data[0],t.data[1]))}),2,s)}function Z(t,e){e||(e={});var s=$(),n=t.length;s.p(t);var i=H(t,e,G(e),8),r=i.length;return J(i,e),X(i,r-8,s.d()),X(i,r-4,n),i}var tt="undefined"!=typeof TextDecoder&&new TextDecoder;try{tt.decode(F,{stream:!0}),1}catch(ei){}class et{constructor(){this.lastTs=0,this.lastSuffix=1,this.backDict={},this.getKey=t=>{let e=!1;const s=`__${t}`;if(!this.backDict[s]){e=!0;const t=Date.now()%10**11;let n=t;n===this.lastTs?(n=1e4*n+this.lastSuffix,this.lastSuffix+=1):this.lastSuffix=1,this.backDict[s]=n,this.lastTs=t}return[this.backDict[s],e]}}}class st{constructor(t){this.sendSetAttribute=(t,e,s)=>{if(this.isDictDisabled){const n=[12,t,e,s];return this.app.send(n)}{const n=[35,t,this.applyDict(e),this.applyDict(s)];return this.app.send(n)}},this.app=t.app,this.isDictDisabled=t.isDictDisabled,this.dict=new et}applyDict(t){const[e,s]=this.dict.getKey(t);return s&&this.app.send([34,e,t]),e}clear(){this.dict=new et}}class nt{constructor(t,e){this.app=t,this.startParams=e,this.conditions=[],this.hasStarted=!1,this.createConditionFromFilter=t=>{const e=rt(t);if(e.type)return e},this.durationInt=null}setConditions(t){this.conditions=t}async fetchConditions(t,e){try{const s=await fetch(`${this.app.options.ingestPoint}/v1/web/conditions/${t}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}),{conditions:n}=await s.json(),i=[];n.forEach((t=>{t.filters.forEach((e=>{let s;"fetch"===e.type?(s={type:"network_request",subConditions:[],name:t.name},e.filters.forEach((t=>{const e=this.createConditionFromFilter(t);e&&s.subConditions.push(e)}))):s=this.createConditionFromFilter(e),s&&("session_duration"===s.type&&this.processDuration(s.value[0],t.name),i.push({...s,name:t.name}))}))})),this.conditions=i}catch(t){this.app.debug.error("Critical: cannot fetch start conditions")}}trigger(t){if(!this.hasStarted)try{this.hasStarted=!0,this.app.start(this.startParams,void 0,t)}catch(t){this.app.debug.error(t)}}processMessage(t){if(!this.hasStarted)switch(t[0]){case 78:this.jsExceptionEvent(t);break;case 27:this.customEvent(t);break;case 68:this.clickEvent(t);break;case 122:this.pageLocationEvent(t);break;case 83:this.networkRequest(t)}}processFlags(t){const e=this.conditions.filter((t=>"feature_flag"===t.type));e.length&&e.forEach((e=>{const s=it[e.operator];s&&t.find((t=>s(t.key,e.value)))&&this.trigger(e.name)}))}processDuration(t,e){this.durationInt=setInterval((()=>{performance.now()>t&&this.trigger(e)}),1e3),this.app.attachStopCallback((()=>{this.durationInt&&clearInterval(this.durationInt)}))}networkRequest(t){const e=this.conditions.filter((t=>"network_request"===t.type));e.length&&e.forEach((e=>{const s=e.subConditions.filter((t=>"isAny"!==t.operator));if(s.length){s.every((e=>{let s;switch(e.key){case"url":s=t[3];break;case"status":s=t[6];break;case"method":s=t[2];break;case"duration":s=t[8]}const n=it[e.operator];if(n&&n(s,e.value))return!0}))&&this.trigger(e.name)}else 0===s.length&&e.subConditions.length&&this.trigger(e.name)}))}customEvent(t){const e=this.conditions.filter((t=>"custom_event"===t.type));e.length&&e.forEach((e=>{const s=it[e.operator];s&&(s(t[1],e.value)||s(t[2],e.value))&&this.trigger(e.name)}))}clickEvent(t){const e=this.conditions.filter((t=>"click"===t.type));e.length&&e.forEach((e=>{const s=it[e.operator];s&&(s(t[3],e.value)||s(t[4],e.value))&&this.trigger(e.name)}))}pageLocationEvent(t){const e=this.conditions.filter((t=>"visited_url"===t.type));e&&e.forEach((e=>{const s=it[e.operator];s&&s(t[1],e.value)&&this.trigger(e.name)}))}jsExceptionEvent(t){const e=[t[1],t[2],t[3]],s=this.conditions.filter((t=>"exception"===t.type));s&&s.forEach((t=>{const s=it[t.operator];s&&e.some((e=>s(e,t.value)))&&this.trigger(t.name)}))}}const it={is:(t,e)=>e.some((e=>t.includes(e))),isAny:()=>!0,isNot:(t,e)=>!e.some((e=>t.includes(e))),contains:(t,e)=>e.some((e=>t.includes(e))),notContains:(t,e)=>!e.some((e=>t.includes(e))),startsWith:(t,e)=>e.some((e=>t.startsWith(e))),endsWith:(t,e)=>e.some((e=>t.endsWith(e))),greaterThan:(t,e)=>t>e,greaterOrEqual:(t,e)=>t>=e,lessOrEqual:(t,e)=>t<=e,lessThan:(t,e)=>t<e},rt=t=>{const e={on:"is",notOn:"isNot",">":"greaterThan","<":"lessThan","=":"is","<=":"lessOrEqual",">=":"greaterOrEqual"},s=t=>{if(Object.keys(e).includes(t))return e[t]};let n={type:"",operator:"",value:t.value,key:""};switch(t.type){case"click":n={type:"click",operator:s(t.operator),value:t.value,key:""};break;case"location":n={type:"visited_url",operator:t.operator,value:t.value,key:""};break;case"custom":n={type:"custom_event",operator:t.operator,value:t.value,key:""};break;case"metadata":n={type:"featureFlag"===t.source?"feature_flag":t.type,operator:t.operator,value:t.value,key:""};break;case"error":n={type:"exception",operator:t.operator,value:t.value,key:""};break;case"duration":n={type:"session_duration",value:t.value,key:"",operator:"is"};break;case"fetchUrl":n={type:"network_request",key:"url",operator:t.operator,value:t.value};break;case"fetchStatusCode":n={type:"network_request",key:"status",operator:s(t.operator),value:t.value};break;case"fetchMethod":n={type:"network_request",key:"method",operator:s(t.operator),value:t.value};break;case"fetchDuration":n={type:"network_request",key:"duration",operator:s(t.operator),value:t.value}}return n};class ot{constructor(t){this.app=t,this.flags=[],this.storageKey="__openreplay_flags";const e=this.app.sessionStorage.getItem(this.storageKey);if(e){const t=e.split(";").filter(Boolean);this.flags=t.map((t=>JSON.parse(t)))}}getFeatureFlag(t){return this.flags.find((e=>e.key===t))}isFlagEnabled(t){return-1!==this.flags.findIndex((e=>e.key===t))}onFlagsLoad(t){this.onFlagsCb=t}async reloadFlags(t){const e=this.app.sessionStorage.getItem(this.storageKey),s={};if(e){e.split(";").filter(Boolean).forEach((t=>{const e=JSON.parse(t);s[e.key]={key:e.key,value:e.value}}))}const n=this.app.session.getInfo(),i=this.app.session.userInfo,r={projectID:n.projectID,userID:n.userID,metadata:n.metadata,referrer:document.referrer,os:i.userOS,device:i.userDevice,country:i.userCountry,state:i.userState,city:i.userCity,browser:i.userBrowser,persistFlags:s},o=t??this.app.session.getSessionToken(),a=await fetch(this.app.options.ingestPoint+"/v1/web/feature-flags",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(r)});if(200===a.status){const t=await a.json();return this.handleFlags(t.flags)}}handleFlags(t){const e=[];t.forEach((t=>{t.is_persist&&e.push(t)}));let s="";return this.diffPersist(e).forEach((t=>{s+=`${JSON.stringify(t)};`})),this.app.sessionStorage.setItem(this.storageKey,s),this.flags=t,this.onFlagsCb?.(t)}clearPersistFlags(){this.app.sessionStorage.removeItem(this.storageKey)}diffPersist(t){const e=this.app.sessionStorage.getItem(this.storageKey);if(!e)return t;const s=e.split(";").filter(Boolean).map((t=>JSON.parse(t)));return t.filter((t=>-1===s.findIndex((e=>e.key===t.key))))}}const at={htmlmasked:"hidden",masked:"obscured"},ct=!("undefined"==typeof window),ht=ct&&navigator.userAgent.match(/firefox|fxios/i);let ut=ct?Date.now()-performance.now():0;function lt(){ut=Date.now()-performance.now()}function dt(){return ut}const pt=ct&&performance.now?()=>Math.round(performance.now()+ut):()=>Date.now(),ft="repeat"in String.prototype?t=>"*".repeat(t.length):t=>t.replace(/./g,"*");function gt(t){return t.trim().replace(/\s+/g," ")}function mt(t){return t.startsWith("https://")||t.startsWith("http://")}const yt="https://docs.openreplay.com",bt={};function vt(t,e,s="/"){bt[t]||(n.warn(`OpenReplay: ${t} is deprecated. ${e?`Please, use ${e} instead.`:""} Visit ${yt}${s} for more information.`),bt[t]=!0)}function wt(t){let e=t.getAttribute("data-openreplay-label");return null!==e||(e=t.getAttribute("data-asayer-label"),null!==e&&vt('"data-asayer-label" attribute','"data-openreplay-label" attribute',"/")),e}function St(t,e){const s=`data-openreplay-${e}`;return!!t.hasAttribute(s)&&(at[e]&&vt(`"${s}" attribute`,`"${at[e]}" attribute`,"/en/sdk/sanitize-data"),!0)}function kt(t){try{return t instanceof HTMLIFrameElement?t.contentDocument:t instanceof Window?t.document:t instanceof Document?t.defaultView:"nodeType"in t?t.nodeType:"addEventListener"in t&&t.addEventListener,!0}catch(t){if(t instanceof DOMException&&"SecurityError"===t.name)return!1}return!0}function Tt(t){return t.toString(16).padStart(2,"0")}function It(){try{return window.self&&window.top&&window.self!==window.top}catch(t){return!0}}function xt(t){return window.Zone&&"__symbol__"in window.Zone?window.Zone.__symbol__(t):t}function Et(t,e){if(e)return new MutationObserver(t);{const e=xt("MutationObserver");return new window[e](t)}}function Ct(t,e,s,i,r){if(!kt(t))return;let o="addEventListener";r||(o=xt("addEventListener"));try{t[o]?t[o](e,s,i):t.addEventListener(e,s,i)}catch(s){const i=s.message;n.error(`Openreplay: ${i}; if this error is caused by an IframeObserver, ignore it`,e,t)}}function _t(t,e,s,i,r){if(!kt(t))return;let o="removeEventListener";r||(o=xt("removeEventListener"));try{t[o]?t[o](e,s,i):t.removeEventListener(e,s,i)}catch(s){const i=s.message;n.error(`Openreplay: ${i}; if this error is caused by an IframeObserver, ignore it`,e,t)}}const Ot=new class{constructor(){this.taskQueue=[],this.isRunning=!1}addTask(t){this.taskQueue.push(t),this.runTasks()}runTasks(){if(this.isRunning||0===this.taskQueue.length)return;this.isRunning=!0;const t=()=>{if(0===this.taskQueue.length)return void(this.isRunning=!1);const e=this.taskQueue.shift();Promise.resolve(e()).then((()=>{requestAnimationFrame((()=>t()))}))};t()}};function Nt(t){Ot.addTask(t)}function Rt(t,e){const s={...t};for(const n in e)if(e.hasOwnProperty(n)){const i=e[n],r=t[n];"object"!=typeof i||Array.isArray(i)||null===i?s[n]=i:s[n]=Rt(r||{},i)}return s}function Mt(t){return[0,t]}function Dt(t,e){return[5,t,e]}function At(t,e){return[6,t,e]}function jt(t,e,s,n,i){return[8,t,e,s,n,i]}function Lt(t,e,s){return[9,t,e,s]}function Ft(t,e,s){return[10,t,e,s]}function Pt(t){return[11,t]}function Bt(t,e,s){return[12,t,e,s]}function $t(t,e){return[13,t,e]}function Ht(t,e){return[14,t,e]}function Ut(t,e,s){return[16,t,e,s]}function zt(t,e,s){return[18,t,e,s]}function qt(t,e){return[19,t,e]}function Wt(t,e){return[20,t,e]}function Kt(t,e){return[22,t,e]}function Vt(t,e,s,n,i,r,o,a,c){return[23,t,e,s,n,i,r,o,a,c]}function Xt(t,e,s){return[24,t,e,s]}function Jt(t,e){return[27,t,e]}function Gt(t){return[28,t]}function Yt(t){return[29,t]}function Qt(t,e){return[30,t,e]}function Zt(t,e,s,n){return[49,t,e,s,n]}function te(t,e){return[54,t,e]}function ee(t){return[55,t]}function se(t,e,s,n){return[57,t,e,s,n]}function ne(t){return[58,t]}function ie(t,e,s,n){return[60,t,e,s,n]}function re(t,e,s){return[61,t,e,s]}function oe(t,e){return[63,t,e]}function ae(t,e){return[64,t,e]}function ce(t,e,s,n,i,r){return[68,t,e,s,n,i,r]}function he(t,e){return[70,t,e]}function ue(t,e,s){return[71,t,e,s]}function le(t,e,s,n){return[73,t,e,s,n]}function de(t,e){return[75,t,e]}function pe(t,e){return[76,t,e]}function fe(t,e){return[77,t,e]}function ge(t,e,s,n){return[78,t,e,s,n]}function me(t,e,s,n,i,r,o,a,c){return[83,t,e,s,n,i,r,o,a,c]}function ye(t,e,s,n,i,r){return[84,t,e,s,n,i,r]}function be(t,e,s,n,i,r){return[112,t,e,s,n,i,r]}function ve(t,e,s){return[113,t,e,s]}function we(t){return[114,t]}function Se(t){return[115,t]}function ke(t,e,s,n,i,r,o,a,c,h){return[116,t,e,s,n,i,r,o,a,c,h]}function Te(t){return[117,t]}function Ie(t){return[118,t]}function xe(t,e){return[119,t,e]}function Ee(t){return[120,t]}function Ce(t,e,s,n){return[122,t,e,s,n]}function _e(t,e){return[124,t,e]}const Oe=ct&&"performance"in window&&"memory"in performance?performance:{memory:{}},Ne=ct?1024*(navigator.deviceMemory||0):0,Re=Oe.memory.jsHeapSizeLimit||0;const Me="__or__watched_tags__";class De{constructor(t){this.intervals={},this.tags=[],this.sessionStorage=t.sessionStorage,this.errLog=t.errLog,this.onTag=t.onTag;const e=JSON.parse(t.sessionStorage.getItem(Me)??"[]");this.setTags(e),this.observer=new IntersectionObserver((t=>{t.forEach((t=>{if(t.isIntersecting&&t.target){const e=t.target.__or_watcher_tagname;e&&this.onTagRendered(e),this.observer.unobserve(t.target)}}))}))}async fetchTags(t,e){return fetch(`${t}/v1/web/tags`,{method:"GET",headers:{Authorization:`Bearer ${e}`}}).then((t=>t.json())).then((({tags:t})=>{if(t&&t.length){this.setTags(t);const e=JSON.stringify(t);this.sessionStorage.setItem(Me,e||"")}})).catch((t=>this.errLog(t)))}setTags(t){this.tags=t,this.intervals={},t.forEach((t=>{this.intervals[t.id]=setInterval((()=>{const e=document.querySelectorAll(t.selector);if(e.length>0){const s=e[0];s.__or_watcher_tagname=t.id,this.observer.observe(s)}}),500)}))}onTagRendered(t){this.intervals[t]&&clearInterval(this.intervals[t]),this.onTag(t)}clear(){this.tags.forEach((t=>{clearInterval(this.intervals[t.id])})),this.tags=[],this.intervals={},this.observer.disconnect()}}const Ae={position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0, 0, 0, 0.40)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999999,fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"'},je={display:"flex",flexDirection:"column",gap:"2rem",alignItems:"center",padding:"1.5rem",borderRadius:"2px",border:"1px solid rgb(255 255 255 / var(--tw-bg-opacity, 1))",background:"#FFF",width:"22rem"},Le={display:"flex","flex-direction":"column",gap:"unset","align-items":"center",padding:"unset",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',"border-radius":"2px",border:"1px solid rgb(255 255 255 / var(--tw-bg-opacity, 1))",background:"rgba(255, 255, 255, 0.75)",width:"22rem"},Fe={fontFamily:"Verdana, sans-serif",fontSize:"1.25rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.75rem",color:"rgba(0, 0, 0, 0.85)"},Pe={borderTop:"1px solid rgba(0, 0, 0, 0.06)",borderBottom:"1px solid rgba(0, 0, 0, 0.06)",padding:"1.25rem 0rem",color:"rgba(0, 0, 0, 0.85)",fontFamily:"Verdana, sans-serif",fontSize:"13px",fontStyle:"normal",fontWeight:"400",lineHeight:"auto",whiteSpace:"pre-wrap"},Be={display:"flex",padding:"0.4rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.625rem",borderRadius:"0.25rem",border:"1px solid #394EFF",background:"#394EFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",color:"#FFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"1rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.5rem",cursor:"pointer"},$e={fontFamily:"Verdana, sans-serif",fontSize:"13px",fontWeight:"500",lineHeight:"auto",display:"flex",justifyContent:"space-between",width:"100%",cursor:"pointer"},He={display:"flex",flexDirection:"column",alignItems:"flex-start",gap:"0.625rem",fontSize:"13px",lineHeight:"auto"},Ue={padding:"0.5rem",gap:"0.5rem",fontFamily:"Verdana, sans-serif",fontSize:"16px",fontStyle:"normal",fontWeight:"500",lineHeight:"auto",color:"white",display:"flex",alignItems:"center",width:"100%",borderRadius:"2px",background:"rgba(0, 0, 0, 0.75)",boxSizing:"border-box"},ze={boxSizing:"border-box",display:"block",width:"100%",borderBottom:"1px solid rgb(255 255 255 / var(--tw-bg-opacity, 1))",background:"#FFF",padding:"0.65rem",alignSelf:"stretch",color:"#000",fontFamily:"Verdana, sans-serif",fontStyle:"normal",fontWeight:"400"},qe={...ze,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.625rem"},We={fontSize:"1.25rem",fontWeight:"500",cursor:"pointer",color:"#394EFF"},Ke={display:"flex",padding:"0.4rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.625rem",borderRadius:"0.25rem",border:"1px solid #394EFF",background:"#394EFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",color:"#FFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"1rem",fontStyle:"normal",fontWeight:"500",lineHeight:"1.5rem",width:"100%",boxSizing:"border-box",cursor:"pointer"},Ve={marginTop:"1rem",marginBottom:"1rem",cursor:"pointer",display:"block",fontWeight:"500",fontSize:"13px!important",lineHeight:"auto"},Xe={display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",padding:"0.5rem",width:"100%",boxSizing:"border-box"},Je={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em",outline:"1px solid #394EFF",fontSize:"13px",height:"24px",width:"24px"},Ge={display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em",outline:"1px solid #D2DFFF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",background:"#D2DFFF",fontSize:"13px",height:"24px",width:"24px"},Ye={borderRadius:"0.375rem",border:"1px solid rgba(0, 0, 0, 0.06)",background:"#F5F7FF",boxShadow:"0px 2px 0px 0px rgba(0, 0, 0, 0.04)",display:"flex",flexDirection:"column",padding:"0.625rem 0.9375rem",gap:"0.5rem",alignSelf:"stretch"},Qe={fontWeight:"bold"},Ze={fontSize:"13px",lineHeight:"auto"},ts={marginRight:"0.5rem",cursor:"pointer",color:"#394EFF",textAlign:"center",fontFamily:"Verdana, sans-serif",fontSize:"13px",fontStyle:"normal",fontWeight:"500",lineHeight:"auto"},es={...ts,display:"flex",padding:"0.25rem 0.9375rem",justifyContent:"center",alignItems:"center",gap:"0.5rem",borderRadius:"0.25rem",border:"1px solid #394EFF"},ss={display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",boxSizing:"border-box"},ns={border:"4px solid rgba(255, 255, 255, 0.4)",width:"16px",height:"16px",borderRadius:"50%",borderLeftColor:"#fff",animation:"spin 0.5s linear infinite"},is={width:1280,height:720};class rs{constructor(t){this.app=t,this.mediaRecorder=null,this.recordedChunks=[],this.stream=null,this.recStartTs=null}async startRecording(t,e,s,i){this.recStartTs=this.app.timestamp();const r=e;try{this.stream=await navigator.mediaDevices.getUserMedia({video:!!i&&{...r,frameRate:{ideal:t}},audio:s}),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:"video/webm;codecs=vp9"}),this.recordedChunks=[],this.mediaRecorder.ondataavailable=t=>{t.data.size>0&&this.recordedChunks.push(t.data)},this.mediaRecorder.start()}catch(t){n.error(t)}}async stopRecording(){return new Promise((t=>{this.mediaRecorder&&(this.mediaRecorder.onstop=()=>{const e=new Blob(this.recordedChunks,{type:"video/webm"});t(e)},this.mediaRecorder.stop())}))}async sendToAPI(){const t=await this.stopRecording();return fetch(`${this.app.options.ingestPoint}/v1/web/uxt/upload-url`,{headers:{Authorization:`Bearer ${this.app.session.getSessionToken()}`}}).then((t=>{if(t.ok)return t.json();throw new Error("Failed to get upload url")})).then((({url:e})=>fetch(e,{method:"PUT",headers:{"Content-Type":"video/webm"},body:t}))).catch(n.error).finally((()=>{this.discard()}))}async saveToFile(t="recorded-video.webm"){const e=await this.stopRecording(),s=URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=s,n.download=t,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(s),document.body.removeChild(n)}discard(){this.mediaRecorder?.stop(),this.stream?.getTracks().forEach((t=>t.stop()))}}function os(){!function(){const t=document.createElement("style");t.type="text/css",t.innerText="@keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n    }",document.head.appendChild(t)}();const t=document.createElement("div");return t.classList.add("spinner"),Object.assign(t.style,ns),t}function as(t,e,s,n,i){const r=document.createElement(t);return r.className=e,Object.assign(r.style,s),n&&(r.textContent=n),i&&(r.id=i),r}const cs="or_uxt_test_start",hs="or_uxt_task_index",us="or_uxt_session_id";class ls{constructor(t,e,s,i,r,o,a,c,h){this.ingestPoint=t,this.getTimestamp=e,this.token=s,this.testId=i,this.storageKey=r,this.setStorageKey=o,this.removeStorageKey=a,this.getStorageKey=c,this.getSessionId=h,this.durations={testStart:0,tasks:[]},this.getDurations=()=>this.durations,this.setDurations=t=>{this.durations.testStart=t.testStart,this.durations.tasks=t.tasks},this.signalTask=(t,e,s)=>{if(!t)return n.error("User Testing: No Task ID Given");const i=this.durations.tasks.find((e=>e.taskId===t)),r=this.getTimestamp(),o=i?r-i.started:0;return fetch(`${this.ingestPoint}/v1/web/uxt/signals/task`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:JSON.stringify({testId:this.testId,taskId:t,status:e,duration:o,timestamp:r,taskAnswer:s})})},this.signalTest=t=>{const e=this.getTimestamp();if("begin"===t&&this.testId){const t=this.getSessionId();this.setStorageKey(us,t),this.setStorageKey(this.storageKey,this.testId.toString()),this.setStorageKey(cs,e.toString())}else this.removeStorageKey(this.storageKey),this.removeStorageKey(hs),this.removeStorageKey(cs);const s=e-(this.durations.testStart||e);return fetch(`${this.ingestPoint}/v1/web/uxt/signals/test`,{method:"POST",headers:{Authorization:`Bearer ${this.token}`},body:JSON.stringify({testId:this.testId,status:t,duration:s,timestamp:e})})};const u=this.getStorageKey(cs);u&&(this.durations.testStart=parseInt(u,10))}}class ds{constructor(t,e){this.app=t,this.storageKey=e,this.bg=as("div","bg",Ae,void 0,"__or_ut_bg"),this.container=as("div","container",je,void 0,"__or_ut_ct"),this.widgetGuidelinesVisible=!0,this.widgetTasksVisible=!1,this.widgetVisible=!0,this.isActive=!1,this.descriptionSection=null,this.taskSection=null,this.endSection=null,this.stopButton=null,this.stopButtonContainer=null,this.test=null,this.testId=null,this.signalManager=null,this.getTest=(t,e,s)=>{this.testId=t;const i=this.app.options.ingestPoint;return fetch(`${i}/v1/web/uxt/test/${t}`,{headers:{Authorization:`Bearer ${e}`}}).then((t=>t.json())).then((({test:n})=>{this.isActive=!0,this.test=n,this.signalManager=new ls(this.app.options.ingestPoint,(()=>this.app.timestamp()),e,t,this.storageKey,((t,e)=>this.app.localStorage.setItem(t,e)),(t=>this.app.localStorage.removeItem(t)),(t=>this.app.localStorage.getItem(t)),(()=>this.app.getSessionID())),this.createGreeting(n.title,n.reqMic,n.reqCamera),s&&((n.reqMic||n.reqCamera)&&this.userRecorder.startRecording(30,is,n.reqMic,n.reqCamera),this.showWidget(n.description,n.tasks,!0),this.showTaskSection())})).then((()=>t)).catch((t=>{n.log("OR: Error fetching test",t)}))},this.hideTaskSection=()=>!1,this.showTaskSection=()=>!0,this.collapseWidget=()=>!1,this.removeGreeting=()=>!1,this.toggleDescriptionVisibility=()=>{},this.currentTaskIndex=0,this.userRecorder=new rs(t);this.app.getSessionID()!==this.app.localStorage.getItem(us)&&(this.app.localStorage.removeItem(this.storageKey),this.app.localStorage.removeItem(us),this.app.localStorage.removeItem("or_uxt_test_id"),this.app.localStorage.removeItem(hs),this.app.localStorage.removeItem(cs));const s=this.app.localStorage.getItem(hs);s&&(this.currentTaskIndex=parseInt(s,10))}getTestId(){return this.testId}createGreeting(t,e,s){const n=as("div","title",Fe,t),i=as("div","description",Pe,"Welcome, you're here to help us improve, not to be judged. Your insights matter!\n\n📹 We're recording this browser tab to learn from your experience.\n🎤 Please enable mic and camera if asked, to give us a complete picture."),r=as("div","button",Be,"Read guidelines to begin");this.removeGreeting=()=>((e||s)&&this.userRecorder.startRecording(30,is,e,s),this.container.removeChild(r),this.container.removeChild(i),this.container.removeChild(n),!1),r.onclick=()=>{this.removeGreeting();const t=this.signalManager?.getDurations();t&&this.signalManager&&(t.testStart=this.app.timestamp(),this.signalManager.setDurations(t)),this.signalManager?.signalTest("begin"),this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,Le),this.showWidget(this.test?.guidelines||"",this.test?.tasks||[])},this.container.append(n,i,r),this.bg.appendChild(this.container),document.body.appendChild(this.bg)}showWidget(t,e,s){this.container.innerHTML="",Object.assign(this.bg.style,{position:"fixed",zIndex:99999999999999,right:"8px",left:"unset",width:"fit-content",top:"8px",height:"fit-content",background:"unset",display:"unset",alignItems:"unset",justifyContent:"unset"});const n=this.createTitleSection();this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,Le);const i=this.createDescriptionSection(t),r=this.createTasksSection(e),o=as("div","stop_bn_or",Ve,"Abort Session"),a=as("div","stop_ct_or",{fontSize:"13px!important"});a.style.fontSize="13px",a.append(o),this.container.append(n,i,r,a),this.taskSection=r,this.descriptionSection=i,this.stopButton=o,this.stopButtonContainer=a,o.onclick=()=>{this.userRecorder.discard(),this.signalManager?.signalTest("skipped"),document.body.removeChild(this.bg),window.close()},s?this.toggleDescriptionVisibility():this.hideTaskSection()}createTitleSection(){const t=as("div","title",Ue),e=function(){const t=document.createElement("div");t.className="grid";for(let e=0;e<16;e++){const e=document.createElement("div");Object.assign(e.style,{width:"2px",height:"2px",borderRadius:"10px",background:"white"}),e.className="cell",t.appendChild(e)}return Object.assign(t.style,{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gridTemplateRows:"repeat(4, 1fr)",gap:"2px",cursor:"grab"}),t}(),s=as("div","title_text",{maxWidth:"19rem",overflow:"hidden",textOverflow:"ellipsis",width:"100%",fontSize:16,lineHeight:"auto",cursor:"pointer"},this.test?.title),n=function(){const t=document.createElement("div");Object.assign(t.style,{width:"0",height:"0",borderLeft:"7px solid transparent",borderRight:"7px solid transparent",borderBottom:"7px solid white"});const e=document.createElement("div");return e.appendChild(t),Object.assign(e.style,{display:"flex",alignItems:"center",justifyContent:"center",width:"16px",height:"16px",cursor:"pointer",marginLeft:"auto",transform:"rotate(180deg)"}),e}();t.append(e,s,n);const i=t=>(this.widgetVisible=t,this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,this.widgetVisible?Le:{border:"none",background:"none",padding:0}),this.taskSection&&Object.assign(this.taskSection.style,this.widgetVisible?ze:{display:"none"}),this.descriptionSection&&Object.assign(this.descriptionSection.style,this.widgetVisible?ze:{display:"none"}),this.endSection&&Object.assign(this.endSection.style,this.widgetVisible?ze:{display:"none"}),this.stopButton&&Object.assign(this.stopButton.style,this.widgetVisible?Ve:{display:"none"}),t),r=()=>{Object.assign(n.style,{transform:this.widgetVisible?"rotate(0deg)":"rotate(180deg)"}),i(!this.widgetVisible)};var o,a;return s.onclick=r,n.onclick=r,o=this.bg,(a=e).onmousedown=function(t){const e=o.getBoundingClientRect(),s=t.clientX-e.left,n=t.clientY-e.top;function i(t,i){let r=t-s,a=i-n;r<=5&&(r=5),a<=5&&(a=5),r>=window.innerWidth-e.width&&(r=window.innerWidth-e.width),a>=window.innerHeight-e.height&&(a=window.innerHeight-e.height),o.style.left=`${r}px`,o.style.top=`${a}px`}function r(t){i(t.pageX,t.pageY)}o.style.position="fixed",o.style.zIndex=99999999999999,i(t.pageX,t.pageY),document.addEventListener("mousemove",r);const a=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a)};document.addEventListener("mouseup",a)},a.ondragstart=function(){return!1},this.collapseWidget=()=>i(!1),t}createDescriptionSection(t){const e=as("div","description_section_or",ze),s=as("div","description_s_title_or",$e),n=as("div","title",{fontSize:13,fontWeight:500,lineHeight:"auto"},"Introduction & Guidelines"),i=as("div","icon",We,"-"),r=as("div","content",He),o=as("div","text_description",{maxHeight:"250px",overflowY:"auto",whiteSpace:"pre-wrap",fontSize:13,color:"#454545",lineHeight:"auto"});o.innerHTML=t;const a=as("div","button_begin_or",Ke,"Begin Test");s.append(n,i),r.append(o,a),e.append(s,r);const c=()=>{this.widgetGuidelinesVisible=!this.widgetGuidelinesVisible,i.textContent=this.widgetGuidelinesVisible?"-":"+",Object.assign(r.style,this.widgetGuidelinesVisible?He:{display:"none"})};return s.onclick=c,this.toggleDescriptionVisibility=()=>{this.widgetGuidelinesVisible=!1,i.textContent=this.widgetGuidelinesVisible?"-":"+",Object.assign(r.style,this.widgetGuidelinesVisible?He:{display:"none"}),r.removeChild(a)},a.onclick=()=>{if(c(),this.test){const t=this.signalManager?.getDurations(),e=t?t.tasks.findIndex((t=>this.test&&t.taskId===this.test.tasks[0].task_id)):null;t&&-1===e&&(t.tasks.push({taskId:this.test.tasks[0].task_id,started:this.app.timestamp()}),this.signalManager?.setDurations(t)),this.signalManager?.signalTask(this.test.tasks[0].task_id,"begin")}this.showTaskSection(),r.removeChild(a)},e}createTasksSection(t){this.container.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',Object.assign(this.container.style,Le);const e=as("div","task_section_or",ze),s=as("div","description_t_title_or",$e),n=as("div","title",{fontSize:"13px",fontWeight:"500",lineHeight:"auto"},"Tasks"),i=as("div","icon",We,"-"),r=as("div","content",He),o=as("div","pagination",Xe),a=as("div","taskCard",Ye),c=as("div","taskText",Qe),h=as("div","taskDescription",Ze),u=as("div","taskButtons",ss),l=as("div","taskText",Qe);l.textContent="Your answer";const d=as("textarea","taskDescription",{resize:"vertical"}),p=as("div","inputArea",Ye);p.append(l,d);const f=as("div","closePanelButton",ts,"Collapse Panel"),g=as("div","nextButton",es,"Done, Next");s.append(n,i),a.append(c,h),u.append(f,g),r.append(o,a,p,u),e.append(s,r);const m=()=>{const e=t[this.currentTaskIndex];c.textContent=e.title,h.textContent=e.description,e.allow_typing?p.style.display="flex":p.style.display="none"};t.forEach(((t,e)=>{const s=as("span",`or_task_${e}`,{outline:"1px solid #efefef",fontSize:"13px",height:"24px",width:"24px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",borderRadius:"6.25em"},(e+1).toString());s.id=`or_task_${e}`,o.append(s)}));this.hideTaskSection=()=>(i.textContent="+",Object.assign(r.style,{display:"none"}),this.widgetTasksVisible=!1,!1),this.showTaskSection=()=>(i.textContent="-",Object.assign(r.style,He),this.widgetTasksVisible=!0,!0);const y=()=>{const t=document.getElementById(`or_task_${this.currentTaskIndex}`);t&&Object.assign(t.style,Je);for(let t=0;t<this.currentTaskIndex;t++){const e=document.getElementById(`or_task_${t}`);e&&Object.assign(e.style,Ge)}};return s.onclick=()=>{this.widgetTasksVisible=!this.widgetTasksVisible,i.textContent=this.widgetTasksVisible?"-":"+",Object.assign(r.style,this.widgetTasksVisible?He:{display:"none"})},f.onclick=this.collapseWidget,g.onclick=()=>{const e=t[this.currentTaskIndex].allow_typing?d.value:void 0;if(d.value="",this.signalManager?.signalTask(t[this.currentTaskIndex].task_id,"done",e),this.currentTaskIndex<t.length-1){this.currentTaskIndex++,m();const e=this.signalManager?.getDurations();e&&-1===e.tasks.findIndex((e=>e.taskId===t[this.currentTaskIndex].task_id))&&(e.tasks.push({taskId:t[this.currentTaskIndex].task_id,started:this.app.timestamp()}),this.signalManager?.setDurations(e)),this.signalManager?.signalTask(t[this.currentTaskIndex].task_id,"begin"),y()}else this.showEndSection();this.app.localStorage.setItem("or_uxt_task_index",this.currentTaskIndex.toString())},setTimeout((()=>{const t=document.getElementById("or_task_0");t&&Object.assign(t.style,Je),m(),y()}),1),e}showEndSection(){let t=!0;this.signalManager?.signalTest("done");const e=as("div","end_section_or",qe),s=as("div","end_title_or",{fontSize:"1.25rem",fontWeight:"500"},"Thank you! 👍"),i=as("div","end_description_or",{},this.test?.conclusion??"Thank you for participating in our usability test. Your feedback has been captured and will be used to enhance our website. \n\nWe appreciate your time and valuable input."),r=as("div","end_button_or",Ke,"Submitting Feedback"),o=os();r.appendChild(o),this.test?.reqMic||this.test?.reqCamera?this.userRecorder.sendToAPI().then((()=>{r.removeChild(o),r.textContent="End Session",t=!1})).catch((e=>{n.error(e),r.removeChild(o),r.textContent="End Session",t=!1})):(r.removeChild(o),r.textContent="End Session",t=!1),this.taskSection&&this.container.removeChild(this.taskSection),this.descriptionSection&&this.container.removeChild(this.descriptionSection),this.stopButton&&this.stopButtonContainer&&this.container.removeChild(this.stopButtonContainer),r.onclick=()=>{t||(window.close(),document.body.removeChild(this.bg))},e.append(s,i,r),this.endSection=e,this.container.append(e)}}function ps(t){return!!t&&null!=t.nodeType}function fs(t){return"http://www.w3.org/2000/svg"===t.namespaceURI||"svg"===t.localName}function gs(t){return t.nodeType===Node.ELEMENT_NODE}function ms(t){return t.nodeType===Node.TEXT_NODE}function ys(t){return t.nodeType===Node.DOCUMENT_NODE}function bs(t){return t.nodeType===Node.DOCUMENT_NODE||t.nodeType===Node.DOCUMENT_FRAGMENT_NODE}function vs(t,e){return t.localName===e}class ws{constructor(t,e){this.app=t,this.options=e,this.snapshots={},this.intervals=[],this.restartTracking=()=>{this.clear(),this.app.nodes.scanTree(this.captureCanvas)},this.captureCanvas=t=>{const e=this.app.nodes.getID(t);if(!e||!vs(t,"canvas"))return;if(this.app.sanitizer.isObscured(e)||this.app.sanitizer.isHidden(e)||!vs(t,"canvas")||this.snapshots[e])return;new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting&&(t.target?this.snapshots[e]&&this.snapshots[e].createdAt?this.snapshots[e].paused=!1:this.recordCanvas(t.target,e):this.snapshots[e]&&(this.snapshots[e].paused=!0))}))})).observe(t)},this.recordCanvas=(t,e)=>{const s=this.app.timestamp();this.snapshots[e]={images:[],createdAt:s,paused:!1,dummy:document.createElement("canvas")};const n=xe(e.toString(),s);this.app.send(n);const i=t=>{!function(t,e="medium",s,n=!1,i,r){const o=`image/${i}`;if(n){const n=window.devicePixelRatio||1;s.width=t.width/n,s.height=t.height/n;const i=s.getContext("2d");if(!i)return"";i.clearRect(0,0,s.width,s.height),i.drawImage(t,0,0,s.width,s.height),s.toBlob(r,o,Ss[e])}else t.toBlob(r,o,Ss[e])}(t,this.options.quality,this.snapshots[e].dummy,this.options.fixedScaling,this.fileExt,(t=>{if(t){if(!this.snapshots[e])return this.app.debug.warn("Canvas not present in snapshots after capture:",this.snapshots,e);this.snapshots[e].images.push({id:this.app.timestamp(),data:t}),this.snapshots[e].images.length>9&&(this.sendSnaps(this.snapshots[e].images,e,this.snapshots[e].createdAt),this.snapshots[e].images=[])}}))},r=setInterval((()=>{const s=this.app.nodes.getID(t),n=s?this.app.nodes.getNode(s):void 0;return this.snapshots[e]?n&&vs(n,"canvas")&&n===t?void(this.snapshots[e].paused||(this.options.useAnimationFrame?requestAnimationFrame((()=>{i(n)})):i(n))):(this.app.debug.log("Canvas element not in sync",n,t),void clearInterval(r)):(this.app.debug.log("Canvas is not present in {snapshots}"),void clearInterval(r))}),this.interval);this.intervals.push(r)},this.fileExt=e.fileExt??"webp",this.interval=1e3/e.fps}startTracking(){setTimeout((()=>{this.app.nodes.scanTree(this.captureCanvas),this.app.nodes.attachNodeCallback(this.captureCanvas)}),250)}sendSnaps(t,e,s){if(0===Object.keys(this.snapshots).length)return;const n=new FormData;t.forEach((t=>{const i=t.data;i&&(n.append("snapshot",i,`${s}_${e}_${t.id}.${this.fileExt}`),this.options.isDebug&&function(t,e){const s=URL.createObjectURL(t),n=document.createElement("a");n.href=s,n.download=e,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}(i,`${s}_${e}_${t.id}.${this.fileExt}`))}));const i=()=>{this.app.debug.log("Restarting tracker; token expired"),this.app.stop(!1),setTimeout((()=>{this.app.start({},!0)}),250)};fetch(this.app.options.ingestPoint+"/v1/web/images",{method:"POST",headers:{Authorization:`Bearer ${this.app.session.getSessionToken()??""}`},body:n}).then((t=>401!==t.status||i())).catch((t=>{this.app.debug.error("error saving canvas",t)}))}clear(){this.intervals.forEach((t=>clearInterval(t))),this.snapshots={}}}const Ss={low:.35,medium:.55,high:.8};const ks=5,Ts=4,Is=3,xs=2,Es=0;class Cs{constructor(t=Es){this.shouldLog=t=>this.level>=t,this.info=(...t)=>{this.shouldLog(ks)&&n.info(...t)},this.log=(...t)=>{this.shouldLog(Ts)&&n.log(...t)},this.warn=(...t)=>{this.shouldLog(Is)&&n.warn(...t)},this.error=(...t)=>{this.shouldLog(xs)&&n.error(...t)},this.level=t}}const _s={interval:3e4,batchSize:2500,enabled:!0};class Os{constructor(t,e,s){this.nodes=t,this.unregisterNode=e,this.start=()=>{this.options.enabled&&(this.stop(),this.interval=setInterval((()=>{!function(t,e,s){const n=t.entries();!function t(){const i=[];let r=n.next();for(;!r.done&&i.length<e;)i.push(r.value),r=n.next();i.length>0&&(i.forEach((([t,e])=>{e&&s(e)})),setTimeout(t,50))}()}(this.nodes,this.options.batchSize,(t=>{const e=function(t){try{if(!t.isConnected)return[!1,"not connected"];const e=t.nodeType===Node.DOCUMENT_NODE,s=e?t.defaultView:t.ownerDocument?.defaultView,n=e?t:t.ownerDocument;return s?s.closed?[!1,"window closed"]:n?.documentElement.isConnected?[!0,"ok"]:[!1,"documentElement not connected"]:[!1,"no window"]}catch(t){return[!1,t]}}(t)[0];e||this.unregisterNode(t)}))}),this.options.interval))},this.stop=()=>{this.interval&&clearInterval(this.interval)},this.options={..._s,...s}}}class Ns{constructor(t){this.nodes=new Map,this.totalNodeAmount=0,this.nodeCallbacks=[],this.elementListeners=new Map,this.nextNodeId=0,this.attachNodeCallback=t=>this.nodeCallbacks.push(t),this.scanTree=t=>{this.nodes.forEach((e=>e?t(e):void 0))},this.attachNodeListener=(t,e,s,n=!0)=>{const i=this.getID(t);if(void 0===i)return;Ct(t,e,s,n,this.forceNgOff);let r=this.elementListeners.get(i);void 0===r&&(r=[],this.elementListeners.set(i,r)),r.push([e,s,n])},this.unregisterNode=t=>{const e=t[this.node_id];if(void 0!==e){t[this.node_id]=void 0,delete t[this.node_id],this.nodes.delete(e);const s=this.elementListeners.get(e);void 0!==s&&(this.elementListeners.delete(e),s.forEach((e=>_t(t,e[0],e[1],e[2],this.forceNgOff)))),this.totalNodeAmount--}return e},this.node_id=t.node_id,this.forceNgOff=t.forceNgOff,this.maintainer=new Os(this.nodes,this.unregisterNode,t.maintainer),this.maintainer.start()}syntheticMode(t){const e=99999999*t;if(e>Number.MAX_SAFE_INTEGER)throw new Error("Placeholder id overflow");this.nextNodeId=e}registerNode(t){let e=t[this.node_id];const s=void 0===e;return s&&(e=this.nextNodeId,this.totalNodeAmount++,this.nextNodeId++,this.nodes.set(e,t),t[this.node_id]=e),[e,s]}cleanTree(){for(const[t,e]of this.nodes)e&&!document.contains(e)&&this.unregisterNode(e)}callNodeCallbacks(t,e){this.nodeCallbacks.forEach((s=>s(t,e)))}getID(t){if(t)return t[this.node_id]}getNode(t){return this.nodes.get(t)}getNodeCount(){return this.totalNodeAmount}clear(){for(const[t,e]of this.nodes)e&&this.unregisterNode(e);this.nextNodeId=0,this.nodes.clear()}}let Rs=99e6;function Ms(t,e,s,i,r,o,a,c,h){const u=c?null:i();c||o(u,e);const l=t.sheet;if(l&&!a)try{const t=p(l);if(t)return void d(t)}catch(t){}function d(t){const e=function(t){const e=[];let s=!1,n=!1,i="",r=0,o="";for(let a=0;a<t.length;a++){const c=t[a],h=t[a+1]||"";n||"/"!==c||"*"!==h?s?"*"===c&&"/"===h&&(s=!1,a++):n||'"'!==c&&"'"!==c?n?(o+=c,c===i&&"\\"!==t[a-1]&&(n=!1)):(o+=c,"{"===c?r++:"}"===c&&(r--,0===r&&(e.push(o.trim()),o=""))):(n=!0,i=c,o+=c):(s=!0,a++)}o.trim()&&e.push(o.trim());return e}(t=t.replace(/\/\*[\s\S]*?\*\//g,""));for(let t=0;t<e.length;t++)r(u,e[t],t,s)}function p(t){try{const e=t.rules||t.cssRules;if(!e)return null;let s=t.href;!s&&t.ownerNode&&t.ownerNode.ownerDocument&&(s=t.ownerNode.ownerDocument.location.href);const n=Array.from(e,(t=>function(t,e){if(function(t){return"styleSheet"in t}(t)){let e;try{e=p(t.styleSheet)||function(t){const{cssText:e}=t;if(e.split('"').length<3)return e;const s=["@import",`url(${JSON.stringify(t.href)})`];""===t.layerName?s.push("layer"):t.layerName&&s.push(`layer(${t.layerName})`);t.supportsText&&s.push(`supports(${t.supportsText})`);t.media.length&&s.push(t.media.mediaText);return s.join(" ")+";"}(t)}catch(s){e=t.cssText}return t.styleSheet.href?f(e,t.styleSheet.href):e}{let s=t.cssText;return function(t){return"selectorText"in t}(t)&&t.selectorText.includes(":")&&(s=function(t){const e=/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm;return t.replace(e,"$1\\$2")}(s)),e?f(s,e):s}}(t,s))).join("");return function(t){t.includes(" background-clip: text;")&&!t.includes(" -webkit-background-clip: text;")&&(t=t.replace(/\sbackground-clip:\s*text;/g," -webkit-background-clip: text; background-clip: text;"));return t}(n)}catch(t){return null}}function f(t,e){if(!t)return"";const s=/^(?:[a-z+]+:)?\/\//i,n=/^www\..*/i,i=/^(data:)([^,]*),(.*)/i;return t.replace(/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,((t,r,o,a,c,h)=>{const u=o||c||h,l=r||a||"";if(!u)return t;if(s.test(u)||n.test(u))return`url(${l}${u}${l})`;if(i.test(u))return`url(${l}${u}${l})`;if("/"===u[0])return`url(${l}${function(t){let e="";e=t.indexOf("//")>-1?t.split("/").slice(0,3).join("/"):t.split("/")[0];return e=e.split("?")[0],e}(e)+u}${l})`;const d=e.split("/"),p=u.split("/");d.pop();for(const t of p)"."!==t&&(".."===t?d.pop():d.push(t));return`url(${l}${d.join("/")}${l})`}))}t.href&&fetch(t.href).then((t=>{if(!t.ok)throw new Error(`response status ${t.status}`);return t.text()})).then((t=>{c&&h?h(t,Rs++):d(t)})).catch((e=>{n.error(`OpenReplay: Failed to fetch CSS from ${t.href}:`,e)}))}function Ds(t){return bs(t)&&!!t.adoptedStyleSheets}let As=15;function js(){return As++}const Ls=new Map;const Fs={},Ps={};function Bs(t){if(function(t){return t.nodeType===Node.COMMENT_NODE}(t))return!0;if(ms(t))return!1;if(!gs(t))return!0;const e=t.tagName.toUpperCase();if("LINK"===e){const e=t.getAttribute("rel"),s=t.getAttribute("as");return!(e?.includes("stylesheet")||"style"===s||"font"===s)}return"SCRIPT"===e||"NOSCRIPT"===e||"META"===e||"TITLE"===e||"BASE"===e}function $s(t){return!!bs(t)||!Bs(t)}var Hs,Us;!function(t){t[t.New=0]="New",t[t.Removed=1]="Removed",t[t.Changed=2]="Changed"}(Hs||(Hs={}));class zs{constructor(t,e=!1,s={}){this.app=t,this.isTopContext=e,this.commited=[],this.recents=new Map,this.indexes=[],this.attributesMap=new Map,this.textSet=new Set,this.disableSprites=!1,this.inlineRemoteCss=!1,this.inlinerOptions=void 0,this.domParser=new DOMParser,this.disableSprites=Boolean(s.disableSprites),this.inlineRemoteCss=Boolean(s.inlineRemoteCss),this.inlinerOptions=s.inlinerOptions,this.observer=Et(this.app.safe((t=>{for(const e of t){const t=e.target,s=e.type;if(!$s(t))continue;if("childList"===s){for(let t=0;t<e.removedNodes.length;t++)$s(e.removedNodes[t])&&this.bindNode(e.removedNodes[t]);for(let t=0;t<e.addedNodes.length;t++)this.bindTree(e.addedNodes[t]);continue}const n=this.app.nodes.getID(t);if(void 0!==n)if(this.recents.has(n)||this.recents.set(n,Hs.Changed),"attributes"!==s)"characterData"!==s||this.textSet.add(n);else{const t=e.attributeName;if(null===t)continue;let s=this.attributesMap.get(n);void 0===s&&this.attributesMap.set(n,s=new Set),s.add(t)}}this.commitNodes()})),this.app.options.forceNgOff)}clear(){this.commited.length=0,this.recents.clear(),this.indexes.length=1,this.attributesMap.clear(),this.textSet.clear()}handleIframeSrcChange(t){const e=t.contentDocument;if(e){if(void 0!==this.app.nodes.getID(e)){const s=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:t=>Bs(t)||void 0===this.app.nodes.getID(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);let n=0;const i=this.app.nodes.getNodeCount(),r=t.contentDocument,o=this.app.nodes.unregisterNode.bind(this.app.nodes);for(;s.nextNode();)r.contains(s.currentNode)||(n+=1,o(s.currentNode));const a=Math.floor(n/i*100);a>30&&this.app.send(Se(a))}}}sendNodeAttribute(t,e,s,i){if(fs(e))return s.startsWith("xlink:")&&(s=s.substring(6)),null===i&&this.app.send($t(t,s)),function(t){return"use"===t.localName}(e)&&"href"===s&&!this.disableSprites?void async function(t,e,s){try{const i=t.getAttribute("xlink:href")||t.getAttribute("href");if(!i)return void n.debug("Openreplay: xlink:href or href not found on <use>.");let r,[o,a]=i.split("#");if(!o&&a){const t=document.querySelector(i);if(t){const e=`\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="${t.getAttribute("viewBox")||"0 0 24 24"}">\n          ${t.innerHTML}\n        </svg>\n      `;return Fs[a]=e,e}return void n.warn("Openreplay: Sprite symbol not found in the document.")}if(!o&&!a)return void n.warn("Openreplay: Invalid xlink:href or href found on <use>.");if(Fs[a])return Fs[a];if(Ps[o])1===Ps[o]?await new Promise((t=>{let e=0;const s=setInterval((()=>{e>100&&(clearInterval(s),t(!1)),1!==Ps[o]?(r=Ps[o],clearInterval(s),t(!0)):e++}),100)})):r=Ps[o]??'<svg xmlns="http://www.w3.org/2000/svg"></svg>';else{Ps[o]=1;const t=await fetch(o),e=await t.text();r=s.parseFromString(e,"image/svg+xml"),Ps[o]=r}const c=r.getElementById(a);if(!c)return n.debug("Openreplay: Symbol not found in SVG."),"";if("svgtext"===e){const t=`\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="${c.getAttribute("viewBox")||"0 0 24 24"}">\n          ${c.innerHTML}\n        </svg>\n      `;return Fs[a]=t,t}n.debug(`Openreplay: Unknown mode: ${e}. Use "inline" or "dataurl".`)}catch(t){n.error("Openreplay: Error processing <use> element:",t)}}(e,"svgtext",this.domParser).then((e=>{e&&this.app.send(Bt(t,s,`_$OPENREPLAY_SPRITE$_${e}`))})).catch((t=>{n.error("Openreplay: Error parsing <use> element:",t)})):void("href"===s?(i.length>1e5&&(i=""),this.app.send(ie(t,s,i,this.app.getBaseHref()))):this.app.attributeSender.sendSetAttribute(t,s,i));if("src"!==s&&"srcset"!==s&&"integrity"!==s&&"crossorigin"!==s&&"autocomplete"!==s&&"on"!==s.substring(0,2)&&("value"!==s||!vs(e,"input")||"button"===e.type||"reset"===e.type||"submit"===e.type))if(null!==i){if("style"===s||"href"===s&&vs(e,"link"))return"rel"in e&&"stylesheet"===e.rel&&this.inlineRemoteCss?void setTimeout((()=>{Ms(e,t,this.app.getBaseHref(),js,((t,e,s,n)=>{this.app.send(le(t,e,s,n))}),((t,e)=>{this.app.send(pe(t,e))}),this.inlinerOptions?.forceFetch,this.inlinerOptions?.forcePlain,((e,s)=>{this.app.send(Lt(s,t,0)),setTimeout((()=>{this.app.send(re(s,e,this.app.getBaseHref()))}),10)}))}),0):void this.app.send(ie(t,s,i,this.app.getBaseHref()));("href"===s||i.length>1e5)&&(i=""),["alt","placeholder"].includes(s)&&this.app.sanitizer.privateMode&&(i=i.replaceAll(/./g,"*")),this.app.attributeSender.sendSetAttribute(t,s,i)}else this.app.send($t(t,s))}sendNodeData(t,e,s){vs(e,"style")?this.app.send(re(t,s,this.app.getBaseHref())):(s=this.app.sanitizer.sanitize(t,s),this.app.send(Ht(t,s)))}bindNode(t){const[e,s]=this.app.nodes.registerNode(t);s?this.recents.set(e,Hs.New):this.recents.get(e)!==Hs.New&&this.recents.set(e,Hs.Removed)}bindTree(t){if(!$s(t))return;this.bindNode(t);const e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:t=>(void 0!==this.app.nodes.getID(t)&&this.app.debug.info("! Node is already bound",t),Bs(t)||void 0!==this.app.nodes.getID(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT)},!1);for(;e.nextNode();)this.bindNode(e.currentNode)}unbindTree(t){const e=this.app.nodes.unregisterNode(t);if(void 0!==e&&this.recents.get(e)===Hs.Removed){this.app.send(Pt(e));const s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT+NodeFilter.SHOW_TEXT,{acceptNode:t=>Bs(t)||void 0===this.app.nodes.getID(t)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT},!1);let n=0;const i=this.app.nodes.getNodeCount();for(;s.nextNode();)n+=1,this.app.nodes.unregisterNode(s.currentNode);const r=Math.floor(n/i*100);r>30&&this.app.send(Se(r))}}_commitNode(t,e){if(bs(e))return!0;const s=e.assignedSlot?e.assignedSlot:e.parentNode;let n;if(!vs(e,"html")||!this.isTopContext){if(null===s)return this.unbindTree(e),!1;if(n=this.app.nodes.getID(s),void 0===n)return this.unbindTree(e),!1;if(!this.commitNode(n))return this.unbindTree(e),!1;if(this.app.sanitizer.handleNode(t,n,e),this.app.sanitizer.isHidden(n))return!1}let i=e.previousSibling;for(;null!==i;){const e=this.app.nodes.getID(i);if(void 0!==e){this.commitNode(e),this.indexes[t]=this.indexes[e]+1;break}i=i.previousSibling}null===i&&(this.indexes[t]=0);const r=this.recents.get(t),o=r===Hs.New,a=this.indexes[t];if(void 0===a)throw"commitNode: missing node index";if(o){if(gs(e)){let s=e;if(void 0!==n){if(this.app.sanitizer.isHidden(t)){const t=s.clientWidth,n=s.clientHeight;s=e.cloneNode(),s.style.width=`${t}px`,s.style.height=`${n}px`}"rel"in s&&"stylesheet"===s.rel&&this.inlineRemoteCss?this.app.send(jt(t,n,a,"STYLE",!1)):this.app.send(jt(t,n,a,s.tagName,fs(e)))}for(let e=0;e<s.attributes.length;e++){const n=s.attributes[e];this.sendNodeAttribute(t,s,n.nodeName,n.value)}}else ms(e)&&(this.app.send(Lt(t,n,a)),this.sendNodeData(t,s,e.data));return!0}r===Hs.Removed&&void 0!==n&&this.app.send(Ft(t,n,a));const c=this.attributesMap.get(t);if(void 0!==c){if(!gs(e))throw"commitNode: node is not an element";for(const s of c)this.sendNodeAttribute(t,e,s,e.getAttribute(s))}if(this.textSet.has(t)){if(!ms(e))throw"commitNode: node is not a text";this.sendNodeData(t,s,e.data)}return!0}commitNode(t){const e=this.app.nodes.getNode(t);if(!e)return!1;const s=this.commited[t];return void 0!==s?s:this.commited[t]=this._commitNode(t,e)}commitNodes(t=!1){let e;for(const[s,n]of this.recents.entries())this.commitNode(s),n===Hs.New&&(e=this.app.nodes.getNode(s))&&this.app.nodes.callNodeCallbacks(e,t);this.clear()}observeRoot(t,e,s=t){this.observer.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1,characterDataOldValue:!1}),this.bindTree(s),e(this.app.nodes.getID(t)),this.commitNodes(!0)}disconnect(){this.observer.disconnect(),this.clear()}}class qs extends zs{observe(t){const e=t.contentDocument,s=this.app.nodes.getID(t);e&&void 0!==s&&this.observeRoot(e,(t=>{void 0!==t?(this.docId=t,this.app.send(he(s,t))):this.app.debug.log("OpenReplay: Iframe document not bound")}))}syntheticObserve(t,e){this.observeRoot(e,(e=>{void 0!==e?this.app.send(he(t,e)):this.app.debug.log("OpenReplay: Iframe document not bound")}))}}class Ws extends zs{observe(t){const e=t.shadowRoot,s=this.app.nodes.getID(t);e&&void 0!==s&&this.observeRoot(e,(t=>{void 0!==t?this.app.send(he(s,t)):this.app.debug.error("OpenReplay: Shadow Root was not bound")}))}}class Ks{constructor(){this.states=new WeakMap}calcOffset(t){let e=0,s=0;if(t.parent&&([e,s]=this.calcOffset(t.parent)),!t.offset){const{left:e,top:s}=t.iFrame.getBoundingClientRect();t.offset=[e,s]}const[n,i]=t.offset;return[e+n,s+i]}getDocumentOffset(t){const e=this.states.get(t);return e?this.calcOffset(e):[0,0]}observe(t){const e=t.contentDocument;if(!e)return;const s=t.ownerDocument,n={offset:null,iFrame:t,parent:this.states.get(s)||null,clear:()=>{s.removeEventListener("scroll",i),s.defaultView?.removeEventListener("resize",i)}},i=()=>{n.offset=null};s.addEventListener("scroll",i),s.defaultView?.addEventListener("resize",i),this.states.set(e,n)}clear(){this.states=new WeakMap}}function Vs(t){switch(t){case Us.Inline:return{inlineRemoteCss:!0,inlinerOptions:{forceFetch:!1,forcePlain:!1}};case Us.InlineFetched:return{inlineRemoteCss:!0,inlinerOptions:{forceFetch:!0,forcePlain:!1}};case Us.PlainFetched:return{inlineRemoteCss:!0,inlinerOptions:{forceFetch:!0,forcePlain:!0}};case Us.Disabled:default:return{inlineRemoteCss:!1,inlinerOptions:{forceFetch:!1,forcePlain:!1}}}}!function(t){t[t.Disabled=0]="Disabled",t[t.Inline=1]="Inline",t[t.InlineFetched=2]="InlineFetched",t[t.PlainFetched=3]="PlainFetched"}(Us||(Us={}));const Xs=ct?Element.prototype.attachShadow:()=>new ShadowRoot;class Js extends zs{constructor(t){const e=Object.assign({captureIFrames:!0,disableSprites:!1,inlineCss:0},t.options),s={disableSprites:e.disableSprites,...Vs(e.inlineCss)};super(t.app,!0,s),this.iframeOffsets=new Ks,this.contextCallbacks=[],this.contextsSet=new WeakSet,this.iframeObserversArr=[],this.iframeObservers=new WeakMap,this.docObservers=new WeakMap,this.shadowRootObservers=new WeakMap,this.app=t.app,this.options=e,this.app.nodes.attachNodeCallback((t=>{vs(t,"iframe")&&(this.options.captureIFrames&&!St(t,"obscured")||St(t,"capture"))&&this.handleIframe(t)})),this.app.nodes.attachNodeCallback((t=>{gs(t)&&null!==t.shadowRoot&&this.handleShadowRoot(t.shadowRoot)}))}attachContextCallback(t){this.contextCallbacks.push(t)}getDocumentOffset(t){return this.iframeOffsets.getDocumentOffset(t)}handleIframe(t){const e=this.app.safe((()=>setTimeout((()=>{const e=this.app.nodes.getID(t);if(void 0===e||!function(t){try{return Boolean(t.contentDocument)}catch(t){return!1}}(t))return;const s=t.contentWindow,n=t.contentDocument;if(!n)return void this.app.debug.warn("no doc for iframe found",t);if(n&&this.docObservers.has(n))return void this.app.debug.info("doc already observed for",e);const i=new qs(this.app,!1,{});this.iframeObservers.set(t,i),this.docObservers.set(n,i),this.iframeObserversArr.push(i),i.observe(t),this.iframeOffsets.observe(t),s&&s===s.window&&!this.contextsSet.has(s)&&(this.contextsSet.add(s),this.contextCallbacks.forEach((t=>t(s))))}),250)));t.addEventListener("load",e),e()}handleShadowRoot(t){const e=new Ws(this.app);this.shadowRootObservers.set(t,e),e.observe(t.host)}observe(){const t=this;Element.prototype.attachShadow=function(){const e=Xs.apply(this,arguments);return t.handleShadowRoot(e),e},this.app.nodes.clear(),this.observeRoot(window.document,(()=>{this.app.send([7]),this.app.nodes.callNodeCallbacks(document,!0)}),window.document.documentElement)}crossdomainObserve(t,e){const s=this;Element.prototype.attachShadow=function(){const t=Xs.apply(this,arguments);return s.handleShadowRoot(t),t},this.app.nodes.clear(),this.app.nodes.syntheticMode(e);const n=new qs(this.app);this.iframeObservers.set(window.document,n),n.syntheticObserve(t,window.document)}disconnect(){this.iframeOffsets.clear(),Element.prototype.attachShadow=Xs,this.iframeObserversArr.forEach((t=>t.disconnect())),this.iframeObserversArr=[],this.iframeObservers=new WeakMap,this.shadowRootObservers=new WeakMap,this.docObservers=new WeakMap,super.disconnect()}}var Gs;!function(t){t[t.Plain=0]="Plain",t[t.Obscured=1]="Obscured",t[t.Hidden=2]="Hidden"}(Gs||(Gs={}));const Ys=t=>t.trim().replace(/[^\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff\s]/g,"*");class Qs{constructor(t){this.obscured=new Set,this.hidden=new Set,this.app=t.app;const e={obscureTextEmails:!0,obscureTextNumbers:!1,privateMode:!1,domSanitizer:void 0};this.privateMode=t.options?.privateMode??!1,this.options=Object.assign(e,t.options)}handleNode(t,e,s){if(this.options.privateMode){if(gs(s)&&!St(s,"unmask"))return this.obscured.add(t);if(ms(s)&&!St(s.parentNode,"unmask"))return this.obscured.add(t)}if((this.obscured.has(e)||gs(s)&&(St(s,"masked")||St(s,"obscured")))&&this.obscured.add(t),(this.hidden.has(e)||gs(s)&&(St(s,"htmlmasked")||St(s,"hidden")))&&this.hidden.add(t),void 0!==this.options.domSanitizer&&gs(s)){const e=this.options.domSanitizer(s);e===Gs.Obscured&&this.obscured.add(t),e===Gs.Hidden&&this.hidden.add(t)}}sanitize(t,e){return this.obscured.has(t)?Ys(e):(this.options.obscureTextNumbers&&(e=e.replace(/\d/g,"0")),this.options.obscureTextEmails&&(e=e.replace(/^\w+([+.-]\w+)*@\w+([.-]\w+)*\.\w{2,3}$/g,(t=>{const[e,s]=t.split("@"),[n,i]=s.split(".");return`${ft(e)}@${ft(n)}.${ft(i)}`}))),e)}isObscured(t){return this.obscured.has(t)}isHidden(t){return this.hidden.has(t)}getInnerTextSecure(t){const e=this.app.nodes.getID(t);return e?this.sanitize(e,t.innerText):""}clear(){this.obscured.clear(),this.hidden.clear()}}class Zs{constructor(t){this.metadata={},this.userID=null,this.callbacks=[],this.timestamp=0,this.getPageNumber=()=>{const t=this.app.sessionStorage.getItem(this.options.session_pageno_key);if(null!=t)return parseInt(t)},this.incPageNo=()=>{let t=this.getPageNumber();return void 0===t?t=0:t++,this.app.sessionStorage.setItem(this.options.session_pageno_key,t.toString()),t},this.app=t.app,this.options=t.options,this.createTabId()}attachUpdateCallback(t){this.callbacks.push(t)}handleUpdate(t){null==t.userID&&delete t.userID,null==t.sessionID&&delete t.sessionID,this.callbacks.forEach((e=>e(t)))}assign(t){void 0!==t.userID&&(this.userID=t.userID),void 0!==t.metadata&&Object.entries(t.metadata).forEach((([t,e])=>this.metadata[t]=e)),void 0!==t.sessionID&&(this.sessionID=t.sessionID),void 0!==t.timestamp&&(this.timestamp=t.timestamp),void 0!==t.projectID&&(this.projectID=t.projectID),this.handleUpdate(t)}setMetadata(t,e){this.metadata[t]=e,this.handleUpdate({metadata:{[t]:e}})}setUserID(t){this.userID=t,this.handleUpdate({userID:t})}setUserInfo(t){this.userInfo=t}getSessionToken(t){const e=this.token||this.app.sessionStorage.getItem(this.options.session_token_key);if(t&&e){const s=e.split("_&_")[1];if(!s||s!==t)return this.app.sessionStorage.removeItem(this.options.session_token_key),void(this.token=void 0)}return e||void 0}setSessionToken(t,e){this.token=t,this.app.sessionStorage.setItem(this.options.session_token_key,`${t}_&_${e}`)}applySessionHash(t){const e=decodeURI(t).split("&");let s=t,n="100500";2==e.length&&([n,s]=e),n&&s&&(this.app.sessionStorage.setItem(this.options.session_token_key,s),this.app.sessionStorage.setItem(this.options.session_pageno_key,n))}getSessionHash(){const t=this.getPageNumber(),e=this.getSessionToken();if(void 0!==t&&void 0!==e)return encodeURI(String(t)+"&"+e)}getTabId(){return this.tabId||this.createTabId(),this.tabId}regenerateTabId(){const t=function(t){const e=new Uint8Array(t/2),s=window.crypto||window.msCrypto;return s?(s.getRandomValues(e),Array.from(e,Tt).join("")):Array.from({length:t},(()=>Tt(Math.floor(16*Math.random())))).join("")}(12);this.app.sessionStorage.setItem(this.options.session_tabid_key,t),this.tabId=t}createTabId(){const t=this.app.sessionStorage.getItem(this.options.session_tabid_key);t?this.tabId=t:this.regenerateTabId()}getInfo(){return{sessionID:this.sessionID,metadata:this.metadata,userID:this.userID,timestamp:this.timestamp,projectID:this.projectID}}reset(){this.app.sessionStorage.removeItem(this.options.session_token_key),this.metadata={},this.userID=null,this.sessionID=void 0,this.timestamp=0}}class tn{constructor(t){this.app=t,this.timer=null,this.callbacks=[]}attach(t,e=0,s=!0,n){n&&(t=t.bind(n)),s&&(t=this.app.safe(t)),this.callbacks.unshift(e?function(t,e){let s=0;return()=>{s++>=e&&(s=0,t())}}(t,e):t)}start(){null===this.timer&&(this.timer=setInterval((()=>this.callbacks.forEach((t=>{t&&t()}))),30))}stop(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)}}const en="canceled",sn="or_uxt_active",nn="or_buffer_1",rn=t=>({reason:t,success:!1}),on=t=>({...t,success:!0});var an;!function(t){t[t.NotActive=0]="NotActive",t[t.Starting=1]="Starting",t[t.Active=2]="Active",t[t.ColdStart=3]="ColdStart"}(an||(an={}));function cn(){const t=-1*(new Date).getTimezoneOffset(),e=t>=0?"+":"-",s=Math.floor(Math.abs(t)/60),n=Math.abs(t)%60;return`UTC${e}${String(s).padStart(2,"0")}:${String(n).padStart(2,"0")}`}const hn=t=>new Promise((e=>setTimeout(e,t))),un="never-gonna-give-you-up",ln="never-gonna-let-you-down",dn="never-gonna-run-around-and-desert-you",pn="tracker inside a child iframe",fn="getting node id for child iframe",gn="batch of messages from an iframe window",mn="signal that parent is live",yn="stop tracker inside frame",bn="start tracker inside frame",vn="hello-how-are-you-im-under-the-water-please-help-me";class wn{constructor(t,e,s,i,r){this.signalError=i,this.insideIframe=r,this.messages=[],this.bufferedMessages1=[],this.bufferedMessages2=[],this.startCallbacks=[],this.stopCallbacks=[],this.commitCallbacks=[],this.activityState=an.NotActive,this.version="16.4.2-beta.3",this.socketMode=!1,this.compressionThreshold=24e3,this.bc=null,this.canvasRecorder=null,this.conditionsManager=null,this.canStart=!1,this.rootId=null,this.pageFrames=[],this.frameOderNumber=0,this.features={"feature-flags":!0,"usability-test":!0},this.emptyBatchCounter=0,this.parentActive=!1,this.checkStatus=()=>this.parentActive,this.parentCrossDomainFrameListener=t=>{const{data:e}=t;if(e&&t.source!==window){if(e.line===bn){if(this.active())return;try{this.allowAppStart(),this.start()}catch(t){n.error("children frame restart failed:",t)}}e.line===mn&&(this.parentActive=!0),e.line===fn&&(this.parentActive=!0,this.rootId=e.id,this.session.setSessionToken(e.token,this.projectKey),this.frameOderNumber=e.frameOrderNumber,this.debug.log("starting iframe tracking",e),this.allowAppStart()),e.line===yn&&this.active()&&this.stop()}},this.trackedFrames=[],this.crossDomainIframeListener=t=>{if(!this.active()||t.source===window)return;const{data:e}=t;if(e){if(e.line===pn){t.source?.postMessage({ping:!0,line:mn},"*");const s=async()=>{if(null===t.source)return n.error("Couldnt connect to event.source for child iframe tracking");const s=await this.checkNodeId(t.source);if(s)try{this.trackedFrames.includes(e.context)?this.debug.log("Trying to observe already added iframe; ignore if its a restart"):this.trackedFrames.push(e.context),await this.waitStarted();const n=this.session.getSessionToken(this.projectKey),i=this.trackedFrames.findIndex((t=>t===e.context))+1;0===i&&this.debug.error("Couldnt get order number for iframe",e.context,this.trackedFrames);const r={line:fn,id:s,token:n,frameOrderNumber:i};this.debug.log("Got child frame signal; nodeId",s,t.source,r),t.source?.postMessage(r,"*")}catch(t){n.error(t)}else this.debug.log("Couldnt get node id for iframe",t.source)};s()}if(e.line===gn){const s=e.messages.map((e=>{if(20===e[0]){let s=e;return this.pageFrames.forEach((n=>{if(n.contentWindow===t.source){const[t,i,r]=e,{left:o,top:a}=n.getBoundingClientRect();s=[t,i+o,r+a]}})),s}if(68===e[0]){let s=e;return this.pageFrames.forEach((n=>{if(n.contentWindow===t.source){const[t,i,r,o,a,c,h]=e,{left:u,top:l,width:d,height:p}=n.getBoundingClientRect(),f=(c/100*d+u)/document.documentElement.scrollWidth,g=(h/100*p+l)/document.documentElement.scrollHeight;s=[t,i,r,o,a,Math.round(1e3*f)/10,Math.round(1e3*g)/10]}})),s}return e}));this.messages.push(...s)}if(e.line===vn){if(!this.pollingQueue.order.length)return;const s=this.pollingQueue.order[0];if(s&&0===this.pollingQueue[s].length)return void(this.pollingQueue.order=this.pollingQueue.order.filter((t=>t!==s)));this.pollingQueue[s].includes(e.context)&&(this.pollingQueue[s]=this.pollingQueue[s].filter((t=>t!==e.context)),t.source?.postMessage({line:s},"*"),0===this.pollingQueue[s].length&&this.pollingQueue.order.shift())}}},this.pollingQueue={order:[]},this.addCommand=t=>{this.pollingQueue.order.push(t),this.pollingQueue[t]=[...this.trackedFrames]},this.bootChildrenFrames=async()=>{await this.waitStarted(),this.addCommand(bn)},this.killChildrenFrames=()=>{this.addCommand(yn)},this.signalIframeTracker=()=>{const t=this.session.getTabId();window.parent.postMessage({line:pn,source:t,context:this.contextId},this.options.crossdomain?.parentDomain??"*");let e=0,s=250,n=0,i=!1;const r=()=>{i||this.checkStatus()?i=!0:(window.parent.postMessage({line:pn,source:t,context:this.contextId},this.options.crossdomain?.parentDomain??"*"),this.debug.info("Trying to signal to parent, attempt:",e+1),e++)};for(let t=0;t<10;t++){if(this.checkStatus()){i=!0;break}n+=s,setTimeout((()=>{r()}),n),s*=1.5}},this.startTimeout=null,this.send=(t,e=!1)=>{this.activityState!==an.NotActive&&(this.activityState===an.ColdStart?(this.bufferedMessages1.push(t),this.singleBuffer||this.bufferedMessages2.push(t),this.conditionsManager?.processMessage(t)):this.messages.push(t),this.activityState===an.Active&&e&&this.commit())},this.coldStartCommitN=0,this.delay=0,this.attachStartCallback=(t,e=!1)=>{e&&(t=this.safe(t)),this.startCallbacks.push(t)},this.attachStopCallback=(t,e=!1)=>{e&&(t=this.safe(t)),this.stopCallbacks.push(t)},this.attachEventListener=(t,e,s,n=!0,i=!0)=>{n&&(s=this.safe(s));this.attachStartCallback((()=>t?Ct(t,e,s,i,this.options.forceNgOff):null),n),this.attachStopCallback((()=>t?_t(t,e,s,i,this.options.forceNgOff):null),n)},this.coldInterval=null,this.orderNumber=0,this.coldStartTs=0,this.singleBuffer=!1,this.onSessionSent=()=>{},this.prevOpts={},this.restartCanvasTracking=()=>{this.canvasRecorder?.restartTracking()},this.flushBuffer=async t=>new Promise(((e,s)=>{if(0===t.length)return void e(null);let n=1;for(;n<t.length&&0!==t[n][0];)n++;Nt((()=>{try{const s=t.splice(0,n);this.postToWorker(s.map((t=>[...t]))),e(null)}catch(t){this._debug("flushBuffer",t),s(new Error("flushBuffer failed"))}}))})),this.onUxtCb=[],this.contextId=Math.random().toString(36).slice(2),this.projectKey=t,this.networkOptions=s.network;const o={revID:"",node_id:"__openreplay_id",session_token_key:"__openreplay_token",session_pageno_key:"__openreplay_pageno",session_reset_key:"__openreplay_reset",session_tabid_key:"__openreplay_tabid",local_uuid_key:"__openreplay_uuid",ingestPoint:"https://api.openreplay.com/ingest",resourceBaseHref:null,__is_snippet:!1,__debug_report_edp:null,__debug__:Es,localStorage:null,sessionStorage:null,forceSingleTab:!1,assistSocketHost:"",captureIFrames:!0,obscureTextEmails:!1,obscureTextNumbers:!1,disableStringDict:!1,crossdomain:{parentDomain:"*"},canvas:{disableCanvas:!1,fixedCanvasScaling:!1,__save_canvas_locally:!1,useAnimationFrame:!1},forceNgOff:!1,inlineCss:0,disableSprites:!1};if(this.options=Rt(o,s),!this.insideIframe&&!this.options.forceSingleTab&&globalThis&&"BroadcastChannel"in globalThis){const t=location.hostname.split(".").slice(-2).join("_");this.bc=new BroadcastChannel(`rick_${t}`)}else this.options.forceSingleTab&&this.allowAppStart();this.revID=this.options.revID,this.localStorage=this.options.localStorage??window.localStorage,this.sessionStorage=this.options.sessionStorage??window.sessionStorage,this.sanitizer=new Qs({app:this,options:s}),this.nodes=new Ns({node_id:this.options.node_id,forceNgOff:Boolean(s.forceNgOff),maintainer:this.options.nodes?.maintainer}),this.observer=new Js({app:this,options:s}),this.ticker=new tn(this),this.ticker.attach((()=>this.commit())),this.debug=new Cs(this.options.__debug__),this.session=new Zs({app:this,options:this.options}),this.attributeSender=new st({app:this,isDictDisabled:Boolean(this.options.disableStringDict||this.options.crossdomain?.enabled)}),this.featureFlags=new ot(this),this.tagWatcher=new De({sessionStorage:this.sessionStorage,errLog:this.debug.error,onTag:t=>this.send(Ee(t))}),this.session.attachUpdateCallback((({userID:t,metadata:e})=>{null!=t&&this.send(Gt(t)),null!=e&&Object.entries(e).forEach((([t,e])=>this.send(Qt(t,e))))})),null!=e&&this.session.applySessionHash(e);const a=this.session.getTabId();this.insideIframe?(window.addEventListener("message",this.parentCrossDomainFrameListener),setInterval((()=>{document.hidden||window.parent.postMessage({line:vn,context:this.contextId},s.crossdomain?.parentDomain??"*")}),250)):(this.initWorker(),window.addEventListener("message",this.crossDomainIframeListener)),null!==this.bc&&(this.bc.postMessage({line:un,source:a,context:this.contextId,projectKey:this.projectKey}),this.startTimeout=setTimeout((()=>{this.allowAppStart()}),250),this.bc.onmessage=t=>{if(t.data.context!==this.contextId&&this.projectKey===t.data.projectKey){if(this.debug.log(t),t.data.line===ln){const e=t.data.token;this.session.setSessionToken(e,this.projectKey),this.allowAppStart()}if(t.data.line===dn){const e=t.data.token;this.session.regenerateTabId(),this.session.setSessionToken(e,this.projectKey),this.allowAppStart()}if(t.data.line===un){const e=this.session.getSessionToken(this.projectKey);e&&this.bc&&this.bc.postMessage({line:t.data.source===a?dn:ln,token:e,source:a,context:this.contextId,projectKey:this.projectKey})}}})}allowAppStart(){this.canStart=!0,this.startTimeout&&(clearTimeout(this.startTimeout),this.startTimeout=null)}async checkNodeId(t){let e;if(this.pageFrames.length>0&&(e=this.pageFrames.find((e=>e.contentWindow===t))),!e||!this.pageFrames.length){const s=Array.from(document.querySelectorAll("iframe"));this.pageFrames=s,e=s.find((e=>e.contentWindow===t))}if(!e)return null;let s=0;for(;s<100;){const t=e[this.options.node_id];if(void 0!==t)return s=100,t;s++,await hn(100)}return null}initWorker(){try{this.worker=new Worker(URL.createObjectURL(new Blob(['!function(){"use strict";class t{constructor(t,s,i,e=10,n=250,h,r){this.onUnauthorised=s,this.onFailure=i,this.MAX_ATTEMPTS_COUNT=e,this.ATTEMPT_TIMEOUT=n,this.onCompress=h,this.pageNo=r,this.attemptsCount=0,this.busy=!1,this.queue=[],this.token=null,this.lastBatchNum=0,this.ingestURL=t+"/v1/web/i",this.isCompressing=void 0!==h}getQueueStatus(){return 0===this.queue.length&&!this.busy}authorise(t){this.token=t,this.busy||this.sendNext()}push(t){if(this.busy||!this.token)this.queue.push(t);else if(this.busy=!0,this.isCompressing&&this.onCompress)this.onCompress(t);else{const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}}sendNext(){const t=this.queue.shift();if(t)if(this.busy=!0,this.isCompressing&&this.onCompress)this.onCompress(t);else{const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}else this.busy=!1}retry(t,s,i){this.attemptsCount>=this.MAX_ATTEMPTS_COUNT?this.onFailure(`Failed to send batch after ${this.attemptsCount} attempts.`):(this.attemptsCount++,setTimeout((()=>this.sendBatch(t,s,i)),this.ATTEMPT_TIMEOUT*this.attemptsCount))}sendBatch(t,s,i){var e;const n=null==i?void 0:i.toString().replace(/^([^_]+)_([^_]+).*/,"$1_$2_$3");this.busy=!0;const h={Authorization:`Bearer ${this.token}`};s&&(h["Content-Encoding"]="gzip"),null!==this.token?fetch(`${this.ingestURL}?batch=${null!==(e=this.pageNo)&&void 0!==e?e:"noPageNum"}_${null!=n?n:"noBatchNum"}`,{body:t,method:"POST",headers:h,keepalive:t.length<65536}).then((e=>{if(401===e.status)return this.busy=!1,void this.onUnauthorised();e.status>=400?this.retry(t,s,`${null!=i?i:"noBatchNum"}_network:${e.status}`):(this.attemptsCount=0,this.sendNext())})).catch((e=>{console.warn("OpenReplay:",e),this.retry(t,s,`${null!=i?i:"noBatchNum"}_reject:${e.message}`)})):setTimeout((()=>{this.sendBatch(t,s,`${null!=i?i:"noBatchNum"}_newToken`)}),500)}sendCompressed(t){const s=++this.lastBatchNum;this.sendBatch(t,!0,s)}sendUncompressed(t){const s=++this.lastBatchNum;this.sendBatch(t,!1,s)}clean(){this.sendNext(),setTimeout((()=>{this.token=null,this.queue.length=0}),10)}}const s="function"==typeof TextEncoder?new TextEncoder:{encode(t){const s=t.length,i=new Uint8Array(3*s);let e=-1;for(let n=0,h=0,r=0;r!==s;){if(n=t.charCodeAt(r),r+=1,n>=55296&&n<=56319){if(r===s){i[e+=1]=239,i[e+=1]=191,i[e+=1]=189;break}if(h=t.charCodeAt(r),!(h>=56320&&h<=57343)){i[e+=1]=239,i[e+=1]=191,i[e+=1]=189;continue}if(n=1024*(n-55296)+h-56320+65536,r+=1,n>65535){i[e+=1]=240|n>>>18,i[e+=1]=128|n>>>12&63,i[e+=1]=128|n>>>6&63,i[e+=1]=128|63&n;continue}}n<=127?i[e+=1]=0|n:n<=2047?(i[e+=1]=192|n>>>6,i[e+=1]=128|63&n):(i[e+=1]=224|n>>>12,i[e+=1]=128|n>>>6&63,i[e+=1]=128|63&n)}return i.subarray(0,e+1)}};class i{constructor(t){this.size=t,this.offset=0,this.checkpointOffset=0,this.data=new Uint8Array(t)}getCurrentOffset(){return this.offset}checkpoint(){this.checkpointOffset=this.offset}get isEmpty(){return 0===this.offset}skip(t){return this.offset+=t,this.offset<=this.size}set(t,s){this.data.set(t,s)}boolean(t){return this.data[this.offset++]=+t,this.offset<=this.size}uint(t){for((t<0||t>Number.MAX_SAFE_INTEGER)&&(t=0);t>=128;)this.data[this.offset++]=t%256|128,t=Math.floor(t/128);return this.data[this.offset++]=t,this.offset<=this.size}int(t){return t=Math.round(t),this.uint(t>=0?2*t:-2*t-1)}string(t){const i=s.encode(t),e=i.byteLength;return!(!this.uint(e)||this.offset+e>this.size)&&(this.data.set(i,this.offset),this.offset+=e,!0)}reset(){this.offset=0,this.checkpointOffset=0}flush(){const t=this.data.slice(0,this.checkpointOffset);return this.reset(),t}}class e extends i{encode(t){switch(t[0]){case 0:case 11:case 114:case 115:return this.uint(t[1]);case 4:case 44:case 47:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3]);case 5:case 20:case 38:case 70:case 75:case 76:case 77:case 82:return this.uint(t[1])&&this.uint(t[2]);case 6:return this.int(t[1])&&this.int(t[2]);case 7:return!0;case 8:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.string(t[4])&&this.boolean(t[5]);case 9:case 10:case 24:case 35:case 51:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3]);case 12:case 52:case 61:case 71:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3]);case 13:case 14:case 17:case 34:case 50:case 54:return this.uint(t[1])&&this.string(t[2]);case 16:return this.uint(t[1])&&this.int(t[2])&&this.int(t[3]);case 18:return this.uint(t[1])&&this.string(t[2])&&this.int(t[3]);case 19:return this.uint(t[1])&&this.boolean(t[2]);case 21:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.string(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8]);case 22:case 27:case 30:case 41:case 45:case 46:case 43:case 63:case 64:case 79:case 124:return this.string(t[1])&&this.string(t[2]);case 23:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 28:case 29:case 42:case 117:case 118:return this.string(t[1]);case 37:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3]);case 39:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.uint(t[7]);case 40:return this.string(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 48:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.int(t[5]);case 49:return this.int(t[1])&&this.int(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 53:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8]);case 55:return this.boolean(t[1]);case 57:case 60:return this.uint(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 58:case 120:return this.int(t[1]);case 59:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.string(t[5])&&this.string(t[6])&&this.string(t[7]);case 67:case 73:return this.uint(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 68:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])&&this.uint(t[6]);case 69:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3])&&this.string(t[4]);case 78:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4]);case 81:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.int(t[4])&&this.string(t[5]);case 83:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.string(t[5])&&this.uint(t[6])&&this.uint(t[7])&&this.uint(t[8])&&this.uint(t[9]);case 84:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.uint(t[4])&&this.string(t[5])&&this.string(t[6]);case 112:return this.uint(t[1])&&this.string(t[2])&&this.boolean(t[3])&&this.string(t[4])&&this.int(t[5])&&this.int(t[6]);case 113:return this.uint(t[1])&&this.uint(t[2])&&this.string(t[3]);case 116:return this.uint(t[1])&&this.uint(t[2])&&this.uint(t[3])&&this.uint(t[4])&&this.uint(t[5])&&this.uint(t[6])&&this.string(t[7])&&this.string(t[8])&&this.uint(t[9])&&this.boolean(t[10]);case 119:return this.string(t[1])&&this.uint(t[2]);case 121:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.uint(t[4]);case 122:return this.string(t[1])&&this.string(t[2])&&this.uint(t[3])&&this.string(t[4]);case 123:return this.string(t[1])&&this.string(t[2])&&this.string(t[3])&&this.string(t[4])&&this.uint(t[5])}}}class n{constructor(t,s,i,n,h,r){this.pageNo=t,this.timestamp=s,this.url=i,this.onBatch=n,this.tabId=h,this.onOfflineEnd=r,this.nextIndex=0,this.beaconSize=2e5,this.encoder=new e(this.beaconSize),this.sizeBuffer=new Uint8Array(3),this.isEmpty=!0,this.checkpoints=[],this.beaconSizeLimit=1e6,this.prepare()}writeType(t){return this.encoder.uint(t[0])}writeFields(t){return this.encoder.encode(t)}writeSizeAt(t,s){for(let s=0;s<3;s++)this.sizeBuffer[s]=t>>8*s;this.encoder.set(this.sizeBuffer,s)}prepare(){if(!this.encoder.isEmpty)return;this.checkpoints.length=0;const t=[81,1,this.pageNo,this.nextIndex,this.timestamp,this.url],s=[0,this.timestamp],i=[118,this.tabId];this.writeType(t),this.writeFields(t),this.writeWithSize(s),this.writeWithSize(i),this.isEmpty=!0}writeWithSize(t){const s=this.encoder;if(!this.writeType(t)||!s.skip(3))return!1;const i=s.getCurrentOffset(),e=this.writeFields(t);if(e){const e=s.getCurrentOffset()-i;if(e>16777215)return console.warn("OpenReplay: max message size overflow."),!1;this.writeSizeAt(e,i-3),s.checkpoint(),this.checkpoints.push(s.getCurrentOffset()),this.isEmpty=this.isEmpty&&0===t[0],this.nextIndex++}return e}setBeaconSizeLimit(t){this.beaconSizeLimit=t}writeMessage(t){if("q_end"===t[0])return this.finaliseBatch(),this.onOfflineEnd();0===t[0]&&(this.timestamp=t[1]),122===t[0]&&(this.url=t[1]),this.writeWithSize(t)||(this.finaliseBatch(),this.writeWithSize(t)||(this.encoder=new e(this.beaconSizeLimit),this.prepare(),this.writeWithSize(t)?this.finaliseBatch():console.warn("OpenReplay: beacon size overflow. Skipping large message.",t,this),this.encoder=new e(this.beaconSize),this.prepare()))}finaliseBatch(t=!1){if(this.isEmpty)return;const s=this.encoder.flush();this.onBatch(s,t),this.prepare()}clean(){this.encoder.reset(),this.checkpoints.length=0}}var h;!function(t){t[t.NotActive=0]="NotActive",t[t.Starting=1]="Starting",t[t.Stopping=2]="Stopping",t[t.Active=3]="Active",t[t.Stopped=4]="Stopped"}(h||(h={}));let r=null,a=null,u=h.NotActive;function o(t){a&&a.finaliseBatch(t)}function c(){return new Promise((t=>{u=h.Stopping,null!==p&&(clearInterval(p),p=null),a&&(a.clean(),a=null),r&&(r.clean(),setTimeout((()=>{r=null}),20)),setTimeout((()=>{u=h.NotActive,t(null)}),100)}))}function g(){[h.Stopped,h.Stopping].includes(u)||(postMessage("a_stop"),c().then((()=>{postMessage("a_start")})))}let l,p=null;self.onmessage=({data:s})=>{if("stop"===s)return o(),void c().then((()=>{u=h.Stopped}));if("forceFlushBatch"!==s)if("closing"!==s){if(!Array.isArray(s)){if("compressed"===s.type){if(!r)return console.debug("OR WebWorker: sender not initialised. Compressed batch."),void g();s.batch&&r.sendCompressed(s.batch)}if("uncompressed"===s.type){if(!r)return console.debug("OR WebWorker: sender not initialised. Uncompressed batch."),void g();s.batch&&r.sendUncompressed(s.batch)}return"start"===s.type?(u=h.Starting,r=new t(s.ingestPoint,(()=>{g()}),(t=>{!function(t){postMessage({type:"failure",reason:t}),c()}(t)}),s.connAttemptCount,s.connAttemptGap,(t=>{postMessage({type:"compress",batch:t},[t.buffer])}),s.pageNo),a=new n(s.pageNo,s.timestamp,s.url,((t,s)=>{r&&(s?r.sendUncompressed(t):r.push(t))}),s.tabId,(()=>postMessage({type:"queue_empty"}))),null===p&&(p=setInterval(o,3e4)),u=h.Active):"auth"===s.type?r?a?(r.authorise(s.token),void(s.beaconSizeLimit&&a.setBeaconSizeLimit(s.beaconSizeLimit))):(console.debug("OR WebWorker: writer not initialised. Received auth."),void g()):(console.debug("OR WebWorker: sender not initialised. Received auth."),void g()):void 0}if(a){const t=a;s.forEach((s=>{55===s[0]&&(s[1]?l=setTimeout((()=>g()),18e5):clearTimeout(l)),t.writeMessage(s)}))}else postMessage("not_init"),g()}else o(!0);else o()}}();\n'],{type:"text/javascript"}))),this.worker.onerror=t=>{this._debug("webworker_error",t)},this.worker.onmessage=({data:t})=>{this.handleWorkerMsg(t)};let t=!1;const e=()=>{t||(t=!0,setTimeout((()=>{t=!1}),500),this.worker&&this.worker.postMessage("closing"))};this.attachEventListener(document.body,"mouseleave",e,!1,!1),this.attachEventListener(window,"pagehide",e,!1,!1),this.attachEventListener(document,"visibilitychange",(t=>"hidden"===document.visibilityState&&e()),!1)}catch(t){this._debug("worker_start",t)}}handleWorkerMsg(t){if("a_stop"===t)this.stop(!1);else if("a_start"===t)this.waitStatus(an.NotActive).then((()=>{this.allowAppStart(),this.start(this.prevOpts,!0).then((t=>{this.debug.info("Worker restart, session too long",t)})).catch((t=>{this.debug.error("Worker restart failed",t)}))}));else if("not_init"===t)this.debug.warn("OR WebWorker: writer not initialised. Restarting tracker");else if("failure"===t.type)this.stop(!1),this.debug.error("worker_failed",t.reason),this._debug("worker_failed",t.reason);else if("compress"===t.type){const e=t.batch;e.byteLength>this.compressionThreshold?Q(t.batch,{mtime:0},((t,s)=>{t?(this.debug.error("Openreplay compression error:",t),this.worker?.postMessage({type:"uncompressed",batch:e})):this.worker?.postMessage({type:"compressed",batch:s})})):this.worker?.postMessage({type:"uncompressed",batch:e})}else"queue_empty"===t.type&&this.onSessionSent()}_debug(t,e){null!==this.options.__debug_report_edp&&fetch(this.options.__debug_report_edp,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({context:t,error:`${e}`})}),this.debug.error("OpenReplay error: ",t,e)}_nCommit(){if(this.socketMode)return this.messages.unshift(Mt(this.timestamp()),Ie(this.session.getTabId())),this.commitCallbacks.forEach((t=>t(this.messages))),void(this.messages.length=0);if(this.insideIframe)return window.parent.postMessage({line:gn,messages:this.messages},this.options.crossdomain?.parentDomain??"*"),this.commitCallbacks.forEach((t=>t(this.messages))),void(this.messages.length=0);if(void 0!==this.worker&&this.messages.length)if(!this.messages.length&&this.emptyBatchCounter<1e3)this.emptyBatchCounter++;else{this.emptyBatchCounter=0;try{Nt((()=>{this.messages.unshift(Mt(this.timestamp()),Ie(this.session.getTabId())),this.worker?.postMessage(this.messages),this.commitCallbacks.forEach((t=>t(this.messages))),this.messages.length=0}))}catch(t){this._debug("worker_commit",t),this.stop(!0),setTimeout((()=>{this.start()}),500)}}}_cStartCommit(){if(this.coldStartCommitN+=1,2===this.coldStartCommitN){const t=[Mt(this.timestamp()),Ie(this.session.getTabId())];this.bufferedMessages1.push(...t),this.bufferedMessages2.push(...t),this.coldStartCommitN=0}}commit(){this.activityState===an.ColdStart?this._cStartCommit():this._nCommit()}postToWorker(t){this.worker?.postMessage(t),this.commitCallbacks.forEach((e=>e(t)))}timestamp(){return pt()+this.delay}safe(t){const e=this;return function(...s){try{t.apply(this,s)}catch(t){e._debug("safe_fn_call",t)}}}attachCommitCallback(t){this.commitCallbacks.push(t)}checkRequiredVersion(t){const e=t.split(/[.-]/),s=this.version.split(/[.-]/);for(let t=0;t<3;t++){if(isNaN(Number(s[t]))||isNaN(Number(e[t])))return!1;if(Number(s[t])>Number(e[t]))return!0;if(Number(s[t])<Number(e[t]))return!1}return!0}getTrackerInfo(){return{userUUID:this.localStorage.getItem(this.options.local_uuid_key),projectKey:this.projectKey,revID:this.revID,trackerVersion:this.version,isSnippet:this.options.__is_snippet}}getSessionInfo(){return{...this.session.getInfo(),...this.getTrackerInfo()}}getSessionToken(){return this.session.getSessionToken(this.projectKey)}getSessionID(){return this.session.getInfo().sessionID||void 0}getSessionURL(t){const{projectID:e,sessionID:s,timestamp:n}=this.session.getInfo();if(!e||!s)return void this.debug.error("OpenReplay error: Unable to build session URL");const i=this.options.ingestPoint,r=(/api\.openreplay\.com/.test(i)?"https://app.openreplay.com/ingest":i).replace(/ingest$/,`${e}/session/${s}`);if(t?.withCurrentTime){return`${r}?jumpto=${pt()-n}`}return r}getHost(){return new URL(this.options.ingestPoint).host}getProjectKey(){return this.projectKey}getBaseHref(){return"string"==typeof this.options.resourceBaseHref?this.options.resourceBaseHref:(this.options.resourceBaseHref,document.baseURI?document.baseURI:document.head?.getElementsByTagName("base")[0]?.getAttribute("href")||location.origin+location.pathname)}resolveResourceURL(t){const e=new URL(this.getBaseHref());return e.pathname+="/"+new URL(t).pathname,e.pathname.replace(/\/+/g,"/"),e.toString()}isServiceURL(t){return t.startsWith(this.options.ingestPoint)}active(){return this.activityState===an.Active}resetNextPageSession(t){t?this.sessionStorage.setItem(this.options.session_reset_key,"t"):this.sessionStorage.removeItem(this.options.session_reset_key)}checkSessionToken(t){const e=null!==this.sessionStorage.getItem(this.options.session_reset_key),s=t||e,n=this.session.getSessionToken(this.projectKey);return s||!n}async coldStart(t={},e){this.singleBuffer=!1;const s=this.checkSessionToken(t.forceNew);e&&await this.setupConditionalStart(t);const n=()=>{this.orderNumber+=1,lt(),this.coldStartTs=pt(),this.orderNumber%2==0?(this.bufferedMessages1.length=0,this.bufferedMessages1.push(Mt(this.timestamp())),this.bufferedMessages1.push(Ie(this.session.getTabId()))):(this.bufferedMessages2.length=0,this.bufferedMessages2.push(Mt(this.timestamp())),this.bufferedMessages2.push(Ie(this.session.getTabId()))),this.stop(!1),this.activityState=an.ColdStart,t.sessionHash&&this.session.applySessionHash(t.sessionHash),t.forceNew&&this.session.reset(),this.session.assign({userID:t.userID,metadata:t.metadata}),s||(this.debug.log("continuing session on new tab",this.session.getTabId()),this.send(Te(this.session.getTabId()))),this.observer.observe(),this.ticker.start()};this.coldInterval=setInterval((()=>{n()}),3e4),n()}async setupConditionalStart(t){this.conditionsManager=new nt(this,t);const e=await fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:pt(),doNotRecord:!0,bufferDiff:0,userID:this.session.getInfo().userID,token:void 0,deviceMemory:Ne,jsHeapSizeLimit:Re,timezone:cn(),width:window.screen.width,height:window.screen.height})}),{token:s,userBrowser:n,userCity:i,userCountry:r,userDevice:o,userOS:a,userState:c,projectID:h,features:u}=await e.json();this.features=u||this.features,this.session.assign({projectID:h}),this.session.setUserInfo({userBrowser:n,userCity:i,userCountry:r,userDevice:o,userOS:a,userState:c});const l={sessionToken:s,userUUID:"",sessionID:""};this.startCallbacks.forEach((t=>t(l))),await(this.conditionsManager?.fetchConditions(h,s)),this.features["feature-flags"]&&(await this.featureFlags.reloadFlags(s),this.conditionsManager?.processFlags(this.featureFlags.flags)),await this.tagWatcher.fetchTags(this.options.ingestPoint,s)}offlineRecording(t={},e){this.onSessionSent=e,this.singleBuffer=!0;const s=this.checkSessionToken(t.forceNew);lt(),this.coldStartTs=pt();const n=this.localStorage.getItem(nn);if(n){const t=JSON.parse(n);this.bufferedMessages1=Array.isArray(t)?t:this.bufferedMessages1,this.localStorage.removeItem(nn)}this.bufferedMessages1.push(Mt(this.timestamp())),this.bufferedMessages1.push(Ie(this.session.getTabId())),this.activityState=an.ColdStart,t.sessionHash&&this.session.applySessionHash(t.sessionHash),t.forceNew&&this.session.reset(),this.session.assign({userID:t.userID,metadata:t.metadata});const i={sessionToken:"",userUUID:"",sessionID:""};return this.startCallbacks.forEach((t=>t(i))),s||this.send(Te(this.session.getTabId())),this.observer.observe(),this.ticker.start(),{saveBuffer:this.saveBuffer,getBuffer:this.getBuffer,setBuffer:this.setBuffer}}saveBuffer(){this.localStorage.setItem(nn,JSON.stringify(this.bufferedMessages1))}getBuffer(){return this.bufferedMessages1}setBuffer(t){this.bufferedMessages1=t}async uploadOfflineRecording(){this.stop(!1);const t=pt();this.worker?.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:this.coldStartTs,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap,tabId:this.session.getTabId()});const e=await fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:t,doNotRecord:!1,bufferDiff:t-this.coldStartTs,userID:this.session.getInfo().userID,token:void 0,deviceMemory:Ne,jsHeapSizeLimit:Re,timezone:cn()})}),{token:s,userBrowser:n,userCity:i,userCountry:r,userDevice:o,userOS:a,userState:c,beaconSizeLimit:h,projectID:u}=await e.json();for(this.worker?.postMessage({type:"auth",token:s,beaconSizeLimit:h}),this.session.assign({projectID:u}),this.session.setUserInfo({userBrowser:n,userCity:i,userCountry:r,userDevice:o,userOS:a,userState:c});this.bufferedMessages1.length>0;)await this.flushBuffer(this.bufferedMessages1);this.postToWorker([["q_end"]]),this.clearBuffers()}async _start(t={},e=!1,s){0!==Object.keys(t).length&&(this.prevOpts=t);const i=this.activityState===an.ColdStart;if(i&&this.coldInterval&&clearInterval(this.coldInterval),!this.worker&&!this.insideIframe){const t="No worker found: perhaps, CSP is not set.";return this.signalError(t,[]),Promise.resolve(rn(t))}if(this.activityState===an.Active||this.activityState===an.Starting){const t="OpenReplay: trying to call `start()` on the instance that has been started already.";return Promise.resolve(rn(t))}this.activityState=an.Starting,i||lt(),t.sessionHash&&this.session.applySessionHash(t.sessionHash),t.forceNew&&this.session.reset(),this.session.assign({userID:t.userID,metadata:t.metadata});const r=pt();this.worker?.postMessage({type:"start",pageNo:this.session.incPageNo(),ingestPoint:this.options.ingestPoint,timestamp:i?this.coldStartTs:r,url:document.URL,connAttemptCount:this.options.connAttemptCount,connAttemptGap:this.options.connAttemptGap,tabId:this.session.getTabId()});const o=this.session.getSessionToken(this.projectKey),a=this.checkSessionToken(t.forceNew);this.sessionStorage.removeItem(this.options.session_reset_key),this.debug.log("OpenReplay: starting session; need new session id?",a,"session token: ",o);try{const e=await window.fetch(this.options.ingestPoint+"/v1/web/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...this.getTrackerInfo(),timestamp:r,doNotRecord:!1,bufferDiff:r-this.coldStartTs,userID:this.session.getInfo().userID,token:a?void 0:o,deviceMemory:Ne,jsHeapSizeLimit:Re,timezone:cn(),condition:s,assistOnly:t.assistOnly??this.socketMode,width:window.screen.width,height:window.screen.height})});if(200!==e.status){const t=await e.text(),s=t===en?en:`Server error: ${e.status}. ${t}`;return rn(s)}if(!this.worker&&!this.insideIframe){const t="no worker found after start request (this should not happen in real world)";return this.signalError(t,[]),rn(t)}const{token:n,userUUID:c,projectID:h,beaconSizeLimit:u,compressionThreshold:l,delay:d,sessionID:p,startTimestamp:f,userBrowser:g,userCity:m,userCountry:y,userDevice:b,userOS:v,userState:w,canvasEnabled:S,canvasQuality:k,canvasFPS:T,assistOnly:I,features:x}=await e.json();if(this.features=x||this.features,"string"!=typeof n||"string"!=typeof c||"number"!=typeof f&&void 0!==f||"string"!=typeof p||"number"!=typeof d||"number"!=typeof u&&void 0!==u){const t=`Incorrect server response: ${JSON.stringify(e)}`;return this.signalError(t,[]),rn(t)}this.delay=d,this.session.setSessionToken(n,this.projectKey),this.session.setUserInfo({userBrowser:g,userCity:m,userCountry:y,userDevice:b,userOS:v,userState:w}),this.session.assign({sessionID:p,timestamp:f||r,projectID:h}),I?(this.socketMode=!0,this.worker?.postMessage("stop")):this.worker?.postMessage({type:"auth",token:n,beaconSizeLimit:u}),a||n!==o||(this.debug.log("continuing session on new tab",this.session.getTabId()),this.send(Te(this.session.getTabId()))),Object.entries(this.session.getInfo().metadata).forEach((([t,e])=>this.send(Qt(t,e)))),this.localStorage.setItem(this.options.local_uuid_key,c),this.compressionThreshold=l;const E={sessionToken:n,userUUID:c,sessionID:p};if(this.startCallbacks.forEach((t=>t(E))),t.startCallback&&t.startCallback(on(E)),this.features["feature-flags"]&&this.featureFlags.reloadFlags(),await this.tagWatcher.fetchTags(this.options.ingestPoint,n),this.activityState=an.Active,this.options.crossdomain?.enabled&&!this.insideIframe&&this.bootChildrenFrames(),S&&!this.options.canvas.disableCanvas&&(this.canvasRecorder=this.canvasRecorder??new ws(this,{fps:T,quality:k,isDebug:this.options.canvas.__save_canvas_locally,fixedScaling:this.options.canvas.fixedCanvasScaling,useAnimationFrame:this.options.canvas.useAnimationFrame})),i){const t=this.bufferedMessages1.length>this.bufferedMessages2.length?this.bufferedMessages1:this.bufferedMessages2;for(;t.length>0;)await this.flushBuffer(t);this.clearBuffers(),this.commit()}else this.insideIframe&&this.rootId?this.observer.crossdomainObserve(this.rootId,this.frameOderNumber):this.observer.observe(),this.ticker.start();if(this.canvasRecorder?.startTracking(),this.features["usability-test"]&&!this.insideIframe){let t;this.uxtManager=this.uxtManager?this.uxtManager:new ds(this,sn);const e=this.localStorage.getItem(sn);if(e&&(t=parseInt(e,10)),location?.search){const e=new URLSearchParams(location.search);if(e.has("oruxt")){const s=e.get("oruxt");t=s?parseInt(s,10):void 0}}t&&(this.uxtManager.isActive?this.onUxtCb.forEach((e=>e(t))):this.uxtManager.getTest(t,n,Boolean(e)).then((t=>{t&&this.onUxtCb.forEach((e=>e(t)))})))}return on(E)}catch(t){if(this.stop(),this.session.reset(),!t)return n.error("Unknown error during start"),this.signalError("Unknown error",[]),rn("Unknown error");if(t===en)return this.signalError(en,[]),rn(en);this._debug("session_start",t);const e=t instanceof Error?t.message:t.toString();return this.signalError(e,[]),rn(e)}}addOnUxtCb(t){this.onUxtCb.push(t)}getUxtId(){return this.uxtManager?.getTestId()}async waitStart(){return new Promise((t=>{const e=setInterval((()=>{this.canStart&&(clearInterval(e),t(!0))}),100)}))}async waitStarted(){return this.waitStatus(an.Active)}async waitStatus(t){return new Promise((e=>{const s=()=>{this.activityState===t?e(!0):setTimeout(s,25)};s()}))}async start(...t){if(this.activityState===an.Active||this.activityState===an.Starting){const t="OpenReplay: trying to call `start()` on the instance that has been started already.";return Promise.resolve(rn(t))}return this.insideIframe&&this.signalIframeTracker(),document.hidden?new Promise((e=>{const s=async()=>{document.hidden||(await this.waitStart(),document.removeEventListener("visibilitychange",s),e(this._start(...t)))};document.addEventListener("visibilitychange",s)})):(await this.waitStart(),this._start(...t))}forceFlushBatch(){this.worker?.postMessage("forceFlushBatch")}getTabId(){return this.session.getTabId()}clearBuffers(){this.bufferedMessages1.length=0,this.bufferedMessages2.length=0}trackWs(t){const e=t;return(t,s,n="down")=>{"string"!=typeof t||"string"!=typeof s||s.length>5242880||t.length>255||this.send(ye("websocket",e,s,this.timestamp(),n,t))}}stop(t=!0){if(this.activityState!==an.NotActive)try{!this.insideIframe&&this.options.crossdomain?.enabled&&this.killChildrenFrames(),this.attributeSender.clear(),this.sanitizer.clear(),this.observer.disconnect(),this.nodes.clear(),this.ticker.stop(),this.stopCallbacks.forEach((t=>t())),this.tagWatcher.clear(),this.worker&&t&&this.worker.postMessage("stop"),this.canvasRecorder?.clear(),this.messages.length=0,this.parentActive=!1}finally{this.activityState=an.NotActive,this.debug.log("OpenReplay tracking stopped.")}}}const Sn=ct&&"InstallTrigger"in window?t=>t.message+"\n"+t.stack:t=>t.stack||t.message;function kn(t){return void 0===t?"undefined":null===t?"null":t instanceof Error?Sn(t):Array.isArray(t)?`Array(${t.length})`:String(t)}function Tn(t){if(void 0===t)return"undefined";if(null===t)return"null";if(t instanceof Error)return Sn(t);if(Array.isArray(t)){return`Array(${t.length})[${t.slice(0,10).map(kn).join(", ")}]`}if("object"==typeof t){const e=[];let s=0;for(const n in t){if(10==++s)break;const i=t[n];e.push(n+": "+kn(i))}return"{"+e.join(", ")+"}"}return t.toString()}function In(t){return"string"==typeof t[0]&&t.unshift(t.shift().replace(/%(o|s|f|d|i)/g,((e,s)=>{const n=t.shift();if(void 0===n)return e;switch(s){case"o":return Tn(n);case"s":return kn(n);case"f":return function(t){return"number"!=typeof t?"NaN":t.toString()}(n);case"d":case"i":return function(t){return"number"!=typeof t?"NaN":Math.floor(t).toString()}(n);default:return e}}))),t.map(Tn).join(" ")}const xn=["log","info","warn","error","debug","assert"];function En(t,e){const s=Object.assign({consoleMethods:xn,consoleThrottling:30},e);if(!Array.isArray(s.consoleMethods)||0===s.consoleMethods.length)return;const n=t.safe(((e,s)=>{let n=In(s);t.sanitizer.privateMode&&(n=n.replaceAll(/./g,"*")),t.send(Kt(e,n))}));let i=0;const r=()=>{i=0};t.attachStartCallback(r),t.ticker.attach(r,33,!1);const o=t.safe((e=>((e,r)=>{const o={apply:function(t,e,o){Reflect.apply(t,r,o),i+=1,i>s.consoleThrottling||n(t.name,o)}};s.consoleMethods.forEach((s=>{if(-1===xn.indexOf(s))return void t.debug.error(`OpenReplay: unsupported console method "${s}"`);const n=r.console[s];e[s]=new Proxy(n,o)}))})(e.console,e)));o(window),t.observer.attachContextCallback(o)}const Cn=/(^|@)\S+:\d+/,_n=/^\s*at .*(\S+:\d+|\(native\))/m,On=/^(eval@)?(\[native code\])?$/;function Nn(t,e){if(void 0!==t.stacktrace||void 0!==t["opera#sourceloc"])return function(t,e){return!t.stacktrace||t.message.includes("\n")&&t.message.split("\n").length>t.stacktrace.split("\n").length?function(t,e){const s=/Line (\d+).*script (?:in )?(\S+)/i,n=t.message.split("\n"),i=[];for(let t=2,e=n.length;t<e;t+=2){const e=s.exec(n[t]);e&&i.push({file:e[2],line:+e[1],raw:n[t]})}return Mn(i)}(t):t.stack?function(t,e){const s=Mn(t.stack.split("\n").filter((t=>!!t.match(Cn)&&!t.match(/^Error created at/))));return s.map((t=>{const e=t.split("@"),s=Rn(e.pop()),n=e.shift()||"",i=n.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^)]*\)/g,"")||void 0;let r;n.match(/\(([^)]*)\)/)&&(r=n.replace(/^[^(]+\(([^)]*)\)$/,"$1"));return{function:i,args:void 0===r||"[arguments not available]"===r?void 0:r.split(","),file:s[0],line:s[1]?+s[1]:void 0,col:s[2]?+s[2]:void 0,raw:t}}))}(t):function(t,e){const s=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,n=t.stacktrace.split("\n"),i=[];for(let t=0,e=n.length;t<e;t+=2){const e=s.exec(n[t]);e&&i.push({function:e[3]||void 0,file:e[2],line:e[1]?+e[1]:void 0,raw:n[t]})}return Mn(i)}(t)}(t);if(t.stack&&t.stack.match(_n))return function(t,e){return s=t.stack,Mn(s.split("\n").filter((t=>!!t.match(_n)))).map((t=>{t.includes("(eval ")&&(t=t.replace(/eval code/g,"eval").replace(/(\(eval at [^()]*)|(,.*$)/g,""));let e=t.replace(/^\s+/,"").replace(/\(eval code/g,"(").replace(/^.*?\s+/,"");const s=e.match(/ (\(.+\)$)/);e=s?e.replace(s[0],""):e;const n=Rn(s?s[1]:e);return{function:s&&e||void 0,file:["eval","<anonymous>"].includes(n[0])?void 0:n[0],line:n[1]?+n[1]:void 0,col:n[2]?+n[2]:void 0,raw:t}}));var s}(t);if(t.stack)return function(t,e){return s=t.stack,Mn(s.split("\n").filter((t=>!t.match(On)))).map((t=>{if(t.includes(" > eval")&&(t=t.replace(/ line (\d+)(?: > eval line \d+)* > eval:\d+:\d+/g,":$1")),t.includes("@")||t.includes(":")){const e=/(([^\n\r"\u2028\u2029]*".[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*(?:@[^\n\r"\u2028\u2029]*"[^\n\r@\u2028\u2029]*)*(?:[\n\r\u2028\u2029][^@]*)?)?[^@]*)@/,s=t.match(e),n=s&&s[1]?s[1]:void 0,i=Rn(t.replace(e,""));return{function:n,file:i[0],line:i[1]?+i[1]:void 0,col:i[2]?+i[2]:void 0,raw:t}}return{function:t}}));var s}(t);throw new Error("Cannot parse given Error object")}function Rn(t){if(!t.includes(":"))return[t,void 0,void 0];const e=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(t.replace(/[()]/g,""));return[e[1],e[2]||void 0,e[3]||void 0]}function Mn(t,e){return t}function Dn(t){return[{columnNumber:t.colno,lineNumber:t.lineno,fileName:t.filename,functionName:"",source:""}]}function An(t,e,s={}){let n=e;try{n=function(t,e){return Nn(t).map((t=>({functionName:t.function,args:t.args,fileName:t.file,lineNumber:t.line,columnNumber:t.col,source:t.raw})))}(t)}catch(t){}return ge(t.name,t.message,JSON.stringify(n),JSON.stringify(s))}function jn(t,e=window,s={}){if(t instanceof ErrorEvent){if(t.error instanceof Error)return An(t.error,Dn(t),s);{let[e,n]=t.message.split(":");return n||(e="Error",n=t.message),ge(e,n,JSON.stringify(Dn(t)),JSON.stringify(s))}}if("PromiseRejectionEvent"in e&&t instanceof e.PromiseRejectionEvent){if(t.reason instanceof Error)return An(t.reason,[],s);{let e;try{e=JSON.stringify(t.reason)}catch(s){e=String(t.reason)}return ge("Unhandled Promise Rejection",e,"[]",JSON.stringify(s))}}return null}function Ln(t,e=document.location){return(t=t.trim()).startsWith("//")||t.startsWith("http://")||t.startsWith("https://")||t.startsWith("data:")?t:t.startsWith("/")?e.origin+t:e.origin+e.pathname+t}function Fn(t){function e(e,s){t.attributeSender.sendSetAttribute(e,"src","https://static.openreplay.com/tracker/placeholder.jpeg");const{width:n,height:i}=s.getBoundingClientRect();s.hasAttribute("width")||t.attributeSender.sendSetAttribute(e,"width",String(n)),s.hasAttribute("height")||t.attributeSender.sendSetAttribute(e,"height",String(i))}const s=function(e,s){const{srcset:n}=s;if(!n)return;const i=n.split(n.match(/,\s+/)?/,\s+/:",").map((t=>Ln(t))).join(", ");t.attributeSender.sendSetAttribute(e,"srcset",i)},n=function(s,n){n.src.length>1e5&&e(s,n),t.send(ie(s,"src",n.src,t.getBaseHref()))},i=t.safe((function(e){const s=Ln(e.src||"");mt(s)&&t.send(ke(t.timestamp(),0,0,0,0,0,s,"img",0,!1))})),r=t.safe((function(r){const o=t.nodes.getID(r);var a;void 0!==o&&(r.complete&&(0!==r.naturalHeight||0!==r.naturalWidth||(a=r.src,ht&&(a.startsWith("data:image/svg+xml")||a.match(/.svg$|/i)))?t.sanitizer.isHidden(o)||t.sanitizer.isObscured(o)?e(o,r):(n(o,r),s(o,r)):i(r)))})),o=Et(t.safe((e=>{for(const i of e)if("attributes"===i.type){const e=i.target,r=t.nodes.getID(e);if(void 0===r)return;"src"===i.attributeName&&n(r,e),"srcset"===i.attributeName&&s(r,e)}})),t.options.forceNgOff);t.attachStopCallback((()=>{o.disconnect()})),t.nodes.attachNodeCallback((e=>{vs(e,"img")&&(t.nodes.attachNodeListener(e,"error",(()=>i(e))),t.nodes.attachNodeListener(e,"load",(()=>r(e))),r(e),o.observe(e,{attributes:!0,attributeFilter:["src","srcset"]}))}))}const Pn=["text","password","email","search","number","range","date","tel","time"];const Bn=ct&&"labels"in HTMLInputElement.prototype?t=>{let e=t;for(;null!==(e=e.parentNode);)if(vs(e,"label"))return e;const s=t.labels;if(null!==s&&1===s.length)return s[0]}:t=>{let e=t;for(;null!==(e=e.parentNode);)if(vs(e,"label"))return e;const s=t.id;if(s){const e=t.ownerDocument.querySelectorAll('label[for="'+s+'"]');if(null!==e&&1===e.length)return e[0]}};function $n(t){let e=wt(t);if(null===e){const s=Bn(t);e=s&&s.innerText||t.placeholder||t.name||t.id||t.className||t.type}return gt(e).slice(0,100)}const Hn=0,Un=1,zn=2;function qn(t,e){const s=Object.assign({obscureInputNumbers:!0,obscureInputEmails:!0,defaultInputMode:Un,obscureInputDates:!1},e);function n(e,n){let i=n.value,r=s.defaultInputMode;"password"===n.type||t.sanitizer.isHidden(e)?r=zn:(t.sanitizer.isObscured(e)||r===Hn&&(s.obscureInputNumbers&&"date"!==n.type&&/\d\d\d\d/.test(i)||s.obscureInputDates&&"date"===n.type||s.obscureInputEmails&&("email"===n.type||~i.indexOf("@"))))&&(r=Un);let o=0;switch(r){case zn:o=-1,i="";break;case Un:o=i.length,i=""}return{value:i,mask:o}}function i(e,s){const{value:i,mask:r}=n(e,s);t.send(zt(e,i,r))}const r=new Map,o=new Map;function a(t,e){r.get(t)!==e.value&&(r.set(t,e.value),i(t,e))}function c(e,s){o.get(e)!==s&&(o.set(e,s),t.send(qt(e,s)))}t.attachStopCallback((()=>{r.clear(),o.clear()})),t.ticker.attach((()=>{r.forEach(((e,s)=>{const n=t.nodes.getNode(s);if(!n)return r.delete(s);a(s,n)})),o.forEach(((e,s)=>{const n=t.nodes.getNode(s);if(!n)return o.delete(s);c(s,n.checked)}))}),3),t.nodes.attachNodeCallback(t.safe((e=>{const s=t.nodes.getID(e);if(void 0!==s){if(vs(e,"select")&&(i(s,e),t.nodes.attachNodeListener(e,"change",(()=>i(s,e)))),function(t){return!!vs(t,"textarea")||!!vs(t,"input")&&Pn.includes(t.type)}(e)){a(s,e);let i=0,r=0,o=0;const c=()=>{i=pt()},h=()=>{0===r&&0!==i&&(r=pt()-i)},u=()=>{0!==i&&(o=pt()-i),function(e,s,i,r){const{value:o,mask:a}=n(e,s);let c=$n(s);t.sanitizer.privateMode&&(c=c.replaceAll(/./g,"*")),t.send(be(e,o,0!==a,c,i,r))}(s,e,r,o),r=0,o=0,i=0};return t.nodes.attachNodeListener(e,"focus",c),t.nodes.attachNodeListener(e,"input",h),void t.nodes.attachNodeListener(e,"change",u)}return function(t){if(!vs(t,"input"))return!1;const e=t.type;return"checkbox"===e||"radio"===e}(e)?(c(s,e.checked),void t.nodes.attachNodeListener(e,"change",(()=>c(s,e.checked)))):void 0}})))}const Wn="undefined"!=typeof CSS&&CSS.escape||(t=>t),Kn=new WeakMap;function Vn(t){return function(t){if(!t||1!==t.nodeType)return!1;if(t.id)return`#${Wn(t.id)}`;const e=[];for(;t&&1===t.nodeType&&t!==t.ownerDocument;){if(t.id){e.unshift(`#${Wn(t.id)}`);break}const s=t.tagName.toLowerCase();if(t.classList?.length)for(const n of t.classList)if(Zn(n)&&Qn(n,t.ownerDocument))return e.unshift(`${s}.${Wn(n)}`),e.join(" > ");const n=ti(t);if(n)e.unshift(`${s}.${Wn(n)}`);else if(t===t.ownerDocument.body||t===t.ownerDocument.documentElement)e.unshift(s);else{let n=1;for(let e=t.previousElementSibling;e;e=e.previousElementSibling)e.tagName.toLowerCase()===s&&n++;e.unshift(`${s}:nth-of-type(${n})`)}t=t.parentNode}return e.join(" > ")}(t)||""}function Xn(t){const e=t.tagName.toUpperCase();return"BUTTON"===e||"A"===e||"LI"===e||"SELECT"===e||"TR"===e||"TH"===e||null!=t.onclick||"button"===t.getAttribute("role")}function Jn(t,e){return t instanceof Element?function(t,e){let s=t;for(;null!==s&&s!==e.documentElement;){if(St(s,"masked"))return null;s=s.parentElement}if(fs(t)){let e=t.ownerSVGElement;for(;null!==e;)t=e,e=e.ownerSVGElement}s=t;for(;null!==s&&s!==e.documentElement;){const t=s.tagName.toUpperCase();if("LABEL"===t)return null;if("INPUT"===t)return s;if(Xn(s)||null!==wt(s))return s;s=s.parentElement}return t===e.documentElement?null:t}(t,e):null}function Gn(t,e){const{disableClickmaps:s=!1}=e||{};let n,i=-1,r=-1,o=!1,a=null,c=0,h={},u=0,l=0,d=0,p=0;t.attachStartCallback((()=>{n=setInterval((()=>function(){const e=p/225;if(!u)return void(u=e);d>4&&(e-u)/225>.008&&t.send(we(pt())),p=0,d=0,u=e}()),225)})),t.attachStopCallback((()=>{i=-1,r=-1,o=!1,a=null,h={},n&&clearInterval(n)}));const f=()=>{o&&(t.send(Wt(i,r)),o=!1)},g=(e,n=!1)=>{const u=n?t.attachEventListener.bind(t):t.nodes.attachNodeListener.bind(t.nodes);u(e.documentElement,"mouseover",(t=>{const s=Jn(t.target,e);s!==a&&(a=s,c=performance.now())})),u(e,"mousemove",(s=>{const[n,a]=t.observer.getDocumentOffset(e);i=s.clientX+n,r=s.clientY+a,o=!0;const c=Math.sign(s.movementX);p+=Math.abs(s.movementX)+Math.abs(s.movementY),c!==l&&(l=c,d++)}),!1),u(e,"click",(n=>{const i=Jn(n.target,e);if(!n.clientX&&!n.clientY||null===i)return;const r=t.nodes.getID(i);if(void 0!==r){const o=n.pageX,u=n.pageY,l=e.documentElement.scrollWidth,d=e.documentElement.scrollHeight,p=Yn(o/l),g=Yn(u/d);f();const m=function(e){const s=wt(e);if(null!==s)return s;if(vs(e,"input"))return $n(e);if(Xn(e)){let s="";return e instanceof HTMLElement&&(s=t.sanitizer.getInnerTextSecure(e)),s=s||e.id||e.className,gt(s).slice(0,100)}return""}(i);t.send(ce(r,a===i?Math.round(performance.now()-c):0,t.sanitizer.privateMode?m.replaceAll(/./g,"*"):m,Xn(i)&&!s?function(t,e){return h[t]=h[t]||Vn(e)}(r,i):"",p,g),!0)}a=null}))};t.nodes.attachNodeCallback((t=>{ys(t)&&g(t)})),g(document,!0),t.ticker.attach(f,e?.trackingOffset||7)}function Yn(t){return Math.round(1e4*t)}function Qn(t,e){let s=Kn.get(e);if(s||(s=Object.create(null),Kn.set(e,s)),t in s)return s[t];const n=1===e.querySelectorAll(`.${Wn(t)}`).length;return s[t]=n,n}function Zn(t){if(/^[a-z\-]{3,}$/i.test(t)){const e=t.split(/-|[A-Z]/);for(const t of e){if(t.length<=2)return!1;if(/[^aeiou]{4,}/i.test(t))return!1}return!0}return!1}function ti(t){if(!t.classList?.length||!t.parentNode)return null;const e=t.parentNode.children;t:for(const s of t.classList)if(Zn(s)&&Qn(s,t.ownerDocument)){for(const n of e)if(n!==t&&n.classList?.contains(s))continue t;return s}return null}var ei,si=-1,ni=function(t){addEventListener("pageshow",(function(e){e.persisted&&(si=e.timeStamp,t(e))}),!0)},ii=function(){var t=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(t&&t.responseStart>0&&t.responseStart<performance.now())return t},ri=function(){var t=ii();return t&&t.activationStart||0},oi=function(t,e){var s=ii(),n="navigate";return si>=0?n="back-forward-cache":s&&(document.prerendering||ri()>0?n="prerender":document.wasDiscarded?n="restore":s.type&&(n=s.type.replace(/_/g,"-"))),{name:t,value:void 0===e?-1:e,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:n}},ai=function(t,e,s){try{if(PerformanceObserver.supportedEntryTypes.includes(t)){var n=new PerformanceObserver((function(t){Promise.resolve().then((function(){e(t.getEntries())}))}));return n.observe(Object.assign({type:t,buffered:!0},s||{})),n}}catch(t){}},ci=function(t,e,s,n){var i,r;return function(o){e.value>=0&&(o||n)&&((r=e.value-(i||0))||void 0===i)&&(i=e.value,e.delta=r,e.rating=function(t,e){return t>e[1]?"poor":t>e[0]?"needs-improvement":"good"}(e.value,s),t(e))}},hi=function(t){requestAnimationFrame((function(){return requestAnimationFrame((function(){return t()}))}))},ui=function(t){document.addEventListener("visibilitychange",(function(){"hidden"===document.visibilityState&&t()}))},li=function(t){var e=!1;return function(){e||(t(),e=!0)}},di=-1,pi=function(){return"hidden"!==document.visibilityState||document.prerendering?1/0:0},fi=function(t){"hidden"===document.visibilityState&&di>-1&&(di="visibilitychange"===t.type?t.timeStamp:0,mi())},gi=function(){addEventListener("visibilitychange",fi,!0),addEventListener("prerenderingchange",fi,!0)},mi=function(){removeEventListener("visibilitychange",fi,!0),removeEventListener("prerenderingchange",fi,!0)},yi=function(){return di<0&&(di=pi(),gi(),ni((function(){setTimeout((function(){di=pi(),gi()}),0)}))),{get firstHiddenTime(){return di}}},bi=function(t){document.prerendering?addEventListener("prerenderingchange",(function(){return t()}),!0):t()},vi=[1800,3e3],wi=[.1,.25],Si=function(t,e){e=e||{},function(t,e){e=e||{},bi((function(){var s,n=yi(),i=oi("FCP"),r=ai("paint",(function(t){t.forEach((function(t){"first-contentful-paint"===t.name&&(r.disconnect(),t.startTime<n.firstHiddenTime&&(i.value=Math.max(t.startTime-ri(),0),i.entries.push(t),s(!0)))}))}));r&&(s=ci(t,i,vi,e.reportAllChanges),ni((function(n){i=oi("FCP"),s=ci(t,i,vi,e.reportAllChanges),hi((function(){i.value=performance.now()-n.timeStamp,s(!0)}))})))}))}(li((function(){var s,n=oi("CLS",0),i=0,r=[],o=function(t){t.forEach((function(t){if(!t.hadRecentInput){var e=r[0],s=r[r.length-1];i&&t.startTime-s.startTime<1e3&&t.startTime-e.startTime<5e3?(i+=t.value,r.push(t)):(i=t.value,r=[t])}})),i>n.value&&(n.value=i,n.entries=r,s())},a=ai("layout-shift",o);a&&(s=ci(t,n,wi,e.reportAllChanges),ui((function(){o(a.takeRecords()),s(!0)})),ni((function(){i=0,n=oi("CLS",0),s=ci(t,n,wi,e.reportAllChanges),hi((function(){return s()}))})),setTimeout(s,0))})))},ki=0,Ti=1/0,Ii=0,xi=function(t){t.forEach((function(t){t.interactionId&&(Ti=Math.min(Ti,t.interactionId),Ii=Math.max(Ii,t.interactionId),ki=Ii?(Ii-Ti)/7+1:0)}))},Ei=function(){return ei?ki:performance.interactionCount||0},Ci=function(){"interactionCount"in performance||ei||(ei=ai("event",xi,{type:"event",buffered:!0,durationThreshold:0}))},_i=[],Oi=new Map,Ni=0,Ri=[],Mi=function(t){if(Ri.forEach((function(e){return e(t)})),t.interactionId||"first-input"===t.entryType){var e=_i[_i.length-1],s=Oi.get(t.interactionId);if(s||_i.length<10||t.duration>e.latency){if(s)t.duration>s.latency?(s.entries=[t],s.latency=t.duration):t.duration===s.latency&&t.startTime===s.entries[0].startTime&&s.entries.push(t);else{var n={id:t.interactionId,latency:t.duration,entries:[t]};Oi.set(n.id,n),_i.push(n)}_i.sort((function(t,e){return e.latency-t.latency})),_i.length>10&&_i.splice(10).forEach((function(t){return Oi.delete(t.id)}))}}},Di=function(t){var e=self.requestIdleCallback||self.setTimeout,s=-1;return t=li(t),"hidden"===document.visibilityState?t():(s=e(t),ui(t)),s},Ai=[200,500],ji=function(t,e){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(e=e||{},bi((function(){var s;Ci();var n,i=oi("INP"),r=function(t){Di((function(){t.forEach(Mi);var e=function(){var t=Math.min(_i.length-1,Math.floor((Ei()-Ni)/50));return _i[t]}();e&&e.latency!==i.value&&(i.value=e.latency,i.entries=e.entries,n())}))},o=ai("event",r,{durationThreshold:null!==(s=e.durationThreshold)&&void 0!==s?s:40});n=ci(t,i,Ai,e.reportAllChanges),o&&(o.observe({type:"first-input",buffered:!0}),ui((function(){r(o.takeRecords()),n(!0)})),ni((function(){Ni=Ei(),_i.length=0,Oi.clear(),i=oi("INP"),n=ci(t,i,Ai,e.reportAllChanges)})))})))},Li=[2500,4e3],Fi={},Pi=[800,1800],Bi=function t(e){document.prerendering?bi((function(){return t(e)})):"complete"!==document.readyState?addEventListener("load",(function(){return t(e)}),!0):setTimeout(e,0)},$i=function(t,e){e=e||{};var s=oi("TTFB"),n=ci(t,s,Pi,e.reportAllChanges);Bi((function(){var i=ii();i&&(s.value=Math.max(i.responseStart-ri(),0),s.entries=[i],n(!0),ni((function(){s=oi("TTFB",0),(n=ci(t,s,Pi,e.reportAllChanges))(!0)})))}))};function Hi(t,e){const s=Object.assign({captureResourceTimings:!0,capturePageLoadTimings:!0,capturePageRenderTimings:!0,excludedResourceUrls:[]},e);if("PerformanceObserver"in window||(s.captureResourceTimings=!1),!s.captureResourceTimings)return;let n={};function i(e){if(e.duration<0||!mt(e.name)||t.isServiceURL(e.name))return;null!==n&&(n[e.name]=e.startTime+e.duration);let i=!1;if(s.excludedResourceUrls?.forEach((t=>{e.name.startsWith(t)&&(i=!0)})),i)return;(0===e.responseEnd||0===e.transferSize&&0===e.decodedBodySize)&&t.send(ke(e.startTime+dt(),0,0,0,0,0,e.name,e.initiatorType,0,!0)),t.send(ke(e.startTime+dt(),e.duration,e.responseStart&&e.startTime?e.responseStart-e.startTime:0,e.transferSize>e.encodedBodySize?e.transferSize-e.encodedBodySize:0,e.encodedBodySize||0,e.decodedBodySize||0,t.sanitizer.privateMode?e.name.replaceAll(/./g,"*"):e.name,e.initiatorType,e.transferSize,e.responseStatus&&304===e.responseStatus||0===e.transferSize))}const r=new PerformanceObserver((t=>t.getEntries().forEach(i)));function o(e){if(t.active())return t.send(_e(e.name,String(e.value)))}let a;t.attachStartCallback((function({sessionID:t}){t!==a&&(performance.getEntriesByType("resource").forEach(i),a=t),r.observe({entryTypes:["resource"]}),Si(o),ji(o),function(t,e){e=e||{},bi((function(){var s,n=yi(),i=oi("LCP"),r=function(t){e.reportAllChanges||(t=t.slice(-1)),t.forEach((function(t){t.startTime<n.firstHiddenTime&&(i.value=Math.max(t.startTime-ri(),0),i.entries=[t],s())}))},o=ai("largest-contentful-paint",r);if(o){s=ci(t,i,Li,e.reportAllChanges);var a=li((function(){Fi[i.id]||(r(o.takeRecords()),o.disconnect(),Fi[i.id]=!0,s(!0))}));["keydown","click"].forEach((function(t){addEventListener(t,(function(){return Di(a)}),{once:!0,capture:!0})})),ui(a),ni((function(n){i=oi("LCP"),s=ci(t,i,Li,e.reportAllChanges),hi((function(){i.value=performance.now()-n.timeStamp,Fi[i.id]=!0,s(!0)}))}))}}))}(o),$i(o)})),t.attachStopCallback((function(){r.disconnect()}));let c=0,h=0;if(s.capturePageLoadTimings){let e=!1;t.ticker.attach((()=>{if(!e&&(0!==c&&0!==h||performance.getEntriesByType("paint").forEach((t=>{const{name:e,startTime:s}=t;switch(e){case"first-paint":c=s;break;case"first-contentful-paint":h=s}})),performance.timing.loadEventEnd||performance.now()>3e4)){e=!0;const{navigationStart:s,requestStart:n,responseStart:i,responseEnd:r,domContentLoadedEventStart:o,domContentLoadedEventEnd:a,loadEventStart:u,loadEventEnd:l}=performance.timing;t.send(Vt(n-s||0,i-s||0,r-s||0,o-s||0,a-s||0,u-s||0,l-s||0,c,h))}}),30)}if(s.capturePageRenderTimings){let e=0,s=0,i=0,r=null,o=!1;t.ticker.attach((()=>{if(o)return;const a=performance.now();if(null!==n&&(e=Math.max.apply(null,Object.keys(n).map((t=>n[t]))),a-e>1e3&&(r=function(t){const e=[],s=document.getElementsByTagName("*"),n=/url\(("[^"]*"|'[^']*'|[^)]*)\)/i;for(let i=0;i<s.length;i++){const r=s[i];let o="";if(vs(r,"img")&&(o=r.currentSrc||r.src),!o){const t=getComputedStyle(r).getPropertyValue("background-image");if(t){const e=n.exec(t);null!==e&&(o=e[1],(o.startsWith('"')||o.startsWith("'"))&&(o=o.substr(1,o.length-2)))}}if(!o)continue;const a="data:image"===o.substr(0,10)?0:t[o];if(void 0===a)continue;const c=r.getBoundingClientRect(),h=Math.max(c.top,0),u=Math.max(c.left,0),l=Math.min(c.bottom,window.innerHeight||document.documentElement&&document.documentElement.clientHeight||0),d=Math.min(c.right,window.innerWidth||document.documentElement&&document.documentElement.clientWidth||0);if(l<=h||d<=u)continue;const p=(l-h)*(d-u);e.push({time:a,area:p})}return e}(n),n=null)),null!==i&&(a-i>50&&(s=a),i=a-s>5e3?null:a),null!==r&&null===i||a>3e4){o=!0,n=null;const a=null===r?0:function(t,e){let s=Math.max(document.documentElement&&document.documentElement.clientWidth||0,window.innerWidth||0)*Math.max(document.documentElement&&document.documentElement.clientHeight||0,window.innerHeight||0)/10,n=s*t;for(let i=0;i<e.length;i++){const{time:r,area:o}=e[i];s+=o,n+=o*(r>t?r:t)}return 0===s?0:n/s}(h||c,r),{domContentLoadedEventEnd:u,navigationStart:l}=performance.timing,d=null===i?Math.max(s,h,u-l||0):0;t.send(Xt(a,h>e?h:e,d))}}))}}function Ui(t){const e=t.defaultView;return[e&&e.scrollX||t.documentElement&&t.documentElement.scrollLeft||t.body&&t.body.scrollLeft||0,e&&e.scrollY||t.documentElement&&t.documentElement.scrollTop||t.body&&t.body.scrollTop||0]}const zi={checkCssInterval:200,scanInMemoryCSS:!1,checkLimit:void 0};function qi(t,e,s,n,i){function r(e){t.debug.log("Openreplay: capturing axios response data",e);const{headers:r,data:o,method:a,url:c,baseURL:h}=e.config,{data:u,headers:l,status:d,response:p}=e,{data:f,headers:g,status:m}=p||{},y=s.ignoreHeaders,b=Array.isArray(y)?t=>y.includes(t):()=>y;function v(t,e){b(e[0])||(t[e[0]]=e[1])}let w={},S={};r.toJSON?w=r.toJSON():r instanceof Headers?r.forEach(((t,e)=>v(w,[e,t]))):Array.isArray(r)?r.forEach((t=>v(w,t))):"object"==typeof r&&Object.entries(r).forEach((t=>v(w,t)));const k=g||l;k.toJSON?S=k.toJSON():k instanceof Headers?k.forEach(((t,e)=>v(S,[e,t]))):Array.isArray(k)?k.forEach((t=>v(S,t))):"object"==typeof k&&Object.entries(k).forEach((([t,e])=>{b(t)||(S[t]=e)}));const T=n({url:c,method:a||"",status:d||m||0,request:{headers:w,body:o},response:{headers:S,body:f||u}});if(!T)return void t.debug.log("Openreplay: empty request/response info, skipping");const I=e.config.__openreplay_timing,x=performance.now()-I;t.debug.log("Openreplay: final req object",T),t.send(me("xhr",String(a),String(T.url),i(T.request),i(T.response),T.status,I+dt(),x,0))}t.debug.log("Openreplay: attaching axios spy to instance",e);const o=e.interceptors.request.use((function(e){if(t.debug.log("Openreplay: capturing API request",e),e.__openreplay_timing=performance.now(),s.sessionTokenHeader){const n="string"==typeof s.sessionTokenHeader?s.sessionTokenHeader:"X-OpenReplay-Session-Token",i=t.getSessionToken();i&&e.headers.set(n,i)}return e}),(function(e){t.debug.log("Openreplay: failed API request, skipping",e)}),{synchronous:!0}),a=e.interceptors.response.use((function(t){return s.failuresOnly||r(t),t}),(function(e){var s,n;return t.debug.log("Openreplay: capturing API request error",e),null!==(n=s=e)&&"object"==typeof n&&!0===s.isAxiosError&&Boolean(e.response)?r(e.response):e instanceof Error&&t.send(An(e,[])),Promise.reject(e)}),{synchronous:!0});t.attachStopCallback((()=>{e.interceptors.request.eject?.(o),e.interceptors.response.eject?.(a)}))}const Wi=new Set(["password","pass","pwd","mdp","token","bearer","jwt","api_key","api-key","apiKey","secret","ssn","zip","zipcode","x-api-key","www-authenticate","x-csrf-token","x-requested-with","x-forwarded-for","x-real-ip","cookie","authorization","auth","proxy-authorization","set-cookie","account_key"]);function Ki(t){if("number"==typeof t){const e=function(t){return 1+(0|Math.log10((t^t>>31)-(t>>31)))}(t);return"9".repeat(e)}return"string"==typeof t?t.replace(/[^\f\n\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff\s]/g,"*"):t}function Vi(t){const e={};if(Array.isArray(t))t.forEach((({name:t,value:s})=>{Wi.has(t.toLowerCase())?e[t]=Ki(s):e[t]=s}));else for(const[s,n]of Object.entries(t))Wi.has(s.toLowerCase())?e[s]=Ki(n):e[s]=n;return e}function Xi(t){if(!t)return t;let e,s=!1;try{e=JSON.parse(t),s=!0}catch(t){}if(s)return Ji(e),JSON.stringify(e);if(!("string"==typeof t&&t.includes("?")&&t.includes("=")))return t;try{const e=new URLSearchParams(t);for(const t of e.keys())if(Wi.has(t.toLowerCase())){const s=Ki(e.get(t));e.set(t,s)}return e.toString()}catch(e){return t}}function Ji(t){if(Array.isArray(t))t.forEach(Ji);else if(t&&"object"==typeof t)for(const e in t)Object.hasOwn(t,e)&&(Wi.has(e.toLowerCase())?t[e]=Ki(t[e]):null!==t[e]&&"object"==typeof t[e]&&Ji(t[e]))}function Gi(t){if(!t)return"";try{const e=new URL(t);if(e.searchParams)for(const t of e.searchParams.keys())Wi.has(t.toLowerCase())&&e.searchParams.set(t,"******");return e.toString()}catch(e){return t}}class Yi{constructor(t=[],e,s){this.ignoredHeaders=t,this.setSessionTokenHeader=e,this.sanitize=s,this.id="",this.name="",this.method="",this.url="",this.status=0,this.statusText="",this.cancelState=0,this.readyState=0,this.header={},this.responseType="",this.requestType="xhr",this.requestHeader={},this.responseSize=0,this.responseSizeText="",this.startTime=0,this.endTime=0,this.duration=0,this.getData={},this.requestData=null}getMessage(){const{reqHs:t,resHs:e}=this.writeHeaders(),s="GET"===this.method?JSON.stringify((Ji(n=this.getData),n)):Xi(this.requestData);var n;const i={headers:Vi(t),body:s},r={headers:Vi(e),body:Xi(this.response)},o=this.sanitize({url:Gi(this.url),method:this.method,status:this.status,request:i,response:r});if(!o)return null;if(o.url.includes("/graphql")&&o.response.body&&"string"==typeof o.response.body){const t=o.response.body.includes("errors");o.status=t?400:200,this.requestType="graphql"}return{requestType:this.requestType,method:o.method,url:o.url,request:JSON.stringify(o.request),response:JSON.stringify(o.response),status:o.status,startTime:this.startTime,duration:this.duration,responseSize:this.responseSize}}writeHeaders(){const t={};Object.entries(this.requestHeader).forEach((([e,s])=>{this.isHeaderIgnored(e)||(t[e]=s)})),this.setSessionTokenHeader(((e,s)=>{t[e]=s}));const e={};return Object.entries(this.header).forEach((([t,s])=>{this.isHeaderIgnored(t)||(e[t]=s)})),{reqHs:t,resHs:e}}isHeaderIgnored(t){return Array.isArray(this.ignoredHeaders)?this.ignoredHeaders.map((t=>t.toLowerCase())).includes(t.toLowerCase()):this.ignoredHeaders}}const Qi=(t,e)=>{let s="";switch(t){case"":case"text":case"json":"string"==typeof e?s=e:tr(e)||Array.isArray(e)?s=JSON.stringify(e):void 0!==e&&(s=Object.prototype.toString.call(e));break;default:void 0!==e&&(s=Object.prototype.toString.call(e))}return s},Zi=t=>{if(!t)return null;let e;try{if("string"==typeof t){"{"!==t[0]&&"["!==t[0]||(e=t);const s=t.split("&");e=1===s.length?t:s.join(",")}else if(function(t){if(null==t)return!1;if(ArrayBuffer.isView(t))return!1;return"undefined"!=typeof Symbol&&"function"==typeof t[Symbol.iterator]}(t)){const s=[];for(const[e,n]of t)s.push(`${e}=${"string"==typeof n?n:"[object Object]"}`);e=s.join(",")}else e=t instanceof Blob||t instanceof ReadableStream||t instanceof ArrayBuffer?"byte data":tr(t)?t:"can't parse body "+typeof t;return e}catch(t){return"can't parse body"}};function tr(t){return null!==t&&"object"==typeof t}function er(t){return t<=0?"":t>=1e6?(t/1e3/1e3).toFixed(1)+" MB":t>=1e3?(t/1e3).toFixed(1)+" KB":`${t}B`}const sr=t=>{if(t.startsWith("//")){t=`${new URL(window.location.href).protocol}${t}`}return t.startsWith("http")?new URL(t):new URL(t,window.location.href)},nr=t=>t instanceof Blob?t.type:t instanceof FormData?"multipart/form-data":t instanceof URLSearchParams?"application/x-www-form-urlencoded;charset=UTF-8":"text/plain;charset=UTF-8";class ir{constructor(t,e,s,n,i){this.ignoredHeaders=t,this.setSessionTokenHeader=e,this.sanitize=s,this.sendMessage=n,this.isServiceUrl=i}apply(t,e,s){const n=s[0],i=s[1],r=new Yi(this.ignoredHeaders,this.setSessionTokenHeader,this.sanitize);if(this.isServiceUrl(n))return t.apply(e,s);const o=sr(n);if(r.method="POST",r.url=n,r.name=(o.pathname.split("/").pop()||"")+o.search,r.requestType="beacon",r.requestHeader={"Content-Type":nr(i)},r.status=0,r.statusText="Pending",o.search&&o.searchParams){r.getData={};for(const[t,e]of o.searchParams)r.getData[t]=e}r.requestData=Zi(i),r.startTime||(r.startTime=performance.now());const a=t.apply(e,s);a?(r.endTime=performance.now(),r.duration=r.endTime-(r.startTime||r.endTime),r.status=0,r.statusText="Sent",r.readyState=4):(r.status=500,r.statusText="Unknown");const c=r.getMessage();return c&&this.sendMessage(c),a}}class rr{static create(t,e,s,n,i,r){if(t)return new Proxy(t,new ir(e,s,n,i,r))}}var or;!function(t){t[t.UNSENT=0]="UNSENT",t[t.OPENED=1]="OPENED",t[t.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",t[t.LOADING=3]="LOADING",t[t.DONE=4]="DONE"}(or||(or={}));class ar{constructor(t,e){this.resp=t,this.item=e,this.mockReader()}set(t,e,s){return Reflect.set(t,e,s)}get(t,e){const s=Reflect.get(t,e);switch(e){case"arrayBuffer":case"blob":case"formData":case"json":case"text":return()=>(this.item.responseType=e.toLowerCase(),s.apply(t).then((t=>(this.item.response=Qi(this.item.responseType,t),t))))}return"function"==typeof s?s.bind(t):s}mockReader(){let t;if(!this.resp.body)return;if("function"!=typeof this.resp.body.getReader)return;const e=this.resp.clone(),s=e.body.getReader;e.body.getReader=()=>{const e=s.apply(this.resp.body);if(this.item.readyState===or.DONE)return e;const n=e.read,i=e.cancel;return this.item.responseType="arraybuffer",e.read=()=>n.apply(e).then((e=>{if(t){const s=new Uint8Array(t.length+e.value.length);s.set(t),s.set(e.value,t.length),t=s}else t=new Uint8Array(e.value);return this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.readyState=e.done?4:3,this.item.statusText=e.done?String(this.item.status):"Loading",this.item.responseSize=t.length,this.item.responseSizeText=er(this.item.responseSize),e.done&&(this.item.response=Qi(this.item.responseType,t)),e})),e.cancel=(...s)=>(this.item.cancelState=2,this.item.statusText="Cancel",this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=Qi(this.item.responseType,t),i.apply(e,s)),e}}}class cr{constructor(t,e,s,n,i,r){this.ignoredHeaders=t,this.setSessionTokenHeader=e,this.sanitize=s,this.sendMessage=n,this.isServiceUrl=i,this.tokenUrlMatcher=r}apply(t,e,s){const n=s[0],i=s[1];if(!n||"string"!=typeof n&&!(null==n?void 0:n.url))return t.apply(window,s);if(n instanceof URL||"string"==typeof n?this.isServiceUrl(String(n)):this.isServiceUrl(String(n.url)))return t.apply(window,s);const r=new Yi(this.ignoredHeaders,this.setSessionTokenHeader,this.sanitize);return this.beforeFetch(r,n,i),this.setSessionTokenHeader(((t,e)=>{if(void 0===this.tokenUrlMatcher||this.tokenUrlMatcher(r.url))return void 0===s[1]&&s[0]instanceof Request?s[0].headers.append(t,e):(s[1]||(s[1]={}),void 0===s[1].headers&&(s[1]=Object.assign(Object.assign({},s[1]),{headers:{}})),void(s[1].headers instanceof Headers?s[1].headers.append(t,e):Array.isArray(s[1].headers)?s[1].headers.push([t,e]):s[1].headers[t]=e))})),t.apply(window,s).then(this.afterFetch(r)).catch((t=>{throw r.endTime=performance.now(),r.duration=r.endTime-(r.startTime||r.endTime),t}))}beforeFetch(t,e,s){let n,i="GET",r={};if("string"==typeof e?(i=(null==s?void 0:s.method)||"GET",n=sr(e),r=(null==s?void 0:s.headers)||{}):(i=e.method||"GET",n=sr(e.url),r=e.headers),t.method=i,t.requestType="fetch",t.requestHeader=r,t.url=n.toString(),t.name=(n.pathname.split("/").pop()||"")+n.search,t.status=0,t.statusText="Pending",t.readyState=1,t.startTime||(t.startTime=performance.now()),"[object Headers]"===Object.prototype.toString.call(r)){t.requestHeader={};for(const[e,s]of r)t.requestHeader[e]=s}else t.requestHeader=r;if(n.search&&n.searchParams){t.getData={};for(const[e,s]of n.searchParams)t.getData[e]=s}(null==s?void 0:s.body)&&(t.requestData=Zi(s.body))}afterFetch(t){return e=>{t.endTime=performance.now(),t.duration=t.endTime-(t.startTime||t.endTime),t.status=e.status,t.statusText=String(e.status);let s=!1;t.header={};for(const[n,i]of e.headers)t.header[n]=i,s=i.toLowerCase().indexOf("chunked")>-1||s;return s?t.readyState=3:(t.readyState=4,this.handleResponseBody(e.clone(),t).then((e=>{t.responseSize="string"==typeof e?e.length:e.byteLength,t.responseSizeText=er(t.responseSize),t.response=Qi(t.responseType,e);const s=t.getMessage();s&&this.sendMessage(s)})).catch((t=>{if("AbortError"!==t.name)throw t}))),new Proxy(e,new ar(e,t))}}handleResponseBody(t,e){const s=t.headers.get("content-type");return s&&s.includes("application/json")?(e.responseType="json",t.text()):s&&(s.includes("text/html")||s.includes("text/plain"))?(e.responseType="text",t.text()):(e.responseType="arraybuffer",t.arrayBuffer())}}class hr{static create(t,e,s,n,i,r){return new Proxy(fetch,new cr(t,e,s,n,i,r))}}class ur{constructor(t,e,s,n,i,r,o){this.ignoredHeaders=e,this.setSessionTokenHeader=s,this.sanitize=n,this.sendMessage=i,this.isServiceUrl=r,this.tokenUrlMatcher=o,this.XMLReq=t,this.XMLReq.onreadystatechange=()=>{this.onReadyStateChange()},this.XMLReq.onabort=()=>{this.onAbort()},this.XMLReq.ontimeout=()=>{this.onTimeout()},this.item=new Yi(e,s,n),this.item.requestType="xhr"}get(t,e){switch(e){case"open":return this.getOpen(t);case"send":return this.setSessionTokenHeader(((e,s)=>{(void 0===this.tokenUrlMatcher||this.tokenUrlMatcher(this.item.url))&&t.setRequestHeader(e,s)})),this.getSend(t);case"setRequestHeader":return this.getSetRequestHeader(t);default:const s=Reflect.get(t,e);return"function"==typeof s?s.bind(t):s}}set(t,e,s){switch(e){case"onreadystatechange":return this.setOnReadyStateChange(t,e,s);case"onabort":return this.setOnAbort(t,e,s);case"ontimeout":return this.setOnTimeout(t,e,s)}return Reflect.set(t,e,s)}onReadyStateChange(){if(!(this.item.url&&this.isServiceUrl(this.item.url)||(this.item.readyState=this.XMLReq.readyState,this.item.responseType=this.XMLReq.responseType,this.item.endTime=performance.now(),this.item.duration=this.item.endTime-this.item.startTime,this.updateItemByReadyState(),setTimeout((()=>{this.item.response=Qi(this.item.responseType,this.item.response)}),0),this.XMLReq.readyState!==or.DONE))){const t=this.item.getMessage();t&&this.sendMessage(t)}}onAbort(){this.item.cancelState=1,this.item.statusText="Abort";const t=this.item.getMessage();t&&this.sendMessage(t)}onTimeout(){this.item.cancelState=3,this.item.statusText="Timeout";const t=this.item.getMessage();t&&this.sendMessage(t)}getOpen(t){const e=Reflect.get(t,"open");return(...s)=>{var n,i,r;const o=s[0],a=s[1];return this.item.method=o?o.toUpperCase():"GET",this.item.url=(null===(n=a.toString)||void 0===n?void 0:n.call(a))||"",this.item.name=null!==(r=null===(i=this.item.url)||void 0===i?void 0:i.replace(new RegExp("/*$"),"").split("/").pop())&&void 0!==r?r:"",this.item.getData=((t,e={})=>{tr(e)||(e={});let s=t?t.split("?"):[];if(s.shift(),s.length>0){s=s.join("?").split("&");for(const t of s){const s=t.split("=");try{e[s[0]]=decodeURIComponent(s[1])}catch(t){e[s[0]]=s[1]}}}return e})(this.item.url,{}),e.apply(t,s)}}getSend(t){const e=Reflect.get(t,"send");return(...s)=>{const n=s[0];return this.item.requestData=Zi(n),e.apply(t,s)}}getSetRequestHeader(t){const e=Reflect.get(t,"setRequestHeader");return(...s)=>(this.item.requestHeader||(this.item.requestHeader={}),this.item.requestHeader[s[0]]=s[1],e.apply(t,s))}setOnReadyStateChange(t,e,s){return Reflect.set(t,e,((...e)=>{this.onReadyStateChange(),null==s||s.apply(t,e)}))}setOnAbort(t,e,s){return Reflect.set(t,e,((...e)=>{this.onAbort(),s.apply(t,e)}))}setOnTimeout(t,e,s){return Reflect.set(t,e,((...e)=>{this.onTimeout(),s.apply(t,e)}))}updateItemByReadyState(){switch(this.XMLReq.readyState){case or.UNSENT:case or.OPENED:this.item.status=or.UNSENT,this.item.statusText="Pending",this.item.startTime||(this.item.startTime=performance.now());break;case or.HEADERS_RECEIVED:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.item.header={};const t=(this.XMLReq.getAllResponseHeaders()||"").split("\n");for(let e=0;e<t.length;e++){const s=t[e];if(!s)continue;const n=s.split(": "),i=n[0];this.item.header[i]=n.slice(1).join(": ")}break;case or.LOADING:this.item.status=this.XMLReq.status,this.item.statusText="Loading",this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=er(this.item.responseSize));break;case or.DONE:this.item.status=this.XMLReq.status||this.item.status||0,this.item.statusText=String(this.item.status),this.item.endTime=performance.now(),this.item.duration=this.item.endTime-(this.item.startTime||this.item.endTime),this.item.response=this.XMLReq.response,this.XMLReq.response&&this.XMLReq.response.length&&(this.item.responseSize=this.XMLReq.response.length,this.item.responseSizeText=er(this.item.responseSize));break;default:this.item.status=this.XMLReq.status,this.item.statusText="Unknown"}}}class lr{static create(t,e,s,n,i,r){return new Proxy(XMLHttpRequest,{construct(o){const a=new o;return new Proxy(a,new ur(a,t,e,s,n,i,r))}})}}const dr=t=>{const e=`Openreplay: Can't find ${t} in global context.`;n.warn(e)};function pr(t){return t.__or_req_data__||(t.__or_req_data__={body:void 0,headers:{}}),t.__or_req_data__}function fr(t){return"string"==typeof t?t.toUpperCase():"GET"}function gr(t,e={}){if(e.disabled)return;const s=Object.assign({failuresOnly:!1,ignoreHeaders:["cookie","set-cookie","authorization"],capturePayload:!1,sessionTokenHeader:!1,captureInIframes:!0,axiosInstances:void 0,useProxy:!0},e);!1===s.useProxy&&t.debug.warn("Network module is migrating to proxy api, to gradually migrate and test it set useProxy to true");const n=s.ignoreHeaders,i=Array.isArray(n)?t=>n.includes(t):()=>n,r=!0===s.sessionTokenHeader?"X-OpenReplay-SessionToken":s.sessionTokenHeader;function o(e){if(r){const s=t.getSessionToken();s&&t.safe(e)(r,s)}}function a(e){if(s.capturePayload&&!t.sanitizer.privateMode||(delete e.request.body,delete e.response.body),s.sanitizer){const t=e.response.body;if("string"==typeof t)try{e.response.body=JSON.parse(t)}catch{}return s.sanitizer(e)}return e}function c(e){if(e&&"string"!=typeof e.body)try{e.body=JSON.stringify(e.body)}catch{e.body="<unable to stringify>",t.notify.warn("Openreplay fetch couldn't stringify body:",e.body)}return JSON.stringify(e)}const h=e=>{if(s.useProxy)return function(t,e,s,n,i,r,o={xhr:!0,fetch:!0,beacon:!0},a){var c;if(t&&(o.xhr&&(t.XMLHttpRequest?t.XMLHttpRequest=lr.create(e,s,n,i,r,a):dr("XMLHttpRequest")),o.fetch&&(t.fetch?t.fetch=hr.create(e,s,n,i,r,a):dr("fetch")),o.beacon&&(null===(c=t.navigator)||void 0===c?void 0:c.sendBeacon))){const o=t.navigator.sendBeacon;t.navigator.sendBeacon=rr.create(o,e,s,n,i,r)}}(e,!!t.sanitizer.privateMode||s.ignoreHeaders,o,a,(e=>{if(s.failuresOnly&&e.status<400)return;const n=t.sanitizer.privateMode?"************":e.url;t.send(me(e.requestType,e.method,n,e.request,e.response,e.status,e.startTime+dt(),e.duration,e.responseSize))}),(e=>t.isServiceURL(e)),{xhr:!0,fetch:!0,beacon:!0},s.tokenUrlMatcher);const r=e.fetch.bind(e);e.fetch=(e,h={})=>{if(!("string"==typeof e||e instanceof URL)||t.isServiceURL(String(e)))return r(e,h);o((function(t,e){void 0===h.headers&&(h.headers={}),h.headers instanceof Headers?h.headers.append(t,e):Array.isArray(h.headers)?h.headers.push([t,e]):h.headers[t]=e}));const u=performance.now();return r(e,h).then((r=>{const o=performance.now()-u;if(s.failuresOnly&&r.status<400)return r;const l=r.clone();return l.text().then((s=>{const r={},d={};if(!0!==n){const t=([t,e])=>{i(t)||(r[t]=e)};h.headers instanceof Headers?h.headers.forEach(((e,s)=>t([s,e]))):Array.isArray(h.headers)?h.headers.forEach(t):"object"==typeof h.headers&&Object.entries(h.headers).forEach(t),l.headers.forEach(((t,e)=>{i(e)||(d[e]=t)}))}const p=fr(h.method),f=a({url:String(e),method:p,status:l.status,request:{headers:r,body:h.body||null},response:{headers:d,body:s}});f&&t.send(me("fetch",p,String(f.url),c(f.request),c(f.response),l.status,u+dt(),o,0))})).catch((e=>t.debug.error("Could not process Fetch response:",e))),r}))};const h=e.XMLHttpRequest.prototype.open,u=e.XMLHttpRequest.prototype.setRequestHeader,l=e.XMLHttpRequest.prototype.send;s.axiosInstances||(e.XMLHttpRequest.prototype.open=function(e,s){const n=this;o(((t,e)=>n.setRequestHeader(t,e)));let r=0;return n.addEventListener("loadstart",(t=>{r=t.timeStamp})),n.addEventListener("load",t.safe((o=>{const{headers:h,body:u}=pr(n),l=r>0?o.timeStamp-r:0,d=(n.getAllResponseHeaders()||"").trim().split(/[\r\n]+/),p={};d.forEach((function(t){const e=t.split(": "),s=e.shift();i(s)||(p[s]=e.join(": "))}));const f=fr(e),g=a({url:String(s),method:f,status:n.status,request:{headers:h,body:u||null},response:{headers:p,body:n.response}});g&&t.send(me("xhr",f,String(g.url),c(g.request),c(g.response),n.status,r+dt(),l,0))}))),h.apply(this,arguments)},e.XMLHttpRequest.prototype.send=function(t){return pr(this).body=t,l.apply(this,arguments)},e.XMLHttpRequest.prototype.setRequestHeader=function(t,e){i(t)||(pr(this).headers[t]=e);return u.apply(this,arguments)})};h(window),s.axiosInstances&&s.axiosInstances.forEach((e=>{qi(t,e,s,a,c)})),s.captureInIframes&&t.observer.attachContextCallback(t.safe(h))}const mr="/en/sdk";class yr{constructor(t){if(this.options=t,this.app=null,this.crossdomainMode=!1,this.checkDoNotTrack=()=>this.options.respectDoNotTrack&&("1"==navigator.doNotTrack||"1"==window.doNotTrack),this.signalStartIssue=(t,e)=>{const s=this.checkDoNotTrack();n.log("Tracker couldn't start due to:",JSON.stringify({trackerVersion:"16.4.2-beta.3",projectKey:this.options.projectKey,doNotTrack:s,reason:e.length?`missing api: ${e.join(",")}`:t}))},this.restartCanvasTracking=()=>{null!==this.app&&this.app.restartCanvasTracking()},this.handleError=(t,e={})=>{if(null!==this.app)if(t instanceof Error){const s=An(t,[],e);this.app.send(s)}else if(t instanceof ErrorEvent||"PromiseRejectionEvent"in window&&t instanceof PromiseRejectionEvent){const s=jn(t,void 0,e);null!=s&&this.app.send(s)}},this.crossdomainMode=Boolean(It()&&t.crossdomain?.enabled),!ct||!function(t){if(null==t)return n.error(`OpenReplay: invalid options argument type. Please, check documentation on ${yt}${mr}`),!1;if("string"!=typeof t.projectKey)if("number"!=typeof t.projectKey){if("number"!=typeof t.projectID)return n.error(`OpenReplay: projectKey is missing or wrong type (string is expected). Please, check ${yt}${mr} for more information.`),!1;t.projectKey=t.projectID.toString(),vt("`projectID` option","`projectKey` option",mr)}else n.warn("OpenReplay: projectKey is expected to have a string type."),t.projectKey=t.projectKey.toString();return null!=t.sessionToken&&vt("`sessionToken` option","`sessionHash` start() option","/"),!0}(t))return;if(window.__OPENREPLAY__||!this.crossdomainMode&&It()&&(()=>{try{return Boolean(window.top?.document)}catch{return!1}})()&&window.top.__OPENREPLAY__)return void n.error("OpenReplay: one tracker instance has been initialised already");if(!t.__DISABLE_SECURE_MODE&&"https:"!==location.protocol)return void n.error("OpenReplay: Your website must be publicly accessible and running on SSL in order for OpenReplay to properly capture and replay the user session. You can disable this check by setting `__DISABLE_SECURE_MODE` option to `true` if you are testing in localhost. Keep in mind, that asset files on a local machine are not available to the outside world. This might affect tracking if you use css files.");const e=[],s=["Map","Set","MutationObserver","performance","timing","startsWith","Blob","Worker"];if(this.checkDoNotTrack())e.push("doNotTrack");else for(const t of s)if("timing"===t){if("performance"in window&&!(t in performance)){e.push(t);break}}else if("startsWith"===t){if(!(t in String.prototype)){e.push(t);break}}else if(!(t in window)){e.push(t);break}if(e.length>0){const t=e.join(",");return n.error(`OpenReplay: browser doesn't support API required for tracking or doNotTrack is set to 1. Reason: ${t}`),void this.signalStartIssue("missing_api",e)}const i=new wn(t.projectKey,t.sessionToken,t,this.signalStartIssue,this.crossdomainMode);this.app=i,this.crossdomainMode||(function(t){let e,s,n,i,r=document.referrer;const o=t.safe((()=>{const{URL:s}=document;if(s!==e){e=s;const n=t.sanitizer.privateMode?Ys(document.title):document.title,o=t.sanitizer.privateMode?Ys(e):e,a=t.sanitizer.privateMode?Ys(r):r;t.send(Ce(o,a,i,n)),i=0,r=e}})),a=t.safe((()=>{const{innerWidth:e,innerHeight:i}=window;e===s&&i===n||(s=e,n=i,t.send(Dt(s,n)))})),c=void 0===document.hidden?Function.prototype:t.safe((()=>t.send(ee(document.hidden))));t.attachStartCallback((()=>{e=null,i=dt(),s=n=-1,o(),a(),c()})),void 0!==document.hidden&&t.attachEventListener(document,"visibilitychange",c,!1,!1),t.ticker.attach(o,1,!1),t.ticker.attach(a,5,!1)}(i),function(t){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(void 0===e)return;const s=()=>t.send(te(Math.round(1e3*e.downlink),e.type||"unknown"));s(),e.addEventListener("change",s)}(i),function(t,e){if(!Object.assign({capturePerformance:!0},e).capturePerformance)return;let s,n;const i=()=>{void 0!==s&&-1!==s&&(s++,requestAnimationFrame(i))};t.ticker.attach((()=>{void 0!==n&&-1!==n&&n++}),0,!1);const r=()=>{void 0!==s&&void 0!==n&&(t.send(Zt(s,n,Oe.memory.totalJSHeapSize||0,Oe.memory.usedJSHeapSize||0)),n=s=document.hidden?-1:0)};t.attachStartCallback((()=>{n=s=-1,r(),i()})),t.attachStopCallback((()=>{n=s=void 0})),t.ticker.attach(r,165,!1),void 0!==document.hidden&&t.attachEventListener(document,"visibilitychange",r,!1,!1)}(i,t),function(t){t.attachEventListener(window,"focus",(function(){document.hidden||(t.debug.log("Openreplay: tab change to"+t.session.getTabId()),t.send(Te(t.session.getTabId())))}),!1,!1)}(i)),Gn(i,t.mouse),function(t,e){let s=!1;const n=new Map;function i(t){ps(t)&&(gs(t)&&n.set(t,[t.scrollLeft,t.scrollTop]),ys(t)&&n.set(t,Ui(t)))}const r=t.safe((()=>{e||t.send(At(...Ui(document)))})),o=t.safe(((e,s)=>{const n=t.nodes.getID(s);void 0!==n&&t.send(Ut(n,e[0],e[1]))}));t.attachStartCallback(r),t.attachStopCallback((()=>{s=!1,n.clear()})),t.nodes.attachNodeCallback(((e,s)=>{s&&(gs(e)&&e.scrollLeft+e.scrollTop>0?n.set(e,[e.scrollLeft,e.scrollTop]):ys(e)&&n.set(e,Ui(e))),bs(e)&&t.nodes.attachNodeListener(e,"scroll",(t=>{i(t.target)}))})),t.attachEventListener(document,"scroll",(t=>{const e=t.target;e!==document?i(e):s=!0})),t.ticker.attach((()=>{s&&(r(),s=!1),n.forEach(o),n.clear()}),5,!1)}(i,this.crossdomainMode),function(t,e){if(null===t)return;if(!window.CSSStyleSheet)return void t.send(oe("no_stylesheet_prototype_in_window",""));const s={...zi,...e},n=new Map;let i=null;const r=new Set,o=s.checkCssInterval||200;let a={};function c(){if(!s.scanInMemoryCSS)return;const e=r.values();for(const i of e)try{const e=Ls.get(i);if(!e)continue;if(s.checkLimit&&(a[e]?a[e]++:a[e]=0,a[e]>s.checkLimit))return void r.delete(i);for(let s=0;s<i.cssRules.length;s++)try{const r=i.cssRules[s],o=`${e}:${s}`,a=n.get(o),c=r.cssText;a!==c&&(void 0!==a?(t.send(de(e,s)),t.send(le(e,c,s,t.getBaseHref()))):t.send(le(e,c,s,t.getBaseHref())),n.set(o,c))}catch(t){}const o=Array.from(n.keys()).filter((t=>t.startsWith(`${e}:`)));for(const t of o)parseInt(t.split(":")[1],10)>=i.cssRules.length&&n.delete(t)}catch(t){r.delete(i)}}const h=/{\s*}/;function u(t){return h.test(t)}const l=t.safe(((e,s,i)=>{const o=Ls.get(e);o&&("string"==typeof i?(t.send(le(o,i,s,t.getBaseHref())),u(i)&&(n.set(`${o}:${s}`,i),r.add(e))):(t.send(de(o,s)),n.has(`${o}:${s}`)&&n.delete(`${o}:${s}`)))})),d=t.safe((e=>{let s=e;for(;s.parentRule;)s=s.parentRule;const i=s.parentStyleSheet;if(!i)return;const o=Ls.get(i);if(!o)return;const a=s.cssText,c=Array.from(i.cssRules).indexOf(s);c>=0&&(t.send(le(o,a,c,t.getBaseHref())),t.send(de(o,c+1)),u(a)&&(n.set(`${o}:${c}`,a),r.add(i)))})),p=t.safe((t=>{if(t.__css_tracking_patched__)return;t.__css_tracking_patched__=!0;const{insertRule:e,deleteRule:s}=t.CSSStyleSheet.prototype,{insertRule:n,deleteRule:i}=t.CSSGroupingRule.prototype;t.CSSStyleSheet.prototype.insertRule=function(t,s=0){const n=e.call(this,t,s);return l(this,n,t),n},t.CSSStyleSheet.prototype.deleteRule=function(t){return l(this,t),s.call(this,t)},t.CSSGroupingRule.prototype.insertRule=function(t,e=0){const s=n.call(this,t,e);return d(this),s},t.CSSGroupingRule.prototype.deleteRule=function(t){const e=i.call(this,t);return d(this),e}}));p(window),t.observer.attachContextCallback(p),t.nodes.attachNodeCallback((e=>{if(!vs(e,"style")||!e.sheet)return;if(null!==e.textContent&&e.textContent.trim().length>0)return;const s=t.nodes.getID(e);if(!s)return;const n=e.sheet,i=js();Ls.set(n,i),t.send(pe(i,s));for(let t=0;t<n.cssRules.length;t++)try{l(n,t,n.cssRules[t].cssText)}catch(t){}})),setTimeout((function(){!i&&s.scanInMemoryCSS&&(i=window.setInterval(c,o))}),50),t.attachStopCallback((()=>{i&&(clearInterval(i),i=null),n.clear()}))}(i,t.css),function(t){if(null===t)return;if(!Ds(document))return;const e=new Map,s=new Map,n=n=>setTimeout((()=>{let i=t.nodes.getID(n);if(n===document&&(i=0),void 0===i)return;let r=s.get(i);r||(r=[]);const o=[],a=n.adoptedStyleSheets;if(a&&Symbol.iterator in a)for(const s of a){let n=e.get(s);const a=!n;if(n||(n=js(),e.set(s,n)),r.includes(n)||t.send(pe(n,i)),a){const e=s.cssRules;for(let s=0;s<e.length;s++)t.send(le(n,e[s].cssText,s,t.getBaseHref()))}o.push(n)}if(Symbol.iterator in r)for(const e of r)o.includes(e)||t.send(fe(e,i));s.set(i,o)}),20);function i(t){const e=Object.getOwnPropertyDescriptor(t,"adoptedStyleSheets");e&&Object.defineProperty(t,"adoptedStyleSheets",{...e,set:function(t){const s=e.set.call(this,t);return n(this),s}})}const r=s=>{if(s.__openreplay_adpss_patched__)return;s.__openreplay_adpss_patched__=!0,i(s.Document.prototype),i(s.ShadowRoot.prototype);const{replace:n,replaceSync:r}=s.CSSStyleSheet.prototype;s.CSSStyleSheet.prototype.replace=function(s){return n.call(this,s).then((n=>{const i=e.get(this);return i&&t.send(ue(i,s,t.getBaseHref())),n}))},s.CSSStyleSheet.prototype.replaceSync=function(s){const n=e.get(this);return n&&t.send(ue(n,s,t.getBaseHref())),r.call(this,s)}};r(window),t.observer.attachContextCallback(t.safe(r)),t.attachStopCallback((()=>{e.clear(),s.clear()})),t.attachStartCallback((()=>{n(document)})),t.nodes.attachNodeCallback((t=>{Ds(t)&&n(t)}))}(i),En(i,t),function(t,e){function s(e){function s(s){const n=jn(s,e);null!=n&&t.send(n)}try{t.attachEventListener(e,"unhandledrejection",s),t.attachEventListener(e,"error",s)}catch(t){n.error("Error while attaching to error proto contexts",t)}}Object.assign({captureExceptions:!0},e).captureExceptions&&(t.observer.attachContextCallback(s),s(window))}(i,t),Fn(i),qn(i,t),Hi(i,t),function(t){function e(e){const s=t.nodes.getID(e);void 0!==s&&t.send(ne(s))}let s=!1;t.nodes.attachNodeCallback((n=>{vs(n,"body")&&(t.nodes.attachNodeListener(n,"focus",(t=>{ps(t.target)&&(e(t.target),s=!1)})),t.nodes.attachNodeListener(n,"blur",(e=>{null===e.relatedTarget&&(s=!0,setTimeout((()=>{s&&t.send(ne(-1))}),0))})))})),t.attachStartCallback((()=>{let t=document.activeElement;for(;t&&vs(t,"iframe")&&t.contentDocument;)t=t.contentDocument.activeElement;t&&t!==t.ownerDocument.body&&e(t)}),!0)}(i),function(t){if(!window.FontFace)return;const e=new Map,s=s=>{class n extends s.FontFace{constructor(...n){if("string"==typeof n[1]){let i="";n[2]&&t.safe((()=>{i=JSON.stringify(n[2])}));const r=[n[0],n[1],i],o=e.get(s.document)||[];o.push(r),e.set(s.document,o);const a=s===window?0:t.nodes.getID(s.document);if(void 0===a)return;t.active()&&t.send(se(a,...r))}super(...n)}}s.FontFace=n};t.observer.attachContextCallback(s),s(window),t.nodes.attachNodeCallback(t.safe((s=>{if(!ys(s))return;const n=e.get(s);if(!n)return;const i=s.defaultView===window?0:t.nodes.getID(s);void 0!==i&&n.forEach((e=>{t.send(se(i,...e))}))})))}(i);const r=t.network?.disabled;r||gr(i,t.network),function(t){t.attachEventListener(document,"selectionchange",(()=>{const e=document.getSelection();if(null===e||e.isCollapsed)t.send(ve(-1,-1,""));else{const s=t.nodes.getID(e.anchorNode),n=t.nodes.getID(e.focusNode),i=e.toString().replace(/\s+/g," ");s&&n&&t.send(ve(s,n,i))}}))}(i),window.__OPENREPLAY__=this,t.flags&&t.flags.onFlagsLoad&&this.onFlagsLoad(t.flags.onFlagsLoad);const o=window.open;(t.autoResetOnWindowOpen||t.resetTabOnWindowOpen)&&(i.attachStartCallback((()=>{const e=i.getTabId(),s=i.sessionStorage??window.sessionStorage;window.open=function(...n){return t.autoResetOnWindowOpen&&i.resetNextPageSession(!0),t.resetTabOnWindowOpen&&s.removeItem(t.session_tabid_key||"__openreplay_tabid"),i.resetNextPageSession(!1),s.setItem(t.session_tabid_key||"__openreplay_tabid",e),o.call(window,...n)}})),i.attachStopCallback((()=>{window.open=o})))}isFlagEnabled(t){return this.featureFlags.isFlagEnabled(t)}onFlagsLoad(t){this.app?.featureFlags.onFlagsLoad(t)}clearPersistFlags(){this.app?.featureFlags.clearPersistFlags()}reloadFlags(){return this.app?.featureFlags.reloadFlags()}getFeatureFlag(t){return this.app?.featureFlags.getFeatureFlag(t)}getAllFeatureFlags(){return this.app?.featureFlags.flags}use(t){return t(this.app,this.options)}isActive(){return null!==this.app&&this.app.active()}trackWs(t){if(null!==this.app)return this.app.trackWs(t)}start(t){return this.browserEnvCheck()?null===this.app?Promise.reject("Browser doesn't support required api, or doNotTrack is active."):this.app.start(t):Promise.reject("Trying to start not in browser.")}browserEnvCheck(){return!!ct||(n.error(`OpenReplay: you are trying to start Tracker on a node.js environment. If you want to use OpenReplay with SSR, please, use componentDidMount or useEffect API for placing the \`tracker.start()\` line. Check documentation on ${yt}${mr}`),!1)}coldStart(t,e){return this.browserEnvCheck()?null===this.app?Promise.reject("Tracker not initialized"):void this.app.coldStart(t,e):Promise.reject("Trying to start not in browser.")}startOfflineRecording(t,e){return this.browserEnvCheck()?null===this.app?Promise.reject("Tracker not initialized"):this.app.offlineRecording(t,e):Promise.reject("Trying to start not in browser.")}uploadOfflineRecording(){if(null!==this.app)return this.app.uploadOfflineRecording()}stop(){if(null!==this.app)return this.app.stop(),this.app.session.getSessionHash()}forceFlushBatch(){null!==this.app&&this.app.forceFlushBatch()}getSessionToken(){return null===this.app?null:this.app.getSessionToken()}getSessionInfo(){return null===this.app?null:this.app.session.getInfo()}getSessionID(){return null===this.app?null:this.app.getSessionID()}getTabId(){return null===this.app?null:this.app.getTabId()}getUxId(){return null===this.app?null:this.app.getUxtId()}sessionID(){return vt("'sessionID' method","'getSessionID' method","/"),this.getSessionID()}getSessionURL(t){if(null!==this.app)return this.app.getSessionURL(t)}setUserID(t){"string"==typeof t&&null!==this.app&&this.app.session.setUserID(t)}userID(t){vt("'userID' method","'setUserID' method","/"),this.setUserID(t)}setUserAnonymousID(t){"string"==typeof t&&null!==this.app&&this.app.send(Yt(t))}userAnonymousID(t){vt("'userAnonymousID' method","'setUserAnonymousID' method","/"),this.setUserAnonymousID(t)}setMetadata(t,e){"string"==typeof t&&"string"==typeof e&&null!==this.app&&this.app.session.setMetadata(t,e)}metadata(t,e){vt("'metadata' method","'setMetadata' method","/"),this.setMetadata(t,e)}event(t,e=null,s=!1){if("string"==typeof t&&null!==this.app){if(s)return this.issue(t,e);try{e=JSON.stringify(e)}catch(t){return}this.app.send(Jt(t,e))}}issue(t,e=null){if("string"==typeof t&&null!==this.app){try{e=JSON.stringify(e)}catch(t){return}this.app.send(ae(t,e))}}}new class{constructor(){this.instance=null,this.isConfigured=!1}configure(t){ct&&(this.isConfigured?n.warn("OpenReplay: Tracker is already configured. You should only call configure once."):t.projectKey?(this.instance=new yr(t),this.isConfigured=!0):n.error("OpenReplay: Missing required projectKey option"))}get options(){return this.instance?.options||null}start(t){return ct?this.ensureConfigured()?this.instance?.start(t)||Promise.resolve({success:!1,reason:"Tracker not initialized"}):Promise.resolve({success:!1,reason:"Tracker not configured"}):Promise.resolve({success:!1,reason:"Not in browser environment"})}stop(){if(ct&&this.ensureConfigured()&&this.instance)return this.instance.stop()}setUserID(t){ct&&this.ensureConfigured()&&this.instance&&this.instance.setUserID(t)}setMetadata(t,e){ct&&this.ensureConfigured()&&this.instance&&this.instance.setMetadata(t,e)}getSessionURL(t){if(ct&&this.ensureConfigured()&&this.instance)return this.instance.getSessionURL(t)}getSessionID(){return ct&&this.ensureConfigured()&&this.instance?this.instance.getSessionID():null}getSessionToken(){return ct&&this.ensureConfigured()&&this.instance?this.instance.getSessionToken():null}event(t,e=null,s=!1){ct&&this.ensureConfigured()&&this.instance&&this.instance.event(t,e,s)}issue(t,e=null){ct&&this.ensureConfigured()&&this.instance&&this.instance.issue(t,e)}handleError(t,e={}){ct&&this.ensureConfigured()&&this.instance&&this.instance.handleError(t,e)}isFlagEnabled(t){return!!(ct&&this.ensureConfigured()&&this.instance)&&this.instance.isFlagEnabled(t)}onFlagsLoad(...t){ct&&this.ensureConfigured()&&this.instance&&this.instance.onFlagsLoad(...t)}clearPersistFlags(){ct&&this.ensureConfigured()&&this.instance&&this.instance.clearPersistFlags()}reloadFlags(){if(ct&&this.ensureConfigured()&&this.instance)return this.instance.reloadFlags()}getFeatureFlag(t){if(ct&&this.ensureConfigured()&&this.instance)return this.instance.getFeatureFlag(t)}getAllFeatureFlags(){if(ct&&this.ensureConfigured()&&this.instance)return this.instance.getAllFeatureFlags()}restartCanvasTracking(){ct&&this.ensureConfigured()&&this.instance&&this.instance.restartCanvasTracking()}setUserAnonymousID(t){ct&&this.ensureConfigured()&&this.instance&&this.instance.setUserAnonymousID(t)}isActive(){return!!(ct&&this.ensureConfigured()&&this.instance)&&this.instance.isActive()}getInstance(){return this.ensureConfigured()&&ct?this.instance:null}coldStart(t,e){if(ct&&this.ensureConfigured()&&this.instance)return this.instance.coldStart(t,e)}trackWs(t){return ct&&this.ensureConfigured()&&this.instance?this.instance.trackWs(t):()=>{}}ensureConfigured(){return!(!this.isConfigured&&ct)||(n.warn('OpenReplay: Tracker must be configured before use. Call tracker.configure({projectKey: "your-project-key"}) first.'),!1)}use(t){return ct&&this.ensureConfigured()&&this.instance?this.instance.use(t):t(null)}startOfflineRecording(...t){if(ct&&this.ensureConfigured()&&this.instance)return this.instance.startOfflineRecording(...t)}uploadOfflineRecording(){if(ct&&this.ensureConfigured()&&this.instance)return this.instance.uploadOfflineRecording()}forceFlushBatch(){if(ct&&this.ensureConfigured()&&this.instance)return this.instance.forceFlushBatch()}getSessionInfo(){return ct&&this.ensureConfigured()&&this.instance?this.instance.getSessionInfo():null}getTabId(){return ct&&this.ensureConfigured()&&this.instance?this.instance.getTabId():null}getUxId(){return ct&&this.ensureConfigured()&&this.instance?this.instance.getUxId():null}}}}]);
//# sourceMappingURL=vendors-4717f4f6-e691b739d0a8e620.bundle.js.map